"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _remoteMessages = _interopRequireDefault(require("./remote-messages"));

var _asyncbox = require("asyncbox");

var _logger = _interopRequireDefault(require("./logger"));

var _lodash = _interopRequireDefault(require("lodash"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _uuidJs = _interopRequireDefault(require("uuid-js"));

var _rpcMessageHandler = _interopRequireDefault(require("./rpc-message-handler"));

var _helpers = require("./helpers");

var _appiumSupport = require("appium-support");

const DATA_LOG_LENGTH = {
  length: 200
};
const WAIT_FOR_TARGET_TIMEOUT = 10000;
const WAIT_FOR_TARGET_INTERVAL = 1000;
const MIN_PLATFORM_FOR_TARGET_BASED = '12.2';

function isTargetBased(isSafari, platformVersion) {
  const isHighVersion = _appiumSupport.util.compareVersions(platformVersion, '>=', MIN_PLATFORM_FOR_TARGET_BASED);

  _logger.default.debug(`Checking which communication style to use (${isSafari ? '' : 'non-'}Safari on platform version '${platformVersion}')`);

  _logger.default.debug(`Platform version equal or higher than '${MIN_PLATFORM_FOR_TARGET_BASED}': ${isHighVersion}`);

  return isSafari && isHighVersion;
}

class RpcClient {
  constructor(opts = {}) {
    this._targets = [];
    this._shouldCheckForTarget = !!opts.shouldCheckForTarget;
    const {
      bundleId,
      platformVersion = {},
      isSafari = true,
      specialMessageHandlers = {},
      logAllCommunication = false,
      logAllCommunicationHexDump = false,
      socketChunkSize
    } = opts;
    this.isSafari = isSafari;
    this.connected = false;
    this.connId = _uuidJs.default.create().toString();
    this.senderId = _uuidJs.default.create().toString();
    this.msgId = 0;
    this.logAllCommunication = logAllCommunication;
    this.logAllCommunicationHexDump = logAllCommunicationHexDump;
    this.socketChunkSize = socketChunkSize;
    this.bundleId = bundleId;
    this.platformVersion = platformVersion;
    this.specialMessageHandlers = specialMessageHandlers;
    this.specialMessageHandlers.targetCreated = this.addTarget.bind(this);
    this.specialMessageHandlers.targetDestroyed = this.removeTarget.bind(this), this.setCommunicationProtocol(isTargetBased(isSafari, this.platformVersion));
  }

  setCommunicationProtocol(isTargetBased = false) {
    _logger.default.warn(`Setting communication protocol: using ${isTargetBased ? 'Target-based' : 'full Web Inspector protocol'} communication`);

    this.isTargetBased = isTargetBased;

    if (!this.remoteMessages) {
      this.remoteMessages = new _remoteMessages.default(isTargetBased);
    } else {
      this.remoteMessages.setCommunicationProtocol(isTargetBased);
    }

    if (!this.messageHandler) {
      this.messageHandler = new _rpcMessageHandler.default(this.specialMessageHandlers, isTargetBased);
    } else {
      this.messageHandler.setCommunicationProtocol(isTargetBased);
    }
  }

  needsTarget() {
    return this.shouldCheckForTarget && this.isTargetBased;
  }

  async waitForTarget(appIdKey, pageIdKey) {
    if (!this.needsTarget()) {
      return;
    }

    if (this.getTarget(appIdKey, pageIdKey)) {
      return;
    }

    try {
      await (0, _asyncbox.waitForCondition)(() => !_lodash.default.isEmpty(this.getTarget(appIdKey, pageIdKey)), {
        waitMs: WAIT_FOR_TARGET_TIMEOUT,
        intervalMs: WAIT_FOR_TARGET_INTERVAL,
        error: 'No targets found, unable to communicate with device'
      });
    } catch (err) {
      if (!err.message.includes('Condition unmet')) {
        throw err;
      }

      throw new Error('No targets found, unable to communicate with device');
    }
  }

  async send(command, opts = {}, waitForResponse = true) {
    const startTime = process.hrtime();
    const {
      appIdKey,
      pageIdKey
    } = opts;

    try {
      if (!_lodash.default.isEmpty(appIdKey) && !_lodash.default.isEmpty(pageIdKey)) {
        await this.waitForTarget(appIdKey, pageIdKey);
      }

      return await this.sendToDevice(command, opts, waitForResponse);
    } catch (err) {
      if (err.message.includes(`'Target' domain was not found`)) {
        this.setCommunicationProtocol(false);
        return await this.sendToDevice(command, opts, waitForResponse);
      } else if (err.message.includes(`domain was not found`) || err.message.includes(`Some arguments of method`)) {
        this.setCommunicationProtocol(true);
        await this.waitForTarget(appIdKey, pageIdKey);
        return await this.sendToDevice(command, opts, waitForResponse);
      }

      throw err;
    } finally {
      _logger.default.debug(`Sending to Web Inspector took ${(0, _helpers.getElapsedTime)(startTime)}ms`);
    }
  }

  async sendToDevice(command, opts = {}, waitForResponse = true) {
    return await new _bluebird.default(async (resolve, reject) => {
      const wrapperMsgId = this.msgId++;
      let msgId = wrapperMsgId;

      if (this.isTargetBased) {
        msgId = this.msgId++;
        this.setDataMessageHandler(wrapperMsgId.toString(), reject, _lodash.default.noop);
      }

      const appIdKey = opts.appIdKey;
      const pageIdKey = opts.pageIdKey;
      const targetId = this.getTarget(appIdKey, pageIdKey);

      const fullOpts = _lodash.default.defaults({
        connId: this.connId,
        senderId: this.senderId,
        targetId,
        id: msgId
      }, opts);

      const cmd = this.remoteMessages.getRemoteCommand(command, fullOpts);

      if (cmd.__argument && cmd.__argument.WIRSocketDataKey) {
        if (_lodash.default.isNil(cmd.__argument.WIRSocketDataKey.id)) {
          cmd.__argument.WIRSocketDataKey.id = wrapperMsgId;
        }

        cmd.__argument.WIRSocketDataKey = Buffer.from(JSON.stringify(cmd.__argument.WIRSocketDataKey));
      }

      let messageHandled = true;

      if (!waitForResponse) {
        messageHandled = false;
        this.setDataMessageHandler(msgId.toString(), reject, _lodash.default.noop);
      } else if (this.messageHandler.hasSpecialMessageHandler(cmd.__selector)) {
        const specialMessageHandler = this.getSpecialMessageHandler(cmd.__selector);
        this.setSpecialMessageHandler(cmd.__selector, reject, (...args) => {
          _logger.default.debug(`Received response from send (id: ${msgId}): '${_lodash.default.truncate(JSON.stringify(args), DATA_LOG_LENGTH)}'`);

          specialMessageHandler(...args);

          if (this.messageHandler.hasSpecialMessageHandler(cmd.__selector)) {
            this.setSpecialMessageHandler(cmd.__selector, null, specialMessageHandler);
          }

          resolve(args);
        });
      } else if (cmd.__argument && cmd.__argument.WIRSocketDataKey) {
        const errorHandler = function (err) {
          const msg = `Remote debugger error with code '${err.code}': ${err.message}`;
          reject(new Error(msg));
        };

        this.setDataMessageHandler(msgId.toString(), errorHandler, value => {
          _logger.default.debug(`Received data response from send (id: ${msgId}): '${_lodash.default.truncate(JSON.stringify(value), DATA_LOG_LENGTH)}'`);

          resolve(value);
        });
      } else {
        messageHandled = false;
      }

      const msg = `Sending '${cmd.__selector}' message` + (fullOpts.appIdKey ? ` to app '${fullOpts.appIdKey}'` : '') + (fullOpts.pageIdKey ? `, page '${fullOpts.pageIdKey}'` : '') + (this.needsTarget() ? `, target '${targetId}'` : '') + ` (id: ${msgId})`;

      _logger.default.debug(msg);

      try {
        const res = await this.sendMessage(cmd);

        if (!messageHandled) {
          resolve(res);
        }
      } catch (err) {
        return reject(err);
      }
    });
  }

  async sendMessage() {
    throw new Error(`Sub-classes need to implement a 'sendMessage' function`);
  }

  addTarget(app, targetInfo) {
    if (_lodash.default.isUndefined(targetInfo) || _lodash.default.isUndefined(targetInfo.targetId)) {
      _logger.default.warn(`Received 'targetCreated' event with no target. Skipping`);

      return;
    }

    if (_lodash.default.isEmpty(this.pendingTargetNotification)) {
      _logger.default.warn(`Received 'targetCreated' event with no pending request: ${JSON.stringify(targetInfo)}`);

      return;
    }

    const [appIdKey, pageIdKey] = this.pendingTargetNotification;

    if (_lodash.default.has(targetInfo, 'type')) {
      this.pendingTargetNotification = null;
    }

    _logger.default.debug(`Target created for app '${appIdKey}' and page '${pageIdKey}': ${JSON.stringify(targetInfo)}`);

    if (_lodash.default.has(this.targets[appIdKey], pageIdKey)) {
      _logger.default.debug(`There is already a target for this app and page ('${this.targets[appIdKey][pageIdKey]}'). This might cause problems`);
    }

    this.targets[appIdKey] = this.targets[appIdKey] || {};
    this.targets[appIdKey][pageIdKey] = targetInfo.targetId;
  }

  removeTarget(app, targetInfo) {
    if (_lodash.default.isUndefined(targetInfo) || _lodash.default.isUndefined(targetInfo.targetId)) {
      _logger.default.debug(`Received 'targetDestroyed' event with no target. Skipping`);

      return;
    }

    _logger.default.debug(`Target destroyed: ${JSON.stringify(targetInfo)}`);

    _lodash.default.pull(this.targets, targetInfo.targetId);
  }

  get targets() {
    this._targets = this._targets || {};
    return this._targets;
  }

  getTarget(appIdKey, pageIdKey) {
    return (this.targets[appIdKey] || {})[pageIdKey];
  }

  get shouldCheckForTarget() {
    return this._shouldCheckForTarget;
  }

  set shouldCheckForTarget(shouldCheckForTarget) {
    this._shouldCheckForTarget = !!shouldCheckForTarget;
  }

  async connect() {
    throw new Error(`Sub-classes need to implement a 'connect' function`);
  }

  async disconnect() {
    throw new Error(`Sub-classes need to implement a 'disconnect' function`);
  }

  isConnected() {
    return this.connected;
  }

  setSpecialMessageHandler(key, errorHandler, handler) {
    this.messageHandler.setSpecialMessageHandler(key, errorHandler, handler);
  }

  getSpecialMessageHandler(key) {
    return this.messageHandler.getSpecialMessageHandler(key);
  }

  setDataMessageHandler(key, errorHandler, handler) {
    this.messageHandler.setDataMessageHandler(key, errorHandler, handler);
  }

  async selectPage(appIdKey, pageIdKey) {
    this.pendingTargetNotification = [appIdKey, pageIdKey];
    this.shouldCheckForTarget = false;
    const sendOpts = {
      appIdKey,
      pageIdKey
    };
    await this.send('setSenderKey', sendOpts);

    _logger.default.debug('Sender key set');

    if (this.isTargetBased) {
      await this.send('targetExists', sendOpts, false);
    }

    this.shouldCheckForTarget = true;
    await this.send('enableInspector', sendOpts);
    await this.send('enablePage', sendOpts);
    await this.send('enableRuntime', sendOpts);
    await this.send('enableDebugger', sendOpts);
    await this.send('enableConsole', sendOpts);
    await this.send('inspectorInitialized', sendOpts);
  }

  async selectApp(appIdKey, applicationConnectedHandler) {
    return await new _bluebird.default((resolve, reject) => {
      const onAppChange = dict => {
        let oldAppIdKey = dict.WIRHostApplicationIdentifierKey;
        let correctAppIdKey = dict.WIRApplicationIdentifierKey;

        if (oldAppIdKey && correctAppIdKey !== oldAppIdKey) {
          _logger.default.debug(`We were notified we might have connected to the wrong app. ` + `Using id ${correctAppIdKey} instead of ${oldAppIdKey}`);
        }

        applicationConnectedHandler(dict);
        reject(new Error('New application has connected'));
      };

      this.setSpecialMessageHandler('_rpc_applicationConnected:', reject, onAppChange);
      return (async () => {
        let pageDict, connectedAppIdKey;

        try {
          [connectedAppIdKey, pageDict] = await this.send('connectToApp', {
            appIdKey
          });
        } catch (err) {
          _logger.default.warn(`Unable to connect to app: ${err.message}`);

          reject(err);
        }

        if (_lodash.default.isEmpty(pageDict)) {
          let msg = 'Empty page dictionary received';

          _logger.default.debug(msg);

          reject(new Error(msg));
        } else {
          resolve([connectedAppIdKey, pageDict]);
        }
      })();
    }).finally(() => {
      this.setSpecialMessageHandler('_rpc_applicationConnected:', null, applicationConnectedHandler);
    });
  }

  async receive() {
    throw new Error(`Sub-classes need to implement a 'receive' function`);
  }

  setTimelineEventHandler(timelineEventHandler) {
    this.timelineEventHandler = timelineEventHandler;
    this.messageHandler.setTimelineEventHandler(timelineEventHandler);
  }

  setConsoleLogEventHandler(consoleEventHandler) {
    this.consoleEventHandler = consoleEventHandler;
    this.messageHandler.setConsoleLogEventHandler(consoleEventHandler);
  }

  setNetworkLogEventHandler(networkEventHandler) {
    this.networkEventHandler = networkEventHandler;
    this.messageHandler.setNetworkEventHandler(networkEventHandler);
  }

}

exports.default = RpcClient;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9ycGMtY2xpZW50LmpzIl0sIm5hbWVzIjpbIkRBVEFfTE9HX0xFTkdUSCIsImxlbmd0aCIsIldBSVRfRk9SX1RBUkdFVF9USU1FT1VUIiwiV0FJVF9GT1JfVEFSR0VUX0lOVEVSVkFMIiwiTUlOX1BMQVRGT1JNX0ZPUl9UQVJHRVRfQkFTRUQiLCJpc1RhcmdldEJhc2VkIiwiaXNTYWZhcmkiLCJwbGF0Zm9ybVZlcnNpb24iLCJpc0hpZ2hWZXJzaW9uIiwidXRpbCIsImNvbXBhcmVWZXJzaW9ucyIsImxvZyIsImRlYnVnIiwiUnBjQ2xpZW50IiwiY29uc3RydWN0b3IiLCJvcHRzIiwiX3RhcmdldHMiLCJfc2hvdWxkQ2hlY2tGb3JUYXJnZXQiLCJzaG91bGRDaGVja0ZvclRhcmdldCIsImJ1bmRsZUlkIiwic3BlY2lhbE1lc3NhZ2VIYW5kbGVycyIsImxvZ0FsbENvbW11bmljYXRpb24iLCJsb2dBbGxDb21tdW5pY2F0aW9uSGV4RHVtcCIsInNvY2tldENodW5rU2l6ZSIsImNvbm5lY3RlZCIsImNvbm5JZCIsIlVVSUQiLCJjcmVhdGUiLCJ0b1N0cmluZyIsInNlbmRlcklkIiwibXNnSWQiLCJ0YXJnZXRDcmVhdGVkIiwiYWRkVGFyZ2V0IiwiYmluZCIsInRhcmdldERlc3Ryb3llZCIsInJlbW92ZVRhcmdldCIsInNldENvbW11bmljYXRpb25Qcm90b2NvbCIsIndhcm4iLCJyZW1vdGVNZXNzYWdlcyIsIlJlbW90ZU1lc3NhZ2VzIiwibWVzc2FnZUhhbmRsZXIiLCJScGNNZXNzYWdlSGFuZGxlciIsIm5lZWRzVGFyZ2V0Iiwid2FpdEZvclRhcmdldCIsImFwcElkS2V5IiwicGFnZUlkS2V5IiwiZ2V0VGFyZ2V0IiwiXyIsImlzRW1wdHkiLCJ3YWl0TXMiLCJpbnRlcnZhbE1zIiwiZXJyb3IiLCJlcnIiLCJtZXNzYWdlIiwiaW5jbHVkZXMiLCJFcnJvciIsInNlbmQiLCJjb21tYW5kIiwid2FpdEZvclJlc3BvbnNlIiwic3RhcnRUaW1lIiwicHJvY2VzcyIsImhydGltZSIsInNlbmRUb0RldmljZSIsIkIiLCJyZXNvbHZlIiwicmVqZWN0Iiwid3JhcHBlck1zZ0lkIiwic2V0RGF0YU1lc3NhZ2VIYW5kbGVyIiwibm9vcCIsInRhcmdldElkIiwiZnVsbE9wdHMiLCJkZWZhdWx0cyIsImlkIiwiY21kIiwiZ2V0UmVtb3RlQ29tbWFuZCIsIl9fYXJndW1lbnQiLCJXSVJTb2NrZXREYXRhS2V5IiwiaXNOaWwiLCJCdWZmZXIiLCJmcm9tIiwiSlNPTiIsInN0cmluZ2lmeSIsIm1lc3NhZ2VIYW5kbGVkIiwiaGFzU3BlY2lhbE1lc3NhZ2VIYW5kbGVyIiwiX19zZWxlY3RvciIsInNwZWNpYWxNZXNzYWdlSGFuZGxlciIsImdldFNwZWNpYWxNZXNzYWdlSGFuZGxlciIsInNldFNwZWNpYWxNZXNzYWdlSGFuZGxlciIsImFyZ3MiLCJ0cnVuY2F0ZSIsImVycm9ySGFuZGxlciIsIm1zZyIsImNvZGUiLCJ2YWx1ZSIsInJlcyIsInNlbmRNZXNzYWdlIiwiYXBwIiwidGFyZ2V0SW5mbyIsImlzVW5kZWZpbmVkIiwicGVuZGluZ1RhcmdldE5vdGlmaWNhdGlvbiIsImhhcyIsInRhcmdldHMiLCJwdWxsIiwiY29ubmVjdCIsImRpc2Nvbm5lY3QiLCJpc0Nvbm5lY3RlZCIsImtleSIsImhhbmRsZXIiLCJzZWxlY3RQYWdlIiwic2VuZE9wdHMiLCJzZWxlY3RBcHAiLCJhcHBsaWNhdGlvbkNvbm5lY3RlZEhhbmRsZXIiLCJvbkFwcENoYW5nZSIsImRpY3QiLCJvbGRBcHBJZEtleSIsIldJUkhvc3RBcHBsaWNhdGlvbklkZW50aWZpZXJLZXkiLCJjb3JyZWN0QXBwSWRLZXkiLCJXSVJBcHBsaWNhdGlvbklkZW50aWZpZXJLZXkiLCJwYWdlRGljdCIsImNvbm5lY3RlZEFwcElkS2V5IiwiZmluYWxseSIsInJlY2VpdmUiLCJzZXRUaW1lbGluZUV2ZW50SGFuZGxlciIsInRpbWVsaW5lRXZlbnRIYW5kbGVyIiwic2V0Q29uc29sZUxvZ0V2ZW50SGFuZGxlciIsImNvbnNvbGVFdmVudEhhbmRsZXIiLCJzZXROZXR3b3JrTG9nRXZlbnRIYW5kbGVyIiwibmV0d29ya0V2ZW50SGFuZGxlciIsInNldE5ldHdvcmtFdmVudEhhbmRsZXIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0EsTUFBTUEsZUFBZSxHQUFHO0FBQUNDLEVBQUFBLE1BQU0sRUFBRTtBQUFULENBQXhCO0FBRUEsTUFBTUMsdUJBQXVCLEdBQUcsS0FBaEM7QUFDQSxNQUFNQyx3QkFBd0IsR0FBRyxJQUFqQztBQUVBLE1BQU1DLDZCQUE2QixHQUFHLE1BQXRDOztBQUVBLFNBQVNDLGFBQVQsQ0FBd0JDLFFBQXhCLEVBQWtDQyxlQUFsQyxFQUFtRDtBQUVqRCxRQUFNQyxhQUFhLEdBQUdDLG9CQUFLQyxlQUFMLENBQXFCSCxlQUFyQixFQUFzQyxJQUF0QyxFQUE0Q0gsNkJBQTVDLENBQXRCOztBQUNBTyxrQkFBSUMsS0FBSixDQUFXLDhDQUE2Q04sUUFBUSxHQUFHLEVBQUgsR0FBUSxNQUFPLCtCQUE4QkMsZUFBZ0IsSUFBN0g7O0FBQ0FJLGtCQUFJQyxLQUFKLENBQVcsMENBQXlDUiw2QkFBOEIsTUFBS0ksYUFBYyxFQUFyRzs7QUFDQSxTQUFPRixRQUFRLElBQUlFLGFBQW5CO0FBQ0Q7O0FBRWMsTUFBTUssU0FBTixDQUFnQjtBQUM3QkMsRUFBQUEsV0FBVyxDQUFFQyxJQUFJLEdBQUcsRUFBVCxFQUFhO0FBQ3RCLFNBQUtDLFFBQUwsR0FBZ0IsRUFBaEI7QUFDQSxTQUFLQyxxQkFBTCxHQUE2QixDQUFDLENBQUNGLElBQUksQ0FBQ0csb0JBQXBDO0FBRUEsVUFBTTtBQUNKQyxNQUFBQSxRQURJO0FBRUpaLE1BQUFBLGVBQWUsR0FBRyxFQUZkO0FBR0pELE1BQUFBLFFBQVEsR0FBRyxJQUhQO0FBSUpjLE1BQUFBLHNCQUFzQixHQUFHLEVBSnJCO0FBS0pDLE1BQUFBLG1CQUFtQixHQUFHLEtBTGxCO0FBTUpDLE1B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RDs7QUFFRG1FLEVBQUFBLHVCQUF1QixDQUFFQyxvQkFBRixFQUF3QjtBQUM3QyxTQUFLQSxvQkFBTCxHQUE0QkEsb0JBQTVCO0FBQ0EsU0FBS25GLGNBQUwsQ0FBb0JrRix1QkFBcEIsQ0FBNENDLG9CQUE1QztBQUNEOztBQUVEQyxFQUFBQSx5QkFBeUIsQ0FBRUMsbUJBQUYsRUFBdUI7QUFDOUMsU0FBS0EsbUJBQUwsR0FBMkJBLG1CQUEzQjtBQUNBLFNBQUtyRixjQUFMLENBQW9Cb0YseUJBQXBCLENBQThDQyxtQkFBOUM7QUFDRDs7QUFFREMsRUFBQUEseUJBQXlCLENBQUVDLG1CQUFGLEVBQXVCO0FBQzlDLFNBQUtBLG1CQUFMLEdBQTJCQSxtQkFBM0I7QUFDQSxTQUFLdkYsY0FBTCxDQUFvQndGLHNCQUFwQixDQUEyQ0QsbUJBQTNDO0FBQ0Q7O0FBeFg0QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZW1vdGVNZXNzYWdlcyBmcm9tICcuL3JlbW90ZS1tZXNzYWdlcyc7XG5pbXBvcnQgeyB3YWl0Rm9yQ29uZGl0aW9uIH0gZnJvbSAnYXN5bmNib3gnO1xuaW1wb3J0IGxvZyBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IFVVSUQgZnJvbSAndXVpZC1qcyc7XG5pbXBvcnQgUnBjTWVzc2FnZUhhbmRsZXIgZnJvbSAnLi9ycGMtbWVzc2FnZS1oYW5kbGVyJztcbmltcG9ydCB7IGdldEVsYXBzZWRUaW1lIH0gZnJvbSAnLi9oZWxwZXJzJztcbmltcG9ydCB7IHV0aWwgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5cblxuY29uc3QgREFUQV9MT0dfTEVOR1RIID0ge2xlbmd0aDogMjAwfTtcblxuY29uc3QgV0FJVF9GT1JfVEFSR0VUX1RJTUVPVVQgPSAxMDAwMDtcbmNvbnN0IFdBSVRfRk9SX1RBUkdFVF9JTlRFUlZBTCA9IDEwMDA7XG5cbmNvbnN0IE1JTl9QTEFURk9STV9GT1JfVEFSR0VUX0JBU0VEID0gJzEyLjInO1xuXG5mdW5jdGlvbiBpc1RhcmdldEJhc2VkIChpc1NhZmFyaSwgcGxhdGZvcm1WZXJzaW9uKSB7XG4gIC8vIG9uIGlPUyAxMi4yIHRoZSBtZXNzYWdlcyBnZXQgc2VudCB0aHJvdWdoIHRoZSBUYXJnZXQgZG9tYWluXG4gIGNvbnN0IGlzSGlnaFZlcnNpb24gPSB1dGlsLmNvbXBhcmVWZXJzaW9ucyhwbGF0Zm9ybVZlcnNpb24sICc+PScsIE1JTl9QTEFURk9STV9GT1JfVEFSR0VUX0JBU0VEKTtcbiAgbG9nLmRlYnVnKGBDaGVja2luZyB3aGljaCBjb21tdW5pY2F0aW9uIHN0eWxlIHRvIHVzZSAoJHtpc1NhZmFyaSA/ICcnIDogJ25vbi0nfVNhZmFyaSBvbiBwbGF0Zm9ybSB2ZXJzaW9uICcke3BsYXRmb3JtVmVyc2lvbn0nKWApO1xuICBsb2cuZGVidWcoYFBsYXRmb3JtIHZlcnNpb24gZXF1YWwgb3IgaGlnaGVyIHRoYW4gJyR7TUlOX1BMQVRGT1JNX0ZPUl9UQVJHRVRfQkFTRUR9JzogJHtpc0hpZ2hWZXJzaW9ufWApO1xuICByZXR1cm4gaXNTYWZhcmkgJiYgaXNIaWdoVmVyc2lvbjtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUnBjQ2xpZW50IHtcbiAgY29uc3RydWN0b3IgKG9wdHMgPSB7fSkge1xuICAgIHRoaXMuX3RhcmdldHMgPSBbXTtcbiAgICB0aGlzLl9zaG91bGRDaGVja0ZvclRhcmdldCA9ICEhb3B0cy5zaG91bGRDaGVja0ZvclRhcmdldDtcblxuICAgIGNvbnN0IHtcbiAgICAgIGJ1bmRsZUlkLFxuICAgICAgcGxhdGZvcm1WZXJzaW9uID0ge30sXG4gICAgICBpc1NhZmFyaSA9IHRydWUsXG4gICAgICBzcGVjaWFsTWVzc2FnZUhhbmRsZXJzID0ge30sXG4gICAgICBsb2dBbGxDb21tdW5pY2F0aW9uID0gZmFsc2UsXG4gICAgICBsb2dBbGxDb21tdW5pY2F0aW9uSGV4RHVtcCA9IGZhbHNlLFxuICAgICAgc29ja2V0Q2h1bmtTaXplLFxuICAgIH0gPSBvcHRzO1xuXG4gICAgdGhpcy5pc1NhZmFyaSA9IGlzU2FmYXJpO1xuXG4gICAgdGhpcy5jb25uZWN0ZWQgPSBmYWxzZTtcbiAgICB0aGlzLmNvbm5JZCA9IFVVSUQuY3JlYXRlKCkudG9TdHJpbmcoKTtcbiAgICB0aGlzLnNlbmRlcklkID0gVVVJRC5jcmVhdGUoKS50b1N0cmluZygpO1xuICAgIHRoaXMubXNnSWQgPSAwO1xuXG4gICAgdGhpcy5sb2dBbGxDb21tdW5pY2F0aW9uID0gbG9nQWxsQ29tbXVuaWNhdGlvbjtcbiAgICB0aGlzLmxvZ0FsbENvbW11bmljYXRpb25IZXhEdW1wID0gbG9nQWxsQ29tbXVuaWNhdGlvbkhleER1bXA7XG4gICAgdGhpcy5zb2NrZXRDaHVua1NpemUgPSBzb2NrZXRDaHVua1NpemU7XG5cbiAgICB0aGlzLmJ1bmRsZUlkID0gYnVuZGxlSWQ7XG4gICAgdGhpcy5wbGF0Zm9ybVZlcnNpb24gPSBwbGF0Zm9ybVZlcnNpb247XG5cbiAgICAvLyBtZXNzYWdlIGhhbmRsZXJzXG4gICAgdGhpcy5zcGVjaWFsTWVzc2FnZUhhbmRsZXJzID0gc3BlY2lhbE1lc3NhZ2VIYW5kbGVycztcbiAgICAvLyBhZGQgbWVzc2FnZSBoYW5kbGVycyBmb3IgZXZlbnRzIHRoYXQgYXJlIHB1cmVseSBycGMgcmVsYXRlZFxuICAgIHRoaXMuc3BlY2lhbE1lc3NhZ2VIYW5kbGVycy50YXJnZXRDcmVhdGVkID0gdGhpcy5hZGRUYXJnZXQuYmluZCh0aGlzKTtcbiAgICB0aGlzLnNwZWNpYWxNZXNzYWdlSGFuZGxlcnMudGFyZ2V0RGVzdHJveWVkID0gdGhpcy5yZW1vdmVUYXJnZXQuYmluZCh0aGlzKSxcblxuICAgIC8vIHN0YXJ0IHdpdGggYSBiZXN0IGd1ZXNzIGZvciB0aGUgcHJvdG9jb2xcbiAgICB0aGlzLnNldENvbW11bmljYXRpb25Qcm90b2NvbChpc1RhcmdldEJhc2VkKGlzU2FmYXJpLCB0aGlzLnBsYXRmb3JtVmVyc2lvbikpO1xuICB9XG5cbiAgc2V0Q29tbXVuaWNhdGlvblByb3RvY29sIChpc1RhcmdldEJhc2VkID0gZmFsc2UpIHtcbiAgICBsb2cud2FybihgU2V0dGluZyBjb21tdW5pY2F0aW9uIHByb3RvY29sOiB1c2luZyAke2lzVGFyZ2V0QmFzZWQgPyAnVGFyZ2V0LWJhc2VkJyA6ICdmdWxsIFdlYiBJbnNwZWN0b3IgcHJvdG9jb2wnfSBjb21tdW5pY2F0aW9uYCk7XG4gICAgdGhpcy5pc1RhcmdldEJhc2VkID0gaXNUYXJnZXRCYXNlZDtcblxuICAgIGlmICghdGhpcy5yZW1vdGVNZXNzYWdlcykge1xuICAgICAgdGhpcy5yZW1vdGVNZXNzYWdlcyA9IG5ldyBSZW1vdGVNZXNzYWdlcyhpc1RhcmdldEJhc2VkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5yZW1vdGVNZXNzYWdlcy5zZXRDb21tdW5pY2F0aW9uUHJvdG9jb2woaXNUYXJnZXRCYXNlZCk7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLm1lc3NhZ2VIYW5kbGVyKSB7XG4gICAgICB0aGlzLm1lc3NhZ2VIYW5kbGVyID0gbmV3IFJwY01lc3NhZ2VIYW5kbGVyKHRoaXMuc3BlY2lhbE1lc3NhZ2VIYW5kbGVycywgaXNUYXJnZXRCYXNlZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubWVzc2FnZUhhbmRsZXIuc2V0Q29tbXVuaWNhdGlvblByb3RvY29sKGlzVGFyZ2V0QmFzZWQpO1xuICAgIH1cbiAgfVxuXG4gIG5lZWRzVGFyZ2V0ICgpIHtcbiAgICByZXR1cm4gdGhpcy5zaG91bGRDaGVja0ZvclRhcmdldCAmJiB0aGlzLmlzVGFyZ2V0QmFzZWQ7XG4gIH1cblxuICBhc3luYyB3YWl0Rm9yVGFyZ2V0IChhcHBJZEtleSwgcGFnZUlkS2V5KSB7XG4gICAgaWYgKCF0aGlzLm5lZWRzVGFyZ2V0KCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5nZXRUYXJnZXQoYXBwSWRLZXksIHBhZ2VJZEtleSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBvdGhlcndpc2Ugd2FpdGluZyBpcyBuZWNlc3NhcnkgdG8gc2VlIHdoYXQgdGhlIHRhcmdldCBpc1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB3YWl0Rm9yQ29uZGl0aW9uKCgpID0+ICFfLmlzRW1wdHkodGhpcy5nZXRUYXJnZXQoYXBwSWRLZXksIHBhZ2VJZEtleSkpLCB7XG4gICAgICAgIHdhaXRNczogV0FJVF9GT1JfVEFSR0VUX1RJTUVPVVQsXG4gICAgICAgIGludGVydmFsTXM6IFdBSVRfRk9SX1RBUkdFVF9JTlRFUlZBTCxcbiAgICAgICAgZXJyb3I6ICdObyB0YXJnZXRzIGZvdW5kLCB1bmFibGUgdG8gY29tbXVuaWNhdGUgd2l0aCBkZXZpY2UnLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBpZiAoIWVyci5tZXNzYWdlLmluY2x1ZGVzKCdDb25kaXRpb24gdW5tZXQnKSkge1xuICAgICAgICB0aHJvdyBlcnI7XG4gICAgICB9XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIHRhcmdldHMgZm91bmQsIHVuYWJsZSB0byBjb21tdW5pY2F0ZSB3aXRoIGRldmljZScpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHNlbmQgKGNvbW1hbmQsIG9wdHMgPSB7fSwgd2FpdEZvclJlc3BvbnNlID0gdHJ1ZSkge1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IHByb2Nlc3MuaHJ0aW1lKCk7XG4gICAgY29uc3Qge1xuICAgICAgYXBwSWRLZXksXG4gICAgICBwYWdlSWRLZXlcbiAgICB9ID0gb3B0cztcbiAgICB0cnkge1xuICAgICAgaWYgKCFfLmlzRW1wdHkoYXBwSWRLZXkpICYmICFfLmlzRW1wdHkocGFnZUlkS2V5KSkge1xuICAgICAgICBhd2FpdCB0aGlzLndhaXRGb3JUYXJnZXQoYXBwSWRLZXksIHBhZ2VJZEtleSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5zZW5kVG9EZXZpY2UoY29tbWFuZCwgb3B0cywgd2FpdEZvclJlc3BvbnNlKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmIChlcnIubWVzc2FnZS5pbmNsdWRlcyhgJ1RhcmdldCcgZG9tYWluIHdhcyBub3QgZm91bmRgKSkge1xuICAgICAgICB0aGlzLnNldENvbW11bmljYXRpb25Qcm90b2NvbChmYWxzZSk7XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLnNlbmRUb0RldmljZShjb21tYW5kLCBvcHRzLCB3YWl0Rm9yUmVzcG9uc2UpO1xuICAgICAgfSBlbHNlIGlmIChlcnIubWVzc2FnZS5pbmNsdWRlcyhgZG9tYWluIHdhcyBub3QgZm91bmRgKSB8fCBlcnIubWVzc2FnZS5pbmNsdWRlcyhgU29tZSBhcmd1bWVudHMgb2YgbWV0aG9kYCkpIHtcbiAgICAgICAgdGhpcy5zZXRDb21tdW5pY2F0aW9uUHJvdG9jb2wodHJ1ZSk7XG4gICAgICAgIGF3YWl0IHRoaXMud2FpdEZvclRhcmdldChhcHBJZEtleSwgcGFnZUlkS2V5KTtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuc2VuZFRvRGV2aWNlKGNvbW1hbmQsIG9wdHMsIHdhaXRGb3JSZXNwb25zZSk7XG4gICAgICB9XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGxvZy5kZWJ1ZyhgU2VuZGluZyB0byBXZWIgSW5zcGVjdG9yIHRvb2sgJHtnZXRFbGFwc2VkVGltZShzdGFydFRpbWUpfW1zYCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc2VuZFRvRGV2aWNlIChjb21tYW5kLCBvcHRzID0ge30sIHdhaXRGb3JSZXNwb25zZSA9IHRydWUpIHtcbiAgICByZXR1cm4gYXdhaXQgbmV3IEIoYXN5bmMgKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgLy8gcHJvbWlzZSB0byBiZSByZXNvbHZlZCB3aGVuZXZlciByZW1vdGUgZGVidWdnZXJcbiAgICAgIC8vIHJlcGxpZXMgdG8gb3VyIHJlcXVlc3RcblxuICAgICAgLy8ga2VlcCB0cmFjayBvZiB0aGUgbWVzc2FnZXMgY29taW5nIGFuZCBnb2luZyB1c2luZyBhIHNpbXBsZSBzZXF1ZW50aWFsIGlkXG4gICAgICBjb25zdCB3cmFwcGVyTXNnSWQgPSB0aGlzLm1zZ0lkKys7XG4gICAgICBsZXQgbXNnSWQgPSB3cmFwcGVyTXNnSWQ7XG4gICAgICBpZiAodGhpcy5pc1RhcmdldEJhc2VkKSB7XG4gICAgICAgIC8vIGZvciB0YXJnZXQtYmFzZSBjb21tdW5pY2F0aW9uLCBldmVyeXRoaW5nIGlzIHdyYXBwZWQgdXBcbiAgICAgICAgbXNnSWQgPSB0aGlzLm1zZ0lkKys7XG4gICAgICAgIC8vIGFja25vd2xlZGdlIHdyYXBwZXIgbWVzc2FnZVxuICAgICAgICB0aGlzLnNldERhdGFNZXNzYWdlSGFuZGxlcih3cmFwcGVyTXNnSWQudG9TdHJpbmcoKSwgcmVqZWN0LCBfLm5vb3ApO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBhcHBJZEtleSA9IG9wdHMuYXBwSWRLZXk7XG4gICAgICBjb25zdCBwYWdlSWRLZXkgPSBvcHRzLnBhZ2VJZEtleTtcbiAgICAgIGNvbnN0IHRhcmdldElkID0gdGhpcy5nZXRUYXJnZXQoYXBwSWRLZXksIHBhZ2VJZEtleSk7XG5cbiAgICAgIC8vIHJldHJpZXZlIHRoZSBjb3JyZWN0IGNvbW1hbmQgdG8gc2VuZFxuICAgICAgY29uc3QgZnVsbE9wdHMgPSBfLmRlZmF1bHRzKHtcbiAgICAgICAgY29ubklkOiB0aGlzLmNvbm5JZCxcbiAgICAgICAgc2VuZGVySWQ6IHRoaXMuc2VuZGVySWQsXG4gICAgICAgIHRhcmdldElkLFxuICAgICAgICBpZDogbXNnSWQsXG4gICAgICB9LCBvcHRzKTtcbiAgICAgIGNvbnN0IGNtZCA9IHRoaXMucmVtb3RlTWVzc2FnZXMuZ2V0UmVtb3RlQ29tbWFuZChjb21tYW5kLCBmdWxsT3B0cyk7XG5cbiAgICAgIGlmIChjbWQuX19hcmd1bWVudCAmJiBjbWQuX19hcmd1bWVudC5XSVJTb2NrZXREYXRhS2V5KSB7XG4gICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgbWVzc2FnZSBiZWluZyBzZW50IGhhcyBhbGwgdGhlIGluZm9ybWF0aW9uIHRoYXQgaXMgbmVlZGVkXG4gICAgICAgIGlmIChfLmlzTmlsKGNtZC5fX2FyZ3VtZW50LldJUlNvY2tldERhdGFLZXkuaWQpKSB7XG4gICAgICAgICAgY21kLl9fYXJndW1lbnQuV0lSU29ja2V0RGF0YUtleS5pZCA9IHdyYXBwZXJNc2dJZDtcbiAgICAgICAgfVxuICAgICAgICBjbWQuX19hcmd1bWVudC5XSVJTb2NrZXREYXRhS2V5ID1cbiAgICAgICAgICBCdWZmZXIuZnJvbShKU09OLnN0cmluZ2lmeShjbWQuX19hcmd1bWVudC5XSVJTb2NrZXREYXRhS2V5KSk7XG4gICAgICB9XG5cbiAgICAgIGxldCBtZXNzYWdlSGFuZGxlZCA9IHRydWU7XG4gICAgICBpZiAoIXdhaXRGb3JSZXNwb25zZSkge1xuICAgICAgICAvLyB0aGUgcHJvbWlzZSB3aWxsIGJlIHJlc29sdmVkIGFzIHNvb24gYXMgdGhlIHNvY2tldCBoYXMgYmVlbiBzZW50XG4gICAgICAgIG1lc3NhZ2VIYW5kbGVkID0gZmFsc2U7XG4gICAgICAgIC8vIGRvIG5vdCBsb2cgcmVjZWlwdHNcbiAgICAgICAgdGhpcy5zZXREYXRhTWVzc2FnZUhhbmRsZXIobXNnSWQudG9TdHJpbmcoKSwgcmVqZWN0LCBfLm5vb3ApO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLm1lc3NhZ2VIYW5kbGVyLmhhc1NwZWNpYWxNZXNzYWdlSGFuZGxlcihjbWQuX19zZWxlY3RvcikpIHtcbiAgICAgICAgLy8gc3BlY2lhbCByZXBsaWVzIHdpbGwgcmV0dXJuIGFueSBudW1iZXIgb2YgYXJndW1lbnRzXG4gICAgICAgIC8vIHRlbXBvcmFyaWx5IHdyYXAgd2l0aCBwcm9taXNlIGhhbmRsaW5nXG4gICAgICAgIGNvbnN0IHNwZWNpYWxNZXNzYWdlSGFuZGxlciA9IHRoaXMuZ2V0U3BlY2lhbE1lc3NhZ2VIYW5kbGVyKGNtZC5fX3NlbGVjdG9yKTtcbiAgICAgICAgdGhpcy5zZXRTcGVjaWFsTWVzc2FnZUhhbmRsZXIoY21kLl9fc2VsZWN0b3IsIHJlamVjdCwgKC4uLmFyZ3MpID0+IHtcbiAgICAgICAgICBsb2cuZGVidWcoYFJlY2VpdmVkIHJlc3BvbnNlIGZyb20gc2VuZCAoaWQ6ICR7bXNnSWR9KTogJyR7Xy50cnVuY2F0ZShKU09OLnN0cmluZ2lmeShhcmdzKSwgREFUQV9MT0dfTEVOR1RIKX0nYCk7XG5cbiAgICAgICAgICAvLyBjYWxsIHRoZSBvcmlnaW5hbCBsaXN0ZW5lciwgYW5kIHB1dCBpdCBiYWNrLCBpZiBuZWNlc3NhcnlcbiAgICAgICAgICBzcGVjaWFsTWVzc2FnZUhhbmRsZXIoLi4uYXJncyk7XG4gICAgICAgICAgaWYgKHRoaXMubWVzc2FnZUhhbmRsZXIuaGFzU3BlY2lhbE1lc3NhZ2VIYW5kbGVyKGNtZC5fX3NlbGVjdG9yKSkge1xuICAgICAgICAgICAgLy8gdGhpcyBtZWFucyB0aGF0IHRoZSBzeXN0ZW0gaGFzIG5vdCByZW1vdmVkIHRoaXMgbGlzdGVuZXJcbiAgICAgICAgICAgIHRoaXMuc2V0U3BlY2lhbE1lc3NhZ2VIYW5kbGVyKGNtZC5fX3NlbGVjdG9yLCBudWxsLCBzcGVjaWFsTWVzc2FnZUhhbmRsZXIpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJlc29sdmUoYXJncyk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIGlmIChjbWQuX19hcmd1bWVudCAmJiBjbWQuX19hcmd1bWVudC5XSVJTb2NrZXREYXRhS2V5KSB7XG4gICAgICAgIGNvbnN0IGVycm9ySGFuZGxlciA9IGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICBjb25zdCBtc2cgPSBgUmVtb3RlIGRlYnVnZ2VyIGVycm9yIHdpdGggY29kZSAnJHtlcnIuY29kZX0nOiAke2Vyci5tZXNzYWdlfWA7XG4gICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcihtc2cpKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5zZXREYXRhTWVzc2FnZUhhbmRsZXIobXNnSWQudG9TdHJpbmcoKSwgZXJyb3JIYW5kbGVyLCAodmFsdWUpID0+IHtcbiAgICAgICAgICBsb2cuZGVidWcoYFJlY2VpdmVkIGRhdGEgcmVzcG9uc2UgZnJvbSBzZW5kIChpZDogJHttc2dJZH0pOiAnJHtfLnRydW5jYXRlKEpTT04uc3RyaW5naWZ5KHZhbHVlKSwgREFUQV9MT0dfTEVOR1RIKX0nYCk7XG4gICAgICAgICAgcmVzb2x2ZSh2YWx1ZSk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gbm90aGluZyBlbHNlIGlzIGhhbmRsaW5nIHRoaW5ncywgc28ganVzdCByZXNvbHZlIHdoZW4gdGhlIG1lc3NhZ2UgaXMgc2VudFxuICAgICAgICBtZXNzYWdlSGFuZGxlZCA9IGZhbHNlO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBtc2cgPSBgU2VuZGluZyAnJHtjbWQuX19zZWxlY3Rvcn0nIG1lc3NhZ2VgICtcbiAgICAgICAgKGZ1bGxPcHRzLmFwcElkS2V5ID8gYCB0byBhcHAgJyR7ZnVsbE9wdHMuYXBwSWRLZXl9J2AgOiAnJykgK1xuICAgICAgICAoZnVsbE9wdHMucGFnZUlkS2V5ID8gYCwgcGFnZSAnJHtmdWxsT3B0cy5wYWdlSWRLZXl9J2AgOiAnJykgK1xuICAgICAgICAodGhpcy5uZWVkc1RhcmdldCgpID8gYCwgdGFyZ2V0ICcke3RhcmdldElkfSdgIDogJycpICtcbiAgICAgICAgYCAoaWQ6ICR7bXNnSWR9KWA7XG4gICAgICBsb2cuZGVidWcobXNnKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuc2VuZE1lc3NhZ2UoY21kKTtcbiAgICAgICAgaWYgKCFtZXNzYWdlSGFuZGxlZCkge1xuICAgICAgICAgIC8vIFRoZXJlIGFyZSBubyBoYW5kbGVycyB3YWl0aW5nIGZvciBhIHJlc3BvbnNlIGJlZm9yZSByZXNvbHZpbmcsXG4gICAgICAgICAgLy8gYW5kIG5vIGVycm9ycyBzZW5kaW5nIHRoZSBtZXNzYWdlIG92ZXIgdGhlIHNvY2tldCwgc28gcmVzb2x2ZVxuICAgICAgICAgIHJlc29sdmUocmVzKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIHJldHVybiByZWplY3QoZXJyKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIHNlbmRNZXNzYWdlICgvKiBjb21tYW5kICovKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICAgIHRocm93IG5ldyBFcnJvcihgU3ViLWNsYXNzZXMgbmVlZCB0byBpbXBsZW1lbnQgYSAnc2VuZE1lc3NhZ2UnIGZ1bmN0aW9uYCk7XG4gIH1cblxuICBhZGRUYXJnZXQgKGFwcCwgdGFyZ2V0SW5mbykge1xuICAgIGlmIChfLmlzVW5kZWZpbmVkKHRhcmdldEluZm8pIHx8IF8uaXNVbmRlZmluZWQodGFyZ2V0SW5mby50YXJnZXRJZCkpIHtcbiAgICAgIGxvZy53YXJuKGBSZWNlaXZlZCAndGFyZ2V0Q3JlYXRlZCcgZXZlbnQgd2l0aCBubyB0YXJnZXQuIFNraXBwaW5nYCk7XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKF8uaXNFbXB0eSh0aGlzLnBlbmRpbmdUYXJnZXROb3RpZmljYXRpb24pKSB7XG4gICAgICBsb2cud2FybihgUmVjZWl2ZWQgJ3RhcmdldENyZWF0ZWQnIGV2ZW50IHdpdGggbm8gcGVuZGluZyByZXF1ZXN0OiAke0pTT04uc3RyaW5naWZ5KHRhcmdldEluZm8pfWApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IFthcHBJZEtleSwgcGFnZUlkS2V5XSA9IHRoaXMucGVuZGluZ1RhcmdldE5vdGlmaWNhdGlvbjtcbiAgICBpZiAoXy5oYXModGFyZ2V0SW5mbywgJ3R5cGUnKSkge1xuICAgICAgLy8gcmVhbCB0YXJnZXQgbm90aWZpY2F0aW9ucyAoZnJvbSBXZWIgSW5zcGVjdG9yLCBub3QgZnJvbSBBcHBpdW0pXG4gICAgICAvLyBoYXZlIGEgJ3R5cGUnLiBJZiB3ZSBoYXZlIGFscmVhZHkgc2V0IHRoZSB0YXJnZXQsIGFuZCBnZXQgYSBuZXdcbiAgICAgIC8vIG5vdGlmaWNhdGlvbiwgd2Ugd2FudCB0byBmb2xsb3cgaXRcbiAgICAgIHRoaXMucGVuZGluZ1RhcmdldE5vdGlmaWNhdGlvbiA9IG51bGw7XG4gICAgfVxuXG4gICAgbG9nLmRlYnVnKGBUYXJnZXQgY3JlYXRlZCBmb3IgYXBwICcke2FwcElkS2V5fScgYW5kIHBhZ2UgJyR7cGFnZUlkS2V5fSc6ICR7SlNPTi5zdHJpbmdpZnkodGFyZ2V0SW5mbyl9YCk7XG4gICAgaWYgKF8uaGFzKHRoaXMudGFyZ2V0c1thcHBJZEtleV0sIHBhZ2VJZEtleSkpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgVGhlcmUgaXMgYWxyZWFkeSBhIHRhcmdldCBmb3IgdGhpcyBhcHAgYW5kIHBhZ2UgKCcke3RoaXMudGFyZ2V0c1thcHBJZEtleV1bcGFnZUlkS2V5XX0nKS4gVGhpcyBtaWdodCBjYXVzZSBwcm9ibGVtc2ApO1xuICAgIH1cbiAgICB0aGlzLnRhcmdldHNbYXBwSWRLZXldID0gdGhpcy50YXJnZXRzW2FwcElkS2V5XSB8fCB7fTtcbiAgICB0aGlzLnRhcmdldHNbYXBwSWRLZXldW3BhZ2VJZEtleV0gPSB0YXJnZXRJbmZvLnRhcmdldElkO1xuICB9XG5cbiAgcmVtb3ZlVGFyZ2V0IChhcHAsIHRhcmdldEluZm8pIHtcbiAgICBpZiAoXy5pc1VuZGVmaW5lZCh0YXJnZXRJbmZvKSB8fCBfLmlzVW5kZWZpbmVkKHRhcmdldEluZm8udGFyZ2V0SWQpKSB7XG4gICAgICBsb2cuZGVidWcoYFJlY2VpdmVkICd0YXJnZXREZXN0cm95ZWQnIGV2ZW50IHdpdGggbm8gdGFyZ2V0LiBTa2lwcGluZ2ApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBsb2cuZGVidWcoYFRhcmdldCBkZXN0cm95ZWQ6ICR7SlNPTi5zdHJpbmdpZnkodGFyZ2V0SW5mbyl9YCk7XG4gICAgXy5wdWxsKHRoaXMudGFyZ2V0cywgdGFyZ2V0SW5mby50YXJnZXRJZCk7XG4gIH1cblxuICBnZXQgdGFyZ2V0cyAoKSB7XG4gICAgdGhpcy5fdGFyZ2V0cyA9IHRoaXMuX3RhcmdldHMgfHwge307XG4gICAgcmV0dXJuIHRoaXMuX3RhcmdldHM7XG4gIH1cblxuICBnZXRUYXJnZXQgKGFwcElkS2V5LCBwYWdlSWRLZXkpIHtcbiAgICByZXR1cm4gKHRoaXMudGFyZ2V0c1thcHBJZEtleV0gfHwge30pW3BhZ2VJZEtleV07XG4gIH1cblxuICBnZXQgc2hvdWxkQ2hlY2tGb3JUYXJnZXQgKCkge1xuICAgIHJldHVybiB0aGlzLl9zaG91bGRDaGVja0ZvclRhcmdldDtcbiAgfVxuXG4gIHNldCBzaG91bGRDaGVja0ZvclRhcmdldCAoc2hvdWxkQ2hlY2tGb3JUYXJnZXQpIHtcbiAgICB0aGlzLl9zaG91bGRDaGVja0ZvclRhcmdldCA9ICEhc2hvdWxkQ2hlY2tGb3JUYXJnZXQ7XG4gIH1cblxuICBhc3luYyBjb25uZWN0ICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgdGhyb3cgbmV3IEVycm9yKGBTdWItY2xhc3NlcyBuZWVkIHRvIGltcGxlbWVudCBhICdjb25uZWN0JyBmdW5jdGlvbmApO1xuICB9XG5cbiAgYXN5bmMgZGlzY29ubmVjdCAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICAgIHRocm93IG5ldyBFcnJvcihgU3ViLWNsYXNzZXMgbmVlZCB0byBpbXBsZW1lbnQgYSAnZGlzY29ubmVjdCcgZnVuY3Rpb25gKTtcbiAgfVxuXG4gIGlzQ29ubmVjdGVkICgpIHtcbiAgICByZXR1cm4gdGhpcy5jb25uZWN0ZWQ7XG4gIH1cblxuICBzZXRTcGVjaWFsTWVzc2FnZUhhbmRsZXIgKGtleSwgZXJyb3JIYW5kbGVyLCBoYW5kbGVyKSB7XG4gICAgdGhpcy5tZXNzYWdlSGFuZGxlci5zZXRTcGVjaWFsTWVzc2FnZUhhbmRsZXIoa2V5LCBlcnJvckhhbmRsZXIsIGhhbmRsZXIpO1xuICB9XG5cbiAgZ2V0U3BlY2lhbE1lc3NhZ2VIYW5kbGVyIChrZXkpIHtcbiAgICByZXR1cm4gdGhpcy5tZXNzYWdlSGFuZGxlci5nZXRTcGVjaWFsTWVzc2FnZUhhbmRsZXIoa2V5KTtcbiAgfVxuXG4gIHNldERhdGFNZXNzYWdlSGFuZGxlciAoa2V5LCBlcnJvckhhbmRsZXIsIGhhbmRsZXIpIHtcbiAgICB0aGlzLm1lc3NhZ2VIYW5kbGVyLnNldERhdGFNZXNzYWdlSGFuZGxlcihrZXksIGVycm9ySGFuZGxlciwgaGFuZGxlcik7XG4gIH1cblxuICBhc3luYyBzZWxlY3RQYWdlIChhcHBJZEtleSwgcGFnZUlkS2V5KSB7XG4gICAgdGhpcy5wZW5kaW5nVGFyZ2V0Tm90aWZpY2F0aW9uID0gW2FwcElkS2V5LCBwYWdlSWRLZXldO1xuICAgIHRoaXMuc2hvdWxkQ2hlY2tGb3JUYXJnZXQgPSBmYWxzZTtcblxuICAgIGNvbnN0IHNlbmRPcHRzID0ge1xuICAgICAgYXBwSWRLZXksXG4gICAgICBwYWdlSWRLZXksXG4gICAgfTtcblxuICAgIGF3YWl0IHRoaXMuc2VuZCgnc2V0U2VuZGVyS2V5Jywgc2VuZE9wdHMpO1xuICAgIGxvZy5kZWJ1ZygnU2VuZGVyIGtleSBzZXQnKTtcblxuICAgIGlmICh0aGlzLmlzVGFyZ2V0QmFzZWQpIHtcbiAgICAgIGF3YWl0IHRoaXMuc2VuZCgndGFyZ2V0RXhpc3RzJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICB9XG5cbiAgICB0aGlzLnNob3VsZENoZWNrRm9yVGFyZ2V0ID0gdHJ1ZTtcblxuICAgIGF3YWl0IHRoaXMuc2VuZCgnZW5hYmxlSW5zcGVjdG9yJywgc2VuZE9wdHMpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnZW5hYmxlUGFnZScsIHNlbmRPcHRzKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ2VuYWJsZVJ1bnRpbWUnLCBzZW5kT3B0cyk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdlbmFibGVEZWJ1Z2dlcicsIHNlbmRPcHRzKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ2VuYWJsZUNvbnNvbGUnLCBzZW5kT3B0cyk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdpbnNwZWN0b3JJbml0aWFsaXplZCcsIHNlbmRPcHRzKTtcbiAgfVxuXG4gIGFzeW5jIHNlbGVjdEFwcCAoYXBwSWRLZXksIGFwcGxpY2F0aW9uQ29ubmVjdGVkSGFuZGxlcikge1xuICAgIHJldHVybiBhd2FpdCBuZXcgQigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAvLyBsb2NhbCBjYWxsYmFjaywgdGVtcG9yYXJpbHkgYWRkZWQgYXMgY2FsbGJhY2sgdG9cbiAgICAgIC8vIGBfcnBjX2FwcGxpY2F0aW9uQ29ubmVjdGVkOmAgcmVtb3RlIGRlYnVnZ2VyIHJlc3BvbnNlXG4gICAgICAvLyB0byBoYW5kbGUgdGhlIGluaXRpYWwgY29ubmVjdGlvblxuICAgICAgY29uc3Qgb25BcHBDaGFuZ2UgPSAoZGljdCkgPT4ge1xuICAgICAgICAvLyBmcm9tIHRoZSBkaWN0aW9uYXJ5IHJldHVybmVkLCBnZXQgdGhlIGlkc1xuICAgICAgICBsZXQgb2xkQXBwSWRLZXkgPSBkaWN0LldJUkhvc3RBcHBsaWNhdGlvbklkZW50aWZpZXJLZXk7XG4gICAgICAgIGxldCBjb3JyZWN0QXBwSWRLZXkgPSBkaWN0LldJUkFwcGxpY2F0aW9uSWRlbnRpZmllcktleTtcblxuICAgICAgICAvLyBpZiB0aGlzIGlzIGEgcmVwb3J0IG9mIGEgcHJveHkgcmVkaXJlY3QgZnJvbSB0aGUgcmVtb3RlIGRlYnVnZ2VyXG4gICAgICAgIC8vIHdlIHdhbnQgdG8gdXBkYXRlIG91ciBkaWN0aW9uYXJ5IGFuZCBnZXQgYSBuZXcgYXBwIGlkXG4gICAgICAgIGlmIChvbGRBcHBJZEtleSAmJiBjb3JyZWN0QXBwSWRLZXkgIT09IG9sZEFwcElkS2V5KSB7XG4gICAgICAgICAgbG9nLmRlYnVnKGBXZSB3ZXJlIG5vdGlmaWVkIHdlIG1pZ2h0IGhhdmUgY29ubmVjdGVkIHRvIHRoZSB3cm9uZyBhcHAuIGAgK1xuICAgICAgICAgICAgICAgICAgICBgVXNpbmcgaWQgJHtjb3JyZWN0QXBwSWRLZXl9IGluc3RlYWQgb2YgJHtvbGRBcHBJZEtleX1gKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGFwcGxpY2F0aW9uQ29ubmVjdGVkSGFuZGxlcihkaWN0KTtcbiAgICAgICAgcmVqZWN0KG5ldyBFcnJvcignTmV3IGFwcGxpY2F0aW9uIGhhcyBjb25uZWN0ZWQnKSk7XG4gICAgICB9O1xuICAgICAgdGhpcy5zZXRTcGVjaWFsTWVzc2FnZUhhbmRsZXIoJ19ycGNfYXBwbGljYXRpb25Db25uZWN0ZWQ6JywgcmVqZWN0LCBvbkFwcENoYW5nZSk7XG5cbiAgICAgIC8vIGRvIHRoZSBhY3R1YWwgY29ubmVjdGluZyB0byB0aGUgYXBwXG4gICAgICByZXR1cm4gKGFzeW5jICgpID0+IHtcbiAgICAgICAgbGV0IHBhZ2VEaWN0LCBjb25uZWN0ZWRBcHBJZEtleTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAoW2Nvbm5lY3RlZEFwcElkS2V5LCBwYWdlRGljdF0gPSBhd2FpdCB0aGlzLnNlbmQoJ2Nvbm5lY3RUb0FwcCcsIHtcbiAgICAgICAgICAgIGFwcElkS2V5XG4gICAgICAgICAgfSkpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICBsb2cud2FybihgVW5hYmxlIHRvIGNvbm5lY3QgdG8gYXBwOiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gc29tZXRpbWVzIHRoZSBjb25uZWN0IGxvZ2ljIGhhcHBlbnMsIGJ1dCB3aXRoIGFuIGVtcHR5IGRpY3Rpb25hcnlcbiAgICAgICAgLy8gd2hpY2ggbGVhZHMgdG8gdGhlIHJlbW90ZSBkZWJ1Z2dlciBnZXR0aW5nIGRpc2Nvbm5lY3RlZCwgYW5kIGludG8gYSBsb29wXG4gICAgICAgIGlmIChfLmlzRW1wdHkocGFnZURpY3QpKSB7XG4gICAgICAgICAgbGV0IG1zZyA9ICdFbXB0eSBwYWdlIGRpY3Rpb25hcnkgcmVjZWl2ZWQnO1xuICAgICAgICAgIGxvZy5kZWJ1Zyhtc2cpO1xuICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IobXNnKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzb2x2ZShbY29ubmVjdGVkQXBwSWRLZXksIHBhZ2VEaWN0XSk7XG4gICAgICAgIH1cbiAgICAgIH0pKCk7XG4gICAgfSkuZmluYWxseSgoKSA9PiB7XG4gICAgICAvLyBubyBtYXR0ZXIgd2hhdCwgd2Ugd2FudCB0byByZXN0b3JlIHRoZSBoYW5kbGVyIHRoYXQgd2FzIGNoYW5nZWQuXG4gICAgICB0aGlzLnNldFNwZWNpYWxNZXNzYWdlSGFuZGxlcignX3JwY19hcHBsaWNhdGlvbkNvbm5lY3RlZDonLCBudWxsLCBhcHBsaWNhdGlvbkNvbm5lY3RlZEhhbmRsZXIpO1xuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgcmVjZWl2ZSAoLyogZGF0YSAqLykgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFN1Yi1jbGFzc2VzIG5lZWQgdG8gaW1wbGVtZW50IGEgJ3JlY2VpdmUnIGZ1bmN0aW9uYCk7XG4gIH1cblxuICBzZXRUaW1lbGluZUV2ZW50SGFuZGxlciAodGltZWxpbmVFdmVudEhhbmRsZXIpIHtcbiAgICB0aGlzLnRpbWVsaW5lRXZlbnRIYW5kbGVyID0gdGltZWxpbmVFdmVudEhhbmRsZXI7XG4gICAgdGhpcy5tZXNzYWdlSGFuZGxlci5zZXRUaW1lbGluZUV2ZW50SGFuZGxlcih0aW1lbGluZUV2ZW50SGFuZGxlcik7XG4gIH1cblxuICBzZXRDb25zb2xlTG9nRXZlbnRIYW5kbGVyIChjb25zb2xlRXZlbnRIYW5kbGVyKSB7XG4gICAgdGhpcy5jb25zb2xlRXZlbnRIYW5kbGVyID0gY29uc29sZUV2ZW50SGFuZGxlcjtcbiAgICB0aGlzLm1lc3NhZ2VIYW5kbGVyLnNldENvbnNvbGVMb2dFdmVudEhhbmRsZXIoY29uc29sZUV2ZW50SGFuZGxlcik7XG4gIH1cblxuICBzZXROZXR3b3JrTG9nRXZlbnRIYW5kbGVyIChuZXR3b3JrRXZlbnRIYW5kbGVyKSB7XG4gICAgdGhpcy5uZXR3b3JrRXZlbnRIYW5kbGVyID0gbmV0d29ya0V2ZW50SGFuZGxlcjtcbiAgICB0aGlzLm1lc3NhZ2VIYW5kbGVyLnNldE5ldHdvcmtFdmVudEhhbmRsZXIobmV0d29ya0V2ZW50SGFuZGxlcik7XG4gIH1cbn1cbiJdLCJmaWxlIjoibGliL3JwYy1jbGllbnQuanMiLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
