"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _logger = _interopRequireDefault(require("./logger"));

var _remoteDebugger = require("./remote-debugger");

var _helpers = require("./helpers");

var _lodash = _interopRequireDefault(require("lodash"));

async function onPageChange(appIdKey, pageDict) {
  if (_lodash.default.isEmpty(pageDict)) {
    return;
  }

  const pageArray = (0, _helpers.pageArrayFromDict)(pageDict);
  await this.useAppDictLock(done => {
    try {
      if (this.appDict[appIdKey]) {
        if (this.appDict[appIdKey].pageArray) {
          if (this.appDict[appIdKey].pageArray.resolve) {
            this.appDict[appIdKey].pageArray.resolve();
          } else {
            if (_lodash.default.isEqual(this.appDict[appIdKey].pageArray, pageArray)) {
              _logger.default.debug(`Received page change notice for app '${appIdKey}' ` + `but the listing has not changed. Ignoring.`);

              return done();
            }
          }
        }

        this.appDict[appIdKey].pageArray = pageArray;
      }
    } finally {
      done();
    }
  });

  if (this._navigatingToPage) {
    return;
  }

  _logger.default.debug(`Page changed: ${(0, _helpers.simpleStringify)(pageDict, true)}`);

  this.emit(_remoteDebugger.RemoteDebugger.EVENT_PAGE_CHANGE, {
    appIdKey: appIdKey.replace('PID:', ''),
    pageArray
  });
}

async function onAppConnect(dict) {
  let appIdKey = dict.WIRApplicationIdentifierKey;

  _logger.default.debug(`Notified that new application '${appIdKey}' has connected`);

  await this.useAppDictLock(done => {
    try {
      this.updateAppsWithDict(dict);
    } finally {
      done();
    }
  });
}

function onAppDisconnect(dict) {
  let appIdKey = dict.WIRApplicationIdentifierKey;

  _logger.default.debug(`Application '${appIdKey}' disconnected. Removing from app dictionary.`);

  _logger.default.debug(`Current app is ${this.appIdKey}`);

  delete this.appDict[appIdKey];

  if (this.appIdKey === appIdKey) {
    _logger.default.debug(`No longer have app id. Attempting to find new one.`);

    this.appIdKey = (0, _helpers.getDebuggerAppKey)(this.bundleId, this.appDict);
  }

  if (!this.appDict) {
    _logger.default.debug('Main app disconnected. Disconnecting altogether.');

    this.connected = false;
    this.emit(_remoteDebugger.RemoteDebugger.EVENT_DISCONNECT, true);
  }
}

async function onAppUpdate(dict) {
  await this.useAppDictLock(done => {
    try {
      this.updateAppsWithDict(dict);
    } finally {
      done();
    }
  });
}

function onConnectedDriverList(drivers) {
  this.connectedDrivers = drivers.WIRDriverDictionaryKey;

  _logger.default.debug(`Received connected driver list: ${JSON.stringify(this.connectedDrivers)}`);
}

async function onConnectedApplicationList(apps) {
  _logger.default.debug(`Received connected applications list: ${_lodash.default.keys(apps).join(', ')}`);

  let newDict = {};

  for (const dict of _lodash.default.values(apps)) {
    const [id, entry] = (0, _helpers.appInfoFromDict)(dict);

    if (this.skippedApps.includes(entry.name)) {
      continue;
    }

    newDict[id] = entry;
  }

  await this.useAppDictLock(done => {
    try {
      _lodash.default.defaults(this.appDict, newDict);
    } finally {
      done();
    }
  });
}

const messageHandlers = {
  onPageChange,
  onAppConnect,
  onAppDisconnect,
  onAppUpdate,
  onConnectedDriverList,
  onConnectedApplicationList
};
var _default = messageHandlers;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9tZXNzYWdlLWhhbmRsZXJzLmpzIl0sIm5hbWVzIjpbIm9uUGFnZUNoYW5nZSIsImFwcElkS2V5IiwicGFnZURpY3QiLCJfIiwiaXNFbXB0eSIsInBhZ2VBcnJheSIsInVzZUFwcERpY3RMb2NrIiwiZG9uZSIsImFwcERpY3QiLCJyZXNvbHZlIiwiaXNFcXVhbCIsImxvZyIsImRlYnVnIiwiX25hdmlnYXRpbmdUb1BhZ2UiLCJlbWl0IiwiUmVtb3RlRGVidWdnZXIiLCJFVkVOVF9QQUdFX0NIQU5HRSIsInJlcGxhY2UiLCJvbkFwcENvbm5lY3QiLCJkaWN0IiwiV0lSQXBwbGljYXRpb25JZGVudGlmaWVyS2V5IiwidXBkYXRlQXBwc1dpdGhEaWN0Iiwib25BcHBEaXNjb25uZWN0IiwiYnVuZGxlSWQiLCJjb25uZWN0ZWQiLCJFVkVOVF9ESVNDT05ORUNUIiwib25BcHBVcGRhdGUiLCJvbkNvbm5lY3RlZERyaXZlckxpc3QiLCJkcml2ZXJzIiwiY29ubmVjdGVkRHJpdmVycyIsIldJUkRyaXZlckRpY3Rpb25hcnlLZXkiLCJKU09OIiwic3RyaW5naWZ5Iiwib25Db25uZWN0ZWRBcHBsaWNhdGlvbkxpc3QiLCJhcHBzIiwia2V5cyIsImpvaW4iLCJuZXdEaWN0IiwidmFsdWVzIiwiaWQiLCJlbnRyeSIsInNraXBwZWRBcHBzIiwiaW5jbHVkZXMiLCJuYW1lIiwiZGVmYXVsdHMiLCJtZXNzYWdlSGFuZGxlcnMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBUUEsZUFBZUEsWUFBZixDQUE2QkMsUUFBN0IsRUFBdUNDLFFBQXZDLEVBQWlEO0FBQy9DLE1BQUlDLGdCQUFFQyxPQUFGLENBQVVGLFFBQVYsQ0FBSixFQUF5QjtBQUN2QjtBQUNEOztBQUVELFFBQU1HLFNBQVMsR0FBRyxnQ0FBa0JILFFBQWxCLENBQWxCO0FBRUEsUUFBTSxLQUFLSSxjQUFMLENBQXFCQyxJQUFELElBQVU7QUFDbEMsUUFBSTtBQUVGLFVBQUksS0FBS0MsT0FBTCxDQUFhUCxRQUFiLENBQUosRUFBNEI7QUFDMUIsWUFBSSxLQUFLTyxPQUFMLENBQWFQLFFBQWIsRUFBdUJJLFNBQTNCLEVBQXNDO0FBQ3BDLGNBQUksS0FBS0csT0FBTCxDQUFhUCxRQUFiLEVBQXVCSSxTQUF2QixDQUFpQ0ksT0FBckMsRUFBOEM7QUFFNUMsaUJBQUtELE9BQUwsQ0FBYVAsUUFBYixFQUF1QkksU0FBdkIsQ0FBaUNJLE9BQWpDO0FBQ0QsV0FIRCxNQUdPO0FBRUwsZ0JBQUlOLGdCQUFFTyxPQUFGLENBQVUsS0FBS0YsT0FBTCxDQUFhUCxRQUFiLEVBQXVCSSxTQUFqQyxFQUE0Q0EsU0FBNUMsQ0FBSixFQUE0RDtBQUMxRE0sOEJBQUlDLEtBQUosQ0FBVyx3Q0FBdUNYLFFBQVMsSUFBakQsR0FDQyw0Q0FEWDs7QUFFQSxxQkFBT00sSUFBSSxFQUFYO0FBQ0Q7QUFDRjtBQUNGOztBQUVELGFBQUtDLE9BQUwsQ0FBYVAsUUFBYixFQUF1QkksU0FBdkIsR0FBbUNBLFNBQW5DO0FBQ0Q7QUFDRixLQW5CRCxTQW1CVTtBQUNSRSxNQUFBQSxJQUFJO0FBQ0w7QUFDRixHQXZCSyxDQUFOOztBQXlCQSxNQUFJLEtBQUtNLGlCQUFULEVBQTRCO0FBRTFCO0FBQ0Q7O0FBRURGLGtCQUFJQyxLQUFKLENBQVcsaUJBQWdCLDhCQUFnQlYsUUFBaEIsRUFBMEIsSUFBMUIsQ0FBZ0MsRUFBM0Q7O0FBRUEsT0FBS1ksSUFBTCxDQUFVQywrQkFBZUMsaUJBQXpCLEVBQTRDO0FBQzFDZixJQUFBQSxRQUFRLEVBQUVBLFFBQVEsQ0FBQ2dCLE9BQVQsQ0FBaUIsTUFBakIsRUFBeUIsRUFBekIsQ0FEZ0M7QUFFMUNaLElBQUFBO0FBRjBDLEdBQTVDO0FBSUQ7O0FBRUQsZUFBZWEsWUFBZixDQUE2QkMsSUFBN0IsRUFBbUM7QUFDakMsTUFBSWxCLFFBQVEsR0FBR2tCLElBQUksQ0FBQ0MsMkJBQXBCOztBQUNBVCxrQkFBSUMsS0FBSixDQUFXLGtDQUFpQ1gsUUFBUyxpQkFBckQ7O0FBQ0EsUUFBTSxLQUFLSyxjQUFMLENBQXFCQyxJQUFELElBQVU7QUFDbEMsUUFBSTtBQUNGLFdBQUtjLGtCQUFMLENBQXdCRixJQUF4QjtBQUNELEtBRkQsU0FFVTtBQUNSWixNQUFBQSxJQUFJO0FBQ0w7QUFDRixHQU5LLENBQU47QUFPRDs7QUFFRCxTQUFTZSxlQUFULENBQTBCSCxJQUExQixFQUFnQztBQUM5QixNQUFJbEIsUUFBUSxHQUFHa0IsSUFBSSxDQUFDQywyQkFBcEI7O0FBQ0FULGtCQUFJQyxLQUFKLENBQVcsZ0JBQWVYLFFBQVMsK0NBQW5DOztBQUNBVSxrQkFBSUMsS0FBSixDQUFXLGtCQUFpQixLQUFLWCxRQUFTLEVBQTFDOztBQUlBLFNBQU8sS0FBS08sT0FBTCxDQUFhUCxRQUFiLENBQVA7O0FBR0EsTUFBSSxLQUFLQSxRQUFMLEtBQWtCQSxRQUF0QixFQUFnQztBQUM5QlUsb0JBQUlDLEtBQUosQ0FBVyxvREFBWDs7QUFDQSxTQUFLWCxRQUFMLEdBQWdCLGdDQUFrQixLQUFLc0IsUUFBdkIsRUFBaUMsS0FBS2YsT0FBdEMsQ0FBaEI7QUFDRDs7QUFFRCxNQUFJLENBQUMsS0FBS0EsT0FBVixFQUFtQjtBQUVqQkcsb0JBQUlDLEtBQUosQ0FBVSxrREFBVjs7QUFDQSxTQUFLWSxTQUFMLEdBQWlCLEtBQWpCO0FBQ0EsU0FBS1YsSUFBTCxDQUFVQywrQkFBZVUsZ0JBQXpCLEVBQTJDLElBQTNDO0FBQ0Q7QUFDRjs7QUFFRCxlQUFlQyxXQUFmLENBQTRCUCxJQUE1QixFQUFrQztBQUNoQyxRQUFNLEtBQUtiLGNBQUwsQ0FBcUJDLElBQUQsSUFBVTtBQUNsQyxRQUFJO0FBQ0YsV0FBS2Msa0JBQUwsQ0FBd0JGLElBQXhCO0FBQ0QsS0FGRCxTQUVVO0FBQ1JaLE1BQUFBLElBQUk7QUFDTDtBQUNGLEdBTkssQ0FBTjtBQU9EOztBQUVELFNBQVNvQixxQkFBVCxDQUFnQ0MsT0FBaEMsRUFBeUM7QUFDdkMsT0FBS0MsZ0JBQUwsR0FBd0JELE9BQU8sQ0FBQ0Usc0JBQWhDOztBQUNBbkIsa0JBQUlDLEtBQUosQ0FBVyxtQ0FBa0NtQixJQUFJLENBQUNDLFNBQUwsQ0FBZSxLQUFLSCxnQkFBcEIsQ0FBc0MsRUFBbkY7QUFDRDs7QUFFRCxlQUFlSSwwQkFBZixDQUEyQ0MsSUFBM0MsRUFBaUQ7QUFDL0N2QixrQkFBSUMsS0FBSixDQUFXLHlDQUF3Q1QsZ0JBQUVnQyxJQUFGLENBQU9ELElBQVAsRUFBYUUsSUFBYixDQUFrQixJQUFsQixDQUF3QixFQUEzRTs7QUFJQSxNQUFJQyxPQUFPLEdBQUcsRUFBZDs7QUFDQSxPQUFLLE1BQU1sQixJQUFYLElBQW1CaEIsZ0JBQUVtQyxNQUFGLENBQVNKLElBQVQsQ0FBbkIsRUFBbUM7QUFDakMsVUFBTSxDQUFDSyxFQUFELEVBQUtDLEtBQUwsSUFBYyw4QkFBZ0JyQixJQUFoQixDQUFwQjs7QUFDQSxRQUFJLEtBQUtzQixXQUFMLENBQWlCQyxRQUFqQixDQUEwQkYsS0FBSyxDQUFDRyxJQUFoQyxDQUFKLEVBQTJDO0FBQ3pDO0FBQ0Q7O0FBQ0ROLElBQUFBLE9BQU8sQ0FBQ0UsRUFBRCxDQUFQLEdBQWNDLEtBQWQ7QUFDRDs7QUFFRCxRQUFNLEtBQUtsQyxjQUFMLENBQXFCQyxJQUFELElBQVU7QUFDbEMsUUFBSTtBQUNGSixzQkFBRXlDLFFBQUYsQ0FBVyxLQUFLcEMsT0FBaEIsRUFBeUI2QixPQUF6QjtBQUNELEtBRkQsU0FFVTtBQUNSOUIsTUFBQUEsSUFBSTtBQUNMO0FBQ0YsR0FOSyxDQUFOO0FBT0Q7O0FBRUQsTUFBTXNDLGVBQWUsR0FBRztBQUN0QjdDLEVBQUFBLFlBRHNCO0FBRXRCa0IsRUFBQUEsWUFGc0I7QUFHdEJJLEVBQUFBLGVBSHNCO0FBSXRCSSxFQUFBQSxXQUpzQjtBQUt0QkMsRUFBQUEscUJBTHNCO0FBTXRCTSxFQUFBQTtBQU5zQixDQUF4QjtlQVNlWSxlIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGxvZyBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgeyBSZW1vdGVEZWJ1Z2dlciB9IGZyb20gJy4vcmVtb3RlLWRlYnVnZ2VyJztcbmltcG9ydCB7IHBhZ2VBcnJheUZyb21EaWN0LCBnZXREZWJ1Z2dlckFwcEtleSwgc2ltcGxlU3RyaW5naWZ5LCBhcHBJbmZvRnJvbURpY3QgfSBmcm9tICcuL2hlbHBlcnMnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcblxuXG4vKlxuICogR2VuZXJpYyBjYWxsYmFja3MgdXNlZCB0aHJvdWdob3V0IHRoZSBsaWZlY3ljbGUgb2YgdGhlIFJlbW90ZSBEZWJ1Z2dlci5cbiAqIFRoZXNlIHdpbGwgYmUgYWRkZWQgdG8gdGhlIHByb3RvdHlwZS5cbiAqL1xuXG5hc3luYyBmdW5jdGlvbiBvblBhZ2VDaGFuZ2UgKGFwcElkS2V5LCBwYWdlRGljdCkge1xuICBpZiAoXy5pc0VtcHR5KHBhZ2VEaWN0KSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHBhZ2VBcnJheSA9IHBhZ2VBcnJheUZyb21EaWN0KHBhZ2VEaWN0KTtcblxuICBhd2FpdCB0aGlzLnVzZUFwcERpY3RMb2NrKChkb25lKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIHNhdmUgdGhlIHBhZ2UgZGljdCBmb3IgdGhpcyBhcHBcbiAgICAgIGlmICh0aGlzLmFwcERpY3RbYXBwSWRLZXldKSB7XG4gICAgICAgIGlmICh0aGlzLmFwcERpY3RbYXBwSWRLZXldLnBhZ2VBcnJheSkge1xuICAgICAgICAgIGlmICh0aGlzLmFwcERpY3RbYXBwSWRLZXldLnBhZ2VBcnJheS5yZXNvbHZlKSB7XG4gICAgICAgICAgICAvLyBwYWdlRGljdCBpcyBhIHBlbmRpbmcgcHJvbWlzZSwgc28gcmVzb2x2ZVxuICAgICAgICAgICAgdGhpcy5hcHBEaWN0W2FwcElkS2V5XS5wYWdlQXJyYXkucmVzb2x2ZSgpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyB3ZSBoYXZlIGEgcHJlLWV4aXN0aW5nIHBhZ2VEaWN0XG4gICAgICAgICAgICBpZiAoXy5pc0VxdWFsKHRoaXMuYXBwRGljdFthcHBJZEtleV0ucGFnZUFycmF5LCBwYWdlQXJyYXkpKSB7XG4gICAgICAgICAgICAgIGxvZy5kZWJ1ZyhgUmVjZWl2ZWQgcGFnZSBjaGFuZ2Ugbm90aWNlIGZvciBhcHAgJyR7YXBwSWRLZXl9JyBgICtcbiAgICAgICAgICAgICAgICAgICAgICAgIGBidXQgdGhlIGxpc3RpbmcgaGFzIG5vdCBjaGFuZ2VkLiBJZ25vcmluZy5gKTtcbiAgICAgICAgICAgICAgcmV0dXJuIGRvbmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8ga2VlcCB0cmFjayBvZiB0aGUgcGFnZSBkaWN0aW9uYXJ5XG4gICAgICAgIHRoaXMuYXBwRGljdFthcHBJZEtleV0ucGFnZUFycmF5ID0gcGFnZUFycmF5O1xuICAgICAgfVxuICAgIH0gZmluYWxseSB7XG4gICAgICBkb25lKCk7XG4gICAgfVxuICB9KTtcblxuICBpZiAodGhpcy5fbmF2aWdhdGluZ1RvUGFnZSkge1xuICAgIC8vIGluIHRoZSBtaWRkbGUgb2YgbmF2aWdhdGluZywgc28gcmVwb3J0aW5nIGEgcGFnZSBjaGFuZ2Ugd2lsbCBjYXVzZSBwcm9ibGVtc1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGxvZy5kZWJ1ZyhgUGFnZSBjaGFuZ2VkOiAke3NpbXBsZVN0cmluZ2lmeShwYWdlRGljdCwgdHJ1ZSl9YCk7XG5cbiAgdGhpcy5lbWl0KFJlbW90ZURlYnVnZ2VyLkVWRU5UX1BBR0VfQ0hBTkdFLCB7XG4gICAgYXBwSWRLZXk6IGFwcElkS2V5LnJlcGxhY2UoJ1BJRDonLCAnJyksXG4gICAgcGFnZUFycmF5LFxuICB9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gb25BcHBDb25uZWN0IChkaWN0KSB7XG4gIGxldCBhcHBJZEtleSA9IGRpY3QuV0lSQXBwbGljYXRpb25JZGVudGlmaWVyS2V5O1xuICBsb2cuZGVidWcoYE5vdGlmaWVkIHRoYXQgbmV3IGFwcGxpY2F0aW9uICcke2FwcElkS2V5fScgaGFzIGNvbm5lY3RlZGApO1xuICBhd2FpdCB0aGlzLnVzZUFwcERpY3RMb2NrKChkb25lKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIHRoaXMudXBkYXRlQXBwc1dpdGhEaWN0KGRpY3QpO1xuICAgIH0gZmluYWxseSB7XG4gICAgICBkb25lKCk7XG4gICAgfVxuICB9KTtcbn1cblxuZnVuY3Rpb24gb25BcHBEaXNjb25uZWN0IChkaWN0KSB7XG4gIGxldCBhcHBJZEtleSA9IGRpY3QuV0lSQXBwbGljYXRpb25JZGVudGlmaWVyS2V5O1xuICBsb2cuZGVidWcoYEFwcGxpY2F0aW9uICcke2FwcElkS2V5fScgZGlzY29ubmVjdGVkLiBSZW1vdmluZyBmcm9tIGFwcCBkaWN0aW9uYXJ5LmApO1xuICBsb2cuZGVidWcoYEN1cnJlbnQgYXBwIGlzICR7dGhpcy5hcHBJZEtleX1gKTtcblxuICAvLyBnZXQgcmlkIG9mIHRoZSBlbnRyeSBpbiBvdXIgYXBwIGRpY3Rpb25hcnksXG4gIC8vIHNpbmNlIGl0IGlzIG5vIGxvbmdlciBhdmFpbGFibGVcbiAgZGVsZXRlIHRoaXMuYXBwRGljdFthcHBJZEtleV07XG5cbiAgLy8gaWYgdGhlIGRpc2Nvbm5lY3RlZCBhcHAgaXMgdGhlIG9uZSB3ZSBhcmUgY29ubmVjdGVkIHRvLCB0cnkgdG8gZmluZCBhbm90aGVyXG4gIGlmICh0aGlzLmFwcElkS2V5ID09PSBhcHBJZEtleSkge1xuICAgIGxvZy5kZWJ1ZyhgTm8gbG9uZ2VyIGhhdmUgYXBwIGlkLiBBdHRlbXB0aW5nIHRvIGZpbmQgbmV3IG9uZS5gKTtcbiAgICB0aGlzLmFwcElkS2V5ID0gZ2V0RGVidWdnZXJBcHBLZXkodGhpcy5idW5kbGVJZCwgdGhpcy5hcHBEaWN0KTtcbiAgfVxuXG4gIGlmICghdGhpcy5hcHBEaWN0KSB7XG4gICAgLy8gdGhpcyBtZWFucyB3ZSBubyBsb25nZXIgaGF2ZSBhbnkgYXBwcy4gd2hhdCB0aGUgd2hhdD9cbiAgICBsb2cuZGVidWcoJ01haW4gYXBwIGRpc2Nvbm5lY3RlZC4gRGlzY29ubmVjdGluZyBhbHRvZ2V0aGVyLicpO1xuICAgIHRoaXMuY29ubmVjdGVkID0gZmFsc2U7XG4gICAgdGhpcy5lbWl0KFJlbW90ZURlYnVnZ2VyLkVWRU5UX0RJU0NPTk5FQ1QsIHRydWUpO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIG9uQXBwVXBkYXRlIChkaWN0KSB7XG4gIGF3YWl0IHRoaXMudXNlQXBwRGljdExvY2soKGRvbmUpID0+IHtcbiAgICB0cnkge1xuICAgICAgdGhpcy51cGRhdGVBcHBzV2l0aERpY3QoZGljdCk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGRvbmUoKTtcbiAgICB9XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBvbkNvbm5lY3RlZERyaXZlckxpc3QgKGRyaXZlcnMpIHtcbiAgdGhpcy5jb25uZWN0ZWREcml2ZXJzID0gZHJpdmVycy5XSVJEcml2ZXJEaWN0aW9uYXJ5S2V5O1xuICBsb2cuZGVidWcoYFJlY2VpdmVkIGNvbm5lY3RlZCBkcml2ZXIgbGlzdDogJHtKU09OLnN0cmluZ2lmeSh0aGlzLmNvbm5lY3RlZERyaXZlcnMpfWApO1xufVxuXG5hc3luYyBmdW5jdGlvbiBvbkNvbm5lY3RlZEFwcGxpY2F0aW9uTGlzdCAoYXBwcykge1xuICBsb2cuZGVidWcoYFJlY2VpdmVkIGNvbm5lY3RlZCBhcHBsaWNhdGlvbnMgbGlzdDogJHtfLmtleXMoYXBwcykuam9pbignLCAnKX1gKTtcblxuICAvLyB0cmFuc2xhdGUgdGhlIHJlY2VpdmVkIGluZm9ybWF0aW9uIGludG8gYW4gZWFzaWVyLXRvLW1hbmFnZVxuICAvLyBoYXNoIHdpdGggYXBwIGlkIGFzIGtleSwgYW5kIGFwcCBpbmZvIGFzIHZhbHVlXG4gIGxldCBuZXdEaWN0ID0ge307XG4gIGZvciAoY29uc3QgZGljdCBvZiBfLnZhbHVlcyhhcHBzKSkge1xuICAgIGNvbnN0IFtpZCwgZW50cnldID0gYXBwSW5mb0Zyb21EaWN0KGRpY3QpO1xuICAgIGlmICh0aGlzLnNraXBwZWRBcHBzLmluY2x1ZGVzKGVudHJ5Lm5hbWUpKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgbmV3RGljdFtpZF0gPSBlbnRyeTtcbiAgfVxuICAvLyB1cGRhdGUgdGhlIG9iamVjdCdzIGxpc3Qgb2YgYXBwc1xuICBhd2FpdCB0aGlzLnVzZUFwcERpY3RMb2NrKChkb25lKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIF8uZGVmYXVsdHModGhpcy5hcHBEaWN0LCBuZXdEaWN0KTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgZG9uZSgpO1xuICAgIH1cbiAgfSk7XG59XG5cbmNvbnN0IG1lc3NhZ2VIYW5kbGVycyA9IHtcbiAgb25QYWdlQ2hhbmdlLFxuICBvbkFwcENvbm5lY3QsXG4gIG9uQXBwRGlzY29ubmVjdCxcbiAgb25BcHBVcGRhdGUsXG4gIG9uQ29ubmVjdGVkRHJpdmVyTGlzdCxcbiAgb25Db25uZWN0ZWRBcHBsaWNhdGlvbkxpc3QsXG59O1xuXG5leHBvcnQgZGVmYXVsdCBtZXNzYWdlSGFuZGxlcnM7XG4iXSwiZmlsZSI6ImxpYi9tZXNzYWdlLWhhbmRsZXJzLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uIn0=
