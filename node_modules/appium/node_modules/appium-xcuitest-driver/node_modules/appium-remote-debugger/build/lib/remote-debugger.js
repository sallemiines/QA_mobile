"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.RPC_RESPONSE_TIMEOUT_MS = exports.REMOTE_DEBUGGER_PORT = exports.RemoteDebugger = void 0;

require("source-map-support/register");

var _events = _interopRequireDefault(require("events"));

var _logger = _interopRequireDefault(require("./logger"));

var _appiumBaseDriver = require("appium-base-driver");

var _rpcClientSimulator = _interopRequireDefault(require("./rpc-client-simulator"));

var _messageHandlers = _interopRequireDefault(require("./message-handlers"));

var _helpers = require("./helpers");

var _appiumSupport = require("appium-support");

var _asyncbox = require("asyncbox");

var _lodash = _interopRequireDefault(require("lodash"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _path = _interopRequireDefault(require("path"));

var _uuidJs = _interopRequireDefault(require("uuid-js"));

var _asyncLock = _interopRequireDefault(require("async-lock"));

let VERSION;

try {
  VERSION = require(_path.default.resolve(__dirname, '..', '..', 'package.json')).version;
} catch (ign) {}

const SELECT_APP_RETRIES = 20;
const SELECT_APP_RETRY_SLEEP_MS = 500;
const REMOTE_DEBUGGER_PORT = 27753;
exports.REMOTE_DEBUGGER_PORT = REMOTE_DEBUGGER_PORT;
const SAFARI_BUNDLE_ID = 'com.apple.mobilesafari';
const BLANK_PAGE_URL = 'about:blank';
const RPC_RESPONSE_TIMEOUT_MS = 5000;
exports.RPC_RESPONSE_TIMEOUT_MS = RPC_RESPONSE_TIMEOUT_MS;
const PAGE_READY_TIMEOUT = 5000;
const GARBAGE_COLLECT_TIMEOUT = 5000;
const ACTIVE_APP_CODE = 0;

class RemoteDebugger extends _events.default.EventEmitter {
  constructor(opts = {}) {
    super();

    if (VERSION) {
      _logger.default.info(`Remote Debugger version ${VERSION}`);
    }

    const {
      bundleId,
      additionalBundleIds = [],
      platformVersion,
      isSafari = true,
      includeSafari = false,
      useNewSafari = false,
      pageLoadMs,
      host,
      port = REMOTE_DEBUGGER_PORT,
      socketPath,
      pageReadyTimeout = PAGE_READY_TIMEOUT,
      remoteDebugProxy,
      garbageCollectOnExecute = false,
      logFullResponse = false,
      logAllCommunication = false,
      logAllCommunicationHexDump = false,
      socketChunkSize
    } = opts;
    this.bundleId = bundleId;
    this.additionalBundleIds = additionalBundleIds;
    this.platformVersion = platformVersion;
    this.isSafari = isSafari;
    this.includeSafari = includeSafari;
    this.useNewSafari = useNewSafari;
    this.pageLoadMs = pageLoadMs;

    _logger.default.debug(`useNewSafari --> ${this.useNewSafari}`);

    this.garbageCollectOnExecute = garbageCollectOnExecute;
    this.host = host;
    this.port = port;
    this.socketPath = socketPath;
    this.remoteDebugProxy = remoteDebugProxy;
    this.pageReadyTimeout = pageReadyTimeout;
    this.logAllCommunication = _lodash.default.isNil(logAllCommunication) ? !!logFullResponse : !!logAllCommunication;
    this.logAllCommunicationHexDump = logAllCommunicationHexDump;
    this.socketChunkSize = socketChunkSize;
    this.skippedApps = [];
    this._lock = new _asyncLock.default();
  }

  setup() {
    this.appDict = {};
    this.appIdKey = null;
    this.pageIdKey = null;
    this.pageLoading = false;
    this._navigatingToPage = false;
    this.allowNavigationWithoutReload = false;
    this.specialCbs = {
      '_rpc_reportIdentifier:': _lodash.default.noop,
      '_rpc_forwardGetListing:': this.onPageChange.bind(this),
      '_rpc_reportConnectedApplicationList:': this.onConnectedApplicationList.bind(this),
      '_rpc_applicationConnected:': this.onAppConnect.bind(this),
      '_rpc_applicationDisconnected:': this.onAppDisconnect.bind(this),
      '_rpc_applicationUpdated:': this.onAppUpdate.bind(this),
      '_rpc_reportConnectedDriverList:': this.onConnectedDriverList.bind(this),
      pageLoad: this.pageLoad.bind(this),
      frameDetached: this.frameDetached.bind(this)
    };
    this.rpcClient = null;
  }

  teardown() {
    _logger.default.debug('Cleaning up listeners');

    this.appDict = {};
    this.appIdKey = null;
    this.pageIdKey = null;
    this.pageLoading = false;
    this.specialCbs = {};
    this.rpcClient = null;
    this.removeAllListeners(RemoteDebugger.EVENT_PAGE_CHANGE);
    this.removeAllListeners(RemoteDebugger.EVENT_DISCONNECT);
  }

  async connect() {
    this.setup();
    this.rpcClient = new _rpcClientSimulator.default({
      bundleId: this.bundleId,
      platformVersion: this.platformVersion,
      isSafari: this.isSafari,
      host: this.host,
      port: this.port,
      socketPath: this.socketPath,
      specialMessageHandlers: this.specialCbs,
      messageProxy: this.remoteDebugProxy,
      logAllCommunication: this.logAllCommunication,
      logAllCommunicationHexDump: this.logAllCommunicationHexDump
    });
    await this.rpcClient.connect();

    try {
      await this.setConnectionKey();
      return this.appDict || {};
    } catch (err) {
      _logger.default.error(`Error setting connection key: ${err.message}`);

      await this.disconnect();
      throw err;
    }
  }

  async disconnect() {
    if (this.rpcClient) {
      await this.rpcClient.disconnect();
    }

    this.emit(RemoteDebugger.EVENT_DISCONNECT, true);
    this.teardown();
  }

  isConnected() {
    return !!(this.rpcClient && this.rpcClient.isConnected());
  }

  async setConnectionKey() {
    _logger.default.debug('Sending connection key request');

    await this.rpcClient.send('setConnectionKey', {}, false);
  }

  updateAppsWithDict(dict) {
    this.appDict = this.appDict || {};
    let [id, entry] = (0, _helpers.appInfoFromDict)(dict);

    if (this.appDict[id]) {
      entry.pageArray = this.appDict[id].pageArray;
    }

    this.appDict[id] = entry;

    if (_lodash.default.isUndefined(entry.pageArray)) {
      entry.pageArray = (0, _helpers.deferredPromise)();
    }

    if (!this.appIdKey) {
      this.appIdKey = (0, _helpers.getDebuggerAppKey)(this.bundleId, this.appDict);
    }
  }

  logApplicationDictionary(apps) {
    function getValueString(key, value) {
      if (_lodash.default.isFunction(value)) {
        return '[Function]';
      }

      if (key === 'pageArray' && !_lodash.default.isArray(value)) {
        return `'Waiting for data'`;
      }

      return JSON.stringify(value);
    }

    _logger.default.debug('Current applications available:');

    for (const [app, info] of _lodash.default.toPairs(apps)) {
      _logger.default.debug(`    Application: '${app}'`);

      for (const [key, value] of _lodash.default.toPairs(info)) {
        if (key === 'pageArray' && Array.isArray(value) && value.length) {
          _logger.default.debug(`        ${key}:`);

          for (const page of value) {
            let prefix = '- ';

            for (const [k, v] of _lodash.default.toPairs(page)) {
              _logger.default.debug(`          ${prefix}${k}: ${JSON.stringify(v)}`);

              prefix = '  ';
            }
          }
        } else {
          const valueString = getValueString(key, value);

          _logger.default.debug(`        ${key}: ${valueString}`);
        }
      }
    }
  }

  async selectApp(currentUrl = null, maxTries = SELECT_APP_RETRIES, ignoreAboutBlankUrl = false) {
    const shouldCheckForTarget = this.rpcClient.shouldCheckForTarget;
    this.rpcClient.shouldCheckForTarget = false;

    try {
      const startTime = process.hrtime();

      _logger.default.debug('Selecting application');

      if (!this.appDict || _lodash.default.isEmpty(this.appDict)) {
        _logger.default.debug('No applications currently connected.');

        return [];
      }

      const {
        appIdKey,
        pageDict
      } = await this.searchForApp(currentUrl, maxTries, ignoreAboutBlankUrl);

      if (!appIdKey || !pageDict) {
        _logger.default.errorAndThrow(`Could not connect to a valid app after ${maxTries} tries.`);
      }

      if (this.appIdKey !== appIdKey) {
        _logger.default.debug(`Received altered app id, updating from '${this.appIdKey}' to '${appIdKey}'`);

        this.appIdKey = appIdKey;
      }

      this.logApplicationDictionary(this.appDict);
      const pageArray = _lodash.default.isEmpty(this.appDict[appIdKey].pageArray) ? (0, _helpers.pageArrayFromDict)(pageDict) : this.appDict[appIdKey].pageArray;

      _logger.default.debug(`Finally selecting app ${this.appIdKey}: ${(0, _helpers.simpleStringify)(pageArray)}`);

      let fullPageArray = [];

      for (const [app, info] of _lodash.default.toPairs(this.appDict)) {
        if (!_lodash.default.isArray(info.pageArray) || info.isActive === ACTIVE_APP_CODE) {
          continue;
        }

        const id = app.replace('PID:', '');

        for (const page of info.pageArray) {
          if (page.url && (!ignoreAboutBlankUrl || page.url !== BLANK_PAGE_URL)) {
            let pageDict = _lodash.default.clone(page);

            pageDict.id = `${id}.${pageDict.id}`;
            fullPageArray.push(pageDict);
          }
        }
      }

      _logger.default.debug(`Selected app after ${(0, _helpers.getElapsedTime)(startTime)}ms`);

      return fullPageArray;
    } finally {
      this.rpcClient.shouldCheckForTarget = shouldCheckForTarget;
    }
  }

  async searchForApp(currentUrl, maxTries, ignoreAboutBlankUrl) {
    const bundleIds = this.includeSafari && !this.isSafari ? [this.bundleId, ...this.additionalBundleIds, SAFARI_BUNDLE_ID] : [this.bundleId, ...this.additionalBundleIds];

    try {
      return await (0, _asyncbox.retryInterval)(maxTries, SELECT_APP_RETRY_SLEEP_MS, async retryCount => {
        this.logApplicationDictionary(this.appDict);
        const possibleAppIds = (0, _helpers.getPossibleDebuggerAppKeys)(bundleIds, this.appDict);

        _logger.default.debug(`Trying out the possible app ids: ${possibleAppIds.join(', ')} (try #${retryCount + 1} of ${maxTries})`);

        for (const attemptedAppIdKey of possibleAppIds) {
          try {
            if (this.appDict[attemptedAppIdKey].isActive === ACTIVE_APP_CODE) {
              _logger.default.debug(`Skipping app '${attemptedAppIdKey}' because it is not active`);

              continue;
            }

            _logger.default.debug(`Attempting app '${attemptedAppIdKey}'`);

            const [appIdKey, pageDict] = await this.rpcClient.selectApp(attemptedAppIdKey, this.onAppConnect.bind(this));

            if (_lodash.default.isEmpty(pageDict)) {
              _logger.default.debug('Empty page dictionary received. Trying again.');

              continue;
            }

            this.appDict[appIdKey].pageArray = (0, _helpers.pageArrayFromDict)(pageDict);
            const result = this.searchForPage(this.appDict, currentUrl, ignoreAboutBlankUrl);

            if (result) {
              return result;
            }

            if (currentUrl) {
              _logger.default.debug(`Received app, but expected url ('${currentUrl}') was not found. Trying again.`);
            } else {
              _logger.default.debug('Received app, but no match was found. Trying again.');
            }
          } catch (err) {
            _logger.default.debug(`Error checking application: '${err.message}'. Retrying connection`);
          }
        }

        retryCount++;
        throw new Error('Failed to find an app to select');
      }, 0);
    } catch (ign) {
      _logger.default.errorAndThrow(`Could not connect to a valid app after ${maxTries} tries.`);
    }
  }

  searchForPage(appsDict, currentUrl = null, ignoreAboutBlankUrl = false) {
    for (const appDict of _lodash.default.values(appsDict)) {
      if (!appDict || appDict.isActive === ACTIVE_APP_CODE || !appDict.pageArray || appDict.pageArray.promise) {
        continue;
      }

      for (const dict of appDict.pageArray) {
        if ((!ignoreAboutBlankUrl || dict.url !== BLANK_PAGE_URL) && (!currentUrl || dict.url === currentUrl || dict.url === `${currentUrl}/`)) {
          return {
            appIdKey: appDict.id,
            pageDict: dict
          };
        }
      }
    }

    return null;
  }

  async selectPage(appIdKey, pageIdKey, skipReadyCheck = false) {
    this.appIdKey = `PID:${appIdKey}`;
    this.pageIdKey = pageIdKey;

    _logger.default.debug(`Selecting page '${pageIdKey}' on app '${this.appIdKey}' and forwarding socket setup`);

    const startTime = process.hrtime();
    await this.rpcClient.selectPage(this.appIdKey, pageIdKey);

    if (!skipReadyCheck && !(await this.checkPageIsReady())) {
      await this.pageUnload();
    }

    _logger.default.debug(`Selected page after ${(0, _helpers.getElapsedTime)(startTime)}ms`);
  }

  async executeAtom(atom, args, frames) {
    if (!this.rpcClient.isConnected()) {
      throw new Error('Remote debugger is not connected');
    }

    _logger.default.debug(`Executing atom '${atom}'`);

    const script = await (0, _helpers.getScriptForAtom)(atom, args, frames);
    const value = await this.execute(script, true);

    _logger.default.debug(`Received result for atom '${atom}' execution: ${_lodash.default.truncate((0, _helpers.simpleStringify)(value), {
      length: _helpers.RESPONSE_LOG_LENGTH
    })}`);

    return value;
  }

  async executeAtomAsync(atom, args, frames) {
    const promiseName = `appiumAsyncExecutePromise${_uuidJs.default.create().toString().replace(/-/g, '')}`;
    let script = `var res, rej;` + `window.${promiseName} = new Promise(function (resolve, reject) {` + `  res = resolve;` + `  rej = reject;` + `});` + `window.${promiseName}.resolve = res;` + `window.${promiseName}.reject = rej;` + `window.${promiseName};`;
    const obj = await this.rpcClient.send('sendJSCommand', {
      command: script,
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey,
      returnByValue: false
    });
    const promiseObjectId = obj.result.objectId;
    const asyncCallBack = `function (res) {` + `  window.${promiseName}.resolve(res);` + `  window.${promiseName}Value = res;` + `}`;
    await this.execute((await (0, _helpers.getScriptForAtom)(atom, args, frames, asyncCallBack)));
    let res;
    const subcommandTimeout = 1000;

    try {
      res = await this.rpcClient.send('awaitPromise', {
        promiseObjectId,
        appIdKey: this.appIdKey,
        pageIdKey: this.pageIdKey
      });
    } catch (err) {
      if (!err.message.includes(`'Runtime.awaitPromise' was not found`)) {
        throw err;
      }

      const retryWait = 100;
      const timeout = args.length >= 3 ? args[2] : RPC_RESPONSE_TIMEOUT_MS;
      const retries = parseInt(timeout / retryWait, 10) || 1;
      const startTime = process.hrtime();
      res = await (0, _asyncbox.retryInterval)(retries, retryWait, async () => {
        if (await this.executeAtom('execute_script', [`return window.hasOwnProperty('${promiseName}Value');`, [null, null], subcommandTimeout], frames)) {
          return await this.executeAtom('execute_script', [`return window.${promiseName}Value;`, [null, null], subcommandTimeout], frames);
        }

        throw new _appiumBaseDriver.errors.TimeoutError(`Timed out waiting for asynchronous script ` + `result after ${(0, _helpers.getElapsedTime)(startTime)} ms'));`);
      });
    } finally {
      try {
        await this.executeAtom('execute_script', [`delete window.${promiseName};`, [null, null], subcommandTimeout], frames);
      } catch (ign) {}
    }

    return (0, _helpers.convertResult)(res);
  }

  frameDetached() {
    this.emit(RemoteDebugger.EVENT_FRAMES_DETACHED);
  }

  async pageLoad(startPageLoadMs, pageLoadVerifyHook) {
    let timeoutMs = 500;
    let start = startPageLoadMs || Date.now();

    _logger.default.debug('Page loaded, verifying whether ready');

    this.pageLoading = true;

    const verify = async () => {
      this.pageLoadDelay = _appiumSupport.util.cancellableDelay(timeoutMs);

      try {
        await this.pageLoadDelay;
      } catch (err) {
        if (err instanceof _bluebird.default.CancellationError) {
          return;
        }
      }

      if (!this.appIdKey) {
        _logger.default.debug('Not connected to an application. Ignoring page load');

        return;
      }

      if (_lodash.default.isFunction(pageLoadVerifyHook)) {
        await pageLoadVerifyHook();
      }

      const ready = await this.checkPageIsReady();

      if (ready || this.pageLoadMs > 0 && start + this.pageLoadMs < Date.now()) {
        _logger.default.debug('Page is ready');

        this.pageLoading = false;
      } else {
        _logger.default.debug('Page was not ready, retrying');

        await verify();
      }
    };

    await verify();
  }

  cancelPageLoad() {
    _logger.default.debug('Unregistering from page readiness notifications');

    this.pageLoading = false;

    if (this.pageLoadDelay) {
      this.pageLoadDelay.cancel();
    }
  }

  async pageUnload() {
    _logger.default.debug('Page unloading');

    await this.waitForDom();
  }

  async waitForDom(startPageLoadMs, pageLoadVerifyHook) {
    _logger.default.debug('Waiting for dom...');

    await this.pageLoad(startPageLoadMs, pageLoadVerifyHook);
  }

  async checkPageIsReady() {
    const errors = (0, _helpers.checkParams)({
      appIdKey: this.appIdKey
    });
    if (errors) throw new Error(errors);

    _logger.default.debug('Checking document readyState');

    const readyCmd = 'document.readyState;';
    let readyState = 'loading';

    try {
      readyState = await _bluebird.default.resolve(this.execute(readyCmd, true)).timeout(this.pageReadyTimeout);
    } catch (err) {
      if (!(err instanceof _bluebird.default.TimeoutError)) {
        throw err;
      }

      _logger.default.debug(`Page readiness check timed out after ${this.pageReadyTimeout}ms`);

      return false;
    }

    _logger.default.debug(`Document readyState is '${readyState}'`);

    return readyState === 'complete';
  }

  async launchSafari() {
    await this.rpcClient.send('launchApplication', {
      bundleId: SAFARI_BUNDLE_ID
    });
  }

  async navToUrl(url, pageLoadVerifyHook) {
    const errors = (0, _helpers.checkParams)({
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });

    if (errors) {
      throw new Error(errors);
    }

    this._navigatingToPage = true;

    try {
      _logger.default.debug(`Navigating to new URL: '${url}'`);

      const waitForFramePromise = this.waitForFrameNavigated();
      await this.rpcClient.send('setUrl', {
        url,
        appIdKey: this.appIdKey,
        pageIdKey: this.pageIdKey
      });

      if (!this.useNewSafari) {
        await _bluebird.default.delay(1000);
      }

      await waitForFramePromise;
      await this.waitForDom(Date.now(), pageLoadVerifyHook);
      await this.rpcClient.send('enableConsole', {
        appIdKey: this.appIdKey,
        pageIdKey: this.pageIdKey
      });
    } finally {
      this._navigatingToPage = false;
    }
  }

  async waitForFrameNavigated() {
    return await new _bluebird.default(async (resolve, reject) => {
      _logger.default.debug('Waiting for frame navigated message...');

      let startMs = Date.now();

      const navEventListener = value => {
        _logger.default.debug(`Frame navigated in ${(Date.now() - startMs) / 1000}s from: ${value}`);

        if (!this.allowNavigationWithoutReload && !this.pageLoading) {
          resolve(value);
        } else {
          _logger.default.debug('Frame navigated but we were warned about it, not ' + 'considering page state unloaded');

          this.allowNavigationWithoutReload = false;
        }

        if (this.navigationDelay) {
          this.navigationDelay.cancel();
        }
      };

      this.rpcClient.setSpecialMessageHandler('Page.frameNavigated', reject, navEventListener);

      if (!this.useNewSafari || this.pageLoadMs >= 0) {
        let timeout = this.useNewSafari ? this.pageLoadMs : 500;
        this.navigationDelay = _appiumSupport.util.cancellableDelay(timeout);

        try {
          await this.navigationDelay;
          navEventListener('timeout');
        } catch (err) {}
      }
    });
  }

  async startTimeline(fn) {
    _logger.default.debug('Starting to record the timeline');

    this.rpcClient.setTimelineEventHandler(fn);
    return await this.rpcClient.send('startTimeline', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });
  }

  async stopTimeline() {
    _logger.default.debug('Stopping to record the timeline');

    await this.rpcClient.send('stopTimeline', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });
  }

  async startConsole(fn) {
    _logger.default.debug('Starting to listen for JavaScript console');

    if (_lodash.default.isFunction(fn)) {
      this.rpcClient.setConsoleLogEventHandler(fn);
    }
  }

  async stopConsole() {
    _logger.default.debug('Stopping to listen for JavaScript console');

    await this.rpcClient.send('disableConsole', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });
  }

  async startNetwork(fn) {
    _logger.default.debug('Starting to listen for network events');

    this.rpcClient.setNetworkLogEventHandler(fn);
    return await this.rpcClient.send('startNetwork', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });
  }

  async stopNetwork() {
    _logger.default.debug('Stopping to listen for network events');

    await this.rpcClient.send('stopNetwork', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });
  }

  async execute(command, override) {
    if (this.pageLoading && !override) {
      _logger.default.debug('Trying to execute but page is not loaded.');

      await this.waitForDom();
    }

    const errors = (0, _helpers.checkParams)({
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });

    if (errors) {
      throw new Error(errors);
    }

    if (this.garbageCollectOnExecute) {
      await this.garbageCollect();
    }

    _logger.default.debug(`Sending javascript command: '${_lodash.default.truncate(command, {
      length: 50
    })}'`);

    let res = await this.rpcClient.send('sendJSCommand', {
      command,
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });
    return (0, _helpers.convertResult)(res);
  }

  async callFunction(objId, fn, args) {
    let errors = (0, _helpers.checkParams)({
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });
    if (errors) throw new Error(errors);

    if (this.garbageCollectOnExecute) {
      await this.garbageCollect();
    }

    _logger.default.debug('Calling javascript function');

    const res = await this.rpcClient.send('callJSFunction', {
      objId,
      fn,
      args,
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });
    return (0, _helpers.convertResult)(res);
  }

  set allowNavigationWithoutReload(allow) {
    this._allowNavigationWithoutReload = allow;
  }

  get allowNavigationWithoutReload() {
    return this._allowNavigationWithoutReload;
  }

  async getCookies(urls) {
    _logger.default.debug('Getting network cookies');

    return await this.rpcClient.send('getCookies', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey,
      urls
    });
  }

  async deleteCookie(cookieName, url) {
    _logger.default.debug(`Deleting cookie '${cookieName}' on '${url}'`);

    return await this.rpcClient.send('deleteCookie', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey,
      cookieName,
      url
    });
  }

  async garbageCollect(timeoutMs = GARBAGE_COLLECT_TIMEOUT) {
    _logger.default.debug(`Garbage collecting with ${timeoutMs}ms timeout`);

    const errors = (0, _helpers.checkParams)({
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    });

    if (errors) {
      _logger.default.debug(`Unable to collect garbage at this time`);

      return;
    }

    await _bluebird.default.resolve(this.rpcClient.send('garbageCollect', {
      appIdKey: this.appIdKey,
      pageIdKey: this.pageIdKey
    })).timeout(timeoutMs).then(function gcSuccess() {
      _logger.default.debug(`Garbage collection successful`);
    }).catch(function gcError(err) {
      if (err instanceof _bluebird.default.TimeoutError) {
        _logger.default.debug(`Garbage collection timed out after ${timeoutMs}ms`);
      } else {
        _logger.default.debug(`Unable to collect garbage: ${err.message}`);
      }
    });
  }

  async useAppDictLock(fn) {
    return await this._lock.acquire('appDict', fn);
  }

}

exports.RemoteDebugger = RemoteDebugger;
RemoteDebugger.EVENT_PAGE_CHANGE = 'remote_debugger_page_change';
RemoteDebugger.EVENT_FRAMES_DETACHED = 'remote_debugger_frames_detached';
RemoteDebugger.EVENT_DISCONNECT = 'remote_debugger_disconnect';

for (const [name, handler] of _lodash.default.toPairs(_messageHandlers.default)) {
  RemoteDebugger.prototype[name] = handler;
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9yZW1vdGUtZGVidWdnZXIuanMiXSwibmFtZXMiOlsiVkVSU0lPTiIsInJlcXVpcmUiLCJwYXRoIiwicmVzb2x2ZSIsIl9fZGlybmFtZSIsInZlcnNpb24iLCJpZ24iLCJTRUxFQ1RfQVBQX1JFVFJJRVMiLCJTRUxFQ1RfQVBQX1JFVFJZX1NMRUVQX01TIiwiUkVNT1RFX0RFQlVHR0VSX1BPUlQiLCJTQUZBUklfQlVORExFX0lEIiwiQkxBTktfUEFHRV9VUkwiLCJSUENfUkVTUE9OU0VfVElNRU9VVF9NUyIsIlBBR0VfUkVBRFlfVElNRU9VVCIsIkdBUkJBR0VfQ09MTEVDVF9USU1FT1VUIiwiQUNUSVZFX0FQUF9DT0RFIiwiUmVtb3RlRGVidWdnZXIiLCJldmVudHMiLCJFdmVudEVtaXR0ZXIiLCJjb25zdHJ1Y3RvciIsIm9wdHMiLCJsb2ciLCJpbmZvIiwiYnVuZGxlSWQiLCJhZGRpdGlvbmFsQnVuZGxlSWRzIiwicGxhdGZvcm1WZXJzaW9uIiwiaXNTYWZhcmkiLCJpbmNsdWRlU2FmYXJpIiwidXNlTmV3U2FmYXJpIiwicGFnZUxvYWRNcyIsImhvc3QiLCJwb3J0Iiwic29ja2V0UGF0aCIsInBhZ2VSZWFkeVRpbWVvdXQiLCJyZW1vdGVEZWJ1Z1Byb3h5IiwiZ2FyYmFnZUNvbGxlY3RPbkV4ZWN1dGUiLCJsb2dGdWxsUmVzcG9uc2UiLCJsb2dBbGxDb21tdW5pY2F0aW9uIiwibG9nQWxsQ29tbXVuaWNhdGlvbkhleER1bXAiLCJzb2NrZXRDaHVua1NpemUiLCJkZWJ1ZyIsIl8iLCJpc05pbCIsInNraXBwZWRBcHBzIiwiX2xvY2siLCJBc3luY0xvY2siLCJzZXR1cCIsImFwcERpY3QiLCJhcHBJZEtleSIsInBhZ2VJZEtleSIsInBhZ2VMb2FkaW5nIiwiX25hdmlnYXRpbmdUb1BhZ2UiLCJhbGxvd05hdmlnYXRpb25XaXRob3V0UmVsb2FkIiwic3BlY2lhbENicyIsIm5vb3AiLCJvblBhZ2VDaGFuZ2UiLCJiaW5kIiwib25Db25uZWN0ZWRBcHBsaWNhdGlvbkxpc3QiLCJvbkFwcENvbm5lY3QiLCJvbkFwcERpc2Nvbm5lY3QiLCJvbkFwcFVwZGF0ZSIsIm9uQ29ubmVjdGVkRHJpdmVyTGlzdCIsInBhZ2VMb2FkIiwiZnJhbWVEZXRhY2hlZCIsInJwY0NsaWVudCIsInRlYXJkb3duIiwicmVtb3ZlQWxsTGlzdGVuZXJzIiwiRVZFTlRfUEFHRV9DSEFOR0UiLCJFVkVOVF9ESVNDT05ORUNUIiwiY29ubmVjdCIsIlJwY0NsaWVudFNpbXVsYXRvciIsInNwZWNpYWxNZXNzYWdlSGFuZGxlcnMiLCJtZXNzYWdlUHJveHkiLCJzZXRDb25uZWN0aW9uS2V5IiwiZXJyIiwiZXJyb3IiLCJtZXNzYWdlIiwiZGlzY29ubmVjdCIsImVtaXQiLCJpc0Nvbm5lY3RlZCIsInNlbmQiLCJ1cGRhdGVBcHBzV2l0aERpY3QiLCJkaWN0IiwiaWQiLCJlbnRyeSIsInBhZ2VBcnJheSIsImlzVW5kZWZpbmVkIiwibG9nQXBwbGljYXRpb25EaWN0aW9uYXJ5IiwiYXBwcyIsImdldFZhbHVlU3RyaW5nIiwia2V5IiwidmFsdWUiLCJpc0Z1bmN0aW9uIiwiaXNBcnJheSIsIkpTT04iLCJzdHJpbmdpZnkiLCJhcHAiLCJ0b1BhaXJzIiwiQXJyYXkiLCJsZW5ndGgiLCJwYWdlIiwicHJlZml4IiwiayIsInYiLCJ2YWx1ZVN0cmluZyIsInNlbGVjdEFwcCIsImN1cnJlbnRVcmwiLCJtYXhUcmllcyIsImlnbm9yZUFib3V0QmxhbmtVcmwiLCJzaG91bGRDaGVja0ZvclRhcmdldCIsInN0YXJ0VGltZSIsInByb2Nlc3MiLCJocnRpbWUiLCJpc0VtcHR5IiwicGFnZURpY3QiLCJzZWFyY2hGb3JBcHAiLCJlcnJvckFuZFRocm93IiwiZnVsbFBhZ2VBcnJheSIsImlzQWN0aXZlIiwicmVwbGFjZSIsInVybCIsImNsb25lIiwicHVzaCIsImJ1bmRsZUlkcyIsInJldHJ5Q291bnQiLCJwb3NzaWJsZUFwcElkcyIsImpvaW4iLCJhdHRlbXB0ZWRBcHBJZEtleSIsInJlc3VsdCIsInNlYXJjaEZvclBhZ2UiLCJFcnJvciIsImFwcHNEaWN0IiwidmFsdWVzIiwicHJvbWlzZSIsInNlbGVjdFBhZ2UiLCJza2lwUmVhZHlDaGVjayIsImNoZWNrUGFnZUlzUmVhZHkiLCJwYWdlVW5sb2FkIiwiZXhlY3V0ZUF0b20iLCJhdG9tIiwiYXJncyIsImZyYW1lcyIsInNjcmlwdCIsImV4ZWN1dGUiLCJ0cnVuY2F0ZSIsIlJFU1BPTlNFX0xPR19MRU5HVEgiLCJleGVjdXRlQXRvbUFzeW5jIiwicHJvbWlzZU5hbWUiLCJVVUlEIiwiY3JlYXRlIiwidG9TdHJpbmciLCJvYmoiLCJjb21tYW5kIiwicmV0dXJuQnlWYWx1ZSIsInByb21pc2VPYmplY3RJZCIsIm9iamVjdElkIiwiYXN5bmNDYWxsQmFjayIsInJlcyIsInN1YmNvbW1hbmRUaW1lb3V0IiwiaW5jbHVkZXMiLCJyZXRyeVdhaXQiLCJ0aW1lb3V0IiwicmV0cmllcyIsInBhcnNlSW50IiwiZXJyb3JzIiwiVGltZW91dEVycm9yIiwiRVZFTlRfRlJBTUVTX0RFVEFDSEVEIiwic3RhcnRQYWdlTG9hZE1zIiwicGFnZUxvYWRWZXJpZnlIb29rIiwidGltZW91dE1zIiwic3RhcnQiLCJEYXRlIiwibm93IiwidmVyaWZ5IiwicGFnZUxvYWREZWxheSIsInV0aWwiLCJjYW5jZWxsYWJsZURlbGF5IiwiQiIsIkNhbmNlbGxhdGlvbkVycm9yIiwicmVhZHkiLCJjYW5jZWxQYWdlTG9hZCIsImNhbmNlbCIsIndhaXRGb3JEb20iLCJyZWFkeUNtZCIsInJlYWR5U3RhdGUiLCJsYXVuY2hTYWZhcmkiLCJuYXZUb1VybCIsIndhaXRGb3JGcmFtZVByb21pc2UiLCJ3YWl0Rm9yRnJhbWVOYXZpZ2F0ZWQiLCJkZWxheSIsInJlamVjdCIsInN0YXJ0TXMiLCJuYXZFdmVudExpc3RlbmVyIiwibmF2aWdhdGlvbkRlbGF5Iiwic2V0U3BlY2lhbE1lc3NhZ2VIYW5kbGVyIiwic3RhcnRUaW1lbGluZSIsImZuIiwic2V0VGltZWxpbmVFdmVudEhhbmRsZXIiLCJzdG9wVGltZWxpbmUiLCJzdGFydENvbnNvbGUiLCJzZXRDb25zb2xlTG9nRXZlbnRIYW5kbGVyIiwic3RvcENvbnNvbGUiLCJzdGFydE5ldHdvcmsiLCJzZXROZXR3b3JrTG9nRXZlbnRIYW5kbGVyIiwic3RvcE5ldHdvcmsiLCJvdmVycmlkZSIsImdhcmJhZ2VDb2xsZWN0IiwiY2FsbEZ1bmN0aW9uIiwib2JqSWQiLCJhbGxvdyIsIl9hbGxvd05hdmlnYXRpb25XaXRob3V0UmVsb2FkIiwiZ2V0Q29va2llcyIsInVybHMiLCJkZWxldGVDb29raWUiLCJjb29raWVOYW1lIiwidGhlbiIsImdjU3VjY2VzcyIsImNhdGNoIiwiZ2NFcnJvciIsInVzZUFwcERpY3RMb2NrIiwiYWNxdWlyZSIsIm5hbWUiLCJoYW5kbGVyIiwibWVzc2FnZUhhbmRsZXJzIiwicHJvdG90eXBlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUlBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUdBLElBQUlBLE9BQUo7O0FBQ0EsSUFBSTtBQUNGQSxFQUFBQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQ0MsY0FBS0MsT0FBTCxDQUFhQyxTQUFiLEVBQXdCLElBQXhCLEVBQThCLElBQTlCLEVBQW9DLGNBQXBDLENBQUQsQ0FBUCxDQUE2REMsT0FBdkU7QUFDRCxDQUZELENBRUUsT0FBT0MsR0FBUCxFQUFZLENBQUU7O0FBRWhCLE1BQU1DLGtCQUFrQixHQUFHLEVBQTNCO0FBQ0EsTUFBTUMseUJBQXlCLEdBQUcsR0FBbEM7QUFDQSxNQUFNQyxvQkFBb0IsR0FBRyxLQUE3Qjs7QUFDQSxNQUFNQyxnQkFBZ0IsR0FBRyx3QkFBekI7QUFDQSxNQUFNQyxjQUFjLEdBQUcsYUFBdkI7QUFHQSxNQUFNQyx1QkFBdUIsR0FBRyxJQUFoQzs7QUFFQSxNQUFNQyxrQkFBa0IsR0FBRyxJQUEzQjtBQUVBLE1BQU1DLHVCQUF1QixHQUFHLElBQWhDO0FBRUEsTUFBTUMsZUFB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O0FBQzFCbk0sc0JBQUltQixLQUFKLENBQVcsK0JBQVg7QUFDRCxLQU5LLEVBTUhpTCxLQU5HLENBTUcsU0FBU0MsT0FBVCxDQUFrQmhKLEdBQWxCLEVBQXVCO0FBQzlCLFVBQUlBLEdBQUcsWUFBWXVHLGtCQUFFWixZQUFyQixFQUFtQztBQUNqQ2hKLHdCQUFJbUIsS0FBSixDQUFXLHNDQUFxQ2lJLFNBQVUsSUFBMUQ7QUFDRCxPQUZELE1BRU87QUFDTHBKLHdCQUFJbUIsS0FBSixDQUFXLDhCQUE2QmtDLEdBQUcsQ0FBQ0UsT0FBUSxFQUFwRDtBQUNEO0FBQ0YsS0FaSyxDQUFOO0FBYUQ7O0FBRUQsUUFBTStJLGNBQU4sQ0FBc0J2QixFQUF0QixFQUEwQjtBQUN4QixXQUFPLE1BQU0sS0FBS3hKLEtBQUwsQ0FBV2dMLE9BQVgsQ0FBbUIsU0FBbkIsRUFBOEJ4QixFQUE5QixDQUFiO0FBQ0Q7O0FBaHZCOEM7OztBQW92QmpEcEwsY0FBYyxDQUFDbUQsaUJBQWYsR0FBbUMsNkJBQW5DO0FBQ0FuRCxjQUFjLENBQUNzSixxQkFBZixHQUF1QyxpQ0FBdkM7QUFDQXRKLGNBQWMsQ0FBQ29ELGdCQUFmLEdBQWtDLDRCQUFsQzs7QUFHQSxLQUFLLE1BQU0sQ0FBQ3lKLElBQUQsRUFBT0MsT0FBUCxDQUFYLElBQThCckwsZ0JBQUV3RCxPQUFGLENBQVU4SCx3QkFBVixDQUE5QixFQUEwRDtBQUN4RC9NLEVBQUFBLGNBQWMsQ0FBQ2dOLFNBQWYsQ0FBeUJILElBQXpCLElBQWlDQyxPQUFqQztBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGV2ZW50cyBmcm9tICdldmVudHMnO1xuaW1wb3J0IGxvZyBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgeyBlcnJvcnMgfSBmcm9tICdhcHBpdW0tYmFzZS1kcml2ZXInO1xuaW1wb3J0IFJwY0NsaWVudFNpbXVsYXRvciBmcm9tICcuL3JwYy1jbGllbnQtc2ltdWxhdG9yJztcbmltcG9ydCBtZXNzYWdlSGFuZGxlcnMgZnJvbSAnLi9tZXNzYWdlLWhhbmRsZXJzJztcbmltcG9ydCB7IGFwcEluZm9Gcm9tRGljdCwgcGFnZUFycmF5RnJvbURpY3QsIGdldERlYnVnZ2VyQXBwS2V5LFxuICAgICAgICAgZ2V0UG9zc2libGVEZWJ1Z2dlckFwcEtleXMsIGNoZWNrUGFyYW1zLCBnZXRTY3JpcHRGb3JBdG9tLFxuICAgICAgICAgc2ltcGxlU3RyaW5naWZ5LCBkZWZlcnJlZFByb21pc2UsIGdldEVsYXBzZWRUaW1lLCBjb252ZXJ0UmVzdWx0LFxuICAgICAgICAgUkVTUE9OU0VfTE9HX0xFTkdUSCB9IGZyb20gJy4vaGVscGVycyc7XG5pbXBvcnQgeyB1dGlsIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IHsgcmV0cnlJbnRlcnZhbCB9IGZyb20gJ2FzeW5jYm94JztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBVVUlEIGZyb20gJ3V1aWQtanMnO1xuaW1wb3J0IEFzeW5jTG9jayBmcm9tICdhc3luYy1sb2NrJztcblxuXG5sZXQgVkVSU0lPTjtcbnRyeSB7XG4gIFZFUlNJT04gPSByZXF1aXJlKHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICcuLicsICcuLicsICdwYWNrYWdlLmpzb24nKSkudmVyc2lvbjtcbn0gY2F0Y2ggKGlnbikge31cblxuY29uc3QgU0VMRUNUX0FQUF9SRVRSSUVTID0gMjA7XG5jb25zdCBTRUxFQ1RfQVBQX1JFVFJZX1NMRUVQX01TID0gNTAwO1xuY29uc3QgUkVNT1RFX0RFQlVHR0VSX1BPUlQgPSAyNzc1MztcbmNvbnN0IFNBRkFSSV9CVU5ETEVfSUQgPSAnY29tLmFwcGxlLm1vYmlsZXNhZmFyaSc7XG5jb25zdCBCTEFOS19QQUdFX1VSTCA9ICdhYm91dDpibGFuayc7XG5cbi8qIEhvdyBtYW55IG1pbGxpc2Vjb25kcyB0byB3YWl0IGZvciB3ZWJraXQgdG8gcmV0dXJuIGEgcmVzcG9uc2UgYmVmb3JlIHRpbWluZyBvdXQgKi9cbmNvbnN0IFJQQ19SRVNQT05TRV9USU1FT1VUX01TID0gNTAwMDtcblxuY29uc3QgUEFHRV9SRUFEWV9USU1FT1VUID0gNTAwMDtcblxuY29uc3QgR0FSQkFHRV9DT0xMRUNUX1RJTUVPVVQgPSA1MDAwO1xuXG5jb25zdCBBQ1RJVkVfQVBQX0NPREUgPSAwO1xuXG5jbGFzcyBSZW1vdGVEZWJ1Z2dlciBleHRlbmRzIGV2ZW50cy5FdmVudEVtaXR0ZXIge1xuICAvKlxuICAgKiBUaGUgY29uc3RydWN0b3IgdGFrZXMgYW4gb3B0cyBoYXNoIHdpdGggdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOlxuICAgKiAgIC0gYnVuZGxlSWQgLSBpZCBvZiB0aGUgYXBwIGJlaW5nIGNvbm5lY3RlZCB0b1xuICAgKiAgIC0gYWRkaXRpb25hbEJ1bmRsZUlkcyAtIGFycmF5IG9mIHBvc3NpYmxlIGJ1bmRsZSBpZHMgdGhhdCB0aGUgaW5zcGVjdG9yXG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bGQgcmV0dXJuXG4gICAqICAgLSBwbGF0Zm9ybVZlcnNpb24gLSB2ZXJzaW9uIG9mIGlPU1xuICAgKiAgIC0gdXNlTmV3U2FmYXJpIC0gZm9yIHdlYiBpbnNwZWN0b3IsIHdoZXRoZXIgdGhpcyBpcyBhIG5ldyBTYWZhcmkgaW5zdGFuY2VcbiAgICogICAtIHBhZ2VMb2FkTXMgLSB0aGUgdGltZSwgaW4gbXMsIHRoYXQgc2hvdWxkIGJlIHdhaXRlZCBmb3IgcGFnZSBsb2FkaW5nXG4gICAqICAgLSBob3N0IC0gdGhlIHJlbW90ZSBkZWJ1Z2dlcidzIGhvc3QgYWRkcmVzc1xuICAgKiAgIC0gcG9ydCAtIHRoZSByZW1vdGUgZGVidWdnZXIgcG9ydCB0aHJvdWdoIHdoaWNoIHRvIGNvbW11bmljYXRlXG4gICAqICAgLSBsb2dBbGxDb21tdW5pY2F0aW9uIC0gbG9nIHBsaXN0cyBzZW50IGFuZCByZWNlaXZlZCBmcm9tIFdlYiBJbnNwZWN0b3JcbiAgICogICAtIGxvZ0FsbENvbW11bmljYXRpb25IZXhEdW1wIC0gbG9nIGNvbW11bmljYXRpb24gZnJvbSBXZWIgSW5zcGVjdG9yIGFzIGhleCBkdW1wXG4gICAqICAgLSBzb2NrZXRDaHVua1NpemUgLSBzaXplLCBpbiBieXRlcywgb2YgY2h1bmtzIG9mIGRhdGEgc2VudCB0byBXZWIgSW5zcGVjdG9yIChyZWFsIGRldmljZSBvbmx5KVxuICAgKi9cbiAgY29uc3RydWN0b3IgKG9wdHMgPSB7fSkge1xuICAgIHN1cGVyKCk7XG5cbiAgICBpZiAoVkVSU0lPTikge1xuICAgICAgbG9nLmluZm8oYFJlbW90ZSBEZWJ1Z2dlciB2ZXJzaW9uICR7VkVSU0lPTn1gKTtcbiAgICB9XG5cbiAgICBjb25zdCB7XG4gICAgICBidW5kbGVJZCxcbiAgICAgIGFkZGl0aW9uYWxCdW5kbGVJZHMgPSBbXSxcbiAgICAgIHBsYXRmb3JtVmVyc2lvbixcbiAgICAgIGlzU2FmYXJpID0gdHJ1ZSxcbiAgICAgIGluY2x1ZGVTYWZhcmkgPSBmYWxzZSxcbiAgICAgIHVzZU5ld1NhZmFyaSA9IGZhbHNlLFxuICAgICAgcGFnZUxvYWRNcyxcbiAgICAgIGhvc3QsXG4gICAgICBwb3J0ID0gUkVNT1RFX0RFQlVHR0VSX1BPUlQsXG4gICAgICBzb2NrZXRQYXRoLFxuICAgICAgcGFnZVJlYWR5VGltZW91dCA9IFBBR0VfUkVBRFlfVElNRU9VVCxcbiAgICAgIHJlbW90ZURlYnVnUHJveHksXG4gICAgICBnYXJiYWdlQ29sbGVjdE9uRXhlY3V0ZSA9IGZhbHNlLFxuICAgICAgbG9nRnVsbFJlc3BvbnNlID0gZmFsc2UsXG4gICAgICBsb2dBbGxDb21tdW5pY2F0aW9uID0gZmFsc2UsXG4gICAgICBsb2dBbGxDb21tdW5pY2F0aW9uSGV4RHVtcCA9IGZhbHNlLFxuICAgICAgc29ja2V0Q2h1bmtTaXplLFxuICAgIH0gPSBvcHRzO1xuXG4gICAgdGhpcy5idW5kbGVJZCA9IGJ1bmRsZUlkO1xuICAgIHRoaXMuYWRkaXRpb25hbEJ1bmRsZUlkcyA9IGFkZGl0aW9uYWxCdW5kbGVJZHM7XG4gICAgdGhpcy5wbGF0Zm9ybVZlcnNpb24gPSBwbGF0Zm9ybVZlcnNpb247XG4gICAgdGhpcy5pc1NhZmFyaSA9IGlzU2FmYXJpO1xuICAgIHRoaXMuaW5jbHVkZVNhZmFyaSA9IGluY2x1ZGVTYWZhcmk7XG4gICAgdGhpcy51c2VOZXdTYWZhcmkgPSB1c2VOZXdTYWZhcmk7XG4gICAgdGhpcy5wYWdlTG9hZE1zID0gcGFnZUxvYWRNcztcbiAgICBsb2cuZGVidWcoYHVzZU5ld1NhZmFyaSAtLT4gJHt0aGlzLnVzZU5ld1NhZmFyaX1gKTtcblxuICAgIHRoaXMuZ2FyYmFnZUNvbGxlY3RPbkV4ZWN1dGUgPSBnYXJiYWdlQ29sbGVjdE9uRXhlY3V0ZTtcblxuICAgIHRoaXMuaG9zdCA9IGhvc3Q7XG4gICAgdGhpcy5wb3J0ID0gcG9ydDtcbiAgICB0aGlzLnNvY2tldFBhdGggPSBzb2NrZXRQYXRoO1xuICAgIHRoaXMucmVtb3RlRGVidWdQcm94eSA9IHJlbW90ZURlYnVnUHJveHk7XG4gICAgdGhpcy5wYWdlUmVhZHlUaW1lb3V0ID0gcGFnZVJlYWR5VGltZW91dDtcblxuICAgIHRoaXMubG9nQWxsQ29tbXVuaWNhdGlvbiA9IF8uaXNOaWwobG9nQWxsQ29tbXVuaWNhdGlvbikgPyAhIWxvZ0Z1bGxSZXNwb25zZSA6ICEhbG9nQWxsQ29tbXVuaWNhdGlvbjtcbiAgICB0aGlzLmxvZ0FsbENvbW11bmljYXRpb25IZXhEdW1wID0gbG9nQWxsQ29tbXVuaWNhdGlvbkhleER1bXA7XG4gICAgdGhpcy5zb2NrZXRDaHVua1NpemUgPSBzb2NrZXRDaHVua1NpemU7XG5cbiAgICB0aGlzLnNraXBwZWRBcHBzID0gW107XG5cbiAgICB0aGlzLl9sb2NrID0gbmV3IEFzeW5jTG9jaygpO1xuICB9XG5cbiAgc2V0dXAgKCkge1xuICAgIC8vIGFwcCBoYW5kbGluZyBjb25maWd1cmF0aW9uXG4gICAgdGhpcy5hcHBEaWN0ID0ge307XG4gICAgdGhpcy5hcHBJZEtleSA9IG51bGw7XG4gICAgdGhpcy5wYWdlSWRLZXkgPSBudWxsO1xuICAgIHRoaXMucGFnZUxvYWRpbmcgPSBmYWxzZTtcbiAgICB0aGlzLl9uYXZpZ2F0aW5nVG9QYWdlID0gZmFsc2U7XG4gICAgdGhpcy5hbGxvd05hdmlnYXRpb25XaXRob3V0UmVsb2FkID0gZmFsc2U7XG5cbiAgICAvLyBzZXQgdXAgdGhlIHNwZWNpYWwgY2FsbGJhY2tzIGZvciBoYW5kbGluZyByZCBldmVudHNcbiAgICB0aGlzLnNwZWNpYWxDYnMgPSB7XG4gICAgICAnX3JwY19yZXBvcnRJZGVudGlmaWVyOic6IF8ubm9vcCxcbiAgICAgICdfcnBjX2ZvcndhcmRHZXRMaXN0aW5nOic6IHRoaXMub25QYWdlQ2hhbmdlLmJpbmQodGhpcyksXG4gICAgICAnX3JwY19yZXBvcnRDb25uZWN0ZWRBcHBsaWNhdGlvbkxpc3Q6JzogdGhpcy5vbkNvbm5lY3RlZEFwcGxpY2F0aW9uTGlzdC5iaW5kKHRoaXMpLFxuICAgICAgJ19ycGNfYXBwbGljYXRpb25Db25uZWN0ZWQ6JzogdGhpcy5vbkFwcENvbm5lY3QuYmluZCh0aGlzKSxcbiAgICAgICdfcnBjX2FwcGxpY2F0aW9uRGlzY29ubmVjdGVkOic6IHRoaXMub25BcHBEaXNjb25uZWN0LmJpbmQodGhpcyksXG4gICAgICAnX3JwY19hcHBsaWNhdGlvblVwZGF0ZWQ6JzogdGhpcy5vbkFwcFVwZGF0ZS5iaW5kKHRoaXMpLFxuICAgICAgJ19ycGNfcmVwb3J0Q29ubmVjdGVkRHJpdmVyTGlzdDonOiB0aGlzLm9uQ29ubmVjdGVkRHJpdmVyTGlzdC5iaW5kKHRoaXMpLFxuICAgICAgcGFnZUxvYWQ6IHRoaXMucGFnZUxvYWQuYmluZCh0aGlzKSxcbiAgICAgIGZyYW1lRGV0YWNoZWQ6IHRoaXMuZnJhbWVEZXRhY2hlZC5iaW5kKHRoaXMpLFxuICAgIH07XG5cbiAgICB0aGlzLnJwY0NsaWVudCA9IG51bGw7XG4gIH1cblxuICB0ZWFyZG93biAoKSB7XG4gICAgbG9nLmRlYnVnKCdDbGVhbmluZyB1cCBsaXN0ZW5lcnMnKTtcblxuICAgIHRoaXMuYXBwRGljdCA9IHt9O1xuICAgIHRoaXMuYXBwSWRLZXkgPSBudWxsO1xuICAgIHRoaXMucGFnZUlkS2V5ID0gbnVsbDtcbiAgICB0aGlzLnBhZ2VMb2FkaW5nID0gZmFsc2U7XG5cbiAgICB0aGlzLnNwZWNpYWxDYnMgPSB7fTtcblxuICAgIHRoaXMucnBjQ2xpZW50ID0gbnVsbDtcblxuICAgIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKFJlbW90ZURlYnVnZ2VyLkVWRU5UX1BBR0VfQ0hBTkdFKTtcbiAgICB0aGlzLnJlbW92ZUFsbExpc3RlbmVycyhSZW1vdGVEZWJ1Z2dlci5FVkVOVF9ESVNDT05ORUNUKTtcbiAgfVxuXG4gIGFzeW5jIGNvbm5lY3QgKCkge1xuICAgIHRoaXMuc2V0dXAoKTtcblxuICAgIC8vIGluaXRpYWxpemUgdGhlIHJwYyBjbGllbnRcbiAgICB0aGlzLnJwY0NsaWVudCA9IG5ldyBScGNDbGllbnRTaW11bGF0b3Ioe1xuICAgICAgYnVuZGxlSWQ6IHRoaXMuYnVuZGxlSWQsXG4gICAgICBwbGF0Zm9ybVZlcnNpb246IHRoaXMucGxhdGZvcm1WZXJzaW9uLFxuICAgICAgaXNTYWZhcmk6IHRoaXMuaXNTYWZhcmksXG4gICAgICBob3N0OiB0aGlzLmhvc3QsXG4gICAgICBwb3J0OiB0aGlzLnBvcnQsXG4gICAgICBzb2NrZXRQYXRoOiB0aGlzLnNvY2tldFBhdGgsXG4gICAgICBzcGVjaWFsTWVzc2FnZUhhbmRsZXJzOiB0aGlzLnNwZWNpYWxDYnMsXG4gICAgICBtZXNzYWdlUHJveHk6IHRoaXMucmVtb3RlRGVidWdQcm94eSxcbiAgICAgIGxvZ0FsbENvbW11bmljYXRpb246IHRoaXMubG9nQWxsQ29tbXVuaWNhdGlvbixcbiAgICAgIGxvZ0FsbENvbW11bmljYXRpb25IZXhEdW1wOiB0aGlzLmxvZ0FsbENvbW11bmljYXRpb25IZXhEdW1wLFxuICAgIH0pO1xuICAgIGF3YWl0IHRoaXMucnBjQ2xpZW50LmNvbm5lY3QoKTtcblxuICAgIC8vIGdldCB0aGUgY29ubmVjdGlvbiBpbmZvcm1hdGlvbiBhYm91dCB0aGUgYXBwXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuc2V0Q29ubmVjdGlvbktleSgpO1xuICAgICAgcmV0dXJuIHRoaXMuYXBwRGljdCB8fCB7fTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZy5lcnJvcihgRXJyb3Igc2V0dGluZyBjb25uZWN0aW9uIGtleTogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgIGF3YWl0IHRoaXMuZGlzY29ubmVjdCgpO1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGRpc2Nvbm5lY3QgKCkge1xuICAgIGlmICh0aGlzLnJwY0NsaWVudCkge1xuICAgICAgYXdhaXQgdGhpcy5ycGNDbGllbnQuZGlzY29ubmVjdCgpO1xuICAgIH1cbiAgICB0aGlzLmVtaXQoUmVtb3RlRGVidWdnZXIuRVZFTlRfRElTQ09OTkVDVCwgdHJ1ZSk7XG4gICAgdGhpcy50ZWFyZG93bigpO1xuICB9XG5cbiAgaXNDb25uZWN0ZWQgKCkge1xuICAgIHJldHVybiAhISh0aGlzLnJwY0NsaWVudCAmJiB0aGlzLnJwY0NsaWVudC5pc0Nvbm5lY3RlZCgpKTtcbiAgfVxuXG4gIGFzeW5jIHNldENvbm5lY3Rpb25LZXkgKCkge1xuICAgIGxvZy5kZWJ1ZygnU2VuZGluZyBjb25uZWN0aW9uIGtleSByZXF1ZXN0Jyk7XG4gICAgLy8gc2VuZCBidXQgb25seSB3YWl0IHRvIG1ha2Ugc3VyZSB0aGUgc29ja2V0IHdvcmtlZFxuICAgIC8vIGFzIHJlc3BvbnNlIGZyb20gV2ViIEluc3BlY3RvciBjYW4gdGFrZSBhIGxvbmcgdGltZVxuICAgIGF3YWl0IHRoaXMucnBjQ2xpZW50LnNlbmQoJ3NldENvbm5lY3Rpb25LZXknLCB7fSwgZmFsc2UpO1xuICB9XG5cbiAgdXBkYXRlQXBwc1dpdGhEaWN0IChkaWN0KSB7XG4gICAgLy8gZ2V0IHRoZSBkaWN0aW9uYXJ5IGVudHJ5IGludG8gYSBuaWNlIGZvcm0sIGFuZCBhZGQgaXQgdG8gdGhlXG4gICAgLy8gYXBwbGljYXRpb24gZGljdGlvbmFyeVxuICAgIHRoaXMuYXBwRGljdCA9IHRoaXMuYXBwRGljdCB8fCB7fTtcbiAgICBsZXQgW2lkLCBlbnRyeV0gPSBhcHBJbmZvRnJvbURpY3QoZGljdCk7XG4gICAgaWYgKHRoaXMuYXBwRGljdFtpZF0pIHtcbiAgICAgIC8vIHByZXNlcnZlIHRoZSBwYWdlIGRpY3Rpb25hcnkgZm9yIHRoaXMgZW50cnlcbiAgICAgIGVudHJ5LnBhZ2VBcnJheSA9IHRoaXMuYXBwRGljdFtpZF0ucGFnZUFycmF5O1xuICAgIH1cbiAgICB0aGlzLmFwcERpY3RbaWRdID0gZW50cnk7XG5cbiAgICAvLyBhZGQgYSBwcm9taXNlIHRvIGdldCB0aGUgcGFnZSBkaWN0aW9uYXJ5XG4gICAgaWYgKF8uaXNVbmRlZmluZWQoZW50cnkucGFnZUFycmF5KSkge1xuICAgICAgZW50cnkucGFnZUFycmF5ID0gZGVmZXJyZWRQcm9taXNlKCk7XG4gICAgfVxuXG4gICAgLy8gdHJ5IHRvIGdldCB0aGUgYXBwIGlkIGZyb20gb3VyIGNvbm5lY3RlZCBhcHBzXG4gICAgaWYgKCF0aGlzLmFwcElkS2V5KSB7XG4gICAgICB0aGlzLmFwcElkS2V5ID0gZ2V0RGVidWdnZXJBcHBLZXkodGhpcy5idW5kbGVJZCwgdGhpcy5hcHBEaWN0KTtcbiAgICB9XG4gIH1cblxuICBsb2dBcHBsaWNhdGlvbkRpY3Rpb25hcnkgKGFwcHMpIHtcbiAgICBmdW5jdGlvbiBnZXRWYWx1ZVN0cmluZyAoa2V5LCB2YWx1ZSkge1xuICAgICAgaWYgKF8uaXNGdW5jdGlvbih2YWx1ZSkpIHtcbiAgICAgICAgcmV0dXJuICdbRnVuY3Rpb25dJztcbiAgICAgIH1cbiAgICAgIGlmIChrZXkgPT09ICdwYWdlQXJyYXknICYmICFfLmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgIHJldHVybiBgJ1dhaXRpbmcgZm9yIGRhdGEnYDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7XG4gICAgfVxuICAgIGxvZy5kZWJ1ZygnQ3VycmVudCBhcHBsaWNhdGlvbnMgYXZhaWxhYmxlOicpO1xuICAgIGZvciAoY29uc3QgW2FwcCwgaW5mb10gb2YgXy50b1BhaXJzKGFwcHMpKSB7XG4gICAgICBsb2cuZGVidWcoYCAgICBBcHBsaWNhdGlvbjogJyR7YXBwfSdgKTtcbiAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIF8udG9QYWlycyhpbmZvKSkge1xuICAgICAgICBpZiAoa2V5ID09PSAncGFnZUFycmF5JyAmJiBBcnJheS5pc0FycmF5KHZhbHVlKSAmJiB2YWx1ZS5sZW5ndGgpIHtcbiAgICAgICAgICBsb2cuZGVidWcoYCAgICAgICAgJHtrZXl9OmApO1xuICAgICAgICAgIGZvciAoY29uc3QgcGFnZSBvZiB2YWx1ZSkge1xuICAgICAgICAgICAgbGV0IHByZWZpeCA9ICctICc7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IFtrLCB2XSBvZiBfLnRvUGFpcnMocGFnZSkpIHtcbiAgICAgICAgICAgICAgbG9nLmRlYnVnKGAgICAgICAgICAgJHtwcmVmaXh9JHtrfTogJHtKU09OLnN0cmluZ2lmeSh2KX1gKTtcbiAgICAgICAgICAgICAgcHJlZml4ID0gJyAgJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc3QgdmFsdWVTdHJpbmcgPSBnZXRWYWx1ZVN0cmluZyhrZXksIHZhbHVlKTtcbiAgICAgICAgICBsb2cuZGVidWcoYCAgICAgICAgJHtrZXl9OiAke3ZhbHVlU3RyaW5nfWApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc2VsZWN0QXBwIChjdXJyZW50VXJsID0gbnVsbCwgbWF4VHJpZXMgPSBTRUxFQ1RfQVBQX1JFVFJJRVMsIGlnbm9yZUFib3V0QmxhbmtVcmwgPSBmYWxzZSkge1xuICAgIGNvbnN0IHNob3VsZENoZWNrRm9yVGFyZ2V0ID0gdGhpcy5ycGNDbGllbnQuc2hvdWxkQ2hlY2tGb3JUYXJnZXQ7XG4gICAgdGhpcy5ycGNDbGllbnQuc2hvdWxkQ2hlY2tGb3JUYXJnZXQgPSBmYWxzZTtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gcHJvY2Vzcy5ocnRpbWUoKTtcbiAgICAgIGxvZy5kZWJ1ZygnU2VsZWN0aW5nIGFwcGxpY2F0aW9uJyk7XG4gICAgICBpZiAoIXRoaXMuYXBwRGljdCB8fCBfLmlzRW1wdHkodGhpcy5hcHBEaWN0KSkge1xuICAgICAgICBsb2cuZGVidWcoJ05vIGFwcGxpY2F0aW9ucyBjdXJyZW50bHkgY29ubmVjdGVkLicpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHsgYXBwSWRLZXksIHBhZ2VEaWN0IH0gPSBhd2FpdCB0aGlzLnNlYXJjaEZvckFwcChjdXJyZW50VXJsLCBtYXhUcmllcywgaWdub3JlQWJvdXRCbGFua1VybCk7XG5cbiAgICAgIC8vIGlmLCBhZnRlciBhbGwgdGhpcywgd2UgaGF2ZSBubyBkaWN0aW9uYXJ5LCB3ZSBoYXZlIGZhaWxlZFxuICAgICAgaWYgKCFhcHBJZEtleSB8fCAhcGFnZURpY3QpIHtcbiAgICAgICAgbG9nLmVycm9yQW5kVGhyb3coYENvdWxkIG5vdCBjb25uZWN0IHRvIGEgdmFsaWQgYXBwIGFmdGVyICR7bWF4VHJpZXN9IHRyaWVzLmApO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5hcHBJZEtleSAhPT0gYXBwSWRLZXkpIHtcbiAgICAgICAgbG9nLmRlYnVnKGBSZWNlaXZlZCBhbHRlcmVkIGFwcCBpZCwgdXBkYXRpbmcgZnJvbSAnJHt0aGlzLmFwcElkS2V5fScgdG8gJyR7YXBwSWRLZXl9J2ApO1xuICAgICAgICB0aGlzLmFwcElkS2V5ID0gYXBwSWRLZXk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMubG9nQXBwbGljYXRpb25EaWN0aW9uYXJ5KHRoaXMuYXBwRGljdCk7XG5cbiAgICAgIC8vIHRyYW5zbGF0ZSB0aGUgZGljdGlvbmFyeSBpbnRvIGEgdXNlZnVsIGZvcm0sIGFuZCByZXR1cm4gdG8gc2VuZGVyXG4gICAgICBjb25zdCBwYWdlQXJyYXkgPSBfLmlzRW1wdHkodGhpcy5hcHBEaWN0W2FwcElkS2V5XS5wYWdlQXJyYXkpXG4gICAgICAgID8gcGFnZUFycmF5RnJvbURpY3QocGFnZURpY3QpXG4gICAgICAgIDogdGhpcy5hcHBEaWN0W2FwcElkS2V5XS5wYWdlQXJyYXk7XG4gICAgICBsb2cuZGVidWcoYEZpbmFsbHkgc2VsZWN0aW5nIGFwcCAke3RoaXMuYXBwSWRLZXl9OiAke3NpbXBsZVN0cmluZ2lmeShwYWdlQXJyYXkpfWApO1xuXG4gICAgICBsZXQgZnVsbFBhZ2VBcnJheSA9IFtdO1xuICAgICAgZm9yIChjb25zdCBbYXBwLCBpbmZvXSBvZiBfLnRvUGFpcnModGhpcy5hcHBEaWN0KSkge1xuICAgICAgICBpZiAoIV8uaXNBcnJheShpbmZvLnBhZ2VBcnJheSkgfHwgaW5mby5pc0FjdGl2ZSA9PT0gQUNUSVZFX0FQUF9DT0RFKSB7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaWQgPSBhcHAucmVwbGFjZSgnUElEOicsICcnKTtcbiAgICAgICAgZm9yIChjb25zdCBwYWdlIG9mIGluZm8ucGFnZUFycmF5KSB7XG4gICAgICAgICAgaWYgKHBhZ2UudXJsICYmICghaWdub3JlQWJvdXRCbGFua1VybCB8fCBwYWdlLnVybCAhPT0gQkxBTktfUEFHRV9VUkwpKSB7XG4gICAgICAgICAgICBsZXQgcGFnZURpY3QgPSBfLmNsb25lKHBhZ2UpO1xuICAgICAgICAgICAgcGFnZURpY3QuaWQgPSBgJHtpZH0uJHtwYWdlRGljdC5pZH1gO1xuICAgICAgICAgICAgZnVsbFBhZ2VBcnJheS5wdXNoKHBhZ2VEaWN0KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgbG9nLmRlYnVnKGBTZWxlY3RlZCBhcHAgYWZ0ZXIgJHtnZXRFbGFwc2VkVGltZShzdGFydFRpbWUpfW1zYCk7XG4gICAgICByZXR1cm4gZnVsbFBhZ2VBcnJheTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgdGhpcy5ycGNDbGllbnQuc2hvdWxkQ2hlY2tGb3JUYXJnZXQgPSBzaG91bGRDaGVja0ZvclRhcmdldDtcbiAgICB9XG4gIH1cblxuICBhc3luYyBzZWFyY2hGb3JBcHAgKGN1cnJlbnRVcmwsIG1heFRyaWVzLCBpZ25vcmVBYm91dEJsYW5rVXJsKSB7XG4gICAgY29uc3QgYnVuZGxlSWRzID0gdGhpcy5pbmNsdWRlU2FmYXJpICYmICF0aGlzLmlzU2FmYXJpXG4gICAgICA/IFt0aGlzLmJ1bmRsZUlkLCAuLi50aGlzLmFkZGl0aW9uYWxCdW5kbGVJZHMsIFNBRkFSSV9CVU5ETEVfSURdXG4gICAgICA6IFt0aGlzLmJ1bmRsZUlkLCAuLi50aGlzLmFkZGl0aW9uYWxCdW5kbGVJZHNdO1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgcmV0cnlJbnRlcnZhbChtYXhUcmllcywgU0VMRUNUX0FQUF9SRVRSWV9TTEVFUF9NUywgYXN5bmMgKHJldHJ5Q291bnQpID0+IHtcbiAgICAgICAgdGhpcy5sb2dBcHBsaWNhdGlvbkRpY3Rpb25hcnkodGhpcy5hcHBEaWN0KTtcbiAgICAgICAgY29uc3QgcG9zc2libGVBcHBJZHMgPSBnZXRQb3NzaWJsZURlYnVnZ2VyQXBwS2V5cyhidW5kbGVJZHMsIHRoaXMuYXBwRGljdCk7XG4gICAgICAgIGxvZy5kZWJ1ZyhgVHJ5aW5nIG91dCB0aGUgcG9zc2libGUgYXBwIGlkczogJHtwb3NzaWJsZUFwcElkcy5qb2luKCcsICcpfSAodHJ5ICMke3JldHJ5Q291bnQgKyAxfSBvZiAke21heFRyaWVzfSlgKTtcbiAgICAgICAgZm9yIChjb25zdCBhdHRlbXB0ZWRBcHBJZEtleSBvZiBwb3NzaWJsZUFwcElkcykge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAodGhpcy5hcHBEaWN0W2F0dGVtcHRlZEFwcElkS2V5XS5pc0FjdGl2ZSA9PT0gQUNUSVZFX0FQUF9DT0RFKSB7XG4gICAgICAgICAgICAgIGxvZy5kZWJ1ZyhgU2tpcHBpbmcgYXBwICcke2F0dGVtcHRlZEFwcElkS2V5fScgYmVjYXVzZSBpdCBpcyBub3QgYWN0aXZlYCk7XG4gICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbG9nLmRlYnVnKGBBdHRlbXB0aW5nIGFwcCAnJHthdHRlbXB0ZWRBcHBJZEtleX0nYCk7XG4gICAgICAgICAgICBjb25zdCBbYXBwSWRLZXksIHBhZ2VEaWN0XSA9IGF3YWl0IHRoaXMucnBjQ2xpZW50LnNlbGVjdEFwcChhdHRlbXB0ZWRBcHBJZEtleSwgdGhpcy5vbkFwcENvbm5lY3QuYmluZCh0aGlzKSk7XG4gICAgICAgICAgICAvLyBpbiBpT1MgOC4yIHRoZSBjb25uZWN0IGxvZ2ljIGhhcHBlbnMsIGJ1dCB3aXRoIGFuIGVtcHR5IGRpY3Rpb25hcnlcbiAgICAgICAgICAgIC8vIHdoaWNoIGxlYWRzIHRvIHRoZSByZW1vdGUgZGVidWdnZXIgZ2V0dGluZyBkaXNjb25uZWN0ZWQsIGFuZCBpbnRvIGEgbG9vcFxuICAgICAgICAgICAgaWYgKF8uaXNFbXB0eShwYWdlRGljdCkpIHtcbiAgICAgICAgICAgICAgbG9nLmRlYnVnKCdFbXB0eSBwYWdlIGRpY3Rpb25hcnkgcmVjZWl2ZWQuIFRyeWluZyBhZ2Fpbi4nKTtcbiAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHNhdmUgdGhlIHBhZ2UgYXJyYXkgZm9yIHRoaXMgYXBwXG4gICAgICAgICAgICB0aGlzLmFwcERpY3RbYXBwSWRLZXldLnBhZ2VBcnJheSA9IHBhZ2VBcnJheUZyb21EaWN0KHBhZ2VEaWN0KTtcblxuICAgICAgICAgICAgLy8gaWYgd2UgYXJlIGxvb2tpbmcgZm9yIGEgcGFydGljdWxhciB1cmwsIG1ha2Ugc3VyZSB3ZVxuICAgICAgICAgICAgLy8gaGF2ZSB0aGUgcmlnaHQgcGFnZS4gSWdub3JlIGVtcHR5IG9yIHVuZGVmaW5lZCB1cmxzLlxuICAgICAgICAgICAgLy8gSWdub3JlIGFib3V0OmJsYW5rIGlmIHJlcXVlc3RlZC5cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuc2VhcmNoRm9yUGFnZSh0aGlzLmFwcERpY3QsIGN1cnJlbnRVcmwsIGlnbm9yZUFib3V0QmxhbmtVcmwpO1xuICAgICAgICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoY3VycmVudFVybCkge1xuICAgICAgICAgICAgICBsb2cuZGVidWcoYFJlY2VpdmVkIGFwcCwgYnV0IGV4cGVjdGVkIHVybCAoJyR7Y3VycmVudFVybH0nKSB3YXMgbm90IGZvdW5kLiBUcnlpbmcgYWdhaW4uYCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBsb2cuZGVidWcoJ1JlY2VpdmVkIGFwcCwgYnV0IG5vIG1hdGNoIHdhcyBmb3VuZC4gVHJ5aW5nIGFnYWluLicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgbG9nLmRlYnVnKGBFcnJvciBjaGVja2luZyBhcHBsaWNhdGlvbjogJyR7ZXJyLm1lc3NhZ2V9Jy4gUmV0cnlpbmcgY29ubmVjdGlvbmApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXRyeUNvdW50Kys7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGZpbmQgYW4gYXBwIHRvIHNlbGVjdCcpO1xuICAgICAgfSwgMCk7XG4gICAgfSBjYXRjaCAoaWduKSB7XG4gICAgICBsb2cuZXJyb3JBbmRUaHJvdyhgQ291bGQgbm90IGNvbm5lY3QgdG8gYSB2YWxpZCBhcHAgYWZ0ZXIgJHttYXhUcmllc30gdHJpZXMuYCk7XG4gICAgfVxuICB9XG5cbiAgc2VhcmNoRm9yUGFnZSAoYXBwc0RpY3QsIGN1cnJlbnRVcmwgPSBudWxsLCBpZ25vcmVBYm91dEJsYW5rVXJsID0gZmFsc2UpIHtcbiAgICBmb3IgKGNvbnN0IGFwcERpY3Qgb2YgXy52YWx1ZXMoYXBwc0RpY3QpKSB7XG4gICAgICBpZiAoIWFwcERpY3QgfHwgYXBwRGljdC5pc0FjdGl2ZSA9PT0gQUNUSVZFX0FQUF9DT0RFIHx8ICFhcHBEaWN0LnBhZ2VBcnJheSB8fCBhcHBEaWN0LnBhZ2VBcnJheS5wcm9taXNlKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICBmb3IgKGNvbnN0IGRpY3Qgb2YgYXBwRGljdC5wYWdlQXJyYXkpIHtcbiAgICAgICAgaWYgKCghaWdub3JlQWJvdXRCbGFua1VybCB8fCBkaWN0LnVybCAhPT0gQkxBTktfUEFHRV9VUkwpICYmXG4gICAgICAgICAgICAoIWN1cnJlbnRVcmwgfHwgZGljdC51cmwgPT09IGN1cnJlbnRVcmwgfHwgZGljdC51cmwgPT09IGAke2N1cnJlbnRVcmx9L2ApKSB7XG4gICAgICAgICAgcmV0dXJuIHsgYXBwSWRLZXk6IGFwcERpY3QuaWQsIHBhZ2VEaWN0OiBkaWN0IH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBhc3luYyBzZWxlY3RQYWdlIChhcHBJZEtleSwgcGFnZUlkS2V5LCBza2lwUmVhZHlDaGVjayA9IGZhbHNlKSB7XG4gICAgdGhpcy5hcHBJZEtleSA9IGBQSUQ6JHthcHBJZEtleX1gO1xuICAgIHRoaXMucGFnZUlkS2V5ID0gcGFnZUlkS2V5O1xuXG4gICAgbG9nLmRlYnVnKGBTZWxlY3RpbmcgcGFnZSAnJHtwYWdlSWRLZXl9JyBvbiBhcHAgJyR7dGhpcy5hcHBJZEtleX0nIGFuZCBmb3J3YXJkaW5nIHNvY2tldCBzZXR1cGApO1xuXG4gICAgY29uc3Qgc3RhcnRUaW1lID0gcHJvY2Vzcy5ocnRpbWUoKTtcblxuICAgIGF3YWl0IHRoaXMucnBjQ2xpZW50LnNlbGVjdFBhZ2UodGhpcy5hcHBJZEtleSwgcGFnZUlkS2V5KTtcblxuICAgIC8vIG1ha2Ugc3VyZSBldmVyeXRoaW5nIGlzIHJlYWR5IHRvIGdvXG4gICAgaWYgKCFza2lwUmVhZHlDaGVjayAmJiAhYXdhaXQgdGhpcy5jaGVja1BhZ2VJc1JlYWR5KCkpIHtcbiAgICAgIGF3YWl0IHRoaXMucGFnZVVubG9hZCgpO1xuICAgIH1cblxuICAgIGxvZy5kZWJ1ZyhgU2VsZWN0ZWQgcGFnZSBhZnRlciAke2dldEVsYXBzZWRUaW1lKHN0YXJ0VGltZSl9bXNgKTtcbiAgfVxuXG4gIGFzeW5jIGV4ZWN1dGVBdG9tIChhdG9tLCBhcmdzLCBmcmFtZXMpIHtcbiAgICBpZiAoIXRoaXMucnBjQ2xpZW50LmlzQ29ubmVjdGVkKCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignUmVtb3RlIGRlYnVnZ2VyIGlzIG5vdCBjb25uZWN0ZWQnKTtcbiAgICB9XG5cbiAgICBsb2cuZGVidWcoYEV4ZWN1dGluZyBhdG9tICcke2F0b219J2ApO1xuICAgIGNvbnN0IHNjcmlwdCA9IGF3YWl0IGdldFNjcmlwdEZvckF0b20oYXRvbSwgYXJncywgZnJhbWVzKTtcbiAgICBjb25zdCB2YWx1ZSA9IGF3YWl0IHRoaXMuZXhlY3V0ZShzY3JpcHQsIHRydWUpO1xuICAgIGxvZy5kZWJ1ZyhgUmVjZWl2ZWQgcmVzdWx0IGZvciBhdG9tICcke2F0b219JyBleGVjdXRpb246ICR7Xy50cnVuY2F0ZShzaW1wbGVTdHJpbmdpZnkodmFsdWUpLCB7bGVuZ3RoOiBSRVNQT05TRV9MT0dfTEVOR1RIfSl9YCk7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG5cbiAgYXN5bmMgZXhlY3V0ZUF0b21Bc3luYyAoYXRvbSwgYXJncywgZnJhbWVzKSB7XG4gICAgLy8gZmlyc3QgY3JlYXRlIGEgUHJvbWlzZSBvbiB0aGUgcGFnZSwgc2F2aW5nIHRoZSByZXNvbHZlL3JlamVjdCBmdW5jdGlvbnNcbiAgICAvLyBhcyBwcm9wZXJ0aWVzXG4gICAgY29uc3QgcHJvbWlzZU5hbWUgPSBgYXBwaXVtQXN5bmNFeGVjdXRlUHJvbWlzZSR7VVVJRC5jcmVhdGUoKS50b1N0cmluZygpLnJlcGxhY2UoLy0vZywgJycpfWA7XG4gICAgbGV0IHNjcmlwdCA9IGB2YXIgcmVzLCByZWo7YCArXG4gICAgICAgICAgICAgICAgIGB3aW5kb3cuJHtwcm9taXNlTmFtZX0gPSBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7YCArXG4gICAgICAgICAgICAgICAgIGAgIHJlcyA9IHJlc29sdmU7YCArXG4gICAgICAgICAgICAgICAgIGAgIHJlaiA9IHJlamVjdDtgICtcbiAgICAgICAgICAgICAgICAgYH0pO2AgK1xuICAgICAgICAgICAgICAgICBgd2luZG93LiR7cHJvbWlzZU5hbWV9LnJlc29sdmUgPSByZXM7YCArXG4gICAgICAgICAgICAgICAgIGB3aW5kb3cuJHtwcm9taXNlTmFtZX0ucmVqZWN0ID0gcmVqO2AgK1xuICAgICAgICAgICAgICAgICBgd2luZG93LiR7cHJvbWlzZU5hbWV9O2A7XG4gICAgY29uc3Qgb2JqID0gYXdhaXQgdGhpcy5ycGNDbGllbnQuc2VuZCgnc2VuZEpTQ29tbWFuZCcsIHtcbiAgICAgIGNvbW1hbmQ6IHNjcmlwdCxcbiAgICAgIGFwcElkS2V5OiB0aGlzLmFwcElkS2V5LFxuICAgICAgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleSxcbiAgICAgIHJldHVybkJ5VmFsdWU6IGZhbHNlLFxuICAgIH0pO1xuICAgIGNvbnN0IHByb21pc2VPYmplY3RJZCA9IG9iai5yZXN1bHQub2JqZWN0SWQ7XG5cbiAgICAvLyBleGVjdXRlIHRoZSBhdG9tLCBjYWxsaW5nIGJhY2sgdG8gdGhlIHJlc29sdmUgZnVuY3Rpb25cbiAgICBjb25zdCBhc3luY0NhbGxCYWNrID0gYGZ1bmN0aW9uIChyZXMpIHtgICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgYCAgd2luZG93LiR7cHJvbWlzZU5hbWV9LnJlc29sdmUocmVzKTtgICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgYCAgd2luZG93LiR7cHJvbWlzZU5hbWV9VmFsdWUgPSByZXM7YCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGB9YDtcbiAgICBhd2FpdCB0aGlzLmV4ZWN1dGUoYXdhaXQgZ2V0U2NyaXB0Rm9yQXRvbShhdG9tLCBhcmdzLCBmcmFtZXMsIGFzeW5jQ2FsbEJhY2spKTtcblxuICAgIC8vIHdhaXQgZm9yIHRoZSBwcm9taXNlIHRvIGJlIHJlc29sdmVkXG4gICAgbGV0IHJlcztcbiAgICBjb25zdCBzdWJjb21tYW5kVGltZW91dCA9IDEwMDA7IC8vIHRpbWVvdXQgb24gaW5kaXZpZHVhbCBjb21tYW5kc1xuICAgIHRyeSB7XG4gICAgICByZXMgPSBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZW5kKCdhd2FpdFByb21pc2UnLCB7XG4gICAgICAgIHByb21pc2VPYmplY3RJZCxcbiAgICAgICAgYXBwSWRLZXk6IHRoaXMuYXBwSWRLZXksXG4gICAgICAgIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXksXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmICghZXJyLm1lc3NhZ2UuaW5jbHVkZXMoYCdSdW50aW1lLmF3YWl0UHJvbWlzZScgd2FzIG5vdCBmb3VuZGApKSB7XG4gICAgICAgIHRocm93IGVycjtcbiAgICAgIH1cblxuICAgICAgLy8gYXdhaXRQcm9taXNlIGlzIG5vdCBhbHdheXMgYXZhaWxhYmxlLCBzbyBzaW11bGF0ZSBpdCB3aXRoIHBvbGxcbiAgICAgIGNvbnN0IHJldHJ5V2FpdCA9IDEwMDtcbiAgICAgIGNvbnN0IHRpbWVvdXQgPSAoYXJncy5sZW5ndGggPj0gMykgPyBhcmdzWzJdIDogUlBDX1JFU1BPTlNFX1RJTUVPVVRfTVM7XG4gICAgICAvLyBpZiB0aGUgdGltZW91dCBtYXRoIHR1cm5zIHVwIDAgcmV0cmllcywgbWFrZSBzdXJlIGl0IGhhcHBlbnMgb25jZVxuICAgICAgY29uc3QgcmV0cmllcyA9IHBhcnNlSW50KHRpbWVvdXQgLyByZXRyeVdhaXQsIDEwKSB8fCAxO1xuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gcHJvY2Vzcy5ocnRpbWUoKTtcbiAgICAgIHJlcyA9IGF3YWl0IHJldHJ5SW50ZXJ2YWwocmV0cmllcywgcmV0cnlXYWl0LCBhc3luYyAoKSA9PiB7XG4gICAgICAgIC8vIHRoZSBhdG9tIF93aWxsXyByZXR1cm4sIGVpdGhlciBiZWNhdXNlIGl0IGZpbmlzaGVkIG9yIGFuIGVycm9yXG4gICAgICAgIC8vIGluY2x1ZGluZyBhIHRpbWVvdXQgZXJyb3JcbiAgICAgICAgaWYgKGF3YWl0IHRoaXMuZXhlY3V0ZUF0b20oJ2V4ZWN1dGVfc2NyaXB0JywgW2ByZXR1cm4gd2luZG93Lmhhc093blByb3BlcnR5KCcke3Byb21pc2VOYW1lfVZhbHVlJyk7YCwgW251bGwsIG51bGxdLCBzdWJjb21tYW5kVGltZW91dF0sIGZyYW1lcykpIHtcbiAgICAgICAgICAvLyB3ZSBvbmx5IHB1dCB0aGUgcHJvcGVydHkgb24gYHdpbmRvd2Agd2hlbiB0aGUgY2FsbGJhY2sgaXMgY2FsbGVkLFxuICAgICAgICAgIC8vIHNvIGlmIGl0IGlzIHRoZXJlLCBldmVyeXRoaW5nIGlzIGRvbmVcbiAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5leGVjdXRlQXRvbSgnZXhlY3V0ZV9zY3JpcHQnLCBbYHJldHVybiB3aW5kb3cuJHtwcm9taXNlTmFtZX1WYWx1ZTtgLCBbbnVsbCwgbnVsbF0sIHN1YmNvbW1hbmRUaW1lb3V0XSwgZnJhbWVzKTtcbiAgICAgICAgfVxuICAgICAgICAvLyB0aHJvdyBhIFRpbWVvdXRFcnJvciwgb3IgZWxzZSBpdCBuZWVkcyB0byBiZSBjYXVnaHQgYW5kIHJlLXRocm93blxuICAgICAgICB0aHJvdyBuZXcgZXJyb3JzLlRpbWVvdXRFcnJvcihgVGltZWQgb3V0IHdhaXRpbmcgZm9yIGFzeW5jaHJvbm91cyBzY3JpcHQgYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGByZXN1bHQgYWZ0ZXIgJHtnZXRFbGFwc2VkVGltZShzdGFydFRpbWUpfSBtcycpKTtgKTtcbiAgICAgIH0pO1xuICAgIH0gZmluYWxseSB7XG4gICAgICB0cnkge1xuICAgICAgICAvLyB0cnkgdG8gZ2V0IHJpZCBvZiB0aGUgcHJvbWlzZVxuICAgICAgICBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdleGVjdXRlX3NjcmlwdCcsIFtgZGVsZXRlIHdpbmRvdy4ke3Byb21pc2VOYW1lfTtgLCBbbnVsbCwgbnVsbF0sIHN1YmNvbW1hbmRUaW1lb3V0XSwgZnJhbWVzKTtcbiAgICAgIH0gY2F0Y2ggKGlnbikge31cbiAgICB9XG4gICAgcmV0dXJuIGNvbnZlcnRSZXN1bHQocmVzKTtcbiAgfVxuXG4gIGZyYW1lRGV0YWNoZWQgKCkge1xuICAgIHRoaXMuZW1pdChSZW1vdGVEZWJ1Z2dlci5FVkVOVF9GUkFNRVNfREVUQUNIRUQpO1xuICB9XG5cbiAgYXN5bmMgcGFnZUxvYWQgKHN0YXJ0UGFnZUxvYWRNcywgcGFnZUxvYWRWZXJpZnlIb29rKSB7XG4gICAgbGV0IHRpbWVvdXRNcyA9IDUwMDtcbiAgICBsZXQgc3RhcnQgPSBzdGFydFBhZ2VMb2FkTXMgfHwgRGF0ZS5ub3coKTtcblxuICAgIGxvZy5kZWJ1ZygnUGFnZSBsb2FkZWQsIHZlcmlmeWluZyB3aGV0aGVyIHJlYWR5Jyk7XG4gICAgdGhpcy5wYWdlTG9hZGluZyA9IHRydWU7XG5cbiAgICBjb25zdCB2ZXJpZnkgPSBhc3luYyAoKSA9PiB7XG4gICAgICB0aGlzLnBhZ2VMb2FkRGVsYXkgPSB1dGlsLmNhbmNlbGxhYmxlRGVsYXkodGltZW91dE1zKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHRoaXMucGFnZUxvYWREZWxheTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBpZiAoZXJyIGluc3RhbmNlb2YgQi5DYW5jZWxsYXRpb25FcnJvcikge1xuICAgICAgICAgIC8vIGlmIHRoZSBwcm9taXNlIGhhcyBiZWVuIGNhbmNlbGxlZFxuICAgICAgICAgIC8vIHdlIHdhbnQgdG8gc2tpcCBjaGVja2luZyB0aGUgcmVhZGluZXNzXG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIHdlIGNhbiBnZXQgdGhpcyBjYWxsZWQgaW4gdGhlIG1pZGRsZSBvZiB0cnlpbmcgdG8gZmluZCBhIG5ldyBhcHBcbiAgICAgIGlmICghdGhpcy5hcHBJZEtleSkge1xuICAgICAgICBsb2cuZGVidWcoJ05vdCBjb25uZWN0ZWQgdG8gYW4gYXBwbGljYXRpb24uIElnbm9yaW5nIHBhZ2UgbG9hZCcpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmIChfLmlzRnVuY3Rpb24ocGFnZUxvYWRWZXJpZnlIb29rKSkge1xuICAgICAgICBhd2FpdCBwYWdlTG9hZFZlcmlmeUhvb2soKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgcmVhZHkgPSBhd2FpdCB0aGlzLmNoZWNrUGFnZUlzUmVhZHkoKTtcblxuICAgICAgLy8gaWYgd2UgYXJlIHJlYWR5LCBvciB3ZSd2ZSBzcGVuZCB0b28gbXVjaCB0aW1lIG9uIHRoaXNcbiAgICAgIGlmIChyZWFkeSB8fCAodGhpcy5wYWdlTG9hZE1zID4gMCAmJiAoc3RhcnQgKyB0aGlzLnBhZ2VMb2FkTXMpIDwgRGF0ZS5ub3coKSkpIHtcbiAgICAgICAgbG9nLmRlYnVnKCdQYWdlIGlzIHJlYWR5Jyk7XG4gICAgICAgIHRoaXMucGFnZUxvYWRpbmcgPSBmYWxzZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxvZy5kZWJ1ZygnUGFnZSB3YXMgbm90IHJlYWR5LCByZXRyeWluZycpO1xuICAgICAgICBhd2FpdCB2ZXJpZnkoKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIGF3YWl0IHZlcmlmeSgpO1xuICB9XG5cbiAgY2FuY2VsUGFnZUxvYWQgKCkge1xuICAgIGxvZy5kZWJ1ZygnVW5yZWdpc3RlcmluZyBmcm9tIHBhZ2UgcmVhZGluZXNzIG5vdGlmaWNhdGlvbnMnKTtcbiAgICB0aGlzLnBhZ2VMb2FkaW5nID0gZmFsc2U7XG4gICAgaWYgKHRoaXMucGFnZUxvYWREZWxheSkge1xuICAgICAgdGhpcy5wYWdlTG9hZERlbGF5LmNhbmNlbCgpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHBhZ2VVbmxvYWQgKCkge1xuICAgIGxvZy5kZWJ1ZygnUGFnZSB1bmxvYWRpbmcnKTtcbiAgICBhd2FpdCB0aGlzLndhaXRGb3JEb20oKTtcbiAgfVxuXG4gIGFzeW5jIHdhaXRGb3JEb20gKHN0YXJ0UGFnZUxvYWRNcywgcGFnZUxvYWRWZXJpZnlIb29rKSB7XG4gICAgbG9nLmRlYnVnKCdXYWl0aW5nIGZvciBkb20uLi4nKTtcbiAgICBhd2FpdCB0aGlzLnBhZ2VMb2FkKHN0YXJ0UGFnZUxvYWRNcywgcGFnZUxvYWRWZXJpZnlIb29rKTtcbiAgfVxuXG4gIGFzeW5jIGNoZWNrUGFnZUlzUmVhZHkgKCkge1xuICAgIGNvbnN0IGVycm9ycyA9IGNoZWNrUGFyYW1zKHthcHBJZEtleTogdGhpcy5hcHBJZEtleX0pO1xuICAgIGlmIChlcnJvcnMpIHRocm93IG5ldyBFcnJvcihlcnJvcnMpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGN1cmx5XG5cbiAgICBsb2cuZGVidWcoJ0NoZWNraW5nIGRvY3VtZW50IHJlYWR5U3RhdGUnKTtcbiAgICBjb25zdCByZWFkeUNtZCA9ICdkb2N1bWVudC5yZWFkeVN0YXRlOyc7XG4gICAgbGV0IHJlYWR5U3RhdGUgPSAnbG9hZGluZyc7XG4gICAgdHJ5IHtcbiAgICAgIHJlYWR5U3RhdGUgPSBhd2FpdCBCLnJlc29sdmUodGhpcy5leGVjdXRlKHJlYWR5Q21kLCB0cnVlKSkudGltZW91dCh0aGlzLnBhZ2VSZWFkeVRpbWVvdXQpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKCEoZXJyIGluc3RhbmNlb2YgQi5UaW1lb3V0RXJyb3IpKSB7XG4gICAgICAgIHRocm93IGVycjtcbiAgICAgIH1cbiAgICAgIGxvZy5kZWJ1ZyhgUGFnZSByZWFkaW5lc3MgY2hlY2sgdGltZWQgb3V0IGFmdGVyICR7dGhpcy5wYWdlUmVhZHlUaW1lb3V0fW1zYCk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGxvZy5kZWJ1ZyhgRG9jdW1lbnQgcmVhZHlTdGF0ZSBpcyAnJHtyZWFkeVN0YXRlfSdgKTtcblxuICAgIHJldHVybiByZWFkeVN0YXRlID09PSAnY29tcGxldGUnO1xuICB9XG5cbiAgYXN5bmMgbGF1bmNoU2FmYXJpICgpIHtcbiAgICBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZW5kKCdsYXVuY2hBcHBsaWNhdGlvbicsIHtcbiAgICAgIGJ1bmRsZUlkOiBTQUZBUklfQlVORExFX0lEXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBuYXZUb1VybCAodXJsLCBwYWdlTG9hZFZlcmlmeUhvb2spIHtcbiAgICBjb25zdCBlcnJvcnMgPSBjaGVja1BhcmFtcyh7YXBwSWRLZXk6IHRoaXMuYXBwSWRLZXksIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXl9KTtcbiAgICBpZiAoZXJyb3JzKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JzKTtcbiAgICB9XG5cbiAgICB0aGlzLl9uYXZpZ2F0aW5nVG9QYWdlID0gdHJ1ZTtcblxuICAgIHRyeSB7XG4gICAgICBsb2cuZGVidWcoYE5hdmlnYXRpbmcgdG8gbmV3IFVSTDogJyR7dXJsfSdgKTtcblxuICAgICAgLy8gYmVnaW4gbGlzdGVuaW5nIGZvciBmcmFtZSBuYXZpZ2F0aW9uIGV2ZW50LCB3aGljaCB3aWxsIGJlIHdhaXRlZCBmb3IgbGF0ZXJcbiAgICAgIGNvbnN0IHdhaXRGb3JGcmFtZVByb21pc2UgPSB0aGlzLndhaXRGb3JGcmFtZU5hdmlnYXRlZCgpO1xuXG4gICAgICBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZW5kKCdzZXRVcmwnLCB7XG4gICAgICAgIHVybCxcbiAgICAgICAgYXBwSWRLZXk6IHRoaXMuYXBwSWRLZXksXG4gICAgICAgIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXksXG4gICAgICB9KTtcblxuICAgICAgaWYgKCF0aGlzLnVzZU5ld1NhZmFyaSkge1xuICAgICAgICAvLyBhIHNtYWxsIHBhdXNlIGZvciB0aGUgYnJvd3NlciB0byBjYXRjaCB1cFxuICAgICAgICBhd2FpdCBCLmRlbGF5KDEwMDApO1xuICAgICAgfVxuXG4gICAgICAvLyB3YWl0IHVudGlsIHRoZSBwYWdlIGhhcyBiZWVuIG5hdmlnYXRlZFxuICAgICAgYXdhaXQgd2FpdEZvckZyYW1lUHJvbWlzZTtcblxuICAgICAgYXdhaXQgdGhpcy53YWl0Rm9yRG9tKERhdGUubm93KCksIHBhZ2VMb2FkVmVyaWZ5SG9vayk7XG5cbiAgICAgIC8vIGVuYWJsZSBjb25zb2xlIGxvZ2dpbmcsIHNvIHdlIGdldCB0aGUgZXZlbnRzIChvdGhlcndpc2Ugd2Ugb25seVxuICAgICAgLy8gZ2V0IG5vdGlmaWVkIHdoZW4gbmF2aWdhdGluZyB0byBhIGxvY2FsIHBhZ2VcbiAgICAgIGF3YWl0IHRoaXMucnBjQ2xpZW50LnNlbmQoJ2VuYWJsZUNvbnNvbGUnLCB7XG4gICAgICAgIGFwcElkS2V5OiB0aGlzLmFwcElkS2V5LFxuICAgICAgICBwYWdlSWRLZXk6IHRoaXMucGFnZUlkS2V5LFxuICAgICAgfSk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHRoaXMuX25hdmlnYXRpbmdUb1BhZ2UgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBhc3luYyB3YWl0Rm9yRnJhbWVOYXZpZ2F0ZWQgKCkge1xuICAgIHJldHVybiBhd2FpdCBuZXcgQihhc3luYyAocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBsb2cuZGVidWcoJ1dhaXRpbmcgZm9yIGZyYW1lIG5hdmlnYXRlZCBtZXNzYWdlLi4uJyk7XG4gICAgICBsZXQgc3RhcnRNcyA9IERhdGUubm93KCk7XG5cbiAgICAgIC8vIGFkZCBhIGhhbmRsZXIgZm9yIHRoZSBgUGFnZS5mcmFtZU5hdmlnYXRlZGAgbWVzc2FnZVxuICAgICAgLy8gZnJvbSB0aGUgcmVtb3RlIGRlYnVnZ2VyXG4gICAgICBjb25zdCBuYXZFdmVudExpc3RlbmVyID0gKHZhbHVlKSA9PiB7XG4gICAgICAgIGxvZy5kZWJ1ZyhgRnJhbWUgbmF2aWdhdGVkIGluICR7KChEYXRlLm5vdygpIC0gc3RhcnRNcykgLyAxMDAwKX1zIGZyb206ICR7dmFsdWV9YCk7XG4gICAgICAgIGlmICghdGhpcy5hbGxvd05hdmlnYXRpb25XaXRob3V0UmVsb2FkICYmICF0aGlzLnBhZ2VMb2FkaW5nKSB7XG4gICAgICAgICAgcmVzb2x2ZSh2YWx1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbG9nLmRlYnVnKCdGcmFtZSBuYXZpZ2F0ZWQgYnV0IHdlIHdlcmUgd2FybmVkIGFib3V0IGl0LCBub3QgJyArXG4gICAgICAgICAgICAgICAgICAgICdjb25zaWRlcmluZyBwYWdlIHN0YXRlIHVubG9hZGVkJyk7XG4gICAgICAgICAgdGhpcy5hbGxvd05hdmlnYXRpb25XaXRob3V0UmVsb2FkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubmF2aWdhdGlvbkRlbGF5KSB7XG4gICAgICAgICAgdGhpcy5uYXZpZ2F0aW9uRGVsYXkuY2FuY2VsKCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB0aGlzLnJwY0NsaWVudC5zZXRTcGVjaWFsTWVzc2FnZUhhbmRsZXIoJ1BhZ2UuZnJhbWVOYXZpZ2F0ZWQnLCByZWplY3QsIG5hdkV2ZW50TGlzdGVuZXIpO1xuXG4gICAgICAvLyB0aW1lb3V0LCBpbiBjYXNlIHJlbW90ZSBkZWJ1Z2dlciBkb2Vzbid0IHJlc3BvbmQsXG4gICAgICAvLyBvciB0YWtlcyBhIGxvbmcgdGltZVxuICAgICAgaWYgKCF0aGlzLnVzZU5ld1NhZmFyaSB8fCB0aGlzLnBhZ2VMb2FkTXMgPj0gMCkge1xuICAgICAgICAvLyB1c2UgcGFnZUxvYWRNcywgb3IgYSBzbWFsbCBhbW91bnQgb2YgdGltZVxuICAgICAgICBsZXQgdGltZW91dCA9IHRoaXMudXNlTmV3U2FmYXJpID8gdGhpcy5wYWdlTG9hZE1zIDogNTAwO1xuICAgICAgICB0aGlzLm5hdmlnYXRpb25EZWxheSA9IHV0aWwuY2FuY2VsbGFibGVEZWxheSh0aW1lb3V0KTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBhd2FpdCB0aGlzLm5hdmlnYXRpb25EZWxheTtcbiAgICAgICAgICBuYXZFdmVudExpc3RlbmVyKCd0aW1lb3V0Jyk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIC8vIG5vdGhpbmcgdG8gZG86IHdlIG9ubHkgZ2V0IGhlcmUgaWYgdGhlIHJlbW90ZSBkZWJ1Z2dlclxuICAgICAgICAgIC8vIGFscmVhZHkgbm90aWZpZWQgb2YgZnJhbWUgbmF2aWdhdGlvbiwgYW5kIHRoZSBkZWxheVxuICAgICAgICAgIC8vIHdhcyBjYW5jZWxsZWRcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgc3RhcnRUaW1lbGluZSAoZm4pIHtcbiAgICBsb2cuZGVidWcoJ1N0YXJ0aW5nIHRvIHJlY29yZCB0aGUgdGltZWxpbmUnKTtcbiAgICB0aGlzLnJwY0NsaWVudC5zZXRUaW1lbGluZUV2ZW50SGFuZGxlcihmbik7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMucnBjQ2xpZW50LnNlbmQoJ3N0YXJ0VGltZWxpbmUnLCB7XG4gICAgICBhcHBJZEtleTogdGhpcy5hcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXksXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBzdG9wVGltZWxpbmUgKCkge1xuICAgIGxvZy5kZWJ1ZygnU3RvcHBpbmcgdG8gcmVjb3JkIHRoZSB0aW1lbGluZScpO1xuICAgIGF3YWl0IHRoaXMucnBjQ2xpZW50LnNlbmQoJ3N0b3BUaW1lbGluZScsIHtcbiAgICAgIGFwcElkS2V5OiB0aGlzLmFwcElkS2V5LFxuICAgICAgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleSxcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIHN0YXJ0Q29uc29sZSAoZm4pIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgbG9nLmRlYnVnKCdTdGFydGluZyB0byBsaXN0ZW4gZm9yIEphdmFTY3JpcHQgY29uc29sZScpO1xuICAgIGlmIChfLmlzRnVuY3Rpb24oZm4pKSB7XG4gICAgICB0aGlzLnJwY0NsaWVudC5zZXRDb25zb2xlTG9nRXZlbnRIYW5kbGVyKGZuKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBzdG9wQ29uc29sZSAoKSB7XG4gICAgbG9nLmRlYnVnKCdTdG9wcGluZyB0byBsaXN0ZW4gZm9yIEphdmFTY3JpcHQgY29uc29sZScpO1xuICAgIGF3YWl0IHRoaXMucnBjQ2xpZW50LnNlbmQoJ2Rpc2FibGVDb25zb2xlJywge1xuICAgICAgYXBwSWRLZXk6IHRoaXMuYXBwSWRLZXksXG4gICAgICBwYWdlSWRLZXk6IHRoaXMucGFnZUlkS2V5LFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgc3RhcnROZXR3b3JrIChmbikge1xuICAgIGxvZy5kZWJ1ZygnU3RhcnRpbmcgdG8gbGlzdGVuIGZvciBuZXR3b3JrIGV2ZW50cycpO1xuICAgIHRoaXMucnBjQ2xpZW50LnNldE5ldHdvcmtMb2dFdmVudEhhbmRsZXIoZm4pO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZW5kKCdzdGFydE5ldHdvcmsnLCB7XG4gICAgICBhcHBJZEtleTogdGhpcy5hcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXksXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBzdG9wTmV0d29yayAoKSB7XG4gICAgbG9nLmRlYnVnKCdTdG9wcGluZyB0byBsaXN0ZW4gZm9yIG5ldHdvcmsgZXZlbnRzJyk7XG4gICAgYXdhaXQgdGhpcy5ycGNDbGllbnQuc2VuZCgnc3RvcE5ldHdvcmsnLCB7XG4gICAgICBhcHBJZEtleTogdGhpcy5hcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXksXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBleGVjdXRlIChjb21tYW5kLCBvdmVycmlkZSkge1xuICAgIC8vIGlmIHRoZSBwYWdlIGlzIG5vdCBsb2FkZWQgeWV0LCB3YWl0IGZvciBpdFxuICAgIGlmICh0aGlzLnBhZ2VMb2FkaW5nICYmICFvdmVycmlkZSkge1xuICAgICAgbG9nLmRlYnVnKCdUcnlpbmcgdG8gZXhlY3V0ZSBidXQgcGFnZSBpcyBub3QgbG9hZGVkLicpO1xuICAgICAgYXdhaXQgdGhpcy53YWl0Rm9yRG9tKCk7XG4gICAgfVxuXG4gICAgY29uc3QgZXJyb3JzID0gY2hlY2tQYXJhbXMoe2FwcElkS2V5OiB0aGlzLmFwcElkS2V5LCBwYWdlSWRLZXk6IHRoaXMucGFnZUlkS2V5fSk7XG4gICAgaWYgKGVycm9ycykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9ycyk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZ2FyYmFnZUNvbGxlY3RPbkV4ZWN1dGUpIHtcbiAgICAgIGF3YWl0IHRoaXMuZ2FyYmFnZUNvbGxlY3QoKTtcbiAgICB9XG5cbiAgICBsb2cuZGVidWcoYFNlbmRpbmcgamF2YXNjcmlwdCBjb21tYW5kOiAnJHtfLnRydW5jYXRlKGNvbW1hbmQsIHtsZW5ndGg6IDUwfSl9J2ApO1xuICAgIGxldCByZXMgPSBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZW5kKCdzZW5kSlNDb21tYW5kJywge1xuICAgICAgY29tbWFuZCxcbiAgICAgIGFwcElkS2V5OiB0aGlzLmFwcElkS2V5LFxuICAgICAgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleSxcbiAgICB9KTtcblxuICAgIHJldHVybiBjb252ZXJ0UmVzdWx0KHJlcyk7XG4gIH1cblxuICBhc3luYyBjYWxsRnVuY3Rpb24gKG9iaklkLCBmbiwgYXJncykge1xuICAgIGxldCBlcnJvcnMgPSBjaGVja1BhcmFtcyh7YXBwSWRLZXk6IHRoaXMuYXBwSWRLZXksIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXl9KTtcbiAgICBpZiAoZXJyb3JzKSB0aHJvdyBuZXcgRXJyb3IoZXJyb3JzKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjdXJseVxuXG4gICAgaWYgKHRoaXMuZ2FyYmFnZUNvbGxlY3RPbkV4ZWN1dGUpIHtcbiAgICAgIGF3YWl0IHRoaXMuZ2FyYmFnZUNvbGxlY3QoKTtcbiAgICB9XG5cbiAgICBsb2cuZGVidWcoJ0NhbGxpbmcgamF2YXNjcmlwdCBmdW5jdGlvbicpO1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMucnBjQ2xpZW50LnNlbmQoJ2NhbGxKU0Z1bmN0aW9uJywge1xuICAgICAgb2JqSWQsXG4gICAgICBmbixcbiAgICAgIGFyZ3MsXG4gICAgICBhcHBJZEtleTogdGhpcy5hcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXksXG4gICAgfSk7XG5cbiAgICByZXR1cm4gY29udmVydFJlc3VsdChyZXMpO1xuICB9XG5cbiAgc2V0IGFsbG93TmF2aWdhdGlvbldpdGhvdXRSZWxvYWQgKGFsbG93KSB7XG4gICAgdGhpcy5fYWxsb3dOYXZpZ2F0aW9uV2l0aG91dFJlbG9hZCA9IGFsbG93O1xuICB9XG5cbiAgZ2V0IGFsbG93TmF2aWdhdGlvbldpdGhvdXRSZWxvYWQgKCkge1xuICAgIHJldHVybiB0aGlzLl9hbGxvd05hdmlnYXRpb25XaXRob3V0UmVsb2FkO1xuICB9XG5cbiAgYXN5bmMgZ2V0Q29va2llcyAodXJscykge1xuICAgIGxvZy5kZWJ1ZygnR2V0dGluZyBuZXR3b3JrIGNvb2tpZXMnKTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5ycGNDbGllbnQuc2VuZCgnZ2V0Q29va2llcycsIHtcbiAgICAgIGFwcElkS2V5OiB0aGlzLmFwcElkS2V5LFxuICAgICAgcGFnZUlkS2V5OiB0aGlzLnBhZ2VJZEtleSxcbiAgICAgIHVybHMsXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBkZWxldGVDb29raWUgKGNvb2tpZU5hbWUsIHVybCkge1xuICAgIGxvZy5kZWJ1ZyhgRGVsZXRpbmcgY29va2llICcke2Nvb2tpZU5hbWV9JyBvbiAnJHt1cmx9J2ApO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLnJwY0NsaWVudC5zZW5kKCdkZWxldGVDb29raWUnLCB7XG4gICAgICBhcHBJZEtleTogdGhpcy5hcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXksXG4gICAgICBjb29raWVOYW1lLFxuICAgICAgdXJsLFxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgZ2FyYmFnZUNvbGxlY3QgKHRpbWVvdXRNcyA9IEdBUkJBR0VfQ09MTEVDVF9USU1FT1VUKSB7XG4gICAgbG9nLmRlYnVnKGBHYXJiYWdlIGNvbGxlY3Rpbmcgd2l0aCAke3RpbWVvdXRNc31tcyB0aW1lb3V0YCk7XG4gICAgY29uc3QgZXJyb3JzID0gY2hlY2tQYXJhbXMoe1xuICAgICAgYXBwSWRLZXk6IHRoaXMuYXBwSWRLZXksXG4gICAgICBwYWdlSWRLZXk6IHRoaXMucGFnZUlkS2V5LFxuICAgIH0pO1xuICAgIGlmIChlcnJvcnMpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgVW5hYmxlIHRvIGNvbGxlY3QgZ2FyYmFnZSBhdCB0aGlzIHRpbWVgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBhd2FpdCBCLnJlc29sdmUodGhpcy5ycGNDbGllbnQuc2VuZCgnZ2FyYmFnZUNvbGxlY3QnLCB7XG4gICAgICBhcHBJZEtleTogdGhpcy5hcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleTogdGhpcy5wYWdlSWRLZXksXG4gICAgfSkpLnRpbWVvdXQodGltZW91dE1zKVxuICAgIC50aGVuKGZ1bmN0aW9uIGdjU3VjY2VzcyAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcHJvbWlzZS9wcmVmZXItYXdhaXQtdG8tdGhlblxuICAgICAgbG9nLmRlYnVnKGBHYXJiYWdlIGNvbGxlY3Rpb24gc3VjY2Vzc2Z1bGApO1xuICAgIH0pLmNhdGNoKGZ1bmN0aW9uIGdjRXJyb3IgKGVycikgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHByb21pc2UvcHJlZmVyLWF3YWl0LXRvLWNhbGxiYWNrc1xuICAgICAgaWYgKGVyciBpbnN0YW5jZW9mIEIuVGltZW91dEVycm9yKSB7XG4gICAgICAgIGxvZy5kZWJ1ZyhgR2FyYmFnZSBjb2xsZWN0aW9uIHRpbWVkIG91dCBhZnRlciAke3RpbWVvdXRNc31tc2ApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbG9nLmRlYnVnKGBVbmFibGUgdG8gY29sbGVjdCBnYXJiYWdlOiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgdXNlQXBwRGljdExvY2sgKGZuKSB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuX2xvY2suYWNxdWlyZSgnYXBwRGljdCcsIGZuKTtcbiAgfVxufVxuXG4vLyBldmVudCBlbWl0dGVkIHB1YmxpY2FsbHlcblJlbW90ZURlYnVnZ2VyLkVWRU5UX1BBR0VfQ0hBTkdFID0gJ3JlbW90ZV9kZWJ1Z2dlcl9wYWdlX2NoYW5nZSc7XG5SZW1vdGVEZWJ1Z2dlci5FVkVOVF9GUkFNRVNfREVUQUNIRUQgPSAncmVtb3RlX2RlYnVnZ2VyX2ZyYW1lc19kZXRhY2hlZCc7XG5SZW1vdGVEZWJ1Z2dlci5FVkVOVF9ESVNDT05ORUNUID0gJ3JlbW90ZV9kZWJ1Z2dlcl9kaXNjb25uZWN0JztcblxuLy8gYWRkIGdlbmVyaWMgY2FsbGJhY2tzXG5mb3IgKGNvbnN0IFtuYW1lLCBoYW5kbGVyXSBvZiBfLnRvUGFpcnMobWVzc2FnZUhhbmRsZXJzKSkge1xuICBSZW1vdGVEZWJ1Z2dlci5wcm90b3R5cGVbbmFtZV0gPSBoYW5kbGVyO1xufVxuXG5leHBvcnQge1xuICBSZW1vdGVEZWJ1Z2dlciwgUkVNT1RFX0RFQlVHR0VSX1BPUlQsIFJQQ19SRVNQT05TRV9USU1FT1VUX01TLFxufTtcbiJdLCJmaWxlIjoibGliL3JlbW90ZS1kZWJ1Z2dlci5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
