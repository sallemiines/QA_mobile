"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.PlistServiceEncoder = void 0;

require("source-map-support/register");

var _stream = _interopRequireDefault(require("stream"));

var _appiumSupport = require("appium-support");

const HEADER_LENGTH = 4;

class PlistServiceEncoder extends _stream.default.Transform {
  constructor() {
    super({
      objectMode: true
    });
  }

  _transform(data, encoding, callback) {
    this.push(this._encode(data), 'buffer');
    callback();
  }

  _encode(data) {
    let payloadBuffer = _appiumSupport.plist.createBinaryPlist(data);

    const headerBuffer = Buffer.alloc(HEADER_LENGTH);
    headerBuffer.writeUInt32BE(payloadBuffer.length, 0);
    return Buffer.concat([headerBuffer, payloadBuffer], headerBuffer.length + payloadBuffer.length);
  }

}

exports.PlistServiceEncoder = PlistServiceEncoder;
var _default = PlistServiceEncoder;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9wbGlzdC1zZXJ2aWNlL3RyYW5zZm9ybWVyL3BsaXN0LXNlcnZpY2UtZW5jb2Rlci5qcyJdLCJuYW1lcyI6WyJIRUFERVJfTEVOR1RIIiwiUGxpc3RTZXJ2aWNlRW5jb2RlciIsIlN0cmVhbSIsIlRyYW5zZm9ybSIsImNvbnN0cnVjdG9yIiwib2JqZWN0TW9kZSIsIl90cmFuc2Zvcm0iLCJkYXRhIiwiZW5jb2RpbmciLCJjYWxsYmFjayIsInB1c2giLCJfZW5jb2RlIiwicGF5bG9hZEJ1ZmZlciIsInBsaXN0IiwiY3JlYXRlQmluYXJ5UGxpc3QiLCJoZWFkZXJCdWZmZXIiLCJCdWZmZXIiLCJhbGxvYyIsIndyaXRlVUludDMyQkUiLCJsZW5ndGgiLCJjb25jYXQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQ0E7O0FBQ0E7O0FBR0EsTUFBTUEsYUFBYSxHQUFHLENBQXRCOztBQUVBLE1BQU1DLG1CQUFOLFNBQWtDQyxnQkFBT0MsU0FBekMsQ0FBbUQ7QUFDakRDLEVBQUFBLFdBQVcsR0FBSTtBQUNiLFVBQU07QUFBRUMsTUFBQUEsVUFBVSxFQUFFO0FBQWQsS0FBTjtBQUNEOztBQUVEQyxFQUFBQSxVQUFVLENBQUVDLElBQUYsRUFBUUMsUUFBUixFQUFrQkMsUUFBbEIsRUFBNEI7QUFDcEMsU0FBS0MsSUFBTCxDQUFVLEtBQUtDLE9BQUwsQ0FBYUosSUFBYixDQUFWLEVBQThCLFFBQTlCO0FBQ0FFLElBQUFBLFFBQVE7QUFDVDs7QUFFREUsRUFBQUEsT0FBTyxDQUFFSixJQUFGLEVBQVE7QUFDYixRQUFJSyxhQUFhLEdBQUdDLHFCQUFNQyxpQkFBTixDQUF3QlAsSUFBeEIsQ0FBcEI7O0FBQ0EsVUFBTVEsWUFBWSxHQUFHQyxNQUFNLENBQUNDLEtBQVAsQ0FBYWpCLGFBQWIsQ0FBckI7QUFDQWUsSUFBQUEsWUFBWSxDQUFDRyxhQUFiLENBQTJCTixhQUFhLENBQUNPLE1BQXpDLEVBQWlELENBQWpEO0FBQ0EsV0FBT0gsTUFBTSxDQUFDSSxNQUFQLENBQWMsQ0FBQ0wsWUFBRCxFQUFlSCxhQUFmLENBQWQsRUFBNkNHLFlBQVksQ0FBQ0ksTUFBYixHQUFzQlAsYUFBYSxDQUFDTyxNQUFqRixDQUFQO0FBQ0Q7O0FBZmdEOzs7ZUFtQnBDbEIsbUIiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBwcm9taXNlL3ByZWZlci1hd2FpdC10by1jYWxsYmFja3MgKi9cbmltcG9ydCBTdHJlYW0gZnJvbSAnc3RyZWFtJztcbmltcG9ydCB7IHBsaXN0IH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuXG5cbmNvbnN0IEhFQURFUl9MRU5HVEggPSA0O1xuXG5jbGFzcyBQbGlzdFNlcnZpY2VFbmNvZGVyIGV4dGVuZHMgU3RyZWFtLlRyYW5zZm9ybSB7XG4gIGNvbnN0cnVjdG9yICgpIHtcbiAgICBzdXBlcih7IG9iamVjdE1vZGU6IHRydWUgfSk7XG4gIH1cblxuICBfdHJhbnNmb3JtIChkYXRhLCBlbmNvZGluZywgY2FsbGJhY2spIHtcbiAgICB0aGlzLnB1c2godGhpcy5fZW5jb2RlKGRhdGEpLCAnYnVmZmVyJyk7XG4gICAgY2FsbGJhY2soKTtcbiAgfVxuXG4gIF9lbmNvZGUgKGRhdGEpIHtcbiAgICBsZXQgcGF5bG9hZEJ1ZmZlciA9IHBsaXN0LmNyZWF0ZUJpbmFyeVBsaXN0KGRhdGEpO1xuICAgIGNvbnN0IGhlYWRlckJ1ZmZlciA9IEJ1ZmZlci5hbGxvYyhIRUFERVJfTEVOR1RIKTtcbiAgICBoZWFkZXJCdWZmZXIud3JpdGVVSW50MzJCRShwYXlsb2FkQnVmZmVyLmxlbmd0aCwgMCk7XG4gICAgcmV0dXJuIEJ1ZmZlci5jb25jYXQoW2hlYWRlckJ1ZmZlciwgcGF5bG9hZEJ1ZmZlcl0sIGhlYWRlckJ1ZmZlci5sZW5ndGggKyBwYXlsb2FkQnVmZmVyLmxlbmd0aCk7XG4gIH1cbn1cblxuZXhwb3J0IHsgUGxpc3RTZXJ2aWNlRW5jb2RlciB9O1xuZXhwb3J0IGRlZmF1bHQgUGxpc3RTZXJ2aWNlRW5jb2RlcjtcbiJdLCJmaWxlIjoibGliL3BsaXN0LXNlcnZpY2UvdHJhbnNmb3JtZXIvcGxpc3Qtc2VydmljZS1lbmNvZGVyLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uLy4uLy4uIn0=
