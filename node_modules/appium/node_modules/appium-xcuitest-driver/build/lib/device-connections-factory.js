"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.DeviceConnectionsFactory = exports.DEVICE_CONNECTIONS_FACTORY = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _net = _interopRequireDefault(require("net"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _appiumSupport = require("appium-support");

var _appiumIosDevice = require("appium-ios-device");

var _portscanner = require("portscanner");

class iProxy {
  constructor(udid, localport, deviceport) {
    this.localport = parseInt(localport, 10);
    this.deviceport = parseInt(deviceport, 10);
    this.udid = udid;
    this.serverSocket = null;
    this.log = _appiumSupport.logger.getLogger(`iProxy@${udid.substring(0, 8)}`);
  }

  async start() {
    if (this.serverSocket) {
      return;
    }

    this.serverSocket = _net.default.createServer(async connection => {
      try {
        const socket = await _appiumIosDevice.utilities.connectPort(this.udid, this.deviceport);
        socket.on('close', () => connection.end());
        socket.on('error', e => this.log.error(e));
        connection.on('close', () => socket.end());
        connection.on('error', e => this.log.error(e));
        connection.pipe(socket);
        socket.pipe(connection);
      } catch (e) {
        this.log.error(e);
        connection.end();
      }
    });
    const status = new _bluebird.default((resolve, reject) => {
      this.serverSocket.once('listening', resolve);
      this.serverSocket.once('error', reject);
    });
    this.serverSocket.listen(this.localport);
    await status;
    this.serverSocket.on('error', e => this.log.error(e));
  }

  async quit() {
    if (!this.serverSocket) {
      return;
    }

    this.serverSocket.once('close', () => {
      this.log.info('The connection has been closed');
      this.serverSocket = null;
    });
    this.serverSocket.close();
  }

}

const log = _appiumSupport.logger.getLogger('DevCon Factory');

const SPLITTER = ':';

class DeviceConnectionsFactory {
  constructor() {
    this._connectionsMapping = {};
  }

  _udidAsToken(udid) {
    return `${_appiumSupport.util.hasValue(udid) ? udid : ''}${SPLITTER}`;
  }

  _portAsToken(port) {
    return `${SPLITTER}${_appiumSupport.util.hasValue(port) ? port : ''}`;
  }

  _toKey(udid = null, port = null) {
    return `${_appiumSupport.util.hasValue(udid) ? udid : ''}${SPLITTER}${_appiumSupport.util.hasValue(port) ? port : ''}`;
  }

  async _releaseProxiedConnections(connectionKeys) {
    const promises = [];

    for (const key of connectionKeys.filter(k => _lodash.default.has(this._connectionsMapping[k], 'iproxy'))) {
      promises.push((async () => {
        log.info(`Releasing the listener for '${key}'`);

        try {
          await this._connectionsMapping[key].iproxy.quit();
        } catch (ign) {}

        return key;
      })());
    }

    return await _bluebird.default.all(promises);
  }

  listConnections(udid = null, port = null, strict = false) {
    if (!udid && !port) {
      return [];
    }

    return _lodash.default.keys(this._connectionsMapping).filter(key => strict && udid && port ? key === this._toKey(udid, port) : udid && key.startsWith(this._udidAsToken(udid)) || port && key.endsWith(this._portAsToken(port)));
  }

  async requestConnection(udid, port, options = {}) {
    if (!udid || !port) {
      log.warn('Did not know how to request the connection:');

      if (!udid) {
        log.warn('- Device UDID is unset');
      }

      if (!port) {
        log.warn('- The local port number is unset');
      }

      return;
    }

    const {
      usePortForwarding,
      devicePort
    } = options;
    log.info(`Requesting connection for device ${udid} on local port ${port}` + (devicePort ? `, device port ${devicePort}` : ''));
    log.debug(`Cached connections count: ${_lodash.default.size(this._connectionsMapping)}`);
    const connectionsOnPort = this.listConnections(null, port);

    if (!_lodash.default.isEmpty(connectionsOnPort)) {
      log.info(`Found cached connections on port #${port}: ${JSON.stringify(connectionsOnPort)}`);
    }

    if (usePortForwarding) {
      let isPortBusy = (await (0, _portscanner.checkPortStatus)(port, '127.0.0.1')) === 'open';

      if (isPortBusy) {
        log.warn(`Port #${port} is busy`);

        if (!_lodash.default.isEmpty(connectionsOnPort)) {
          log.info('Trying to release the port');

          for (const key of await this._releaseProxiedConnections(connectionsOnPort)) {
            delete this._connectionsMapping[key];
          }

          if ((await (0, _portscanner.checkPortStatus)(port, '127.0.0.1')) !== 'open') {
            log.info(`Port #${port} has been successfully released`);
            isPortBusy = false;
          } else {
            log.warn(`Did not know how to release port #${port}`);
          }
        }
      }

      if (isPortBusy) {
        throw new Error(`The port #${port} is occupied by an other process. ` + `You can either quit that process or select another free port.`);
      }
    }

    const currentKey = this._toKey(udid, port);

    if (usePortForwarding) {
      const iproxy = new iProxy(udid, port, devicePort);

      try {
        await iproxy.start();
        this._connectionsMapping[currentKey] = {
          iproxy
        };
      } catch (e) {
        try {
          await iproxy.quit();
        } catch (ign) {}

        throw e;
      }
    } else {
      this._connectionsMapping[currentKey] = {};
    }

    log.info(`Successfully requested the connection for ${currentKey}`);
  }

  async releaseConnection(udid = null, port = null) {
    if (!udid && !port) {
      log.warn('Neither device UDID nor local port is set. ' + 'Did not know how to release the connection');
      return;
    }

    log.info(`Releasing connections for ${udid || 'any'} device on ${port || 'any'} port number`);
    const keys = this.listConnections(udid, port, true);

    if (_lodash.default.isEmpty(keys)) {
      log.info('No cached connections have been found');
      return;
    }

    log.info(`Found cached connections to release: ${JSON.stringify(keys)}`);
    await this._releaseProxiedConnections(keys);

    for (const key of keys) {
      delete this._connectionsMapping[key];
    }

    log.debug(`Cached connections count: ${_lodash.default.size(this._connectionsMapping)}`);
  }

}

exports.DeviceConnectionsFactory = DeviceConnectionsFactory;
const DEVICE_CONNECTIONS_FACTORY = new DeviceConnectionsFactory();
exports.DEVICE_CONNECTIONS_FACTORY = DEVICE_CONNECTIONS_FACTORY;
var _default = DEVICE_CONNECTIONS_FACTORY;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9kZXZpY2UtY29ubmVjdGlvbnMtZmFjdG9yeS5qcyJdLCJuYW1lcyI6WyJpUHJveHkiLCJjb25zdHJ1Y3RvciIsInVkaWQiLCJsb2NhbHBvcnQiLCJkZXZpY2Vwb3J0IiwicGFyc2VJbnQiLCJzZXJ2ZXJTb2NrZXQiLCJsb2ciLCJsb2dnZXIiLCJnZXRMb2dnZXIiLCJzdWJzdHJpbmciLCJzdGFydCIsIm5ldCIsImNyZWF0ZVNlcnZlciIsImNvbm5lY3Rpb24iLCJzb2NrZXQiLCJ1dGlsaXRpZXMiLCJjb25uZWN0UG9ydCIsIm9uIiwiZW5kIiwiZSIsImVycm9yIiwicGlwZSIsInN0YXR1cyIsIkIiLCJyZXNvbHZlIiwicmVqZWN0Iiwib25jZSIsImxpc3RlbiIsInF1aXQiLCJpbmZvIiwiY2xvc2UiLCJTUExJVFRFUiIsIkRldmljZUNvbm5lY3Rpb25zRmFjdG9yeSIsIl9jb25uZWN0aW9uc01hcHBpbmciLCJfdWRpZEFzVG9rZW4iLCJ1dGlsIiwiaGFzVmFsdWUiLCJfcG9ydEFzVG9rZW4iLCJwb3J0IiwiX3RvS2V5IiwiX3JlbGVhc2VQcm94aWVkQ29ubmVjdGlvbnMiLCJjb25uZWN0aW9uS2V5cyIsInByb21pc2VzIiwia2V5IiwiZmlsdGVyIiwiayIsIl8iLCJoYXMiLCJwdXNoIiwiaXByb3h5IiwiaWduIiwiYWxsIiwibGlzdENvbm5lY3Rpb25zIiwic3RyaWN0Iiwia2V5cyIsInN0YXJ0c1dpdGgiLCJlbmRzV2l0aCIsInJlcXVlc3RDb25uZWN0aW9uIiwib3B0aW9ucyIsIndhcm4iLCJ1c2VQb3J0Rm9yd2FyZGluZyIsImRldmljZVBvcnQiLCJkZWJ1ZyIsInNpemUiLCJjb25uZWN0aW9uc09uUG9ydCIsImlzRW1wdHkiLCJKU09OIiwic3RyaW5naWZ5IiwiaXNQb3J0QnVzeSIsIkVycm9yIiwiY3VycmVudEtleSIsInJlbGVhc2VDb25uZWN0aW9uIiwiREVWSUNFX0NPTk5FQ1RJT05TX0ZBQ1RPUlkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7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bmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCB7IGxvZ2dlciwgdXRpbCB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCB7IHV0aWxpdGllcyB9IGZyb20gJ2FwcGl1bS1pb3MtZGV2aWNlJztcbmltcG9ydCB7IGNoZWNrUG9ydFN0YXR1cyB9IGZyb20gJ3BvcnRzY2FubmVyJztcblxuY2xhc3MgaVByb3h5IHtcbiAgY29uc3RydWN0b3IgKHVkaWQsIGxvY2FscG9ydCwgZGV2aWNlcG9ydCkge1xuICAgIHRoaXMubG9jYWxwb3J0ID0gcGFyc2VJbnQobG9jYWxwb3J0LCAxMCk7XG4gICAgdGhpcy5kZXZpY2Vwb3J0ID0gcGFyc2VJbnQoZGV2aWNlcG9ydCwgMTApO1xuICAgIHRoaXMudWRpZCA9IHVkaWQ7XG4gICAgdGhpcy5zZXJ2ZXJTb2NrZXQgPSBudWxsO1xuICAgIHRoaXMubG9nID0gbG9nZ2VyLmdldExvZ2dlcihgaVByb3h5QCR7dWRpZC5zdWJzdHJpbmcoMCwgOCl9YCk7XG4gIH1cblxuICBhc3luYyBzdGFydCAoKSB7XG4gICAgaWYgKHRoaXMuc2VydmVyU29ja2V0KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuc2VydmVyU29ja2V0ID0gbmV0LmNyZWF0ZVNlcnZlcihhc3luYyAoY29ubmVjdGlvbikgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3Qgc29ja2V0ID0gYXdhaXQgdXRpbGl0aWVzLmNvbm5lY3RQb3J0KHRoaXMudWRpZCwgdGhpcy5kZXZpY2Vwb3J0KTtcbiAgICAgICAgc29ja2V0Lm9uKCdjbG9zZScsICgpID0+IGNvbm5lY3Rpb24uZW5kKCkpO1xuICAgICAgICBzb2NrZXQub24oJ2Vycm9yJywgKGUpID0+IHRoaXMubG9nLmVycm9yKGUpKTtcbiAgICAgICAgY29ubmVjdGlvbi5vbignY2xvc2UnLCAoKSA9PiBzb2NrZXQuZW5kKCkpO1xuICAgICAgICBjb25uZWN0aW9uLm9uKCdlcnJvcicsIChlKSA9PiB0aGlzLmxvZy5lcnJvcihlKSk7XG4gICAgICAgIGNvbm5lY3Rpb24ucGlwZShzb2NrZXQpO1xuICAgICAgICBzb2NrZXQucGlwZShjb25uZWN0aW9uKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgdGhpcy5sb2cuZXJyb3IoZSk7XG4gICAgICAgIGNvbm5lY3Rpb24uZW5kKCk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgY29uc3Qgc3RhdHVzID0gbmV3IEIoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgdGhpcy5zZXJ2ZXJTb2NrZXQub25jZSgnbGlzdGVuaW5nJywgcmVzb2x2ZSk7XG4gICAgICB0aGlzLnNlcnZlclNvY2tldC5vbmNlKCdlcnJvcicsIHJlamVjdCk7XG4gICAgfSk7XG4gICAgdGhpcy5zZXJ2ZXJTb2NrZXQubGlzdGVuKHRoaXMubG9jYWxwb3J0KTtcbiAgICBhd2FpdCBzdGF0dXM7XG4gICAgdGhpcy5zZXJ2ZXJTb2NrZXQub24oJ2Vycm9yJywgKGUpID0+IHRoaXMubG9nLmVycm9yKGUpKTtcbiAgfVxuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZXF1aXJlLWF3YWl0XG4gIGFzeW5jIHF1aXQgKCkge1xuICAgIGlmICghdGhpcy5zZXJ2ZXJTb2NrZXQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBUT0RPOiBXYWl0IHVudGlsIHRoZSBjb25uZWN0aW9uIGlzIGFjdHVhbGx5IGNsb3NlZFxuICAgIC8vIGFmdGVyIHRoZSBjb3JyZXNwb25kaW5nIGZpeGVzIGFyZSBkb25lIGluIGFwcGl1bS1pb3MtZGV2aWNlXG4gICAgLy8gbW9kdWxlLiBXaXRob3V0IHRoZSBmaXhlcyB0aGUgY2xvc2UgZXZlbnQgbWlnaHQgYmUgZGVsYXllZCBmb3IgdXAgdG9cbiAgICAvLyAzMCBzZWNvbmRzIChzZWUgaHR0cHM6Ly9naXRodWIuY29tL2FwcGl1bS9hcHBpdW0teGN1aXRlc3QtZHJpdmVyL3B1bGwvMTA5NCNpc3N1ZWNvbW1lbnQtNTQ2NTc4NzY1KVxuICAgIHRoaXMuc2VydmVyU29ja2V0Lm9uY2UoJ2Nsb3NlJywgKCkgPT4ge1xuICAgICAgdGhpcy5sb2cuaW5mbygnVGhlIGNvbm5lY3Rpb24gaGFzIGJlZW4gY2xvc2VkJyk7XG4gICAgICB0aGlzLnNlcnZlclNvY2tldCA9IG51bGw7XG4gICAgfSk7XG4gICAgdGhpcy5zZXJ2ZXJTb2NrZXQuY2xvc2UoKTtcbiAgfVxufVxuXG5cbmNvbnN0IGxvZyA9IGxvZ2dlci5nZXRMb2dnZXIoJ0RldkNvbiBGYWN0b3J5Jyk7XG5jb25zdCBTUExJVFRFUiA9ICc6JztcblxuY2xhc3MgRGV2aWNlQ29ubmVjdGlvbnNGYWN0b3J5IHtcbiAgY29uc3RydWN0b3IgKCkge1xuICAgIHRoaXMuX2Nvbm5lY3Rpb25zTWFwcGluZyA9IHt9O1xuICB9XG5cbiAgX3VkaWRBc1Rva2VuICh1ZGlkKSB7XG4gICAgcmV0dXJuIGAke3V0aWwuaGFzVmFsdWUodWRpZCkgPyB1ZGlkIDogJyd9JHtTUExJVFRFUn1gO1xuICB9XG5cbiAgX3BvcnRBc1Rva2VuIChwb3J0KSB7XG4gICAgcmV0dXJuIGAke1NQTElUVEVSfSR7dXRpbC5oYXNWYWx1ZShwb3J0KSA/IHBvcnQgOiAnJ31gO1xuICB9XG5cbiAgX3RvS2V5ICh1ZGlkID0gbnVsbCwgcG9ydCA9IG51bGwpIHtcbiAgICByZXR1cm4gYCR7dXRpbC5oYXNWYWx1ZSh1ZGlkKSA/IHVkaWQgOiAnJ30ke1NQTElUVEVSfSR7dXRpbC5oYXNWYWx1ZShwb3J0KSA/IHBvcnQgOiAnJ31gO1xuICB9XG5cbiAgYXN5bmMgX3JlbGVhc2VQcm94aWVkQ29ubmVjdGlvbnMgKGNvbm5lY3Rpb25LZXlzKSB7XG4gICAgY29uc3QgcHJvbWlzZXMgPSBbXTtcbiAgICBmb3IgKGNvbnN0IGtleSBvZiBjb25uZWN0aW9uS2V5cy5maWx0ZXIoKGspID0+IF8uaGFzKHRoaXMuX2Nvbm5lY3Rpb25zTWFwcGluZ1trXSwgJ2lwcm94eScpKSkge1xuICAgICAgcHJvbWlzZXMucHVzaCgoYXN5bmMgKCkgPT4ge1xuICAgICAgICBsb2cuaW5mbyhgUmVsZWFzaW5nIHRoZSBsaXN0ZW5lciBmb3IgJyR7a2V5fSdgKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBhd2FpdCB0aGlzLl9jb25uZWN0aW9uc01hcHBpbmdba2V5XS5pcHJveHkucXVpdCgpO1xuICAgICAgICB9IGNhdGNoIChpZ24pIHt9XG4gICAgICAgIHJldHVybiBrZXk7XG4gICAgICB9KSgpKTtcbiAgICB9XG4gICAgcmV0dXJuIGF3YWl0IEIuYWxsKHByb21pc2VzKTtcbiAgfVxuXG4gIGxpc3RDb25uZWN0aW9ucyAodWRpZCA9IG51bGwsIHBvcnQgPSBudWxsLCBzdHJpY3QgPSBmYWxzZSkge1xuICAgIGlmICghdWRpZCAmJiAhcG9ydCkge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIC8vIGB0aGlzLl9jb25uZWN0aW9uTWFwcGluZ2Aga2V5cyBoYXZlIGZvcm1hdCBgdWRpZDpwb3J0YFxuICAgIC8vIHRoZSBgc3RyaWN0YCBhcmd1bWVudCBlbmZvcmNlcyB0byBtYXRjaCBrZXlzIGhhdmluZyBib3RoIGB1ZGlkYCBhbmQgYHBvcnRgXG4gICAgLy8gaWYgdGhleSBhcmUgZGVmaW5lZFxuICAgIC8vIHdoaWxlIGluIG5vbi1zdHJpY3QgbW9kZSBrZXlzIGhhdmluZyBhbnkgb2YgdGhlc2UgYXJlIGdvaW5nIHRvIGJlIG1hdGNoZWRcbiAgICByZXR1cm4gXy5rZXlzKHRoaXMuX2Nvbm5lY3Rpb25zTWFwcGluZylcbiAgICAgIC5maWx0ZXIoKGtleSkgPT4gKHN0cmljdCAmJiB1ZGlkICYmIHBvcnQpXG4gICAgICAgID8gKGtleSA9PT0gdGhpcy5fdG9LZXkodWRpZCwgcG9ydCkpXG4gICAgICAgIDogKHVkaWQgJiYga2V5LnN0YXJ0c1dpdGgodGhpcy5fdWRpZEFzVG9rZW4odWRpZCkpIHx8IHBvcnQgJiYga2V5LmVuZHNXaXRoKHRoaXMuX3BvcnRBc1Rva2VuKHBvcnQpKSlcbiAgICAgICk7XG4gIH1cblxuICBhc3luYyByZXF1ZXN0Q29ubmVjdGlvbiAodWRpZCwgcG9ydCwgb3B0aW9ucyA9IHt9KSB7XG4gICAgaWYgKCF1ZGlkIHx8ICFwb3J0KSB7XG4gICAgICBsb2cud2FybignRGlkIG5vdCBrbm93IGhvdyB0byByZXF1ZXN0IHRoZSBjb25uZWN0aW9uOicpO1xuICAgICAgaWYgKCF1ZGlkKSB7XG4gICAgICAgIGxvZy53YXJuKCctIERldmljZSBVRElEIGlzIHVuc2V0Jyk7XG4gICAgICB9XG4gICAgICBpZiAoIXBvcnQpIHtcbiAgICAgICAgbG9nLndhcm4oJy0gVGhlIGxvY2FsIHBvcnQgbnVtYmVyIGlzIHVuc2V0Jyk7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3Qge1xuICAgICAgdXNlUG9ydEZvcndhcmRpbmcsXG4gICAgICBkZXZpY2VQb3J0LFxuICAgIH0gPSBvcHRpb25zO1xuXG4gICAgbG9nLmluZm8oYFJlcXVlc3RpbmcgY29ubmVjdGlvbiBmb3IgZGV2aWNlICR7dWRpZH0gb24gbG9jYWwgcG9ydCAke3BvcnR9YCArXG4gICAgICAoZGV2aWNlUG9ydCA/IGAsIGRldmljZSBwb3J0ICR7ZGV2aWNlUG9ydH1gIDogJycpKTtcbiAgICBsb2cuZGVidWcoYENhY2hlZCBjb25uZWN0aW9ucyBjb3VudDogJHtfLnNpemUodGhpcy5fY29ubmVjdGlvbnNNYXBwaW5nKX1gKTtcbiAgICBjb25zdCBjb25uZWN0aW9uc09uUG9ydCA9IHRoaXMubGlzdENvbm5lY3Rpb25zKG51bGwsIHBvcnQpO1xuICAgIGlmICghXy5pc0VtcHR5KGNvbm5lY3Rpb25zT25Qb3J0KSkge1xuICAgICAgbG9nLmluZm8oYEZvdW5kIGNhY2hlZCBjb25uZWN0aW9ucyBvbiBwb3J0ICMke3BvcnR9OiAke0pTT04uc3RyaW5naWZ5KGNvbm5lY3Rpb25zT25Qb3J0KX1gKTtcbiAgICB9XG5cbiAgICBpZiAodXNlUG9ydEZvcndhcmRpbmcpIHtcbiAgICAgIGxldCBpc1BvcnRCdXN5ID0gKGF3YWl0IGNoZWNrUG9ydFN0YXR1cyhwb3J0LCAnMTI3LjAuMC4xJykpID09PSAnb3Blbic7XG4gICAgICBpZiAoaXNQb3J0QnVzeSkge1xuICAgICAgICBsb2cud2FybihgUG9ydCAjJHtwb3J0fSBpcyBidXN5YCk7XG4gICAgICAgIGlmICghXy5pc0VtcHR5KGNvbm5lY3Rpb25zT25Qb3J0KSkge1xuICAgICAgICAgIGxvZy5pbmZvKCdUcnlpbmcgdG8gcmVsZWFzZSB0aGUgcG9ydCcpO1xuICAgICAgICAgIGZvciAoY29uc3Qga2V5IG9mIGF3YWl0IHRoaXMuX3JlbGVhc2VQcm94aWVkQ29ubmVjdGlvbnMoY29ubmVjdGlvbnNPblBvcnQpKSB7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5fY29ubmVjdGlvbnNNYXBwaW5nW2tleV07XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICgoYXdhaXQgY2hlY2tQb3J0U3RhdHVzKHBvcnQsICcxMjcuMC4wLjEnKSkgIT09ICdvcGVuJykge1xuICAgICAgICAgICAgbG9nLmluZm8oYFBvcnQgIyR7cG9ydH0gaGFzIGJlZW4gc3VjY2Vzc2Z1bGx5IHJlbGVhc2VkYCk7XG4gICAgICAgICAgICBpc1BvcnRCdXN5ID0gZmFsc2U7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxvZy53YXJuKGBEaWQgbm90IGtub3cgaG93IHRvIHJlbGVhc2UgcG9ydCAjJHtwb3J0fWApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoaXNQb3J0QnVzeSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSBwb3J0ICMke3BvcnR9IGlzIG9jY3VwaWVkIGJ5IGFuIG90aGVyIHByb2Nlc3MuIGAgK1xuICAgICAgICAgIGBZb3UgY2FuIGVpdGhlciBxdWl0IHRoYXQgcHJvY2VzcyBvciBzZWxlY3QgYW5vdGhlciBmcmVlIHBvcnQuYCk7XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGN1cnJlbnRLZXkgPSB0aGlzLl90b0tleSh1ZGlkLCBwb3J0KTtcbiAgICBpZiAodXNlUG9ydEZvcndhcmRpbmcpIHtcbiAgICAgIGNvbnN0IGlwcm94eSA9IG5ldyBpUHJveHkodWRpZCwgcG9ydCwgZGV2aWNlUG9ydCk7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBpcHJveHkuc3RhcnQoKTtcbiAgICAgICAgdGhpcy5fY29ubmVjdGlvbnNNYXBwaW5nW2N1cnJlbnRLZXldID0ge2lwcm94eX07XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgaXByb3h5LnF1aXQoKTtcbiAgICAgICAgfSBjYXRjaCAoaWduKSB7fVxuICAgICAgICB0aHJvdyBlO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9jb25uZWN0aW9uc01hcHBpbmdbY3VycmVudEtleV0gPSB7fTtcbiAgICB9XG4gICAgbG9nLmluZm8oYFN1Y2Nlc3NmdWxseSByZXF1ZXN0ZWQgdGhlIGNvbm5lY3Rpb24gZm9yICR7Y3VycmVudEtleX1gKTtcbiAgfVxuXG4gIGFzeW5jIHJlbGVhc2VDb25uZWN0aW9uICh1ZGlkID0gbnVsbCwgcG9ydCA9IG51bGwpIHtcbiAgICBpZiAoIXVkaWQgJiYgIXBvcnQpIHtcbiAgICAgIGxvZy53YXJuKCdOZWl0aGVyIGRldmljZSBVRElEIG5vciBsb2NhbCBwb3J0IGlzIHNldC4gJyArXG4gICAgICAgICdEaWQgbm90IGtub3cgaG93IHRvIHJlbGVhc2UgdGhlIGNvbm5lY3Rpb24nKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgbG9nLmluZm8oYFJlbGVhc2luZyBjb25uZWN0aW9ucyBmb3IgJHt1ZGlkIHx8ICdhbnknfSBkZXZpY2Ugb24gJHtwb3J0IHx8ICdhbnknfSBwb3J0IG51bWJlcmApO1xuXG4gICAgY29uc3Qga2V5cyA9IHRoaXMubGlzdENvbm5lY3Rpb25zKHVkaWQsIHBvcnQsIHRydWUpO1xuICAgIGlmIChfLmlzRW1wdHkoa2V5cykpIHtcbiAgICAgIGxvZy5pbmZvKCdObyBjYWNoZWQgY29ubmVjdGlvbnMgaGF2ZSBiZWVuIGZvdW5kJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGxvZy5pbmZvKGBGb3VuZCBjYWNoZWQgY29ubmVjdGlvbnMgdG8gcmVsZWFzZTogJHtKU09OLnN0cmluZ2lmeShrZXlzKX1gKTtcbiAgICBhd2FpdCB0aGlzLl9yZWxlYXNlUHJveGllZENvbm5lY3Rpb25zKGtleXMpO1xuICAgIGZvciAoY29uc3Qga2V5IG9mIGtleXMpIHtcbiAgICAgIGRlbGV0ZSB0aGlzLl9jb25uZWN0aW9uc01hcHBpbmdba2V5XTtcbiAgICB9XG4gICAgbG9nLmRlYnVnKGBDYWNoZWQgY29ubmVjdGlvbnMgY291bnQ6ICR7Xy5zaXplKHRoaXMuX2Nvbm5lY3Rpb25zTWFwcGluZyl9YCk7XG4gIH1cbn1cblxuY29uc3QgREVWSUNFX0NPTk5FQ1RJT05TX0ZBQ1RPUlkgPSBuZXcgRGV2aWNlQ29ubmVjdGlvbnNGYWN0b3J5KCk7XG5cbmV4cG9ydCB7IERFVklDRV9DT05ORUNUSU9OU19GQUNUT1JZLCBEZXZpY2VDb25uZWN0aW9uc0ZhY3RvcnkgfTtcbmV4cG9ydCBkZWZhdWx0IERFVklDRV9DT05ORUNUSU9OU19GQUNUT1JZO1xuIl0sImZpbGUiOiJsaWIvZGV2aWNlLWNvbm5lY3Rpb25zLWZhY3RvcnkuanMiLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
