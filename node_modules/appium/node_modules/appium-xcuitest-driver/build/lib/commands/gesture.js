"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.gesturesChainToString = gesturesChainToString;
exports.default = exports.commands = exports.helpers = exports.extensions = void 0;

require("source-map-support/register");

var _appiumBaseDriver = require("appium-base-driver");

var _appiumSupport = require("appium-support");

var _appiumIosDriver = require("appium-ios-driver");

var _lodash = _interopRequireDefault(require("lodash"));

var _logger = _interopRequireDefault(require("../logger"));

let helpers = {},
    extensions = {},
    commands = {};
exports.commands = commands;
exports.extensions = extensions;
exports.helpers = helpers;
commands.moveTo = _appiumIosDriver.iosCommands.gesture.moveTo;

commands.mobileShake = async function mobileShake() {
  if (!this.isSimulator()) {
    throw new _appiumBaseDriver.errors.UnknownError('Shake is not supported on real devices');
  }

  await this.opts.device.shake();
};

commands.click = async function click(el) {
  if (!this.isWebContext()) {
    return await this.nativeClick(el);
  }

  el = _appiumSupport.util.unwrapElement(el);

  if ((await this.settings.getSettings()).nativeWebTap) {
    _logger.default.debug('Using native web tap');

    await this.nativeWebTap(el);
  } else {
    let atomsElement = this.useAtomsElement(el);
    return await this.executeAtom('click', [atomsElement]);
  }
};

function gesturesChainToString(gestures, keysToInclude = ['options']) {
  return gestures.map(item => {
    let otherKeys = _lodash.default.difference(_lodash.default.keys(item), ['action']);

    otherKeys = _lodash.default.isArray(keysToInclude) ? _lodash.default.intersection(otherKeys, keysToInclude) : otherKeys;

    if (otherKeys.length) {
      return `${item.action}` + `(${_lodash.default.map(otherKeys, x => x + '=' + (_lodash.default.isPlainObject(item[x]) ? JSON.stringify(item[x]) : item[x])).join(', ')})`;
    }

    return item.action;
  }).join('-');
}

commands.performActions = async function performActions(actions) {
  _logger.default.debug(`Received the following W3C actions: ${JSON.stringify(actions, null, '  ')}`);

  const preprocessedActions = actions.map(action => Object.assign({}, action, action.type === 'pointer' ? {
    parameters: {
      pointerType: 'touch'
    }
  } : {})).map(action => {
    const modifiedAction = _lodash.default.clone(action) || {};
    modifiedAction.actions = (action.actions || []).filter(innerAction => !(innerAction.type === 'pause' && innerAction.duration === 0));
    return modifiedAction;
  });

  _logger.default.debug(`Preprocessed actions: ${JSON.stringify(preprocessedActions, null, '  ')}`);

  return await this.proxyCommand('/actions', 'POST', {
    actions: preprocessedActions
  });
};

commands.performTouch = async function performTouch(gestures) {
  _logger.default.debug(`Received the following touch action: ${gesturesChainToString(gestures)}`);

  try {
    return await this.proxyCommand('/wda/touch/perform', 'POST', {
      actions: gestures
    });
  } catch (e) {
    if (!this.isWebContext()) {
      throw e;
    }

    _logger.default.errorAndThrow('The Touch API is aimed for usage in NATIVE context. ' + 'Consider using "execute" API with custom events trigger script ' + `to emulate touch events being in WEBVIEW context. Original error: ${e.message}`);
  }
};

commands.performMultiAction = async function performMultiAction(actions) {
  _logger.default.debug(`Received the following multi touch action:`);

  for (let i in actions) {
    _logger.default.debug(`    ${parseInt(i, 10) + 1}: ${_lodash.default.map(actions[i], 'action').join('-')}`);
  }

  try {
    return await this.proxyCommand('/wda/touch/multi/perform', 'POST', {
      actions
    });
  } catch (e) {
    if (!this.isWebContext()) {
      throw e;
    }

    _logger.default.errorAndThrow('The MultiTouch API is aimed for usage in NATIVE context. ' + 'Consider using "execute" API with custom events trigger script ' + `to emulate multitouch events being in WEBVIEW context. Original error: ${e.message}`);
  }
};

commands.nativeClick = async function nativeClick(el) {
  el = _appiumSupport.util.unwrapElement(el);
  let endpoint = `/element/${el}/click`;
  return await this.proxyCommand(endpoint, 'POST', {});
};

helpers.mobileScroll = async function mobileScroll(opts = {}, swipe = false) {
  if (!opts.element) {
    opts.element = await this.findNativeElementOrElements(`class name`, `XCUIElementTypeApplication`, false);
  }

  let params = {};

  if (opts.name && !swipe) {
    params.name = opts.name;
  } else if (opts.direction) {
    if (!['up', 'down', 'left', 'right'].includes(opts.direction.toLowerCase())) {
      let msg = 'Direction must be up, down, left or right';

      _logger.default.errorAndThrow(msg);
    }

    params.direction = opts.direction;
  } else if (opts.predicateString && !swipe) {
    params.predicateString = opts.predicateString;
  } else if (opts.toVisible && !swipe) {
    params.toVisible = opts.toVisible;
  } else {
    let msg = swipe ? 'Mobile swipe requires direction' : 'Mobile scroll supports the following strategies: name, direction, predicateString, and toVisible. Specify one of these';

    _logger.default.errorAndThrow(msg);
  }

  if (!swipe && opts.distance) {
    params.distance = opts.distance;
  }

  let element = _appiumSupport.util.unwrapElement(opts.element);

  let endpoint = `/wda/element/${element}/${swipe ? 'swipe' : 'scroll'}`;
  return await this.proxyCommand(endpoint, 'POST', params);
};

helpers.mobileSwipe = async function mobileSwipe(opts = {}) {
  return await this.mobileScroll(opts, true);
};

function parseFloatParameter(paramName, paramValue, methodName) {
  if (_lodash.default.isUndefined(paramValue)) {
    _logger.default.errorAndThrow(`"${paramName}" parameter is mandatory for "${methodName}" call`);
  }

  const result = parseFloat(paramValue);

  if (isNaN(result)) {
    _logger.default.errorAndThrow(`"${paramName}" parameter should be a valid number. "${paramValue}" is given instead`);
  }

  return result;
}

helpers.mobilePinch = async function mobilePinch(opts = {}) {
  if (!opts.element) {
    opts.element = await this.findNativeElementOrElements(`class name`, `XCUIElementTypeApplication`, false);
  }

  const params = {
    scale: parseFloatParameter('scale', opts.scale, 'pinch'),
    velocity: parseFloatParameter('velocity', opts.velocity, 'pinch')
  };

  const el = _appiumSupport.util.unwrapElement(opts.element);

  return await this.proxyCommand(`/wda/element/${el}/pinch`, 'POST', params);
};

helpers.mobileDoubleTap = async function mobileDoubleTap(opts = {}) {
  if (opts.element) {
    const el = _appiumSupport.util.unwrapElement(opts.element);

    return await this.proxyCommand(`/wda/element/${el}/doubleTap`, 'POST');
  }

  const params = {
    x: parseFloatParameter('x', opts.x, 'doubleTap'),
    y: parseFloatParameter('y', opts.y, 'doubleTap')
  };
  return await this.proxyCommand('/wda/doubleTap', 'POST', params);
};

helpers.mobileTwoFingerTap = async function mobileTwoFingerTap(opts = {}) {
  if (!opts.element) {
    opts.element = await this.findNativeElementOrElements(`class name`, `XCUIElementTypeApplication`, false);
  }

  const el = _appiumSupport.util.unwrapElement(opts.element);

  return await this.proxyCommand(`/wda/element/${el}/twoFingerTap`, 'POST');
};

helpers.mobileTouchAndHold = async function mobileTouchAndHold(opts = {}) {
  let params = {
    duration: parseFloatParameter('duration', opts.duration, 'touchAndHold')
  };

  if (opts.element) {
    const el = _appiumSupport.util.unwrapElement(opts.element);

    return await this.proxyCommand(`/wda/element/${el}/touchAndHold`, 'POST', params);
  }

  params.x = parseFloatParameter('x', opts.x, 'touchAndHold');
  params.y = parseFloatParameter('y', opts.y, 'touchAndHold');
  return await this.proxyCommand('/wda/touchAndHold', 'POST', params);
};

helpers.mobileTap = async function mobileTap(opts = {}) {
  const params = {
    x: parseFloatParameter('x', opts.x, 'tap'),
    y: parseFloatParameter('y', opts.y, 'tap')
  };
  const el = opts.element ? _appiumSupport.util.unwrapElement(opts.element) : '0';
  return await this.proxyCommand(`/wda/tap/${el}`, 'POST', params);
};

helpers.mobileDragFromToForDuration = async function mobileDragFromToForDuration(opts = {}) {
  const params = {
    duration: parseFloatParameter('duration', opts.duration, 'dragFromToForDuration'),
    fromX: parseFloatParameter('fromX', opts.fromX, 'dragFromToForDuration'),
    fromY: parseFloatParameter('fromY', opts.fromY, 'dragFromToForDuration'),
    toX: parseFloatParameter('toX', opts.toX, 'dragFromToForDuration'),
    toY: parseFloatParameter('toY', opts.toY, 'dragFromToForDuration')
  };

  if (opts.element) {
    const el = _appiumSupport.util.unwrapElement(opts.element);

    return await this.proxyCommand(`/wda/element/${el}/dragfromtoforduration`, 'POST', params);
  }

  return await this.proxyCommand('/wda/dragfromtoforduration', 'POST', params);
};

helpers.mobileSelectPickerWheelValue = async function mobileSelectPickerWheelValue(opts = {}) {
  if (!opts.element) {
    _logger.default.errorAndThrow('Element id is expected to be set for selectPickerWheelValue method');
  }

  if (!_lodash.default.isString(opts.order) || !['next', 'previous'].includes(opts.order.toLowerCase())) {
    _logger.default.errorAndThrow(`The mandatory 'order' parameter is expected to be equal either to 'next' or 'previous'. ` + `'${opts.order}' is given instead`);
  }

  const el = _appiumSupport.util.unwrapElement(opts.element);

  const params = {
    order: opts.order
  };

  if (opts.offset) {
    params.offset = parseFloatParameter('offset', opts.offset, 'selectPickerWheelValue');
  }

  return await this.proxyCommand(`/wda/pickerwheel/${el}/select`, 'POST', params);
};

helpers.mobileRotateElement = async function mobileRotateElement(opts = {}) {
  if (!opts.element) {
    _logger.default.errorAndThrow('Element id is expected to be set for rotateElement method');
  }

  const el = _appiumSupport.util.unwrapElement(opts.element);

  const params = {
    rotation: parseFloatParameter('rotation', opts.rotation, 'rotateElement'),
    velocity: parseFloatParameter('velocity', opts.velocity, 'rotateElement')
  };
  return await this.proxyCommand(`/wda/element/${el}/rotate`, 'POST', params);
};

helpers.getCoordinates = async function getCoordinates(gesture) {
  let el = gesture.options.element;
  let coordinates = {
    x: 0,
    y: 0,
    areOffsets: false
  };
  let optionX = null;

  if (gesture.options.x) {
    optionX = parseFloatParameter('x', gesture.options.x, 'getCoordinates');
  }

  let optionY = null;

  if (gesture.options.y) {
    optionY = parseFloatParameter('y', gesture.options.y, 'getCoordinates');
  }

  if (el) {
    let rect = await this.getElementRect(el);
    let pos = {
      x: rect.x,
      y: rect.y
    };
    let size = {
      w: rect.width,
      h: rect.height
    };
    let offsetX = 0;
    let offsetY = 0;

    if (optionX || optionY) {
      offsetX = optionX || 0;
      offsetY = optionY || 0;
    } else {
      offsetX = size.w / 2;
      offsetY = size.h / 2;
    }

    coordinates.x = pos.x + offsetX;
    coordinates.y = pos.y + offsetY;
  } else {
    coordinates.areOffsets = gesture.action === 'moveTo';
    coordinates.x = optionX || 0;
    coordinates.y = optionY || 0;
  }

  return coordinates;
};

helpers.applyMoveToOffset = function applyMoveToOffset(firstCoordinates, secondCoordinates) {
  if (secondCoordinates.areOffsets) {
    return {
      x: firstCoordinates.x + secondCoordinates.x,
      y: firstCoordinates.y + secondCoordinates.y
    };
  } else {
    return secondCoordinates;
  }
};

Object.assign(extensions, helpers, commands);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9nZXN0dXJlLmpzIl0sIm5hbWVzIjpbImhlbHBlcnMiLCJleHRlbnNpb25zIiwiY29tbWFuZHMiLCJtb3ZlVG8iLCJpb3NDb21tYW5kcyIsImdlc3R1cmUiLCJtb2JpbGVTaGFrZSIsImlzU2ltdWxhdG9yIiwiZXJyb3JzIiwiVW5rbm93bkVycm9yIiwib3B0cyIsImRldmljZSIsInNoYWtlIiwiY2xpY2siLCJlbCIsImlzV2ViQ29udGV4dCIsIm5hdGl2ZUNsaWNrIiwidXRpbCIsInVud3JhcEVsZW1lbnQiLCJzZXR0aW5ncyIsImdldFNldHRpbmdzIiwibmF0aXZlV2ViVGFwIiwibG9nIiwiZGVidWciLCJhdG9tc0VsZW1lbnQiLCJ1c2VBdG9tc0VsZW1lbnQiLCJleGVjdXRlQXRvbSIsImdlc3R1cmVzQ2hhaW5Ub1N0cmluZyIsImdlc3R1cmVzIiwia2V5c1RvSW5jbHVkZSIsIm1hcCIsIml0ZW0iLCJvdGhlcktleXMiLCJfIiwiZGlmZmVyZW5jZSIsImtleXMiLCJpc0FycmF5IiwiaW50ZXJzZWN0aW9uIiwibGVuZ3RoIiwiYWN0aW9uIiwieCIsImlzUGxhaW5PYmplY3QiLCJKU09OIiwic3RyaW5naWZ5Iiwiam9pbiIsInBlcmZvcm1BY3Rpb25zIiwiYWN0aW9ucyIsInByZXByb2Nlc3NlZEFjdGlvbnMiLCJPYmplY3QiLCJhc3NpZ24iLCJ0eXBlIiwicGFyYW1ldGVycyIsInBvaW50ZXJUeXBlIiwibW9kaWZpZWRBY3Rpb24iLCJjbG9uZSIsImZpbHRlciIsImlubmVyQWN0aW9uIiwiZHVyYXRpb24iLCJwcm94eUNvbW1hbmQiLCJwZXJmb3JtVG91Y2giLCJlIiwiZXJyb3JBbmRUaHJvdyIsIm1lc3NhZ2UiLCJwZXJmb3JtTXVsdGlBY3Rpb24iLCJpIiwicGFyc2VJbnQiLCJlbmRwb2ludCIsIm1vYmlsZVNjcm9sbCIsInN3aXBlIiwiZWxlbWVudCIsImZpbmROYXRpdmVFbGVtZW50T3JFbGVtZW50cyIsInBhcmFtcyIsIm5hbWUiLCJkaXJlY3Rpb24iLCJpbmNsdWRlcyIsInRvTG93ZXJDYXNlIiwibXNnIiwicHJlZGljYXRlU3RyaW5nIiwidG9WaXNpYmxlIiwiZGlzdGFuY2UiLCJtb2JpbGVTd2lwZSIsInBhcnNlRmxvYXRQYXJhbWV0ZXIiLCJwYXJhbU5hbWUiLCJwYXJhbVZhbHVlIiwibWV0aG9kTmFtZSIsImlzVW5kZWZpbmVkIiwicmVzdWx0IiwicGFyc2VGbG9hdCIsImlzTmFOIiwibW9iaWxlUGluY2giLCJzY2FsZSIsInZlbG9jaXR5IiwibW9iaWxlRG91YmxlVGFwIiwieSIsIm1vYmlsZVR3b0ZpbmdlclRhcCIsIm1vYmlsZVRvdWNoQW5kSG9sZCIsIm1vYmlsZVRhcCIsIm1vYmlsZURyYWdGcm9tVG9Gb3JEdXJhdGlvbiIsImZyb21YIiwiZnJvbVkiLCJ0b1giLCJ0b1kiLCJtb2JpbGVTZWxlY3RQaWNrZXJXaGVlbFZhbHVlIiwiaXNTdHJpbmciLCJvcmRlciIsIm9mZnNldCIsIm1vYmlsZVJvdGF0ZUVsZW1lbnQiLCJyb3RhdGlvbiIsImdldENvb3JkaW5hdGVzIiwib3B0aW9ucyIsImNvb3JkaW5hdGVzIiwiYXJlT2Zmc2V0cyIsIm9wdGlvblgiLCJvcHRpb25ZIiwicmVjdCIsImdldEVsZW1lbnRSZWN0IiwicG9zIiwic2l6ZSIsInciLCJ3aWR0aCIsImgiLCJoZWlnaHQiLCJvZmZzZXRYIiwib2Zmc2V0WSIsImFwcGx5TW92ZVRvT2Zmc2V0IiwiZmlyc3RDb29yZGluYXRlcyIsInNlY29uZENvb3JkaW5hdGVzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFHQSxJQUFJQSxPQUFPLEdBQUcsRUFBZDtBQUFBLElBQWtCQyxVQUFVLEdBQUcsRUFBL0I7QUFBQSxJQUFtQ0MsUUFBUSxHQUFHLEVBQTlDOzs7O0FBRUFBLFFBQVEsQ0FBQ0MsTUFBVCxHQUFrQkMsNkJBQVlDLE9BQVosQ0FBb0JGLE1BQXRDOztBQUVBRCxRQUFRLENBQUNJLFdBQVQsR0FB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aUIsQ0FBQ2pDO0FBRnJDLEtBQVA7QUFJRCxHQUxELE1BS087QUFDTCxXQUFPaUMsaUJBQVA7QUFDRDtBQUNGLENBVEQ7O0FBV0E5RSxNQUFNLENBQUNDLE1BQVAsQ0FBY2hELFVBQWQsRUFBMEJELE9BQTFCLEVBQW1DRSxRQUFuQztlQUVlRCxVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXJyb3JzIH0gZnJvbSAnYXBwaXVtLWJhc2UtZHJpdmVyJztcbmltcG9ydCB7IHV0aWwgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgeyBpb3NDb21tYW5kcyB9IGZyb20gJ2FwcGl1bS1pb3MtZHJpdmVyJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgbG9nIGZyb20gJy4uL2xvZ2dlcic7XG5cblxubGV0IGhlbHBlcnMgPSB7fSwgZXh0ZW5zaW9ucyA9IHt9LCBjb21tYW5kcyA9IHt9O1xuXG5jb21tYW5kcy5tb3ZlVG8gPSBpb3NDb21tYW5kcy5nZXN0dXJlLm1vdmVUbztcblxuY29tbWFuZHMubW9iaWxlU2hha2UgPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVTaGFrZSAoKSB7XG4gIGlmICghdGhpcy5pc1NpbXVsYXRvcigpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Vbmtub3duRXJyb3IoJ1NoYWtlIGlzIG5vdCBzdXBwb3J0ZWQgb24gcmVhbCBkZXZpY2VzJyk7XG4gIH1cbiAgYXdhaXQgdGhpcy5vcHRzLmRldmljZS5zaGFrZSgpO1xufTtcblxuY29tbWFuZHMuY2xpY2sgPSBhc3luYyBmdW5jdGlvbiBjbGljayAoZWwpIHtcbiAgaWYgKCF0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgLy8gdGhlcmUgYXJlIG11bHRpcGxlIGNvbW1hbmRzIHRoYXQgbWFwIGhlcmUsIHNvIG1hbnVhbGx5IHByb3h5XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMubmF0aXZlQ2xpY2soZWwpO1xuICB9XG4gIGVsID0gdXRpbC51bndyYXBFbGVtZW50KGVsKTtcbiAgaWYgKChhd2FpdCB0aGlzLnNldHRpbmdzLmdldFNldHRpbmdzKCkpLm5hdGl2ZVdlYlRhcCkge1xuICAgIC8vIGF0b21zLWJhc2VkIGNsaWNrcyBkb24ndCBhbHdheXMgd29yayBpbiBzYWZhcmkgN1xuICAgIGxvZy5kZWJ1ZygnVXNpbmcgbmF0aXZlIHdlYiB0YXAnKTtcbiAgICBhd2FpdCB0aGlzLm5hdGl2ZVdlYlRhcChlbCk7XG4gIH0gZWxzZSB7XG4gICAgbGV0IGF0b21zRWxlbWVudCA9IHRoaXMudXNlQXRvbXNFbGVtZW50KGVsKTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5leGVjdXRlQXRvbSgnY2xpY2snLCBbYXRvbXNFbGVtZW50XSk7XG4gIH1cbn07XG5cbmZ1bmN0aW9uIGdlc3R1cmVzQ2hhaW5Ub1N0cmluZyAoZ2VzdHVyZXMsIGtleXNUb0luY2x1ZGUgPSBbJ29wdGlvbnMnXSkge1xuICByZXR1cm4gZ2VzdHVyZXMubWFwKChpdGVtKSA9PiB7XG4gICAgbGV0IG90aGVyS2V5cyA9IF8uZGlmZmVyZW5jZShfLmtleXMoaXRlbSksIFsnYWN0aW9uJ10pO1xuICAgIG90aGVyS2V5cyA9IF8uaXNBcnJheShrZXlzVG9JbmNsdWRlKSA/IF8uaW50ZXJzZWN0aW9uKG90aGVyS2V5cywga2V5c1RvSW5jbHVkZSkgOiBvdGhlcktleXM7XG4gICAgaWYgKG90aGVyS2V5cy5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBgJHtpdGVtLmFjdGlvbn1gICtcbiAgICAgICAgYCgke18ubWFwKG90aGVyS2V5cywgKHgpID0+IHggKyAnPScgKyAoXy5pc1BsYWluT2JqZWN0KGl0ZW1beF0pID8gSlNPTi5zdHJpbmdpZnkoaXRlbVt4XSkgOiBpdGVtW3hdKSkuam9pbignLCAnKX0pYDtcbiAgICB9XG4gICAgcmV0dXJuIGl0ZW0uYWN0aW9uO1xuICB9KS5qb2luKCctJyk7XG59XG5cbmNvbW1hbmRzLnBlcmZvcm1BY3Rpb25zID0gYXN5bmMgZnVuY3Rpb24gcGVyZm9ybUFjdGlvbnMgKGFjdGlvbnMpIHtcbiAgbG9nLmRlYnVnKGBSZWNlaXZlZCB0aGUgZm9sbG93aW5nIFczQyBhY3Rpb25zOiAke0pTT04uc3RyaW5naWZ5KGFjdGlvbnMsIG51bGwsICcgICcpfWApO1xuICAvLyBUaGlzIGlzIG1hbmRhdG9yeSwgc2luY2UgV0RBIG9ubHkgc3VwcG9ydHMgVE9VQ0ggcG9pbnRlciB0eXBlXG4gIC8vIGFuZCBTZWxlbml1bSBBUEkgdXNlcyBNT1VTRSBhcyB0aGUgZGVmYXVsdCBvbmVcbiAgY29uc3QgcHJlcHJvY2Vzc2VkQWN0aW9ucyA9IGFjdGlvbnNcbiAgICAubWFwKChhY3Rpb24pID0+IE9iamVjdC5hc3NpZ24oe30sIGFjdGlvbiwgYWN0aW9uLnR5cGUgPT09ICdwb2ludGVyJyA/IHtcbiAgICAgIHBhcmFtZXRlcnM6IHtcbiAgICAgICAgcG9pbnRlclR5cGU6ICd0b3VjaCdcbiAgICAgIH1cbiAgICB9IDoge30pKVxuICAgIC5tYXAoKGFjdGlvbikgPT4ge1xuICAgICAgY29uc3QgbW9kaWZpZWRBY3Rpb24gPSBfLmNsb25lKGFjdGlvbikgfHwge307XG4gICAgICAvLyBTZWxlbml1bSBBUEkgdW5leHBlY3RlZGx5IGluc2VydHMgemVybyBwYXVzZXMsIHdoaWNoIGFyZSBub3Qgc3VwcG9ydGVkIGJ5IFdEQVxuICAgICAgbW9kaWZpZWRBY3Rpb24uYWN0aW9ucyA9IChhY3Rpb24uYWN0aW9ucyB8fCBbXSlcbiAgICAgICAgLmZpbHRlcigoaW5uZXJBY3Rpb24pID0+ICEoaW5uZXJBY3Rpb24udHlwZSA9PT0gJ3BhdXNlJyAmJiBpbm5lckFjdGlvbi5kdXJhdGlvbiA9PT0gMCkpO1xuICAgICAgcmV0dXJuIG1vZGlmaWVkQWN0aW9uO1xuICAgIH0pO1xuICBsb2cuZGVidWcoYFByZXByb2Nlc3NlZCBhY3Rpb25zOiAke0pTT04uc3RyaW5naWZ5KHByZXByb2Nlc3NlZEFjdGlvbnMsIG51bGwsICcgICcpfWApO1xuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoJy9hY3Rpb25zJywgJ1BPU1QnLCB7YWN0aW9uczogcHJlcHJvY2Vzc2VkQWN0aW9uc30pO1xufTtcblxuY29tbWFuZHMucGVyZm9ybVRvdWNoID0gYXN5bmMgZnVuY3Rpb24gcGVyZm9ybVRvdWNoIChnZXN0dXJlcykge1xuICBsb2cuZGVidWcoYFJlY2VpdmVkIHRoZSBmb2xsb3dpbmcgdG91Y2ggYWN0aW9uOiAke2dlc3R1cmVzQ2hhaW5Ub1N0cmluZyhnZXN0dXJlcyl9YCk7XG4gIHRyeSB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKCcvd2RhL3RvdWNoL3BlcmZvcm0nLCAnUE9TVCcsIHthY3Rpb25zOiBnZXN0dXJlc30pO1xuICB9IGNhdGNoIChlKSB7XG4gICAgaWYgKCF0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgICB0aHJvdyBlO1xuICAgIH1cbiAgICBsb2cuZXJyb3JBbmRUaHJvdygnVGhlIFRvdWNoIEFQSSBpcyBhaW1lZCBmb3IgdXNhZ2UgaW4gTkFUSVZFIGNvbnRleHQuICcgK1xuICAgICAgJ0NvbnNpZGVyIHVzaW5nIFwiZXhlY3V0ZVwiIEFQSSB3aXRoIGN1c3RvbSBldmVudHMgdHJpZ2dlciBzY3JpcHQgJyArXG4gICAgICBgdG8gZW11bGF0ZSB0b3VjaCBldmVudHMgYmVpbmcgaW4gV0VCVklFVyBjb250ZXh0LiBPcmlnaW5hbCBlcnJvcjogJHtlLm1lc3NhZ2V9YCk7XG4gIH1cbn07XG5cbmNvbW1hbmRzLnBlcmZvcm1NdWx0aUFjdGlvbiA9IGFzeW5jIGZ1bmN0aW9uIHBlcmZvcm1NdWx0aUFjdGlvbiAoYWN0aW9ucykge1xuICBsb2cuZGVidWcoYFJlY2VpdmVkIHRoZSBmb2xsb3dpbmcgbXVsdGkgdG91Y2ggYWN0aW9uOmApO1xuICBmb3IgKGxldCBpIGluIGFjdGlvbnMpIHtcbiAgICBsb2cuZGVidWcoYCAgICAke3BhcnNlSW50KGksIDEwKSArIDF9OiAke18ubWFwKGFjdGlvbnNbaV0sICdhY3Rpb24nKS5qb2luKCctJyl9YCk7XG4gIH1cbiAgdHJ5IHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoJy93ZGEvdG91Y2gvbXVsdGkvcGVyZm9ybScsICdQT1NUJywge2FjdGlvbnN9KTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGlmICghdGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgICAgdGhyb3cgZTtcbiAgICB9XG4gICAgbG9nLmVycm9yQW5kVGhyb3coJ1RoZSBNdWx0aVRvdWNoIEFQSSBpcyBhaW1lZCBmb3IgdXNhZ2UgaW4gTkFUSVZFIGNvbnRleHQuICcgK1xuICAgICAgJ0NvbnNpZGVyIHVzaW5nIFwiZXhlY3V0ZVwiIEFQSSB3aXRoIGN1c3RvbSBldmVudHMgdHJpZ2dlciBzY3JpcHQgJyArXG4gICAgICBgdG8gZW11bGF0ZSBtdWx0aXRvdWNoIGV2ZW50cyBiZWluZyBpbiBXRUJWSUVXIGNvbnRleHQuIE9yaWdpbmFsIGVycm9yOiAke2UubWVzc2FnZX1gKTtcbiAgfVxufTtcblxuY29tbWFuZHMubmF0aXZlQ2xpY2sgPSBhc3luYyBmdW5jdGlvbiBuYXRpdmVDbGljayAoZWwpIHtcbiAgZWwgPSB1dGlsLnVud3JhcEVsZW1lbnQoZWwpO1xuICBsZXQgZW5kcG9pbnQgPSBgL2VsZW1lbnQvJHtlbH0vY2xpY2tgO1xuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoZW5kcG9pbnQsICdQT1NUJywge30pO1xufTtcblxuLypcbiAqIFNlZSBodHRwczovL2dpdGh1Yi5jb20vZmFjZWJvb2svV2ViRHJpdmVyQWdlbnQvYmxvYi9tYXN0ZXIvV2ViRHJpdmVyQWdlbnRMaWIvQ29tbWFuZHMvRkJFbGVtZW50Q29tbWFuZHMubVxuICogdG8gZ2V0IHRoZSBpbmZvIGFib3V0IGF2YWlsYWJsZSBXREEgZ2VzdHVyZXMgQVBJXG4gKlxuICogU2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmFwcGxlLmNvbS9yZWZlcmVuY2UveGN0ZXN0L3hjdWllbGVtZW50IGFuZFxuICogaHR0cHM6Ly9kZXZlbG9wZXIuYXBwbGUuY29tL3JlZmVyZW5jZS94Y3Rlc3QveGN1aWNvb3JkaW5hdGUgdG8gZ2V0IHRoZSBkZXRhaWxlZCBkZXNjcmlwdGlvbiBvZlxuICogYWxsIFhDVGVzdCBnZXN0dXJlc1xuKi9cblxuaGVscGVycy5tb2JpbGVTY3JvbGwgPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVTY3JvbGwgKG9wdHMgPSB7fSwgc3dpcGUgPSBmYWxzZSkge1xuICBpZiAoIW9wdHMuZWxlbWVudCkge1xuICAgIG9wdHMuZWxlbWVudCA9IGF3YWl0IHRoaXMuZmluZE5hdGl2ZUVsZW1lbnRPckVsZW1lbnRzKGBjbGFzcyBuYW1lYCwgYFhDVUlFbGVtZW50VHlwZUFwcGxpY2F0aW9uYCwgZmFsc2UpO1xuICB9XG4gIC8vIFdEQSBzdXBwb3J0cyBmb3VyIHNjcm9sbGluZyBzdHJhdGVnaWVzOiBwcmVkaWNhdGlvbiBiYXNlZCBvbiBuYW1lLCBkaXJlY3Rpb24sXG4gIC8vIHByZWRpY2F0ZVN0cmluZywgYW5kIHRvVmlzaWJsZSwgaW4gdGhhdCBvcmRlci4gU3dpcGluZyByZXF1aXJlcyBkaXJlY3Rpb24uXG4gIGxldCBwYXJhbXMgPSB7fTtcbiAgaWYgKG9wdHMubmFtZSAmJiAhc3dpcGUpIHtcbiAgICBwYXJhbXMubmFtZSA9IG9wdHMubmFtZTtcbiAgfSBlbHNlIGlmIChvcHRzLmRpcmVjdGlvbikge1xuICAgIGlmICghWyd1cCcsICdkb3duJywgJ2xlZnQnLCAncmlnaHQnXS5pbmNsdWRlcyhvcHRzLmRpcmVjdGlvbi50b0xvd2VyQ2FzZSgpKSkge1xuICAgICAgbGV0IG1zZyA9ICdEaXJlY3Rpb24gbXVzdCBiZSB1cCwgZG93biwgbGVmdCBvciByaWdodCc7XG4gICAgICBsb2cuZXJyb3JBbmRUaHJvdyhtc2cpO1xuICAgIH1cbiAgICBwYXJhbXMuZGlyZWN0aW9uID0gb3B0cy5kaXJlY3Rpb247XG4gIH0gZWxzZSBpZiAob3B0cy5wcmVkaWNhdGVTdHJpbmcgJiYgIXN3aXBlKSB7XG4gICAgcGFyYW1zLnByZWRpY2F0ZVN0cmluZyA9IG9wdHMucHJlZGljYXRlU3RyaW5nO1xuICB9IGVsc2UgaWYgKG9wdHMudG9WaXNpYmxlICYmICFzd2lwZSkge1xuICAgIHBhcmFtcy50b1Zpc2libGUgPSBvcHRzLnRvVmlzaWJsZTtcbiAgfSBlbHNlIHtcbiAgICBsZXQgbXNnID0gc3dpcGVcbiAgICAgID8gJ01vYmlsZSBzd2lwZSByZXF1aXJlcyBkaXJlY3Rpb24nXG4gICAgICA6ICdNb2JpbGUgc2Nyb2xsIHN1cHBvcnRzIHRoZSBmb2xsb3dpbmcgc3RyYXRlZ2llczogbmFtZSwgZGlyZWN0aW9uLCBwcmVkaWNhdGVTdHJpbmcsIGFuZCB0b1Zpc2libGUuIFNwZWNpZnkgb25lIG9mIHRoZXNlJztcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhtc2cpO1xuICB9XG5cbiAgLy8gd2UgY2FuIGFsc28gb3B0aW9uYWxseSBwYXNzIGEgZGlzdGFuY2Ugd2hpY2ggYXBwZWFycyB0byBiZSBhIHJhdGlvIG9mXG4gIC8vIHNjcmVlbiBoZWlnaHQsIHNvIDEuMCBtZWFucyBhIGZ1bGwgc2NyZWVuJ3Mgd29ydGggb2Ygc2Nyb2xsaW5nXG4gIGlmICghc3dpcGUgJiYgb3B0cy5kaXN0YW5jZSkge1xuICAgIHBhcmFtcy5kaXN0YW5jZSA9IG9wdHMuZGlzdGFuY2U7XG4gIH1cblxuICBsZXQgZWxlbWVudCA9IHV0aWwudW53cmFwRWxlbWVudChvcHRzLmVsZW1lbnQpO1xuICBsZXQgZW5kcG9pbnQgPSBgL3dkYS9lbGVtZW50LyR7ZWxlbWVudH0vJHtzd2lwZSA/ICdzd2lwZScgOiAnc2Nyb2xsJ31gO1xuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoZW5kcG9pbnQsICdQT1NUJywgcGFyYW1zKTtcbn07XG5cbmhlbHBlcnMubW9iaWxlU3dpcGUgPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVTd2lwZSAob3B0cyA9IHt9KSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLm1vYmlsZVNjcm9sbChvcHRzLCB0cnVlKTtcbn07XG5cbmZ1bmN0aW9uIHBhcnNlRmxvYXRQYXJhbWV0ZXIgKHBhcmFtTmFtZSwgcGFyYW1WYWx1ZSwgbWV0aG9kTmFtZSkge1xuICBpZiAoXy5pc1VuZGVmaW5lZChwYXJhbVZhbHVlKSkge1xuICAgIGxvZy5lcnJvckFuZFRocm93KGBcIiR7cGFyYW1OYW1lfVwiIHBhcmFtZXRlciBpcyBtYW5kYXRvcnkgZm9yIFwiJHttZXRob2ROYW1lfVwiIGNhbGxgKTtcbiAgfVxuICBjb25zdCByZXN1bHQgPSBwYXJzZUZsb2F0KHBhcmFtVmFsdWUpO1xuICBpZiAoaXNOYU4ocmVzdWx0KSkge1xuICAgIGxvZy5lcnJvckFuZFRocm93KGBcIiR7cGFyYW1OYW1lfVwiIHBhcmFtZXRlciBzaG91bGQgYmUgYSB2YWxpZCBudW1iZXIuIFwiJHtwYXJhbVZhbHVlfVwiIGlzIGdpdmVuIGluc3RlYWRgKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5oZWxwZXJzLm1vYmlsZVBpbmNoID0gYXN5bmMgZnVuY3Rpb24gbW9iaWxlUGluY2ggKG9wdHMgPSB7fSkge1xuICBpZiAoIW9wdHMuZWxlbWVudCkge1xuICAgIG9wdHMuZWxlbWVudCA9IGF3YWl0IHRoaXMuZmluZE5hdGl2ZUVsZW1lbnRPckVsZW1lbnRzKGBjbGFzcyBuYW1lYCwgYFhDVUlFbGVtZW50VHlwZUFwcGxpY2F0aW9uYCwgZmFsc2UpO1xuICB9XG4gIGNvbnN0IHBhcmFtcyA9IHtcbiAgICBzY2FsZTogcGFyc2VGbG9hdFBhcmFtZXRlcignc2NhbGUnLCBvcHRzLnNjYWxlLCAncGluY2gnKSxcbiAgICB2ZWxvY2l0eTogcGFyc2VGbG9hdFBhcmFtZXRlcigndmVsb2NpdHknLCBvcHRzLnZlbG9jaXR5LCAncGluY2gnKVxuICB9O1xuICBjb25zdCBlbCA9IHV0aWwudW53cmFwRWxlbWVudChvcHRzLmVsZW1lbnQpO1xuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoYC93ZGEvZWxlbWVudC8ke2VsfS9waW5jaGAsICdQT1NUJywgcGFyYW1zKTtcbn07XG5cbmhlbHBlcnMubW9iaWxlRG91YmxlVGFwID0gYXN5bmMgZnVuY3Rpb24gbW9iaWxlRG91YmxlVGFwIChvcHRzID0ge30pIHtcbiAgaWYgKG9wdHMuZWxlbWVudCkge1xuICAgIC8vIERvdWJsZSB0YXAgZWxlbWVudFxuICAgIGNvbnN0IGVsID0gdXRpbC51bndyYXBFbGVtZW50KG9wdHMuZWxlbWVudCk7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGAvd2RhL2VsZW1lbnQvJHtlbH0vZG91YmxlVGFwYCwgJ1BPU1QnKTtcbiAgfVxuICAvLyBEb3VibGUgdGFwIGNvb3JkaW5hdGVzXG4gIGNvbnN0IHBhcmFtcyA9IHtcbiAgICB4OiBwYXJzZUZsb2F0UGFyYW1ldGVyKCd4Jywgb3B0cy54LCAnZG91YmxlVGFwJyksXG4gICAgeTogcGFyc2VGbG9hdFBhcmFtZXRlcigneScsIG9wdHMueSwgJ2RvdWJsZVRhcCcpXG4gIH07XG4gIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZCgnL3dkYS9kb3VibGVUYXAnLCAnUE9TVCcsIHBhcmFtcyk7XG59O1xuXG5oZWxwZXJzLm1vYmlsZVR3b0ZpbmdlclRhcCA9IGFzeW5jIGZ1bmN0aW9uIG1vYmlsZVR3b0ZpbmdlclRhcCAob3B0cyA9IHt9KSB7XG4gIGlmICghb3B0cy5lbGVtZW50KSB7XG4gICAgb3B0cy5lbGVtZW50ID0gYXdhaXQgdGhpcy5maW5kTmF0aXZlRWxlbWVudE9yRWxlbWVudHMoYGNsYXNzIG5hbWVgLCBgWENVSUVsZW1lbnRUeXBlQXBwbGljYXRpb25gLCBmYWxzZSk7XG4gIH1cbiAgY29uc3QgZWwgPSB1dGlsLnVud3JhcEVsZW1lbnQob3B0cy5lbGVtZW50KTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGAvd2RhL2VsZW1lbnQvJHtlbH0vdHdvRmluZ2VyVGFwYCwgJ1BPU1QnKTtcbn07XG5cbmhlbHBlcnMubW9iaWxlVG91Y2hBbmRIb2xkID0gYXN5bmMgZnVuY3Rpb24gbW9iaWxlVG91Y2hBbmRIb2xkIChvcHRzID0ge30pIHtcbiAgbGV0IHBhcmFtcyA9IHtcbiAgICBkdXJhdGlvbjogcGFyc2VGbG9hdFBhcmFtZXRlcignZHVyYXRpb24nLCBvcHRzLmR1cmF0aW9uLCAndG91Y2hBbmRIb2xkJylcbiAgfTtcbiAgaWYgKG9wdHMuZWxlbWVudCkge1xuICAgIC8vIExvbmcgdGFwIGVsZW1lbnRcbiAgICBjb25zdCBlbCA9IHV0aWwudW53cmFwRWxlbWVudChvcHRzLmVsZW1lbnQpO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZChgL3dkYS9lbGVtZW50LyR7ZWx9L3RvdWNoQW5kSG9sZGAsICdQT1NUJywgcGFyYW1zKTtcbiAgfVxuICAvLyBMb25nIHRhcCBjb29yZGluYXRlc1xuICBwYXJhbXMueCA9IHBhcnNlRmxvYXRQYXJhbWV0ZXIoJ3gnLCBvcHRzLngsICd0b3VjaEFuZEhvbGQnKTtcbiAgcGFyYW1zLnkgPSBwYXJzZUZsb2F0UGFyYW1ldGVyKCd5Jywgb3B0cy55LCAndG91Y2hBbmRIb2xkJyk7XG4gIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZCgnL3dkYS90b3VjaEFuZEhvbGQnLCAnUE9TVCcsIHBhcmFtcyk7XG59O1xuXG5oZWxwZXJzLm1vYmlsZVRhcCA9IGFzeW5jIGZ1bmN0aW9uIG1vYmlsZVRhcCAob3B0cyA9IHt9KSB7XG4gIGNvbnN0IHBhcmFtcyA9IHtcbiAgICB4OiBwYXJzZUZsb2F0UGFyYW1ldGVyKCd4Jywgb3B0cy54LCAndGFwJyksXG4gICAgeTogcGFyc2VGbG9hdFBhcmFtZXRlcigneScsIG9wdHMueSwgJ3RhcCcpXG4gIH07XG4gIGNvbnN0IGVsID0gb3B0cy5lbGVtZW50ID8gKHV0aWwudW53cmFwRWxlbWVudChvcHRzLmVsZW1lbnQpKSA6ICcwJztcbiAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGAvd2RhL3RhcC8ke2VsfWAsICdQT1NUJywgcGFyYW1zKTtcbn07XG5cbmhlbHBlcnMubW9iaWxlRHJhZ0Zyb21Ub0ZvckR1cmF0aW9uID0gYXN5bmMgZnVuY3Rpb24gbW9iaWxlRHJhZ0Zyb21Ub0ZvckR1cmF0aW9uIChvcHRzID0ge30pIHtcbiAgY29uc3QgcGFyYW1zID0ge1xuICAgIGR1cmF0aW9uOiBwYXJzZUZsb2F0UGFyYW1ldGVyKCdkdXJhdGlvbicsIG9wdHMuZHVyYXRpb24sICdkcmFnRnJvbVRvRm9yRHVyYXRpb24nKSxcbiAgICBmcm9tWDogcGFyc2VGbG9hdFBhcmFtZXRlcignZnJvbVgnLCBvcHRzLmZyb21YLCAnZHJhZ0Zyb21Ub0ZvckR1cmF0aW9uJyksXG4gICAgZnJvbVk6IHBhcnNlRmxvYXRQYXJhbWV0ZXIoJ2Zyb21ZJywgb3B0cy5mcm9tWSwgJ2RyYWdGcm9tVG9Gb3JEdXJhdGlvbicpLFxuICAgIHRvWDogcGFyc2VGbG9hdFBhcmFtZXRlcigndG9YJywgb3B0cy50b1gsICdkcmFnRnJvbVRvRm9yRHVyYXRpb24nKSxcbiAgICB0b1k6IHBhcnNlRmxvYXRQYXJhbWV0ZXIoJ3RvWScsIG9wdHMudG9ZLCAnZHJhZ0Zyb21Ub0ZvckR1cmF0aW9uJylcbiAgfTtcbiAgaWYgKG9wdHMuZWxlbWVudCkge1xuICAgIC8vIERyYWcgZWxlbWVudFxuICAgIGNvbnN0IGVsID0gdXRpbC51bndyYXBFbGVtZW50KG9wdHMuZWxlbWVudCk7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGAvd2RhL2VsZW1lbnQvJHtlbH0vZHJhZ2Zyb210b2ZvcmR1cmF0aW9uYCwgJ1BPU1QnLCBwYXJhbXMpO1xuICB9XG4gIC8vIERyYWcgY29vcmRpbmF0ZXNcbiAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKCcvd2RhL2RyYWdmcm9tdG9mb3JkdXJhdGlvbicsICdQT1NUJywgcGFyYW1zKTtcbn07XG5cbmhlbHBlcnMubW9iaWxlU2VsZWN0UGlja2VyV2hlZWxWYWx1ZSA9IGFzeW5jIGZ1bmN0aW9uIG1vYmlsZVNlbGVjdFBpY2tlcldoZWVsVmFsdWUgKG9wdHMgPSB7fSkge1xuICBpZiAoIW9wdHMuZWxlbWVudCkge1xuICAgIGxvZy5lcnJvckFuZFRocm93KCdFbGVtZW50IGlkIGlzIGV4cGVjdGVkIHRvIGJlIHNldCBmb3Igc2VsZWN0UGlja2VyV2hlZWxWYWx1ZSBtZXRob2QnKTtcbiAgfVxuICBpZiAoIV8uaXNTdHJpbmcob3B0cy5vcmRlcikgfHwgIVsnbmV4dCcsICdwcmV2aW91cyddLmluY2x1ZGVzKG9wdHMub3JkZXIudG9Mb3dlckNhc2UoKSkpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgVGhlIG1hbmRhdG9yeSAnb3JkZXInIHBhcmFtZXRlciBpcyBleHBlY3RlZCB0byBiZSBlcXVhbCBlaXRoZXIgdG8gJ25leHQnIG9yICdwcmV2aW91cycuIGAgK1xuICAgICAgICAgICAgICAgICAgICAgIGAnJHtvcHRzLm9yZGVyfScgaXMgZ2l2ZW4gaW5zdGVhZGApO1xuICB9XG4gIGNvbnN0IGVsID0gdXRpbC51bndyYXBFbGVtZW50KG9wdHMuZWxlbWVudCk7XG4gIGNvbnN0IHBhcmFtcyA9IHtvcmRlcjogb3B0cy5vcmRlcn07XG4gIGlmIChvcHRzLm9mZnNldCkge1xuICAgIHBhcmFtcy5vZmZzZXQgPSBwYXJzZUZsb2F0UGFyYW1ldGVyKCdvZmZzZXQnLCBvcHRzLm9mZnNldCwgJ3NlbGVjdFBpY2tlcldoZWVsVmFsdWUnKTtcbiAgfVxuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoYC93ZGEvcGlja2Vyd2hlZWwvJHtlbH0vc2VsZWN0YCwgJ1BPU1QnLCBwYXJhbXMpO1xufTtcblxuaGVscGVycy5tb2JpbGVSb3RhdGVFbGVtZW50ID0gYXN5bmMgZnVuY3Rpb24gbW9iaWxlUm90YXRlRWxlbWVudCAob3B0cyA9IHt9KSB7XG4gIGlmICghb3B0cy5lbGVtZW50KSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coJ0VsZW1lbnQgaWQgaXMgZXhwZWN0ZWQgdG8gYmUgc2V0IGZvciByb3RhdGVFbGVtZW50IG1ldGhvZCcpO1xuICB9XG4gIGNvbnN0IGVsID0gdXRpbC51bndyYXBFbGVtZW50KG9wdHMuZWxlbWVudCk7XG4gIGNvbnN0IHBhcmFtcyA9IHtcbiAgICByb3RhdGlvbjogcGFyc2VGbG9hdFBhcmFtZXRlcigncm90YXRpb24nLCBvcHRzLnJvdGF0aW9uLCAncm90YXRlRWxlbWVudCcpLFxuICAgIHZlbG9jaXR5OiBwYXJzZUZsb2F0UGFyYW1ldGVyKCd2ZWxvY2l0eScsIG9wdHMudmVsb2NpdHksICdyb3RhdGVFbGVtZW50JyksXG4gIH07XG4gIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZChgL3dkYS9lbGVtZW50LyR7ZWx9L3JvdGF0ZWAsICdQT1NUJywgcGFyYW1zKTtcbn07XG5cbmhlbHBlcnMuZ2V0Q29vcmRpbmF0ZXMgPSBhc3luYyBmdW5jdGlvbiBnZXRDb29yZGluYXRlcyAoZ2VzdHVyZSkge1xuICBsZXQgZWwgPSBnZXN0dXJlLm9wdGlvbnMuZWxlbWVudDtcblxuICAvLyBkZWZhdWx0c1xuICBsZXQgY29vcmRpbmF0ZXMgPSB7eDogMCwgeTogMCwgYXJlT2Zmc2V0czogZmFsc2V9O1xuXG4gIGxldCBvcHRpb25YID0gbnVsbDtcbiAgaWYgKGdlc3R1cmUub3B0aW9ucy54KSB7XG4gICAgb3B0aW9uWCA9IHBhcnNlRmxvYXRQYXJhbWV0ZXIoJ3gnLCBnZXN0dXJlLm9wdGlvbnMueCwgJ2dldENvb3JkaW5hdGVzJyk7XG4gIH1cbiAgbGV0IG9wdGlvblkgPSBudWxsO1xuICBpZiAoZ2VzdHVyZS5vcHRpb25zLnkpIHtcbiAgICBvcHRpb25ZID0gcGFyc2VGbG9hdFBhcmFtZXRlcigneScsIGdlc3R1cmUub3B0aW9ucy55LCAnZ2V0Q29vcmRpbmF0ZXMnKTtcbiAgfVxuXG4gIC8vIGZpZ3VyZSBvdXQgdGhlIGVsZW1lbnQgY29vcmRpbmF0ZXMuXG4gIGlmIChlbCkge1xuICAgIGxldCByZWN0ID0gYXdhaXQgdGhpcy5nZXRFbGVtZW50UmVjdChlbCk7XG4gICAgbGV0IHBvcyA9IHt4OiByZWN0LngsIHk6IHJlY3QueX07XG4gICAgbGV0IHNpemUgPSB7dzogcmVjdC53aWR0aCwgaDogcmVjdC5oZWlnaHR9O1xuXG4gICAgLy8gZGVmYXVsdHNcbiAgICBsZXQgb2Zmc2V0WCA9IDA7XG4gICAgbGV0IG9mZnNldFkgPSAwO1xuXG4gICAgLy8gZ2V0IHRoZSByZWFsIG9mZnNldHNcbiAgICBpZiAob3B0aW9uWCB8fCBvcHRpb25ZKSB7XG4gICAgICBvZmZzZXRYID0gKG9wdGlvblggfHwgMCk7XG4gICAgICBvZmZzZXRZID0gKG9wdGlvblkgfHwgMCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG9mZnNldFggPSAoc2l6ZS53IC8gMik7XG4gICAgICBvZmZzZXRZID0gKHNpemUuaCAvIDIpO1xuICAgIH1cblxuICAgIC8vIGFwcGx5IHRoZSBvZmZzZXRzXG4gICAgY29vcmRpbmF0ZXMueCA9IHBvcy54ICsgb2Zmc2V0WDtcbiAgICBjb29yZGluYXRlcy55ID0gcG9zLnkgKyBvZmZzZXRZO1xuICB9IGVsc2Uge1xuICAgIC8vIG1vdmVUbyBjb29yZGluYXRlcyBhcmUgcGFzc2VkIGluIGFzIG9mZnNldHNcbiAgICBjb29yZGluYXRlcy5hcmVPZmZzZXRzID0gKGdlc3R1cmUuYWN0aW9uID09PSAnbW92ZVRvJyk7XG4gICAgY29vcmRpbmF0ZXMueCA9IChvcHRpb25YIHx8IDApO1xuICAgIGNvb3JkaW5hdGVzLnkgPSAob3B0aW9uWSB8fCAwKTtcbiAgfVxuICByZXR1cm4gY29vcmRpbmF0ZXM7XG59O1xuXG5oZWxwZXJzLmFwcGx5TW92ZVRvT2Zmc2V0ID0gZnVuY3Rpb24gYXBwbHlNb3ZlVG9PZmZzZXQgKGZpcnN0Q29vcmRpbmF0ZXMsIHNlY29uZENvb3JkaW5hdGVzKSB7XG4gIGlmIChzZWNvbmRDb29yZGluYXRlcy5hcmVPZmZzZXRzKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHg6IGZpcnN0Q29vcmRpbmF0ZXMueCArIHNlY29uZENvb3JkaW5hdGVzLngsXG4gICAgICB5OiBmaXJzdENvb3JkaW5hdGVzLnkgKyBzZWNvbmRDb29yZGluYXRlcy55LFxuICAgIH07XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHNlY29uZENvb3JkaW5hdGVzO1xuICB9XG59O1xuXG5PYmplY3QuYXNzaWduKGV4dGVuc2lvbnMsIGhlbHBlcnMsIGNvbW1hbmRzKTtcbmV4cG9ydCB7IGV4dGVuc2lvbnMsIGhlbHBlcnMsIGNvbW1hbmRzLCBnZXN0dXJlc0NoYWluVG9TdHJpbmcgfTtcbmV4cG9ydCBkZWZhdWx0IGV4dGVuc2lvbnM7XG4iXSwiZmlsZSI6ImxpYi9jb21tYW5kcy9nZXN0dXJlLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
