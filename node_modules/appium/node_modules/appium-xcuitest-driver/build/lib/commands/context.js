"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _appiumIosDriver = require("appium-ios-driver");

var _appiumRemoteDebugger = require("appium-remote-debugger");

var _appiumBaseDriver = require("appium-base-driver");

var _appiumSupport = require("appium-support");

var _logger = _interopRequireDefault(require("../logger"));

var _asyncbox = require("asyncbox");

var _lodash = _interopRequireDefault(require("lodash"));

const WEBVIEW_BASE = `${_appiumIosDriver.WEBVIEW_WIN}_`;
let commands = {},
    helpers = {},
    extensions = {};
Object.assign(extensions, _appiumIosDriver.iosCommands.context);

extensions.closeAlertBeforeTest = async function closeAlertBeforeTest() {
  return true;
};

extensions.navToInitialWebview = async function navToInitialWebview() {
  if (this.useNewSafari()) {
    await this.typeAndNavToUrl();
  } else if (!this.isRealDevice() && this.opts.safari) {
    await this.navToViewThroughFavorites();
  } else {
    await this.navToViewWithTitle(/.*/);
  }
};

extensions.getLatestWebviewContextForTitle = async function getLatestWebviewContextForTitle(regExp) {
  const currentUrl = this.getCurrentUrl();

  const contexts = _lodash.default.filter((await this.getContextsAndViews()), 'view');

  if (currentUrl) {
    for (const ctx of contexts) {
      if ((ctx.view.url || '') === this.getCurrentUrl()) {
        return ctx.id;
      }
    }
  }

  for (const ctx of contexts) {
    if (ctx.view.title && regExp.test(ctx.view.title) || ctx.view.url && regExp.test(ctx.view.url)) {
      return ctx.id;
    }
  }
};

extensions.isWebContext = function isWebContext() {
  return !!this.curContext && this.curContext !== _appiumIosDriver.iosCommands.context.NATIVE_WIN;
};

extensions.isWebview = function isWebview() {
  return this.isWebContext();
};

extensions.getNewRemoteDebugger = async function getNewRemoteDebugger() {
  let socketPath;

  if (!this.isRealDevice()) {
    socketPath = await this.opts.device.getWebInspectorSocket();
  }

  return (0, _appiumRemoteDebugger.createRemoteDebugger)({
    bundleId: this.opts.bundleId,
    additionalBundleIds: this.opts.additionalWebviewBundleIds,
    isSafari: this.isSafari(),
    includeSafari: this.opts.includeSafariInWebviews,
    useNewSafari: this.useNewSafari(),
    pageLoadMs: this.pageLoadMs,
    platformVersion: this.opts.platformVersion,
    socketPath,
    remoteDebugProxy: this.opts.remoteDebugProxy,
    garbageCollectOnExecute: _appiumSupport.util.hasValue(this.opts.safariGarbageCollect) ? !!this.opts.safariGarbageCollect : false,
    udid: this.opts.udid,
    logAllCommunication: this.opts.safariLogAllCommunication,
    logAllCommunicationHexDump: this.opts.safariLogAllCommunicationHexDump,
    socketChunkSize: this.opts.safariSocketChunkSize
  }, this.isRealDevice());
};

commands.setContext = async function setContext(name, callback, skipReadyCheck) {
  function alreadyInContext(desired, current) {
    return desired === current || desired === null && current === _appiumIosDriver.NATIVE_WIN || desired === _appiumIosDriver.NATIVE_WIN && current === null;
  }

  function isNativeContext(context) {
    return context === _appiumIosDriver.NATIVE_WIN || context === null;
  }

  _logger.default.debug(`Attempting to set context to '${name || _appiumIosDriver.NATIVE_WIN}' from '${this.curContext ? this.curContext : _appiumIosDriver.NATIVE_WIN}'`);

  if (alreadyInContext(name, this.curContext) || alreadyInContext(_lodash.default.replace(name, WEBVIEW_BASE, ''), this.curContext)) {
    _logger.default.debug(`Already in '${name || _appiumIosDriver.NATIVE_WIN}' context. Doing nothing.`);

    return;
  }

  if (isNativeContext(name)) {
    this.curContext = null;
    return;
  }

  if (_lodash.default.isUndefined(this.contexts)) {
    await this.getContexts();
  }

  let contextId = _lodash.default.replace(name, WEBVIEW_BASE, '');

  if (contextId === '') {
    contextId = this.contexts[1];
  }

  if (!_lodash.default.includes(this.contexts, contextId)) {
    throw new _appiumBaseDriver.errors.NoSuchContextError();
  }

  const oldContext = this.curContext;
  this.curContext = this.curWindowHandle = contextId;

  const [appIdKey, pageIdKey] = _lodash.default.map(contextId.split('.'), id => parseInt(id, 10));

  try {
    this.selectingNewPage = true;
    await this.remote.selectPage(appIdKey, pageIdKey, skipReadyCheck);
  } catch (err) {
    this.curContext = this.curWindowHandle = oldContext;
    throw err;
  } finally {
    this.selectingNewPage = false;
  }

  if (this.opts.enablePerformanceLogging && this.remote) {
    _logger.default.debug(`Starting performance log on '${this.curContext}'`);

    this.logs.performance = new _appiumIosDriver.IOSPerformanceLog(this.remote);
    await this.logs.performance.startCapture();
  }

  if (name && name !== _appiumIosDriver.NATIVE_WIN && this.logs) {
    if (this.logs.safariConsole) {
      await this.remote.startConsole(this.logs.safariConsole.addLogLine.bind(this.logs.safariConsole));
    }

    if (this.logs.safariNetwork) {
      await this.remote.startNetwork(this.logs.safariNetwork.addLogLine.bind(this.logs.safariNetwork));
    }
  }
};

extensions.connectToRemoteDebugger = async function connectToRemoteDebugger() {
  this.remote = await this.getNewRemoteDebugger();
  await this.remote.connect();
  this.remote.on(_appiumRemoteDebugger.RemoteDebugger.EVENT_PAGE_CHANGE, this.onPageChange.bind(this));
  this.remote.on(_appiumRemoteDebugger.RemoteDebugger.EVENT_FRAMES_DETACHED, () => {
    if (!_lodash.default.isEmpty(this.curWebFrames)) {
      _logger.default.debug(`Clearing ${this.curWebFrames.length} frames: ${this.curWebFrames.join(', ')}`);
    }

    this.curWebFrames = [];
  });
};

extensions.listWebFrames = async function listWebFrames(useUrl = true) {
  if (!this.opts.bundleId) {
    _logger.default.errorAndThrow('Cannot enter web frame without a bundle ID');
  }

  useUrl = useUrl && !this.isRealDevice() && !!this.getCurrentUrl();

  _logger.default.debug(`Selecting by url: ${useUrl} ${useUrl ? `(expected url: '${this.getCurrentUrl()}')` : ''}`);

  const currentUrl = useUrl ? this.getCurrentUrl() : undefined;
  let pageArray = [];

  const getWebviewPages = async () => {
    try {
      return await this.remote.selectApp(currentUrl, this.opts.webviewConnectRetries, this.opts.ignoreAboutBlankUrl);
    } catch (err) {
      _logger.default.debug(`No available web pages: ${err.message}`);

      return [];
    }
  };

  if (this.remote && this.remote.appIdKey) {
    pageArray = await getWebviewPages();
  } else {
    if (!this.remote) {
      await this.connectToRemoteDebugger();
    }

    await this.remote.setConnectionKey();
    pageArray = await getWebviewPages();
    const alertErrorMsg = 'Close alert failed. Retry.';

    try {
      await (0, _asyncbox.retryInterval)(6, 1000, async () => {
        if (!(await this.closeAlertBeforeTest())) {
          throw new Error(alertErrorMsg);
        }
      });
    } catch (err) {
      if (err.message !== alertErrorMsg) {
        _logger.default.errorAndThrow(err);
      }
    }
  }

  if (pageArray.length === 0) {
    _logger.default.debug('No web frames found.');
  }

  return pageArray;
};

extensions.mobileGetContexts = async function mobileGetContexts() {
  const curOpt = this.opts.fullContextList;

  try {
    this.opts.fullContextList = true;
    return await this.getContexts();
  } finally {
    this.opts.fullContextList = curOpt;
  }
};

commands.setWindow = async function setWindow(name, skipReadyCheck) {
  try {
    await this.setContext(name, _lodash.default.noop, skipReadyCheck);
  } catch (err) {
    throw (0, _appiumBaseDriver.isErrorType)(err, _appiumBaseDriver.errors.NoSuchContextError) ? new _appiumBaseDriver.errors.NoSuchWindowError() : err;
  }
};

commands.getWindowHandle = async function getWindowHandle() {
  if (!this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }

  _logger.default.debug(`Getting current window handle`);

  return this.curContext;
};

commands.getWindowHandles = async function getWindowHandles() {
  if (!this.isWebContext()) {
    throw new _appiumBaseDriver.errors.NotImplementedError();
  }

  _logger.default.debug('Getting list of available window handles');

  const contexts = await this.getContextsAndViews(false);
  return contexts.filter(context => context.id !== _appiumIosDriver.NATIVE_WIN).map(context => context.view.id.toString());
};

extensions.onPageChange = async function onPageChange(pageChangeNotification) {
  _logger.default.debug(`Remote debugger notified us of a new page listing: ${JSON.stringify(pageChangeNotification)}`);

  if (this.selectingNewPage) {
    _logger.default.debug('We are in the middle of selecting a page, ignoring');

    return;
  }

  if (!this.remote || !this.remote.isConnected()) {
    _logger.default.debug('We have not yet connected, ignoring');

    return;
  }

  const {
    appIdKey,
    pageArray
  } = pageChangeNotification;
  let newIds = [];
  let newPages = [];
  let keyId = null;

  for (const page of pageArray) {
    const id = page.id.toString();
    newIds.push(id);

    if (page.isKey) {
      keyId = id;
    }

    const contextId = `${appIdKey}.${id}`;

    if (!_lodash.default.includes(this.contexts, contextId)) {
      newPages.push(id);
      this.contexts.push(contextId);
    }
  }

  if (!keyId) {
    _logger.default.debug('No key id found. Choosing first id from page array');

    keyId = newIds[0] || null;
  }

  if (!_appiumSupport.util.hasValue(this.curContext)) {
    _logger.default.debug('We do not appear to have window set yet, ignoring');

    return;
  }

  const [curAppIdKey, curPageIdKey] = this.curContext.split('.');

  if (curAppIdKey !== appIdKey) {
    _logger.default.debug('Page change not referring to currently selected app, ignoring.');

    return;
  }

  let newPage = null;

  if (newPages.length) {
    newPage = _lodash.default.last(newPages);

    _logger.default.debug(`We have new pages, selecting page '${newPage}'`);
  } else if (!_lodash.default.includes(newIds, curPageIdKey)) {
    _logger.default.debug('New page listing from remote debugger does not contain ' + 'current window; assuming it is closed');

    if (!_appiumSupport.util.hasValue(keyId)) {
      _logger.default.error('Do not have our current window anymore, and there ' + 'are not any more to load! Doing nothing...');

      this.setCurrentUrl(undefined);
      return;
    }

    _logger.default.debug(`Debugger already selected page '${keyId}', ` + `confirming that choice.`);

    this.curContext = `${appIdKey}.${keyId}`;
    newPage = keyId;
  } else {
    _logger.default.debug('Checking if page needs to load');

    const needsPageLoad = (() => {
      const contextArray = _lodash.default.map(pageArray, page => `${appIdKey}.${page.id}`);

      return !_lodash.default.isEqual(_lodash.default.find(this.contexts, this.curContext), _lodash.default.find(contextArray, this.curContext));
    })();

    if (needsPageLoad) {
      _logger.default.debug('Page load needed. Loading...');

      await this.remote.pageLoad();
    }

    _logger.default.debug('New page listing is same as old, doing nothing');
  }

  if (_appiumSupport.util.hasValue(this.curContext)) {
    let currentPageId = parseInt(_lodash.default.last(this.curContext.split('.')), 10);

    let page = _lodash.default.find(pageArray, p => parseInt(p.id, 10) === currentPageId);

    if (page && page.url !== this.getCurrentUrl()) {
      _logger.default.debug(`Redirected from '${this.getCurrentUrl()}' to '${page.url}'`);

      this.setCurrentUrl(page.url);
    }
  }

  if (_appiumSupport.util.hasValue(newPage)) {
    this.selectingNewPage = true;
    const oldContext = this.curContext;
    this.curContext = `${appIdKey}.${newPage}`;
    this.remote.selectPage(appIdKey, parseInt(newPage, 10)).catch(err => {
      _logger.default.warn(`Failed to select page: ${err.message}`);

      this.curContext = oldContext;
    });
    this.selectingNewPage = false;
  }

  this.windowHandleCache = pageArray;
};

Object.assign(extensions, commands, helpers);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9jb250ZXh0LmpzIl0sIm5hbWVzIjpbIldFQlZJRVdfQkFTRSIsIldFQlZJRVdfV0lOIiwiY29tbWFuZHMiLCJoZWxwZXJzIiwiZXh0ZW5zaW9ucyIsIk9iamVjdCIsImFzc2lnbiIsImlvc0NvbW1hbmRzIiwiY29udGV4dCIsImNsb3NlQWxlcnRCZWZvcmVUZXN0IiwibmF2VG9Jbml0aWFsV2VidmlldyIsInVzZU5ld1NhZmFyaSIsInR5cGVBbmROYXZUb1VybCIsImlzUmVhbERldmljZSIsIm9wdHMiLCJzYWZhcmkiLCJuYXZUb1ZpZXdUaHJvdWdoRmF2b3JpdGVzIiwibmF2VG9WaWV3V2l0aFRpdGxlIiwiZ2V0TGF0ZXN0V2Vidmlld0NvbnRleHRGb3JUaXRsZSIsInJlZ0V4cCIsImN1cnJlbnRVcmwiLCJnZXRDdXJyZW50VXJsIiwiY29udGV4dHMiLCJfIiwiZmlsdGVyIiwiZ2V0Q29udGV4dHNBbmRWaWV3cyIsImN0eCIsInZpZXciLCJ1cmwiLCJpZCIsInRpdGxlIiwidGVzdCIsImlzV2ViQ29udGV4dCIsImN1ckNvbnRleHQiLCJOQVRJVkVfV0lOIiwiaXNXZWJ2aWV3IiwiZ2V0TmV3UmVtb3RlRGVidWdnZXIiLCJzb2NrZXRQYXRoIiwiZGV2aWNlIiwiZ2V0V2ViSW5zcGVjdG9yU29ja2V0IiwiYnVuZGxlSWQiLCJhZGRpdGlvbmFsQnVuZGxlSWRzIiwiYWRkaXRpb25hbFdlYnZpZXdCdW5kbGVJZHMiLCJpc1NhZmFyaSIsImluY2x1ZGVTYWZhcmkiLCJpbmNsdWRlU2FmYXJpSW5XZWJ2aWV3cyIsInBhZ2VMb2FkTXMiLCJwbGF0Zm9ybVZlcnNpb24iLCJyZW1vdGVEZWJ1Z1Byb3h5IiwiZ2FyYmFnZUNvbGxlY3RPbkV4ZWN1dGUiLCJ1dGlsIiwiaGFzVmFsdWUiLCJzYWZhcmlHYXJiYWdlQ29sbGVjdCIsInVkaWQiLCJsb2dBbGxDb21tdW5pY2F0aW9uIiwic2FmYXJpTG9nQWxsQ29tbXVuaWNhdGlvbiIsImxvZ0FsbENvbW11bmljYXRpb25IZXhEdW1wIiwic2FmYXJpTG9nQWxsQ29tbXVuaWNhdGlvbkhleER1bXAiLCJzb2NrZXRDaHVua1NpemUiLCJzYWZhcmlTb2NrZXRDaHVua1NpemUiLCJzZXRDb250ZXh0IiwibmFtZSIsImNhbGxiYWNrIiwic2tpcFJlYWR5Q2hlY2siLCJhbHJlYWR5SW5Db250ZXh0IiwiZGVzaXJlZCIsImN1cnJlbnQiLCJpc05hdGl2ZUNvbnRleHQiLCJsb2ciLCJkZWJ1ZyIsInJlcGxhY2UiLCJpc1VuZGVmaW5lZCIsImdldENvbnRleHRzIiwiY29udGV4dElkIiwiaW5jbHVkZXMiLCJlcnJvcnMiLCJOb1N1Y2hDb250ZXh0RXJyb3IiLCJvbGRDb250ZXh0IiwiY3VyV2luZG93SGFuZGxlIiwiYXBwSWRLZXkiLCJwYWdlSWRLZXkiLCJtYXAiLCJzcGxpdCIsInBhcnNlSW50Iiwic2VsZWN0aW5nTmV3UGFnZSIsInJlbW90ZSIsInNlbGVjdFBhZ2UiLCJlcnIiLCJlbmFibGVQZXJmb3JtYW5jZUxvZ2dpbmciLCJsb2dzIiwicGVyZm9ybWFuY2UiLCJJT1NQZXJmb3JtYW5jZUxvZyIsInN0YXJ0Q2FwdHVyZSIsInNhZmFyaUNvbnNvbGUiLCJzdGFydENvbnNvbGUiLCJhZGRMb2dMaW5lIiwiYmluZCIsInNhZmFyaU5ldHdvcmsiLCJzdGFydE5ldHdvcmsiLCJjb25uZWN0VG9SZW1vdGVEZWJ1Z2dlciIsImNvbm5lY3QiLCJvbiIsIlJlbW90ZURlYnVnZ2VyIiwiRVZFTlRfUEFHRV9DSEFOR0UiLCJvblBhZ2VDaGFuZ2UiLCJFVkVOVF9GUkFNRVNfREVUQUNIRUQiLCJpc0VtcHR5IiwiY3VyV2ViRnJhbWVzIiwibGVuZ3RoIiwiam9pbiIsImxpc3RXZWJGcmFtZXMiLCJ1c2VVcmwiLCJlcnJvckFuZFRocm93IiwidW5kZWZpbmVkIiwicGFnZUFycmF5IiwiZ2V0V2Vidmlld1BhZ2VzIiwic2VsZWN0QXBwIiwid2Vidmlld0Nvbm5lY3RSZXRyaWVzIiwiaWdub3JlQWJvdXRCbGFua1VybCIsIm1lc3NhZ2UiLCJzZXRDb25uZWN0aW9uS2V5IiwiYWxlcnRFcnJvck1zZyIsIkVycm9yIiwibW9iaWxlR2V0Q29udGV4dHMiLCJjdXJPcHQiLCJmdWxsQ29udGV4dExpc3QiLCJzZXRXaW5kb3ciLCJub29wIiwiTm9TdWNoV2luZG93RXJyb3IiLCJnZXRXaW5kb3dIYW5kbGUiLCJOb3RJbXBsZW1lbnRlZEVycm9yIiwiZ2V0V2luZG93SGFuZGxlcyIsInRvU3RyaW5nIiwicGFnZUNoYW5nZU5vdGlmaWNhdGlvbiIsIkpTT04iLCJzdHJpbmdpZnkiLCJpc0Nvbm5lY3RlZCIsIm5ld0lkcyIsIm5ld1BhZ2VzIiwia2V5SWQiLCJwYWdlIiwicHVzaCIsImlzS2V5IiwiY3VyQXBwSWRLZXkiLCJjdXJQYWdlSWRLZXkiLCJuZXdQYWdlIiwibGFzdCIsImVycm9yIiwic2V0Q3VycmVudFVybCIsIm5lZWRzUGFnZUxvYWQiLCJjb250ZXh0QXJyYXkiLCJpc0VxdWFsIiwiZmluZCIsInBhZ2VMb2FkIiwiY3VycmVudFBhZ2VJZCIsInAiLCJjYXRjaCIsIndhcm4iLCJ3aW5kb3dIYW5kbGVDYWNoZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFHQSxNQUFNQSxZQUFZLEdBQUksR0FBRUMsNEJBQVksR0FBcEM7QUFFQSxJQUFJQyxRQUFRLEdBQUcsRUFBZjtBQUFBLElBQW1CQyxPQUFPLEdBQUcsRUFBN0I7QUFBQSxJQUFpQ0MsVUFBVSxHQUFHLEVBQTlDO0FBRUFDLE1BQU0sQ0FBQ0MsTUFBUCxDQUFjRixVQUFkLEVBQTBCRyw2QkFBWUMsT0FBdEM7O0FBR0FKLFVBQVUsQ0FBQ0ssb0JBQVgsR0FBa0MsZUFBZUEsb0JBQWYsR0FBdUM7QUFDdkUsU0FBTyxJQUFQO0FBQ0QsQ0FGRDs7QUFNQUwsVUFBVSxDQUFDTSxtQkFBWCxHQUFpQyxlQUFlQSxtQkFBZixHQUFzQztBQUNyRSxNQUFJLEtBQUtDLFlBQUwsRUFBSixFQUF5QjtBQUN2QixV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IFdFQlZJRVdfV0lOIH0gZnJvbSAnYXBwaXVtLWlvcy1kcml2ZXInO1xuaW1wb3J0IHsgY3JlYXRlUmVtb3RlRGVidWdnZXIsIFJlbW90ZURlYnVnZ2VyIH0gZnJvbSAnYXBwaXVtLXJlbW90ZS1kZWJ1Z2dlcic7XG5pbXBvcnQgeyBlcnJvcnMsIGlzRXJyb3JUeXBlIH0gZnJvbSAnYXBwaXVtLWJhc2UtZHJpdmVyJztcbmltcG9ydCB7IHV0aWwgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgbG9nIGZyb20gJy4uL2xvZ2dlcic7XG5pbXBvcnQgeyByZXRyeUludGVydmFsIH0gZnJvbSAnYXN5bmNib3gnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcblxuXG5jb25zdCBXRUJWSUVXX0JBU0UgPSBgJHtXRUJWSUVXX1dJTn1fYDtcblxubGV0IGNvbW1hbmRzID0ge30sIGhlbHBlcnMgPSB7fSwgZXh0ZW5zaW9ucyA9IHt9O1xuXG5PYmplY3QuYXNzaWduKGV4dGVuc2lvbnMsIGlvc0NvbW1hbmRzLmNvbnRleHQpO1xuXG4vLyBvdmVycmlkZSwgYXMgYXBwaXVtLWlvcy1kcml2ZXIncyB2ZXJzaW9uIHVzZXMgVUkgQXV0b21hdGlvbiB0byBjbG9zZVxuZXh0ZW5zaW9ucy5jbG9zZUFsZXJ0QmVmb3JlVGVzdCA9IGFzeW5jIGZ1bmN0aW9uIGNsb3NlQWxlcnRCZWZvcmVUZXN0ICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gIHJldHVybiB0cnVlO1xufTtcblxuLy8gdGhlIGFwcGl1bS1pb3MtZHJpdmVyIHZlcnNpb24gaGFzIGEgd2FpdCBvbiByZWFsIGRldmljZXMsIHdoaWNoIGlzIG5vIGxvbmdlclxuLy8gbmVjZXNzYXJ5XG5leHRlbnNpb25zLm5hdlRvSW5pdGlhbFdlYnZpZXcgPSBhc3luYyBmdW5jdGlvbiBuYXZUb0luaXRpYWxXZWJ2aWV3ICgpIHtcbiAgaWYgKHRoaXMudXNlTmV3U2FmYXJpKCkpIHtcbiAgICBhd2FpdCB0aGlzLnR5cGVBbmROYXZUb1VybCgpO1xuICB9IGVsc2UgaWYgKCF0aGlzLmlzUmVhbERldmljZSgpICYmIHRoaXMub3B0cy5zYWZhcmkpIHtcbiAgICBhd2FpdCB0aGlzLm5hdlRvVmlld1Rocm91Z2hGYXZvcml0ZXMoKTtcbiAgfSBlbHNlIHtcbiAgICBhd2FpdCB0aGlzLm5hdlRvVmlld1dpdGhUaXRsZSgvLiovKTtcbiAgfVxufTtcblxuLy8gdGhlIGFwcGl1bS1pb3MtZHJpdmVyIHZlcnNpb24gb2YgdGhpcyBmdW5jdGlvbiBmYWlscyBpbiBDSSxcbi8vIGFuZCB0aGUgd3Jvbmcgd2VidmlldyBpcyBhbG1vc3QgYWx3YXlzIHJldHJpZXZlZFxuLy8gYWxzbyBvdmVycmlkZSBzbyB0aGF0IHRoZSBjYXNlIHdoZXJlIHRoZSBTREsgdmVyc2lvbiBpcyBub3Qgc2V0IGRvZXMgbm90IGZhaWxcbmV4dGVuc2lvbnMuZ2V0TGF0ZXN0V2Vidmlld0NvbnRleHRGb3JUaXRsZSA9IGFzeW5jIGZ1bmN0aW9uIGdldExhdGVzdFdlYnZpZXdDb250ZXh0Rm9yVGl0bGUgKHJlZ0V4cCkge1xuICBjb25zdCBjdXJyZW50VXJsID0gdGhpcy5nZXRDdXJyZW50VXJsKCk7XG5cbiAgY29uc3QgY29udGV4dHMgPSBfLmZpbHRlcihhd2FpdCB0aGlzLmdldENvbnRleHRzQW5kVmlld3MoKSwgJ3ZpZXcnKTtcblxuICBpZiAoY3VycmVudFVybCkge1xuICAgIC8vIGZpcnN0IHRyeSB0byBtYXRjaCBieSBjdXJyZW50IHVybFxuICAgIGZvciAoY29uc3QgY3R4IG9mIGNvbnRleHRzKSB7XG4gICAgICBpZiAoKGN0eC52aWV3LnVybCB8fCAnJykgPT09IHRoaXMuZ2V0Q3VycmVudFVybCgpKSB7XG4gICAgICAgIHJldHVybiBjdHguaWQ7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gaWYgbm90LCB0cnkgdG8gbWF0Y2ggYnkgcmVndWxhciBleHByZXNzaW9uXG4gIGZvciAoY29uc3QgY3R4IG9mIGNvbnRleHRzKSB7XG4gICAgaWYgKChjdHgudmlldy50aXRsZSAmJiByZWdFeHAudGVzdChjdHgudmlldy50aXRsZSkpIHx8IChjdHgudmlldy51cmwgJiYgcmVnRXhwLnRlc3QoY3R4LnZpZXcudXJsKSkpIHtcbiAgICAgIHJldHVybiBjdHguaWQ7XG4gICAgfVxuICB9XG59O1xuXG5leHRlbnNpb25zLmlzV2ViQ29udGV4dCA9IGZ1bmN0aW9uIGlzV2ViQ29udGV4dCAoKSB7XG4gIHJldHVybiAhIXRoaXMuY3VyQ29udGV4dCAmJiB0aGlzLmN1ckNvbnRleHQgIT09IGlvc0NvbW1hbmRzLmNvbnRleHQuTkFUSVZFX1dJTjtcbn07XG5cbmV4dGVuc2lvbnMuaXNXZWJ2aWV3ID0gZnVuY3Rpb24gaXNXZWJ2aWV3ICgpIHtcbiAgcmV0dXJuIHRoaXMuaXNXZWJDb250ZXh0KCk7XG59O1xuXG5leHRlbnNpb25zLmdldE5ld1JlbW90ZURlYnVnZ2VyID0gYXN5bmMgZnVuY3Rpb24gZ2V0TmV3UmVtb3RlRGVidWdnZXIgKCkge1xuICBsZXQgc29ja2V0UGF0aDtcbiAgaWYgKCF0aGlzLmlzUmVhbERldmljZSgpKSB7XG4gICAgc29ja2V0UGF0aCA9IGF3YWl0IHRoaXMub3B0cy5kZXZpY2UuZ2V0V2ViSW5zcGVjdG9yU29ja2V0KCk7XG4gIH1cbiAgcmV0dXJuIGNyZWF0ZVJlbW90ZURlYnVnZ2VyKHtcbiAgICBidW5kbGVJZDogdGhpcy5vcHRzLmJ1bmRsZUlkLFxuICAgIGFkZGl0aW9uYWxCdW5kbGVJZHM6IHRoaXMub3B0cy5hZGRpdGlvbmFsV2Vidmlld0J1bmRsZUlkcyxcbiAgICBpc1NhZmFyaTogdGhpcy5pc1NhZmFyaSgpLFxuICAgIGluY2x1ZGVTYWZhcmk6IHRoaXMub3B0cy5pbmNsdWRlU2FmYXJpSW5XZWJ2aWV3cyxcbiAgICB1c2VOZXdTYWZhcmk6IHRoaXMudXNlTmV3U2FmYXJpKCksXG4gICAgcGFnZUxvYWRNczogdGhpcy5wYWdlTG9hZE1zLFxuICAgIHBsYXRmb3JtVmVyc2lvbjogdGhpcy5vcHRzLnBsYXRmb3JtVmVyc2lvbixcbiAgICBzb2NrZXRQYXRoLFxuICAgIHJlbW90ZURlYnVnUHJveHk6IHRoaXMub3B0cy5yZW1vdGVEZWJ1Z1Byb3h5LFxuICAgIGdhcmJhZ2VDb2xsZWN0T25FeGVjdXRlOiB1dGlsLmhhc1ZhbHVlKHRoaXMub3B0cy5zYWZhcmlHYXJiYWdlQ29sbGVjdClcbiAgICAgID8gISF0aGlzLm9wdHMuc2FmYXJpR2FyYmFnZUNvbGxlY3RcbiAgICAgIDogZmFsc2UsXG4gICAgdWRpZDogdGhpcy5vcHRzLnVkaWQsXG4gICAgbG9nQWxsQ29tbXVuaWNhdGlvbjogdGhpcy5vcHRzLnNhZmFyaUxvZ0FsbENvbW11bmljYXRpb24sXG4gICAgbG9nQWxsQ29tbXVuaWNhdGlvbkhleER1bXA6IHRoaXMub3B0cy5zYWZhcmlMb2dBbGxDb21tdW5pY2F0aW9uSGV4RHVtcCxcbiAgICBzb2NrZXRDaHVua1NpemU6IHRoaXMub3B0cy5zYWZhcmlTb2NrZXRDaHVua1NpemUsXG4gIH0sIHRoaXMuaXNSZWFsRGV2aWNlKCkpO1xufTtcblxuLyoqXG4gKiBTZXQgY29udGV4dFxuICpcbiAqIEBwYXJhbSB7P3N0cmluZ30gbmFtZSAtIFRoZSBuYW1lIG9mIGNvbnRleHQgdG8gc2V0LiBJdCBjb3VsZCBiZSAnbnVsbCcgYXMgTkFUSVZFX1dJTi5cbiAqIEBwYXJhbSB7Y2FsbGJhY2t9IGNhbGxiYWNrIFRoZSBjYWxsYmFjay4gKEl0IGlzIG5vdCBjYWxsZWQgaW4gdGhpcyBtZXRob2QpXG4gKiBAcGFyYW0ge2Jvb2xlYW59IHNraXBSZWFkeUNoZWNrIC0gV2hldGhlciBpdCB3YWl0cyBmb3IgdGhlIG5ldyBjb250ZXh0IGlzIHJlYWR5XG4gKi9cbmNvbW1hbmRzLnNldENvbnRleHQgPSBhc3luYyBmdW5jdGlvbiBzZXRDb250ZXh0IChuYW1lLCBjYWxsYmFjaywgc2tpcFJlYWR5Q2hlY2spIHtcbiAgZnVuY3Rpb24gYWxyZWFkeUluQ29udGV4dCAoZGVzaXJlZCwgY3VycmVudCkge1xuICAgIHJldHVybiAoZGVzaXJlZCA9PT0gY3VycmVudCB8fFxuICAgICAgICAgICAoZGVzaXJlZCA9PT0gbnVsbCAmJiBjdXJyZW50ID09PSBOQVRJVkVfV0lOKSB8fFxuICAgICAgICAgICAoZGVzaXJlZCA9PT0gTkFUSVZFX1dJTiAmJiBjdXJyZW50ID09PSBudWxsKSk7XG4gIH1cbiAgZnVuY3Rpb24gaXNOYXRpdmVDb250ZXh0IChjb250ZXh0KSB7XG4gICAgcmV0dXJuIGNvbnRleHQgPT09IE5BVElWRV9XSU4gfHwgY29udGV4dCA9PT0gbnVsbDtcbiAgfVxuXG4gIGxvZy5kZWJ1ZyhgQXR0ZW1wdGluZyB0byBzZXQgY29udGV4dCB0byAnJHtuYW1lIHx8IE5BVElWRV9XSU59JyBmcm9tICcke3RoaXMuY3VyQ29udGV4dCA/IHRoaXMuY3VyQ29udGV4dCA6IE5BVElWRV9XSU59J2ApO1xuXG4gIGlmIChhbHJlYWR5SW5Db250ZXh0KG5hbWUsIHRoaXMuY3VyQ29udGV4dCkgfHwgYWxyZWFkeUluQ29udGV4dChfLnJlcGxhY2UobmFtZSwgV0VCVklFV19CQVNFLCAnJyksIHRoaXMuY3VyQ29udGV4dCkpIHtcbiAgICAvLyBhbHJlYWR5IGluIHRoZSBuYW1lZCBjb250ZXh0LCBubyBuZWVkIHRvIGRvIGFueXRoaW5nXG4gICAgbG9nLmRlYnVnKGBBbHJlYWR5IGluICcke25hbWUgfHwgTkFUSVZFX1dJTn0nIGNvbnRleHQuIERvaW5nIG5vdGhpbmcuYCk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGlmIChpc05hdGl2ZUNvbnRleHQobmFtZSkpIHtcbiAgICAvLyBzd2l0Y2hpbmcgaW50byB0aGUgbmF0aXZlIGNvbnRleHRcbiAgICB0aGlzLmN1ckNvbnRleHQgPSBudWxsO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIHN3aXRjaGluZyBpbnRvIGEgd2VidmlldyBjb250ZXh0XG5cbiAgLy8gaWYgY29udGV4dHMgaGF2ZSBub3QgYWxyZWFkeSBiZWVuIHJldHJpZXZlZCwgZ2V0IHRoZW1cbiAgaWYgKF8uaXNVbmRlZmluZWQodGhpcy5jb250ZXh0cykpIHtcbiAgICBhd2FpdCB0aGlzLmdldENvbnRleHRzKCk7XG4gIH1cblxuICBsZXQgY29udGV4dElkID0gXy5yZXBsYWNlKG5hbWUsIFdFQlZJRVdfQkFTRSwgJycpO1xuICBpZiAoY29udGV4dElkID09PSAnJykge1xuICAgIC8vIGFsbG93IHVzZXIgdG8gcGFzcyBpbiBcIldFQlZJRVdcIiB3aXRob3V0IGFuIGluZGV4XG4gICAgLy8gdGhlIHNlY29uZCBjb250ZXh0IHdpbGwgYmUgdGhlIGZpcnN0IHdlYnZpZXcgYXNcbiAgICAvLyB0aGUgZmlyc3QgaXMgYWx3YXlzIE5BVElWRV9BUFBcbiAgICBjb250ZXh0SWQgPSB0aGlzLmNvbnRleHRzWzFdO1xuICB9XG4gIGlmICghXy5pbmNsdWRlcyh0aGlzLmNvbnRleHRzLCBjb250ZXh0SWQpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob1N1Y2hDb250ZXh0RXJyb3IoKTtcbiAgfVxuXG4gIGNvbnN0IG9sZENvbnRleHQgPSB0aGlzLmN1ckNvbnRleHQ7XG4gIHRoaXMuY3VyQ29udGV4dCA9IHRoaXMuY3VyV2luZG93SGFuZGxlID0gY29udGV4dElkO1xuXG4gIC8vIGBjb250ZXh0SWRgIHdpbGwgYmUgaW4gdGhlIGZvcm0gb2YgYGFwcElkLnBhZ2VJZGAgaW4gdGhpcyBjYXNlXG4gIGNvbnN0IFthcHBJZEtleSwgcGFnZUlkS2V5XSA9IF8ubWFwKGNvbnRleHRJZC5zcGxpdCgnLicpLCAoaWQpID0+IHBhcnNlSW50KGlkLCAxMCkpO1xuICB0cnkge1xuICAgIHRoaXMuc2VsZWN0aW5nTmV3UGFnZSA9IHRydWU7XG4gICAgYXdhaXQgdGhpcy5yZW1vdGUuc2VsZWN0UGFnZShhcHBJZEtleSwgcGFnZUlkS2V5LCBza2lwUmVhZHlDaGVjayk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIHRoaXMuY3VyQ29udGV4dCA9IHRoaXMuY3VyV2luZG93SGFuZGxlID0gb2xkQ29udGV4dDtcbiAgICB0aHJvdyBlcnI7XG4gIH0gZmluYWxseSB7XG4gICAgdGhpcy5zZWxlY3RpbmdOZXdQYWdlID0gZmFsc2U7XG4gIH1cblxuICAvLyBhdHRlbXB0IHRvIHN0YXJ0IHBlcmZvcm1hbmNlIGxvZ2dpbmcsIGlmIHJlcXVlc3RlZFxuICBpZiAodGhpcy5vcHRzLmVuYWJsZVBlcmZvcm1hbmNlTG9nZ2luZyAmJiB0aGlzLnJlbW90ZSkge1xuICAgIGxvZy5kZWJ1ZyhgU3RhcnRpbmcgcGVyZm9ybWFuY2UgbG9nIG9uICcke3RoaXMuY3VyQ29udGV4dH0nYCk7XG4gICAgdGhpcy5sb2dzLnBlcmZvcm1hbmNlID0gbmV3IElPU1BlcmZvcm1hbmNlTG9nKHRoaXMucmVtb3RlKTtcbiAgICBhd2FpdCB0aGlzLmxvZ3MucGVyZm9ybWFuY2Uuc3RhcnRDYXB0dXJlKCk7XG4gIH1cblxuICAvLyBzdGFydCBzYWZhcmkgbG9nZ2luZyBpZiB0aGUgbG9ncyBoYW5kbGVycyBhcmUgYWN0aXZlXG4gIGlmIChuYW1lICYmIG5hbWUgIT09IE5BVElWRV9XSU4gJiYgdGhpcy5sb2dzKSB7XG4gICAgaWYgKHRoaXMubG9ncy5zYWZhcmlDb25zb2xlKSB7XG4gICAgICBhd2FpdCB0aGlzLnJlbW90ZS5zdGFydENvbnNvbGUodGhpcy5sb2dzLnNhZmFyaUNvbnNvbGUuYWRkTG9nTGluZS5iaW5kKHRoaXMubG9ncy5zYWZhcmlDb25zb2xlKSk7XG4gICAgfVxuICAgIGlmICh0aGlzLmxvZ3Muc2FmYXJpTmV0d29yaykge1xuICAgICAgYXdhaXQgdGhpcy5yZW1vdGUuc3RhcnROZXR3b3JrKHRoaXMubG9ncy5zYWZhcmlOZXR3b3JrLmFkZExvZ0xpbmUuYmluZCh0aGlzLmxvZ3Muc2FmYXJpTmV0d29yaykpO1xuICAgIH1cbiAgfVxufTtcblxuZXh0ZW5zaW9ucy5jb25uZWN0VG9SZW1vdGVEZWJ1Z2dlciA9IGFzeW5jIGZ1bmN0aW9uIGNvbm5lY3RUb1JlbW90ZURlYnVnZ2VyICgpIHtcbiAgdGhpcy5yZW1vdGUgPSBhd2FpdCB0aGlzLmdldE5ld1JlbW90ZURlYnVnZ2VyKCk7XG4gIGF3YWl0IHRoaXMucmVtb3RlLmNvbm5lY3QoKTtcblxuICB0aGlzLnJlbW90ZS5vbihSZW1vdGVEZWJ1Z2dlci5FVkVOVF9QQUdFX0NIQU5HRSwgdGhpcy5vblBhZ2VDaGFuZ2UuYmluZCh0aGlzKSk7XG4gIHRoaXMucmVtb3RlLm9uKFJlbW90ZURlYnVnZ2VyLkVWRU5UX0ZSQU1FU19ERVRBQ0hFRCwgKCkgPT4ge1xuICAgIGlmICghXy5pc0VtcHR5KHRoaXMuY3VyV2ViRnJhbWVzKSkge1xuICAgICAgbG9nLmRlYnVnKGBDbGVhcmluZyAke3RoaXMuY3VyV2ViRnJhbWVzLmxlbmd0aH0gZnJhbWVzOiAke3RoaXMuY3VyV2ViRnJhbWVzLmpvaW4oJywgJyl9YCk7XG4gICAgfVxuICAgIHRoaXMuY3VyV2ViRnJhbWVzID0gW107XG4gIH0pO1xufTtcblxuZXh0ZW5zaW9ucy5saXN0V2ViRnJhbWVzID0gYXN5bmMgZnVuY3Rpb24gbGlzdFdlYkZyYW1lcyAodXNlVXJsID0gdHJ1ZSkge1xuICBpZiAoIXRoaXMub3B0cy5idW5kbGVJZCkge1xuICAgIGxvZy5lcnJvckFuZFRocm93KCdDYW5ub3QgZW50ZXIgd2ViIGZyYW1lIHdpdGhvdXQgYSBidW5kbGUgSUQnKTtcbiAgfVxuXG4gIHVzZVVybCA9IHVzZVVybCAmJiAhdGhpcy5pc1JlYWxEZXZpY2UoKSAmJiAhIXRoaXMuZ2V0Q3VycmVudFVybCgpO1xuICBsb2cuZGVidWcoYFNlbGVjdGluZyBieSB1cmw6ICR7dXNlVXJsfSAke3VzZVVybCA/IGAoZXhwZWN0ZWQgdXJsOiAnJHt0aGlzLmdldEN1cnJlbnRVcmwoKX0nKWAgOiAnJ31gKTtcblxuICBjb25zdCBjdXJyZW50VXJsID0gdXNlVXJsID8gdGhpcy5nZXRDdXJyZW50VXJsKCkgOiB1bmRlZmluZWQ7XG4gIGxldCBwYWdlQXJyYXkgPSBbXTtcbiAgY29uc3QgZ2V0V2Vidmlld1BhZ2VzID0gYXN5bmMgKCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5yZW1vdGUuc2VsZWN0QXBwKGN1cnJlbnRVcmwsIHRoaXMub3B0cy53ZWJ2aWV3Q29ubmVjdFJldHJpZXMsIHRoaXMub3B0cy5pZ25vcmVBYm91dEJsYW5rVXJsKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgTm8gYXZhaWxhYmxlIHdlYiBwYWdlczogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH07XG5cbiAgaWYgKHRoaXMucmVtb3RlICYmIHRoaXMucmVtb3RlLmFwcElkS2V5KSB7XG4gICAgLy8gYWxyZWFkeSBjb25uZWN0ZWRcbiAgICBwYWdlQXJyYXkgPSBhd2FpdCBnZXRXZWJ2aWV3UGFnZXMoKTtcbiAgfSBlbHNlIHtcbiAgICBpZiAoIXRoaXMucmVtb3RlKSB7XG4gICAgICBhd2FpdCB0aGlzLmNvbm5lY3RUb1JlbW90ZURlYnVnZ2VyKCk7XG4gICAgfVxuICAgIGF3YWl0IHRoaXMucmVtb3RlLnNldENvbm5lY3Rpb25LZXkoKTtcblxuICAgIHBhZ2VBcnJheSA9IGF3YWl0IGdldFdlYnZpZXdQYWdlcygpO1xuXG4gICAgY29uc3QgYWxlcnRFcnJvck1zZyA9ICdDbG9zZSBhbGVydCBmYWlsZWQuIFJldHJ5Lic7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHJldHJ5SW50ZXJ2YWwoNiwgMTAwMCwgYXN5bmMgKCkgPT4ge1xuICAgICAgICBpZiAoIWF3YWl0IHRoaXMuY2xvc2VBbGVydEJlZm9yZVRlc3QoKSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihhbGVydEVycm9yTXNnKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAvLyBpZiB0aGUgbG9vcCB0byBjbG9zZSBhbGVydHMgZmFpbGVkIHRvIGRpc21pc3MsIGlnbm9yZSxcbiAgICAgIC8vIG90aGVyd2lzZSBsb2cgYW5kIHRocm93IHRoZSBlcnJvclxuICAgICAgaWYgKGVyci5tZXNzYWdlICE9PSBhbGVydEVycm9yTXNnKSB7XG4gICAgICAgIGxvZy5lcnJvckFuZFRocm93KGVycik7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgaWYgKHBhZ2VBcnJheS5sZW5ndGggPT09IDApIHtcbiAgICAvLyB3ZSBoYXZlIG5vIHdlYiBmcmFtZXMsIGJ1dCBjb250aW51ZSBhbnl3YXlcbiAgICBsb2cuZGVidWcoJ05vIHdlYiBmcmFtZXMgZm91bmQuJyk7XG4gIH1cbiAgcmV0dXJuIHBhZ2VBcnJheTtcbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gQ29udGV4dFxuICpcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBpZCAtIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBjb250ZXh0LiBUaGUgbmF0aXZlIGNvbnRleHRcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICB3aWxsIGJlICdOQVRJVkVfQVBQJyBhbmQgdGhlIHdlYnZpZXdzIHdpbGwgYmVcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAnV0VCVklFV194eHgnXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IHRpdGxlIC0gVGhlIHRpdGxlIGFzc29jaWF0ZWQgd2l0aCB0aGUgd2VidmlldyBjb250ZW50XG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IHVybCAtIFRoZSB1cmwgYXNzb2NpYXRlZCB3aXRoIHRoZSB3ZWJ2aWV3IGNvbnRlbnRcbiAqL1xuXG4vKipcbiAqIEdldCB0aGUgY29udGV4dHMgYXZhaWxhYmxlLCB3aXRoIGluZm9ybWF0aW9uIGFib3V0IHRoZSB1cmwgYW5kIHRpdGxlIG9mIGVhY2hcbiAqIHdlYnZpZXdcbiAqIEByZXR1cm5zIHtBcnJheX0gTGlzdCBvZiBDb250ZXh0IG9iamVjdHNcbiAqL1xuZXh0ZW5zaW9ucy5tb2JpbGVHZXRDb250ZXh0cyA9IGFzeW5jIGZ1bmN0aW9uIG1vYmlsZUdldENvbnRleHRzICgpIHtcbiAgY29uc3QgY3VyT3B0ID0gdGhpcy5vcHRzLmZ1bGxDb250ZXh0TGlzdDtcbiAgdHJ5IHtcbiAgICAvLyBgYXBwaXVtLWlvcy1kcml2ZXIjZ2V0Q29udGV4dHNgIHJldHVybnMgdGhlIGZ1bGwgbGlzdCBvZiBjb250ZXh0c1xuICAgIC8vIGlmIHRoaXMgb3B0aW9uIGlzIG9uXG4gICAgdGhpcy5vcHRzLmZ1bGxDb250ZXh0TGlzdCA9IHRydWU7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuZ2V0Q29udGV4dHMoKTtcbiAgfSBmaW5hbGx5IHtcbiAgICAvLyByZXNldCB0aGUgb3B0aW9uIHNvIHRoZXJlIGFyZSBubyBzaWRlIGVmZmVjdHNcbiAgICB0aGlzLm9wdHMuZnVsbENvbnRleHRMaXN0ID0gY3VyT3B0O1xuICB9XG59O1xuXG5jb21tYW5kcy5zZXRXaW5kb3cgPSBhc3luYyBmdW5jdGlvbiBzZXRXaW5kb3cgKG5hbWUsIHNraXBSZWFkeUNoZWNrKSB7XG4gIHRyeSB7XG4gICAgYXdhaXQgdGhpcy5zZXRDb250ZXh0KG5hbWUsIF8ubm9vcCwgc2tpcFJlYWR5Q2hlY2spO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICAvLyB0cmFuc2xhdGUgdGhlIGVycm9yIGluIHRlcm1zIG9mIHdpbmRvd3NcbiAgICB0aHJvdyBpc0Vycm9yVHlwZShlcnIsIGVycm9ycy5Ob1N1Y2hDb250ZXh0RXJyb3IpXG4gICAgICA/IG5ldyBlcnJvcnMuTm9TdWNoV2luZG93RXJyb3IoKVxuICAgICAgOiBlcnI7XG4gIH1cbn07XG5cbmNvbW1hbmRzLmdldFdpbmRvd0hhbmRsZSA9IGFzeW5jIGZ1bmN0aW9uIGdldFdpbmRvd0hhbmRsZSAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICBpZiAoIXRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vdEltcGxlbWVudGVkRXJyb3IoKTtcbiAgfVxuICBsb2cuZGVidWcoYEdldHRpbmcgY3VycmVudCB3aW5kb3cgaGFuZGxlYCk7XG4gIHJldHVybiB0aGlzLmN1ckNvbnRleHQ7XG59O1xuXG5jb21tYW5kcy5nZXRXaW5kb3dIYW5kbGVzID0gYXN5bmMgZnVuY3Rpb24gZ2V0V2luZG93SGFuZGxlcyAoKSB7XG4gIGlmICghdGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuTm90SW1wbGVtZW50ZWRFcnJvcigpO1xuICB9XG4gIGxvZy5kZWJ1ZygnR2V0dGluZyBsaXN0IG9mIGF2YWlsYWJsZSB3aW5kb3cgaGFuZGxlcycpO1xuICBjb25zdCBjb250ZXh0cyA9IGF3YWl0IHRoaXMuZ2V0Q29udGV4dHNBbmRWaWV3cyhmYWxzZSk7XG4gIHJldHVybiBjb250ZXh0c1xuICAgIC8vIGdldCByaWQgb2YgdGhlIG5hdGl2ZSBhcHAgY29udGV4dFxuICAgIC5maWx0ZXIoKGNvbnRleHQpID0+IGNvbnRleHQuaWQgIT09IE5BVElWRV9XSU4pXG4gICAgLy8gZ2V0IHRoZSBgYXBwLmlkYCBmb3JtYXQgZXhwZWN0ZWRcbiAgICAubWFwKChjb250ZXh0KSA9PiBjb250ZXh0LnZpZXcuaWQudG9TdHJpbmcoKSk7XG59O1xuXG5leHRlbnNpb25zLm9uUGFnZUNoYW5nZSA9IGFzeW5jIGZ1bmN0aW9uIG9uUGFnZUNoYW5nZSAocGFnZUNoYW5nZU5vdGlmaWNhdGlvbikge1xuICBsb2cuZGVidWcoYFJlbW90ZSBkZWJ1Z2dlciBub3RpZmllZCB1cyBvZiBhIG5ldyBwYWdlIGxpc3Rpbmc6ICR7SlNPTi5zdHJpbmdpZnkocGFnZUNoYW5nZU5vdGlmaWNhdGlvbil9YCk7XG4gIGlmICh0aGlzLnNlbGVjdGluZ05ld1BhZ2UpIHtcbiAgICBsb2cuZGVidWcoJ1dlIGFyZSBpbiB0aGUgbWlkZGxlIG9mIHNlbGVjdGluZyBhIHBhZ2UsIGlnbm9yaW5nJyk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGlmICghdGhpcy5yZW1vdGUgfHwgIXRoaXMucmVtb3RlLmlzQ29ubmVjdGVkKCkpIHtcbiAgICBsb2cuZGVidWcoJ1dlIGhhdmUgbm90IHlldCBjb25uZWN0ZWQsIGlnbm9yaW5nJyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3Qge2FwcElkS2V5LCBwYWdlQXJyYXl9ID0gcGFnZUNoYW5nZU5vdGlmaWNhdGlvbjtcblxuICBsZXQgbmV3SWRzID0gW107XG4gIGxldCBuZXdQYWdlcyA9IFtdO1xuICBsZXQga2V5SWQgPSBudWxsO1xuICBmb3IgKGNvbnN0IHBhZ2Ugb2YgcGFnZUFycmF5KSB7XG4gICAgY29uc3QgaWQgPSBwYWdlLmlkLnRvU3RyaW5nKCk7XG4gICAgbmV3SWRzLnB1c2goaWQpO1xuICAgIGlmIChwYWdlLmlzS2V5KSB7XG4gICAgICBrZXlJZCA9IGlkO1xuICAgIH1cbiAgICBjb25zdCBjb250ZXh0SWQgPSBgJHthcHBJZEtleX0uJHtpZH1gO1xuXG4gICAgLy8gYWRkIGlmIHRoaXMgaXMgYSBuZXcgcGFnZVxuICAgIGlmICghXy5pbmNsdWRlcyh0aGlzLmNvbnRleHRzLCBjb250ZXh0SWQpKSB7XG4gICAgICBuZXdQYWdlcy5wdXNoKGlkKTtcbiAgICAgIHRoaXMuY29udGV4dHMucHVzaChjb250ZXh0SWQpO1xuICAgIH1cbiAgfVxuXG4gIGlmICgha2V5SWQpIHtcbiAgICAvLyBpZiB0aGVyZSBpcyBubyBrZXkgaWQsIHB1bGwgdGhlIGZpcnN0IGlkIGZyb20gdGhlIHBhZ2UgYXJyYXkgYW5kIHVzZSB0aGF0XG4gICAgLy8gYXMgYSBzdGFuZCBpblxuICAgIGxvZy5kZWJ1ZygnTm8ga2V5IGlkIGZvdW5kLiBDaG9vc2luZyBmaXJzdCBpZCBmcm9tIHBhZ2UgYXJyYXknKTtcbiAgICBrZXlJZCA9IG5ld0lkc1swXSB8fCBudWxsO1xuICB9XG5cbiAgaWYgKCF1dGlsLmhhc1ZhbHVlKHRoaXMuY3VyQ29udGV4dCkpIHtcbiAgICBsb2cuZGVidWcoJ1dlIGRvIG5vdCBhcHBlYXIgdG8gaGF2ZSB3aW5kb3cgc2V0IHlldCwgaWdub3JpbmcnKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBbY3VyQXBwSWRLZXksIGN1clBhZ2VJZEtleV0gPSB0aGlzLmN1ckNvbnRleHQuc3BsaXQoJy4nKTtcblxuICBpZiAoY3VyQXBwSWRLZXkgIT09IGFwcElkS2V5KSB7XG4gICAgbG9nLmRlYnVnKCdQYWdlIGNoYW5nZSBub3QgcmVmZXJyaW5nIHRvIGN1cnJlbnRseSBzZWxlY3RlZCBhcHAsIGlnbm9yaW5nLicpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGxldCBuZXdQYWdlID0gbnVsbDtcbiAgaWYgKG5ld1BhZ2VzLmxlbmd0aCkge1xuICAgIG5ld1BhZ2UgPSBfLmxhc3QobmV3UGFnZXMpO1xuICAgIGxvZy5kZWJ1ZyhgV2UgaGF2ZSBuZXcgcGFnZXMsIHNlbGVjdGluZyBwYWdlICcke25ld1BhZ2V9J2ApO1xuICB9IGVsc2UgaWYgKCFfLmluY2x1ZGVzKG5ld0lkcywgY3VyUGFnZUlkS2V5KSkge1xuICAgIGxvZy5kZWJ1ZygnTmV3IHBhZ2UgbGlzdGluZyBmcm9tIHJlbW90ZSBkZWJ1Z2dlciBkb2VzIG5vdCBjb250YWluICcgK1xuICAgICAgICAgICAgICAgICAnY3VycmVudCB3aW5kb3c7IGFzc3VtaW5nIGl0IGlzIGNsb3NlZCcpO1xuICAgIGlmICghdXRpbC5oYXNWYWx1ZShrZXlJZCkpIHtcbiAgICAgIGxvZy5lcnJvcignRG8gbm90IGhhdmUgb3VyIGN1cnJlbnQgd2luZG93IGFueW1vcmUsIGFuZCB0aGVyZSAnICtcbiAgICAgICAgICAgICAgICAgICAnYXJlIG5vdCBhbnkgbW9yZSB0byBsb2FkISBEb2luZyBub3RoaW5nLi4uJyk7XG4gICAgICB0aGlzLnNldEN1cnJlbnRVcmwodW5kZWZpbmVkKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsb2cuZGVidWcoYERlYnVnZ2VyIGFscmVhZHkgc2VsZWN0ZWQgcGFnZSAnJHtrZXlJZH0nLCBgICtcbiAgICAgICAgICAgICAgICAgYGNvbmZpcm1pbmcgdGhhdCBjaG9pY2UuYCk7XG4gICAgdGhpcy5jdXJDb250ZXh0ID0gYCR7YXBwSWRLZXl9LiR7a2V5SWR9YDtcbiAgICBuZXdQYWdlID0ga2V5SWQ7XG4gIH0gZWxzZSB7XG4gICAgLy8gYXQgdGhpcyBwb2ludCwgdGhlcmUgYXJlIG5vIG5ldyBwYWdlcywgYW5kIHRoZSBjdXJyZW50IHBhZ2Ugc3RpbGwgZXhpc3RzXG4gICAgbG9nLmRlYnVnKCdDaGVja2luZyBpZiBwYWdlIG5lZWRzIHRvIGxvYWQnKTtcbiAgICAvLyBJZiBhIHdpbmRvdyBuYXZpZ2F0ZXMgdG8gYW4gYW5jaG9yIGl0IGRvZXNuJ3QgYWx3YXlzIGZpcmUgYSBwYWdlXG4gICAgLy8gY2FsbGJhY2sgZXZlbnQuIExldCdzIGNoZWNrIGlmIHdlIHdvdW5kIHVwIGluIHN1Y2ggYSBzaXR1YXRpb24uXG4gICAgY29uc3QgbmVlZHNQYWdlTG9hZCA9ICgoKSA9PiB7XG4gICAgICAvLyBuZWVkIHRvIG1hcCB0aGUgcGFnZSBpZHMgdG8gY29udGV4dCBpZHNcbiAgICAgIGNvbnN0IGNvbnRleHRBcnJheSA9IF8ubWFwKHBhZ2VBcnJheSwgKHBhZ2UpID0+IGAke2FwcElkS2V5fS4ke3BhZ2UuaWR9YCk7XG4gICAgICAvLyBjaGVjayBpZiB0aGUgY3VycmVudCBjb250ZXh0IGV4aXN0cyBpbiBib3RoIG91ciByZWNvcmRlZCBjb250ZXh0cyxcbiAgICAgIC8vIGFuZCB0aGUgcGFnZSBhcnJheVxuICAgICAgcmV0dXJuICFfLmlzRXF1YWwoXy5maW5kKHRoaXMuY29udGV4dHMsIHRoaXMuY3VyQ29udGV4dCksIF8uZmluZChjb250ZXh0QXJyYXksIHRoaXMuY3VyQ29udGV4dCkpO1xuICAgIH0pKCk7XG5cbiAgICBpZiAobmVlZHNQYWdlTG9hZCkge1xuICAgICAgbG9nLmRlYnVnKCdQYWdlIGxvYWQgbmVlZGVkLiBMb2FkaW5nLi4uJyk7XG4gICAgICBhd2FpdCB0aGlzLnJlbW90ZS5wYWdlTG9hZCgpO1xuICAgIH1cblxuICAgIGxvZy5kZWJ1ZygnTmV3IHBhZ2UgbGlzdGluZyBpcyBzYW1lIGFzIG9sZCwgZG9pbmcgbm90aGluZycpO1xuICB9XG5cbiAgLy8gbWFrZSBzdXJlIHRoYXQgdGhlIHBhZ2UgbGlzdGluZyBpc24ndCBpbmRpY2F0aW5nIGEgcmVkaXJlY3RcbiAgaWYgKHV0aWwuaGFzVmFsdWUodGhpcy5jdXJDb250ZXh0KSkge1xuICAgIGxldCBjdXJyZW50UGFnZUlkID0gcGFyc2VJbnQoXy5sYXN0KHRoaXMuY3VyQ29udGV4dC5zcGxpdCgnLicpKSwgMTApO1xuICAgIGxldCBwYWdlID0gXy5maW5kKHBhZ2VBcnJheSwgKHApID0+IHBhcnNlSW50KHAuaWQsIDEwKSA9PT0gY3VycmVudFBhZ2VJZCk7XG4gICAgaWYgKHBhZ2UgJiYgcGFnZS51cmwgIT09IHRoaXMuZ2V0Q3VycmVudFVybCgpKSB7XG4gICAgICBsb2cuZGVidWcoYFJlZGlyZWN0ZWQgZnJvbSAnJHt0aGlzLmdldEN1cnJlbnRVcmwoKX0nIHRvICcke3BhZ2UudXJsfSdgKTtcbiAgICAgIHRoaXMuc2V0Q3VycmVudFVybChwYWdlLnVybCk7XG4gICAgfVxuICB9XG5cbiAgaWYgKHV0aWwuaGFzVmFsdWUobmV3UGFnZSkpIHtcbiAgICB0aGlzLnNlbGVjdGluZ05ld1BhZ2UgPSB0cnVlO1xuICAgIGNvbnN0IG9sZENvbnRleHQgPSB0aGlzLmN1ckNvbnRleHQ7XG4gICAgdGhpcy5jdXJDb250ZXh0ID0gYCR7YXBwSWRLZXl9LiR7bmV3UGFnZX1gO1xuICAgIC8vIGRvIG5vdCB3YWl0LCBhcyB0aGlzIGNhbiB0YWtlIGEgbG9uZyB0aW1lLCBhbmQgdGhlIHJlc3BvbnNlIGlzIG5vdCBuZWNlc3NhcnlcbiAgICB0aGlzLnJlbW90ZS5zZWxlY3RQYWdlKGFwcElkS2V5LCBwYXJzZUludChuZXdQYWdlLCAxMCkpXG4gICAgICAuY2F0Y2goKGVycikgPT4geyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHByb21pc2UvcHJlZmVyLWF3YWl0LXRvLWNhbGxiYWNrc1xuICAgICAgICBsb2cud2FybihgRmFpbGVkIHRvIHNlbGVjdCBwYWdlOiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgICB0aGlzLmN1ckNvbnRleHQgPSBvbGRDb250ZXh0O1xuICAgICAgfSk7XG4gICAgdGhpcy5zZWxlY3RpbmdOZXdQYWdlID0gZmFsc2U7XG4gIH1cbiAgdGhpcy53aW5kb3dIYW5kbGVDYWNoZSA9IHBhZ2VBcnJheTtcbn07XG5cblxuT2JqZWN0LmFzc2lnbihleHRlbnNpb25zLCBjb21tYW5kcywgaGVscGVycyk7XG5leHBvcnQgZGVmYXVsdCBleHRlbnNpb25zO1xuIl0sImZpbGUiOiJsaWIvY29tbWFuZHMvY29udGV4dC5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLi8uLiJ9
