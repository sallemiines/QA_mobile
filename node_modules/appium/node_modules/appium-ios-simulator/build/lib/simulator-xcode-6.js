"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard.js");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault.js");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.SPRINGBOARD_BUNDLE_ID = exports.BOOT_COMPLETED_EVENT = exports.SimulatorXcode6 = exports.default = void 0;

require("source-map-support/register");

var _path = _interopRequireDefault(require("path"));

var simctl = _interopRequireWildcard(require("node-simctl"));

var _appiumXcode = _interopRequireWildcard(require("appium-xcode"));

var _logger = _interopRequireDefault(require("./logger"));

var _appiumSupport = require("appium-support");

var _bluebird = _interopRequireDefault(require("bluebird"));

var _lodash = _interopRequireDefault(require("lodash"));

var _asyncLock = _interopRequireDefault(require("async-lock"));

var _utils = require("./utils.js");

var _asyncbox = require("asyncbox");

var settings = _interopRequireWildcard(require("./settings"));

var _teen_process = require("teen_process");

var _tailUntil = require("./tail-until.js");

var _index = _interopRequireDefault(require("./extensions/index"));

var _events = require("events");

var _calendar = _interopRequireDefault(require("./calendar"));

var _permissions = _interopRequireDefault(require("./permissions"));

const STARTUP_TIMEOUT = 60 * 1000;
const EXTRA_STARTUP_TIME = 2000;
const UI_CLIENT_ACCESS_GUARD = new _asyncLock.default();
const UI_CLIENT_BUNDLE_ID = 'com.apple.iphonesimulator';
const SPRINGBOARD_BUNDLE_ID = 'com.apple.SpringBoard';
exports.SPRINGBOARD_BUNDLE_ID = SPRINGBOARD_BUNDLE_ID;
const BOOT_COMPLETED_EVENT = 'bootCompleted';
exports.BOOT_COMPLETED_EVENT = BOOT_COMPLETED_EVENT;

class SimulatorXcode6 extends _events.EventEmitter {
  constructor(udid, xcodeVersion) {
    super();
    this.udid = String(udid);
    this.xcodeVersion = xcodeVersion;
    this._platformVersion = null;
    this.keychainPath = _path.default.resolve(this.getDir(), 'Library', 'Keychains');
    this.simulatorApp = 'iOS Simulator.app';
    this.appDataBundlePaths = {};
    this.isFreshFiles = ['Library/ConfigurationProfiles', 'Library/Cookies', 'Library/Preferences/.GlobalPreferences.plist', 'Library/Preferences/com.apple.springboard.plist', 'var/run/syslog.pid'];
    this.extraStartupTime = EXTRA_STARTUP_TIME;
    this.calendar = new _calendar.default(xcodeVersion, this.getDir());
    this.permissions = new _permissions.default(xcodeVersion, this.getDir(), this.udid);
  }

  get uiClientBundleId() {
    return UI_CLIENT_BUNDLE_ID;
  }

  async getUIClientPid() {
    let stdout;

    try {
      ({
        stdout
      } = await (0, _teen_process.exec)('pgrep', ['-fn', `${this.simulatorApp}/Contents/MacOS/`]));
    } catch (e) {
      return null;
    }

    if (isNaN(parseInt(stdout, 10))) {
      return null;
    }

    stdout = stdout.trim();

    _logger.default.debug(`Got Simulator UI client PID: ${stdout}`);

    return stdout;
  }

  async isUIClientRunning() {
    return !_lodash.default.isNull((await this.getUIClientPid()));
  }

  get startupTimeout() {
    return STARTUP_TIMEOUT;
  }

  async getPlatformVersion() {
    if (!this._platformVersion) {
      let {
        sdk
      } = await this.stat();
      this._platformVersion = sdk;
    }

    return this._platformVersion;
  }

  getRootDir() {
    let home = process.env.HOME;
    return _path.default.resolve(home, 'Library', 'Developer', 'CoreSimulator', 'Devices');
  }

  getDir() {
    return _path.default.resolve(this.getRootDir(), this.udid, 'data');
  }

  getLogDir() {
    let home = process.env.HOME;
    return _path.default.resolve(home, 'Library', 'Logs', 'CoreSimulator', this.udid);
  }

  async installApp(app) {
    return await simctl.installApp(this.udid, app);
  }

  async isAppInstalled(bundleId, appFile = null) {
    let appDirs = await this.getAppDirs(appFile, bundleId);
    return appDirs.length !== 0;
  }

  async getUserInstalledBundleIdsByBundleName(bundleName) {
    const rootUserAppDir = await this.buildBundlePathMap('Bundle');
    const bundleIds = [];

    if (_lodash.default.isEmpty(rootUserAppDir)) {
      return bundleIds;
    }

    for (const [bundleId, userAppDirPath] of Object.entries(rootUserAppDir)) {
      const appFile = (await _appiumSupport.fs.readdir(userAppDirPath)).find(file => _path.default.extname(file).toLowerCase() === '.app');

      const infoPlistPath = _path.default.resolve(userAppDirPath, appFile, 'Info.plist');

      if (!(await _appiumSupport.fs.exists(infoPlistPath))) {
        continue;
      }

      try {
        const infoPlist = await _appiumSupport.plist.parsePlistFile(infoPlistPath, false);

        if (infoPlist.CFBundleName === bundleName) {
          bundleIds.push(bundleId);
        }
      } catch (err) {
        _logger.default.warn(`Failed to read plist ${infoPlistPath}. Original error '${err.message}'`);

        continue;
      }
    }

    _logger.default.debug(`The simulator has '${bundleIds.length}' bundles which have '${bundleName}' as their 'CFBundleName':`);

    for (const bundleId of bundleIds) {
      _logger.default.debug(`    '${bundleId}'`);
    }

    return bundleIds;
  }

  async getAppDir(id, subDir = 'Data') {
    this.appDataBundlePaths[subDir] = this.appDataBundlePaths[subDir] || {};

    if (_lodash.default.isEmpty(this.appDataBundlePaths[subDir]) && !(await this.isFresh())) {
      this.appDataBundlePaths[subDir] = await this.buildBundlePathMap(subDir);
    }

    return this.appDataBundlePaths[subDir][id];
  }

  async buildBundlePathMap(subDir = 'Data') {
    _logger.default.debug('Building bundle path map');

    let applicationList;
    let pathBundlePair;

    if ((await this.getPlatformVersion()) === '7.1') {
      applicationList = _path.default.resolve(this.getDir(), 'Applications');

      pathBundlePair = async dir => {
        dir = _path.default.resolve(applicationList, dir);
        let appFiles = await _appiumSupport.fs.glob(`${dir}/*.app`);
        let bundleId = appFiles[0].match(/.*\/(.*)\.app/)[1];
        return {
          path: dir,
          bundleId
        };
      };
    } else {
      applicationList = _path.default.resolve(this.getDir(), 'Containers', subDir, 'Application');

      let readBundleId = async dir => {
        let plist = _path.default.resolve(dir, '.com.apple.mobile_container_manager.metadata.plist');

        let metadata = await settings.read(plist);
        return metadata.MCMMetadataIdentifier;
      };

      pathBundlePair = async dir => {
        dir = _path.default.resolve(applicationList, dir);
        let bundleId = await readBundleId(dir);
        return {
          path: dir,
          bundleId
        };
      };
    }

    if (!(await _appiumSupport.fs.exists(applicationList))) {
      _logger.default.warn(`No directory path '${applicationList}'`);

      return {};
    }

    let bundlePathDirs = await _appiumSupport.fs.readdir(applicationList);
    let bundlePathPairs = await (0, _asyncbox.asyncmap)(bundlePathDirs, async dir => {
      return await pathBundlePair(dir);
    }, false);
    return bundlePathPairs.reduce((bundleMap, bundlePath) => {
      bundleMap[bundlePath.bundleId] = bundlePath.path;
      return bundleMap;
    }, {});
  }

  async stat() {
    for (let [sdk, deviceArr] of _lodash.default.toPairs((await simctl.getDevices()))) {
      for (let device of deviceArr) {
        if (device.udid === this.udid) {
          device.sdk = sdk;
          return device;
        }
      }
    }

    return {};
  }

  async isFresh() {
    let files = this.isFreshFiles;
    let pv = await this.getPlatformVersion();

    if (pv !== '7.1') {
      files.push('Library/Preferences/com.apple.Preferences.plist');
    } else {
      files.push('Applications');
    }

    const dir = this.getDir();
    files = files.map(s => _path.default.resolve(dir, s));
    const existences = await (0, _asyncbox.asyncmap)(files, async f => await _appiumSupport.fs.hasAccess(f));
    const fresh = _lodash.default.compact(existences).length !== files.length;

    _logger.default.debug(`Checking whether simulator has been run before: ${fresh ? 'no' : 'yes'}`);

    return fresh;
  }

  async isRunning() {
    let stat = await this.stat();
    return stat.state === 'Booted';
  }

  async waitForBoot(startupTimeout) {
    let bootedIndicator = await this.getBootedIndicatorString();
    await this.tailLogsUntil(bootedIndicator, startupTimeout);

    _logger.default.debug(`Waiting an extra ${this.extraStartupTime}ms for the simulator to really finish booting`);

    await _bluebird.default.delay(this.extraStartupTime);

    _logger.default.debug('Done waiting extra time for simulator');

    this.emit(BOOT_COMPLETED_EVENT);
  }

  async getBootedIndicatorString() {
    let indicator;
    let platformVersion = await this.getPlatformVersion();

    switch (platformVersion) {
      case '7.1':
      case '8.1':
      case '8.2':
      case '8.3':
      case '8.4':
        indicator = 'profiled: Service starting...';
        break;

      case '9.0':
      case '9.1':
      case '9.2':
      case '9.3':
        indicator = 'System app "com.apple.springboard" finished startup';
        break;

      case '10.0':
        indicator = 'Switching to keyboard';
        break;

      default:
        _logger.default.warn(`No boot indicator case for platform version '${platformVersion}'`);

        indicator = 'no boot indicator string available';
    }

    return indicator;
  }

  async startUIClient(opts = {}) {
    opts = Object.assign({
      scaleFactor: null,
      connectHardwareKeyboard: false,
      startupTimeout: this.startupTimeout
    }, opts);

    const simulatorApp = _path.default.resolve((await (0, _appiumXcode.getPath)()), 'Applications', this.simulatorApp);

    const args = ['-Fn', simulatorApp, '--args', '-CurrentDeviceUDID', this.udid];

    if (opts.scaleFactor) {
      const stat = await this.stat();
      const formattedDeviceName = stat.name.replace(/\s+/g, '-');
      const argumentName = `-SimulatorWindowLastScale-com.apple.CoreSimulator.SimDeviceType.${formattedDeviceName}`;
      args.push(argumentName, opts.scaleFactor);
    }

    if (_lodash.default.isBoolean(opts.connectHardwareKeyboard)) {
      args.push('-ConnectHardwareKeyboard', opts.connectHardwareKeyboard ? '1' : '0');
    }

    _logger.default.info(`Starting Simulator UI with command: open ${args.join(' ')}`);

    try {
      await (0, _teen_process.exec)('open', args, {
        timeout: opts.startupTimeout
      });
    } catch (err) {
      if (!(err.stdout || '').includes('-10825') && !(err.stderr || '').includes('-10825')) {
        throw err;
      }

      _logger.default.warn(`Error while opening UI: ${err.stdout || err.stderr}. Continuing`);
    }
  }

  async run(opts = {}) {
    opts = Object.assign({
      startupTimeout: this.startupTimeout
    }, opts);
    const {
      state
    } = await this.stat();
    const isServerRunning = state === 'Booted';
    const isUIClientRunning = await this.isUIClientRunning();

    if (isServerRunning && isUIClientRunning) {
      _logger.default.info(`Both Simulator with UDID ${this.udid} and the UI client are currently running`);

      return;
    }

    const startTime = process.hrtime();

    try {
      await this.shutdown();
    } catch (err) {
      _logger.default.warn(`Error on Simulator shutdown: ${err.message}`);
    }

    await this.startUIClient(opts);
    await this.waitForBoot(opts.startupTimeout);

    _logger.default.info(`Simulator with UDID ${this.udid} booted in ${process.hrtime(startTime)[0]} seconds`);
  }

  async clean() {
    await this.endSimulatorDaemon();

    _logger.default.info(`Cleaning simulator ${this.udid}`);

    await simctl.eraseDevice(this.udid, 10000);
  }

  async scrubCustomApp(appFile, appBundleId) {
    return await this.cleanCustomApp(appFile, appBundleId, true);
  }

  async cleanCustomApp(appFile, appBundleId, scrub = false) {
    _logger.default.debug(`Cleaning app data files for '${appFile}', '${appBundleId}'`);

    if (!scrub) {
      _logger.default.debug(`Deleting app altogether`);
    }

    let appDirs = await this.getAppDirs(appFile, appBundleId, scrub);

    if (appDirs.length === 0) {
      _logger.default.debug('Could not find app directories to delete. It is probably not installed');

      return;
    }

    let deletePromises = [];

    for (let dir of appDirs) {
      _logger.default.debug(`Deleting directory: '${dir}'`);

      deletePromises.push(_appiumSupport.fs.rimraf(dir));
    }

    if ((await this.getPlatformVersion()) >= 8) {
      let relRmPath = `Library/Preferences/${appBundleId}.plist`;

      let rmPath = _path.default.resolve(this.getRootDir(), relRmPath);

      _logger.default.debug(`Deleting file: '${rmPath}'`);

      deletePromises.push(_appiumSupport.fs.rimraf(rmPath));
    }

    await _bluebird.default.all(deletePromises);
  }

  async getAppDirs(appFile, appBundleId, scrub = false) {
    let dirs = [];

    if ((await this.getPlatformVersion()) >= 8) {
      let data = await this.getAppDir(appBundleId);
      if (!data) return dirs;
      let bundle = !scrub ? await this.getAppDir(appBundleId, 'Bundle') : undefined;

      for (let src of [data, bundle]) {
        if (src) {
          dirs.push(src);
        }
      }
    } else {
      let data = await this.getAppDir(appFile);

      if (data) {
        dirs.push(data);
      }
    }

    return dirs;
  }

  async launchAndQuit(safari = false, startupTimeout = this.startupTimeout) {
    _logger.default.debug('Attempting to launch and quit the simulator, to create directory structure');

    _logger.default.debug(`Will launch with Safari? ${safari}`);

    await this.run(startupTimeout);

    if (safari) {
      await this.openUrl('http://www.appium.io');
    }

    try {
      await (0, _asyncbox.retryInterval)(60, 250, async () => {
        if (await this.isFresh()) {
          throw new Error('Simulator files not fully created. Waiting a bit');
        }
      });
    } catch (err) {
      _logger.default.warn(`Timeout waiting for simulator files to be created. Continuing`);
    }

    await this.shutdown();
  }

  async endSimulatorDaemon() {
    _logger.default.debug(`Killing any simulator daemons for ${this.udid}`);

    let launchctlCmd = `launchctl list | grep ${this.udid} | cut -f 3 | xargs -n 1 launchctl`;

    try {
      let stopCmd = `${launchctlCmd} stop`;
      await (0, _teen_process.exec)('bash', ['-c', stopCmd]);
    } catch (err) {
      _logger.default.warn(`Could not stop simulator daemons: ${err.message}`);

      _logger.default.debug('Carrying on anyway!');
    }

    try {
      let removeCmd = `${launchctlCmd} remove`;
      await (0, _teen_process.exec)('bash', ['-c', removeCmd]);
    } catch (err) {
      _logger.default.warn(`Could not remove simulator daemons: ${err.message}`);

      _logger.default.debug('Carrying on anyway!');
    }

    try {
      await (0, _asyncbox.waitForCondition)(async () => {
        let {
          stdout
        } = await (0, _teen_process.exec)('bash', ['-c', `ps -e  | grep ${this.udid} | grep launchd_sim | grep -v bash | grep -v grep | awk {'print$1'}`]);
        return stdout.trim().length === 0;
      }, {
        waitMs: 10000,
        intervalMs: 500
      });
    } catch (err) {
      _logger.default.warn(`Could not end simulator daemon for ${this.udid}: ${err.message}`);

      _logger.default.debug('Carrying on anyway!');
    }
  }

  async shutdown() {
    await (0, _utils.killAllSimulators)();
  }

  async delete() {
    await simctl.deleteDevice(this.udid);
  }

  async updateSettings(plist, updates) {
    return await settings.updateSettings(this, plist, updates);
  }

  async updateLocationSettings(bundleId, authorized) {
    return await settings.updateLocationSettings(this, bundleId, authorized);
  }

  async setReduceMotion(reduceMotion = true) {
    if (await this.isFresh()) {
      await this.launchAndQuit(false, STARTUP_TIMEOUT);
    }

    await settings.setReduceMotion(this, reduceMotion);
  }

  async setDarkMode() {
    _logger.default.info(`Unable to set dark mode in Xcode version '${this.xcodeVersion}'`);
  }

  async updateSafariSettings(updates) {
    let updated = await settings.updateSafariUserSettings(this, updates);
    return (await settings.updateSettings(this, 'mobileSafari', updates)) || updated;
  }

  async updateSafariGlobalSettings(updates) {
    return await settings.updateSafariGlobalSettings(this, updates);
  }

  async updateLocale(language, locale, calendarFormat) {
    return await settings.updateLocale(this, language, locale, calendarFormat);
  }

  async deleteSafari() {
    _logger.default.debug('Deleting Safari apps from simulator');

    let dirs = [];
    dirs.push((await this.getAppDir('com.apple.mobilesafari')));
    let pv = await this.getPlatformVersion();

    if (pv >= 8) {
      dirs.push((await this.getAppDir('com.apple.mobilesafari', 'Bundle')));
    }

    let deletePromises = [];

    for (let dir of _lodash.default.compact(dirs)) {
      _logger.default.debug(`Deleting directory: '${dir}'`);

      deletePromises.push(_appiumSupport.fs.rimraf(dir));
    }

    await _bluebird.default.all(deletePromises);
  }

  async cleanSafari(keepPrefs = true) {
    _logger.default.debug('Cleaning mobile safari data files');

    if (await this.isFresh()) {
      _logger.default.info('Could not find Safari support directories to clean out old ' + 'data. Probably there is nothing to clean out');

      return;
    }

    let libraryDir = _path.default.resolve(this.getDir(), 'Library');

    let safariRoot = await this.getAppDir('com.apple.mobilesafari');

    if (!safariRoot) {
      _logger.default.info('Could not find Safari support directories to clean out old ' + 'data. Probably there is nothing to clean out');

      return;
    }

    let safariLibraryDir = _path.default.resolve(safariRoot, 'Library');

    let filesToDelete = ['Caches/Snapshots/com.apple.mobilesafari', 'Caches/com.apple.mobilesafari/*', 'Caches/com.apple.WebAppCache/*', 'Caches/com.apple.WebKit.Networking/*', 'Caches/com.apple.WebKit.WebContent/*', 'Image Cache/*', 'WebKit/com.apple.mobilesafari/*', 'WebKit/GeolocationSites.plist', 'WebKit/LocalStorage/*.*', 'Safari/*', 'Cookies/*.binarycookies', 'Caches/com.apple.UIStatusBar/*', 'Caches/com.apple.keyboards/images/*', 'Caches/com.apple.Safari.SafeBrowsing/*', '../tmp/com.apple.mobilesafari/*'];
    let deletePromises = [];

    for (let file of filesToDelete) {
      deletePromises.push(_appiumSupport.fs.rimraf(_path.default.resolve(libraryDir, file)));
      deletePromises.push(_appiumSupport.fs.rimraf(_path.default.resolve(safariLibraryDir, file)));
    }

    if (!keepPrefs) {
      deletePromises.push(_appiumSupport.fs.rimraf(_path.default.resolve(safariLibraryDir, 'Preferences/*.plist')));
    }

    await _bluebird.default.all(deletePromises);
  }

  async removeApp(bundleId) {
    await simctl.removeApp(this.udid, bundleId);
  }

  async moveBuiltInApp(appName, appPath, newAppPath) {
    await (0, _utils.safeRimRaf)(newAppPath);
    await _appiumSupport.fs.copyFile(appPath, newAppPath);

    _logger.default.debug(`Copied '${appName}' to '${newAppPath}'`);

    await _appiumSupport.fs.rimraf(appPath);

    _logger.default.debug(`Temporarily deleted original app at '${appPath}'`);

    return [newAppPath, appPath];
  }

  async openUrl(url) {
    const SAFARI_BOOTED_INDICATOR = 'MobileSafari[';
    const SAFARI_STARTUP_TIMEOUT = 15 * 1000;
    const EXTRA_STARTUP_TIME = 3 * 1000;

    if (await this.isRunning()) {
      await (0, _asyncbox.retry)(5000, simctl.openUrl, this.udid, url);
      await this.tailLogsUntil(SAFARI_BOOTED_INDICATOR, SAFARI_STARTUP_TIMEOUT);

      _logger.default.debug(`Safari started, waiting ${EXTRA_STARTUP_TIME}ms for it to fully start`);

      await _bluebird.default.delay(EXTRA_STARTUP_TIME);

      _logger.default.debug('Done waiting for Safari');

      return;
    } else {
      throw new Error('Tried to open a url, but the Simulator is not Booted');
    }
  }

  async clearCaches(...folderNames) {
    const cachesRoot = _path.default.resolve(this.getDir(), 'Library', 'Caches');

    if (!(await _appiumSupport.fs.hasAccess(cachesRoot))) {
      _logger.default.debug(`Caches root at '${cachesRoot}' does not exist or is not accessible. Nothing to do there`);

      return 0;
    }

    let itemsToRemove = folderNames.length ? folderNames : await _appiumSupport.fs.readdir(cachesRoot);
    itemsToRemove = itemsToRemove.map(x => _path.default.resolve(cachesRoot, x));

    if (folderNames.length) {
      itemsToRemove = await _bluebird.default.filter(itemsToRemove, x => _appiumSupport.fs.hasAccess(x));
    }

    itemsToRemove = await _bluebird.default.filter(itemsToRemove, async x => (await _appiumSupport.fs.stat(x)).isDirectory());

    if (!itemsToRemove.length) {
      _logger.default.debug(`No Simulator cache items for cleanup were matched in '${cachesRoot}'`);

      return 0;
    }

    _logger.default.debug(`Matched ${itemsToRemove.length} Simulator cache ` + `item${itemsToRemove.length === 1 ? '' : 's'} for cleanup: ${itemsToRemove}`);

    try {
      await _bluebird.default.all(itemsToRemove, x => _appiumSupport.fs.rimraf(x));
    } catch (e) {
      _logger.default.warn(`Got an exception while cleaning Simulator caches: ${e.message}`);
    }

    return itemsToRemove.length;
  }

  async tailLogsUntil(bootedIndicator, timeoutMs) {
    let simLog = _path.default.resolve(this.getLogDir(), 'system.log');

    await (0, _asyncbox.retryInterval)(200, 200, async () => {
      let exists = await _appiumSupport.fs.exists(simLog);

      if (!exists) {
        throw new Error(`Could not find Simulator log: '${simLog}'`);
      }
    });

    _logger.default.info(`Simulator log at '${simLog}'`);

    _logger.default.info(`Tailing simulator logs until we encounter the string "${bootedIndicator}"`);

    _logger.default.info(`We will time out after ${timeoutMs}ms`);

    try {
      await (0, _tailUntil.tailUntil)(simLog, bootedIndicator, timeoutMs);
    } catch (err) {
      _logger.default.debug('Simulator startup timed out. Continuing anyway.');
    }
  }

  async enableCalendarAccess(bundleID) {
    await this.calendar.enableCalendarAccess(bundleID);
  }

  async disableCalendarAccess(bundleID) {
    await this.calendar.disableCalendarAccess(bundleID);
  }

  async hasCalendarAccess(bundleID) {
    return await this.calendar.hasCalendarAccess(bundleID);
  }

  async _activateWindow() {
    return `
      tell application "System Events"
        tell process "Simulator"
          set frontmost to false
          set frontmost to true
        end tell
      end tell
    `;
  }

  async executeUIClientScript(appleScript) {
    const windowActivationScript = await this._activateWindow();
    const resultScript = `${windowActivationScript ? windowActivationScript + '\n' : ''}${appleScript}`;

    _logger.default.debug(`Executing UI Apple Script on Simulator with UDID ${this.udid}: ${resultScript}`);

    return await UI_CLIENT_ACCESS_GUARD.acquire(this.simulatorApp, async () => {
      try {
        const {
          stdout
        } = await (0, _teen_process.exec)('osascript', ['-e', resultScript]);
        return stdout;
      } catch (err) {
        _logger.default.errorAndThrow(`Could not complete operation. Make sure Simulator UI is running and the parent Appium application (e. g. Appium.app or Terminal.app) ` + `is present in System Preferences > Security & Privacy > Privacy > Accessibility list. If the operation is still unsuccessful then ` + `it is not supported by this Simulator. ` + `Original error: ${err.message}`);
      }
    });
  }

  async isBiometricEnrolled() {
    const output = await this.executeUIClientScript(`
      tell application "System Events"
        tell process "Simulator"
          set dstMenuItem to menu item "Touch ID Enrolled" of menu 1 of menu bar item "Hardware" of menu bar 1
          set isChecked to (value of attribute "AXMenuItemMarkChar" of dstMenuItem) is "✓"
        end tell
      end tell
    `);

    _logger.default.debug(`Touch ID enrolled state: ${output}`);

    return _lodash.default.isString(output) && output.trim() === 'true';
  }

  async enrollBiometric(isEnabled = true) {
    await this.executeUIClientScript(`
      tell application "System Events"
        tell process "Simulator"
          set dstMenuItem to menu item "Touch ID Enrolled" of menu 1 of menu bar item "Hardware" of menu bar 1
          set isChecked to (value of attribute "AXMenuItemMarkChar" of dstMenuItem) is "✓"
          if ${isEnabled ? 'not ' : ''}isChecked then
            click dstMenuItem
          end if
        end tell
      end tell
    `);
  }

  async sendBiometricMatch(shouldMatch = true) {
    await this.executeUIClientScript(`
      tell application "System Events"
        tell process "Simulator"
          set dstMenuItem to menu item "${shouldMatch ? 'Matching' : 'Non-matching'}" of menu 1 of menu item "Simulate Finger Touch" of menu 1 of menu bar item "Hardware" of menu bar 1
          click dstMenuItem
        end tell
      end tell
    `);
  }

  async dismissDatabaseAlert(increase = true) {
    let button = increase ? 'Increase' : 'Cancel';

    _logger.default.debug(`Attempting to dismiss database alert with '${button}' button`);

    await this.executeUIClientScript(`
      tell application "System Events"
        tell process "Simulator"
          click button "${button}" of window 1
        end tell
      end tell
    `);
  }

  async backupKeychains() {
    if (!(await _appiumSupport.fs.exists(this.keychainPath))) {
      return false;
    }

    const backupPath = await _appiumSupport.tempDir.path({
      prefix: `keychains_backup_${Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1)}`,
      suffix: '.zip'
    });
    const zipArgs = ['-r', backupPath, `${this.keychainPath}${_path.default.sep}`];

    _logger.default.debug(`Creating keychains backup with 'zip ${zipArgs.join(' ')}' command`);

    await (0, _teen_process.exec)('zip', zipArgs);

    if (_lodash.default.isString(this._keychainsBackupPath) && (await _appiumSupport.fs.exists(this._keychainsBackupPath))) {
      await _appiumSupport.fs.unlink(this._keychainsBackupPath);
    }

    this._keychainsBackupPath = backupPath;
    return true;
  }

  async restoreKeychains(excludePatterns = []) {
    if (!_lodash.default.isString(this._keychainsBackupPath) || !(await _appiumSupport.fs.exists(this._keychainsBackupPath))) {
      throw new Error(`The keychains backup archive does not exist. ` + `Are you sure it was created before?`);
    }

    if (_lodash.default.isString(excludePatterns)) {
      excludePatterns = excludePatterns.split(',').map(x => x.trim());
    }

    const {
      state
    } = await this.stat();
    const isServerRunning = state === 'Booted';
    let plistPath;

    if (isServerRunning) {
      plistPath = _path.default.resolve((await this.getLaunchDaemonsRoot()), 'com.apple.securityd.plist');

      if (!(await _appiumSupport.fs.exists(plistPath))) {
        throw new Error(`Cannot clear keychains because '${plistPath}' does not exist`);
      }

      await simctl.spawn(this.udid, ['launchctl', 'unload', plistPath]);
    }

    try {
      await _appiumSupport.fs.rimraf(this.keychainPath);
      await (0, _appiumSupport.mkdirp)(this.keychainPath);
      const unzipArgs = ['-o', this._keychainsBackupPath, ..._lodash.default.flatMap(excludePatterns.map(x => ['-x', x])), '-d', '/'];

      _logger.default.debug(`Restoring keychains with 'unzip ${unzipArgs.join(' ')}' command`);

      await (0, _teen_process.exec)('unzip', unzipArgs);
      await _appiumSupport.fs.unlink(this._keychainsBackupPath);
      this._keychainsBackupPath = null;
    } finally {
      if (isServerRunning && plistPath) {
        await simctl.spawn(this.udid, ['launchctl', 'load', plistPath]);
      }
    }

    return true;
  }

  async clearKeychains() {
    const plistPath = _path.default.resolve((await this.getLaunchDaemonsRoot()), 'com.apple.securityd.plist');

    if (!(await _appiumSupport.fs.exists(plistPath))) {
      throw new Error(`Cannot clear keychains because '${plistPath}' does not exist`);
    }

    await simctl.spawn(this.udid, ['launchctl', 'unload', plistPath]);

    try {
      if (await _appiumSupport.fs.exists(this.keychainPath)) {
        await _appiumSupport.fs.rimraf(this.keychainPath);
        await (0, _appiumSupport.mkdirp)(this.keychainPath);
      }
    } finally {
      await simctl.spawn(this.udid, ['launchctl', 'load', plistPath]);
    }
  }

  async setPermission(bundleId, permission, value) {
    await this.setPermissions(bundleId, {
      [permission]: value
    });
  }

  async setPermissions(bundleId, permissionsMapping) {
    await this.permissions.setAccess(bundleId, permissionsMapping);

    _logger.default.debug(`Set ${JSON.stringify(permissionsMapping)} access for '${bundleId}'`);
  }

  async getPermission(bundleId, serviceName) {
    const result = await this.permissions.getAccess(bundleId, serviceName);

    _logger.default.debug(`Got ${serviceName} access status for '${bundleId}': ${result}`);

    return result;
  }

  async getLaunchDaemonsRoot() {
    const devRoot = await (0, _utils.getDeveloperRoot)();
    return _path.default.resolve(devRoot, 'Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator.sdk/System/Library/LaunchDaemons');
  }

  static async _getDeviceStringPlatformVersion(platformVersion) {
    let reqVersion = platformVersion;

    if (!reqVersion) {
      reqVersion = await _appiumXcode.default.getMaxIOSSDK();

      _logger.default.warn(`No platform version set. Using max SDK version: ${reqVersion}`);

      if (!_lodash.default.isString(reqVersion)) {
        reqVersion = reqVersion % 1 ? String(reqVersion) : `${reqVersion}.0`;
      }
    }

    return reqVersion;
  }

  static async _getDeviceStringVersionString(platformVersion) {
    let reqVersion = await this._getDeviceStringPlatformVersion(platformVersion);
    return `(${reqVersion} Simulator)`;
  }

  static _getDeviceStringConfigFix() {
    return {
      'iPad Simulator (7.1 Simulator)': 'iPad 2 (7.1 Simulator)',
      'iPad Simulator (8.0 Simulator)': 'iPad 2 (8.0 Simulator)',
      'iPad Simulator (8.1 Simulator)': 'iPad 2 (8.1 Simulator)',
      'iPad Simulator (8.2 Simulator)': 'iPad 2 (8.2 Simulator)',
      'iPad Simulator (8.3 Simulator)': 'iPad 2 (8.3 Simulator)',
      'iPad Simulator (8.4 Simulator)': 'iPad 2 (8.4 Simulator)',
      'iPhone Simulator (7.1 Simulator)': 'iPhone 5s (7.1 Simulator)',
      'iPhone Simulator (8.4 Simulator)': 'iPhone 6 (8.4 Simulator)',
      'iPhone Simulator (8.3 Simulator)': 'iPhone 6 (8.3 Simulator)',
      'iPhone Simulator (8.2 Simulator)': 'iPhone 6 (8.2 Simulator)',
      'iPhone Simulator (8.1 Simulator)': 'iPhone 6 (8.1 Simulator)',
      'iPhone Simulator (8.0 Simulator)': 'iPhone 6 (8.0 Simulator)'
    };
  }

  static async getDeviceString(opts) {
    opts = Object.assign({}, {
      deviceName: null,
      platformVersion: null,
      forceIphone: false,
      forceIpad: false
    }, opts);
    let logOpts = {
      deviceName: opts.deviceName,
      platformVersion: opts.platformVersion,
      forceIphone: opts.forceIphone,
      forceIpad: opts.forceIpad
    };

    _logger.default.debug(`Getting device string from options: ${JSON.stringify(logOpts)}`);

    if ((opts.deviceName || '')[0] === '=') {
      return opts.deviceName.substring(1);
    }

    let isiPhone = !!opts.forceIphone || !opts.forceIpad;

    if (opts.deviceName) {
      let device = opts.deviceName.toLowerCase();

      if (device.indexOf('iphone') !== -1) {
        isiPhone = true;
      } else if (device.indexOf('ipad') !== -1) {
        isiPhone = false;
      }
    }

    let iosDeviceString = opts.deviceName || (isiPhone ? 'iPhone Simulator' : 'iPad Simulator');

    if (/^(iPhone|iPad)$/.test(iosDeviceString)) {
      iosDeviceString += ' Simulator';
    }

    if (/[^(iPhone|iPad)] Simulator/.test(iosDeviceString)) {
      iosDeviceString = iosDeviceString.replace(' Simulator', '');
    }

    iosDeviceString += ` ${await this._getDeviceStringVersionString(opts.platformVersion)}`;

    let CONFIG_FIX = this._getDeviceStringConfigFix();

    let configFix = CONFIG_FIX;

    if (configFix[iosDeviceString]) {
      iosDeviceString = configFix[iosDeviceString];

      _logger.default.debug(`Fixing device. Changed from '${opts.deviceName}' ` + `to '${iosDeviceString}'`);
    }

    _logger.default.debug(`Final device string is '${iosDeviceString}'`);

    return iosDeviceString;
  }

  async getWebInspectorSocket() {
    return null;
  }

}

exports.SimulatorXcode6 = SimulatorXcode6;

for (let [cmd, fn] of _lodash.default.toPairs(_index.default)) {
  SimulatorXcode6.prototype[cmd] = fn;
}

var _default = SimulatorXcode6;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9zaW11bGF0b3IteGNvZGUtNi5qcyJdLCJuYW1lcyI6WyJTVEFSVFVQX1RJTUVPVVQiLCJFWFRSQV9TVEFSVFVQX1RJTUUiLCJVSV9DTElFTlRfQUNDRVNTX0dVQVJEIiwiQXN5bmNMb2NrIiwiVUlfQ0xJRU5UX0JVTkRMRV9JRCIsIlNQUklOR0JPQVJEX0JVTkRMRV9JRCIsIkJPT1RfQ09NUExFVEVEX0VWRU5UIiwiU2ltdWxhdG9yWGNvZGU2IiwiRXZlbnRFbWl0dGVyIiwiY29uc3RydWN0b3IiLCJ1ZGlkIiwieGNvZGVWZXJzaW9uIiwiU3RyaW5nIiwiX3BsYXRmb3JtVmVyc2lvbiIsImtleWNoYWluUGF0aCIsInBhdGgiLCJyZXNvbHZlIiwiZ2V0RGlyIiwic2ltdWxhdG9yQXBwIiwiYXBwRGF0YUJ1bmRsZVBhdGhzIiwiaXNGcmVzaEZpbGVzIiwiZXh0cmFTdGFydHVwVGltZSIsImNhbGVuZGFyIiwiQ2FsZW5kYXIiLCJwZXJtaXNzaW9ucyIsIlBlcm1pc3Npb25zIiwidWlDbGllbnRCdW5kbGVJZCIsImdldFVJQ2xpZW50UGlkIiwic3Rkb3V0IiwiZSIsImlzTmFOIiwicGFyc2VJbnQiLCJ0cmltIiwibG9nIiwiZGVidWciLCJpc1VJQ2xpZW50UnVubmluZyIsIl8iLCJpc051bGwiLCJzdGFydHVwVGltZW91dCIsImdldFBsYXRmb3JtVmVyc2lvbiIsInNkayIsInN0YXQiLCJnZXRSb290RGlyIiwiaG9tZSIsInByb2Nlc3MiLCJlbnYiLCJIT01FIiwiZ2V0TG9nRGlyIiwiaW5zdGFsbEFwcCIsImFwcCIsInNpbWN0bCIsImlzQXBwSW5zdGFsbGVkIiwiYnVuZGxlSWQiLCJhcHBGaWxlIiwiYXBwRGlycyIsImdldEFwcERpcnMiLCJsZW5ndGgiLCJnZXRVc2VySW5zdGFsbGVkQnVuZGxlSWRzQnlCdW5kbGVOYW1lIiwiYnVuZGxlTmFtZSIsInJvb3RVc2VyQXBwRGlyIiwiYnVpbGRCdW5kbGVQYXRoTWFwIiwiYnVuZGxlSWRzIiwiaXNFbXB0eSIsInVzZXJBcHBEaXJQYXRoIiwiT2JqZWN0IiwiZW50cmllcyIsImZzIiwicmVhZGRpciIsImZpbmQiLCJmaWxlIiwiZXh0bmFtZSIsInRvTG93ZXJDYXNlIiwiaW5mb1BsaXN0UGF0aCIsImV4aXN0cyIsImluZm9QbGlzdCIsInBsaXN0IiwicGFyc2VQbGlzdEZpbGUiLCJDRkJ1bmRsZU5hbWUiLCJwdXNoIiwiZXJyIiwid2FybiIsIm1lc3NhZ2UiLCJnZXRBcHBEaXIiLCJpZCIsInN1YkRpciIsImlzRnJlc2giLCJhcHBsaWNhdGlvbkxpc3QiLCJwYXRoQnVuZGxlUGFpciIsImRpciIsImFwcEZpbGVzIiwiZ2xvYiIsIm1hdGNoIiwicmVhZEJ1bmRsZUlkIiwibWV0YWRhdGEiLCJzZXR0aW5ncyIsInJlYWQiLCJNQ01NZXRhZGF0YUlkZW50aWZpZXIiLCJidW5kbGVQYXRoRGlycyIsImJ1bmRsZVBhdGhQYWlycyIsInJlZHVjZSIsImJ1bmRsZU1hcCIsImJ1bmRsZVBhdGgiLCJkZXZpY2VBcnIiLCJ0b1BhaXJzIiwiZ2V0RGV2aWNlcyIsImRldmljZSIsImZpbGVzIiwicHYiLCJtYXAiLCJzIiwiZXhpc3RlbmNlcyIsImYiLCJoYXNBY2Nlc3MiLCJmcmVzaCIsImNvbXBhY3QiLCJpc1J1bm5pbmciLCJzdGF0ZSIsIndhaXRGb3JCb290IiwiYm9vdGVkSW5kaWNhdG9yIiwiZ2V0Qm9vdGVkSW5kaWNhdG9yU3RyaW5nIiwidGFpbExvZ3NVbnRpbCIsIkIiLCJkZWxheSIsImVtaXQiLCJpbmRpY2F0b3IiLCJwbGF0Zm9ybVZlcnNpb24iLCJzdGFydFVJQ2xpZW50Iiwib3B0cyIsImFzc2lnbiIsInNjYWxlRmFjdG9yIiwiY29ubmVjdEhhcmR3YXJlS2V5Ym9hcmQiLCJhcmdzIiwiZm9ybWF0dGVkRGV2aWNlTmFtZSIsIm5hbWUiLCJyZXBsYWNlIiwiYXJndW1lbnROYW1lIiwiaXNCb29sZWFuIiwiaW5mbyIsImpvaW4iLCJ0aW1lb3V0IiwiaW5jbHVkZXMiLCJzdGRlcnIiLCJydW4iLCJpc1NlcnZlclJ1bm5pbmciLCJzdGFydFRpbWUiLCJocnRpbWUiLCJzaHV0ZG93biIsImNsZWFuIiwiZW5kU2ltdWxhdG9yRGFlbW9uIiwiZXJhc2VEZXZpY2UiLCJzY3J1YkN1c3RvbUFwcCIsImFwcEJ1bmRsZUlkIiwiY2xlYW5DdXN0b21BcHAiLCJzY3J1YiIsImRlbGV0ZVByb21pc2VzIiwicmltcmFmIiwicmVsUm1QYXRoIiwicm1QYXRoIiwiYWxsIiwiZGlycyIsImRhdGEiLCJidW5kbGUiLCJ1bmRlZmluZWQiLCJzcmMiLCJsYXVuY2hBbmRRdWl0Iiwic2FmYXJpIiwib3BlblVybCIsIkVycm9yIiwibGF1bmNoY3RsQ21kIiwic3RvcENtZCIsInJlbW92ZUNtZCIsIndhaXRNcyIsImludGVydmFsTXMiLCJkZWxldGUiLCJkZWxldGVEZXZpY2UiLCJ1cGRhdGVTZXR0aW5ncyIsInVwZGF0ZXMiLCJ1cGRhdGVMb2NhdGlvblNldHRpbmdzIiwiYXV0aG9yaXplZCIsInNldFJlZHVjZU1vdGlvbiIsInJlZHVjZU1vdGlvbiIsInNldERhcmtNb2RlIiwidXBkYXRlU2FmYXJpU2V0dGluZ3MiLCJ1cGRhdGVkIiwidXBkYXRlU2FmYXJpVXNlclNldHRpbmdzIiwidXBkYXRlU2FmYXJpR2xvYmFsU2V0dGluZ3MiLCJ1cGRhdGVMb2NhbGUiLCJsYW5ndWFnZSIsImxvY2FsZSIsImNhbGVuZGFyRm9ybWF0IiwiZGVsZXRlU2FmYXJpIiwiY2xlYW5TYWZhcmkiLCJrZWVwUHJlZnMiLCJsaWJyYXJ5RGlyIiwic2FmYXJpUm9vdCIsInNhZmFyaUxpYnJhcnlEaXIiLCJmaWxlc1RvRGVsZXRlIiwicmVtb3ZlQXBwIiwibW92ZUJ1aWx0SW5BcHAiLCJhcHBOYW1lIiwiYXBwUGF0aCIsIm5ld0FwcFBhdGgiLCJjb3B5RmlsZSIsInVybCIsIlNBRkFSSV9CT09URURfSU5ESUNBVE9SIiwiU0FGQVJJX1NUQVJUVVBfVElNRU9VVCIsImNsZWFyQ2FjaGVzIiwiZm9sZGVyTmFtZXMiLCJjYWNoZXNSb290IiwiaXRlbXNUb1JlbW92ZSIsIngiLCJmaWx0ZXIiLCJpc0RpcmVjdG9yeSIsInRpbWVvdXRNcyIsInNpbUxvZyIsImVuYWJsZUNhbGVuZGFyQWNjZXNzIiwiYnVuZGxlSUQiLCJkaXNhYmxlQ2FsZW5kYXJBY2Nlc3MiLCJoYXNDYWxlbmRhckFjY2VzcyIsIl9hY3RpdmF0ZVdpbmRvdyIsImV4ZWN1dGVVSUNsaWVudFNjcmlwdCIsImFwcGxlU2NyaXB0Iiwid2luZG93QWN0aXZhdGlvblNjcmlwdCIsInJlc3VsdFNjcmlwdCIsImFjcXVpcmUiLCJlcnJvckFuZFRocm93IiwiaXNCaW9tZXRyaWNFbnJvbGxlZCIsIm91dHB1dCIsImlzU3RyaW5nIiwiZW5yb2xsQmlvbWV0cmljIiwiaXNFbmFibGVkIiwic2VuZEJpb21ldHJpY01hdGNoIiwic2hvdWxkTWF0Y2giLCJkaXNtaXNzRGF0YWJhc2VBbGVydCIsImluY3JlYXNlIiwiYnV0dG9uIiwiYmFja3VwS2V5Y2hhaW5zIiwiYmFja3VwUGF0aCIsInRlbXBEaXIiLCJwcmVmaXgiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJ0b1N0cmluZyIsInN1YnN0cmluZyIsInN1ZmZpeCIsInppcEFyZ3MiLCJzZXAiLCJfa2V5Y2hhaW5zQmFja3VwUGF0aCIsInVubGluayIsInJlc3RvcmVLZXljaGFpbnMiLCJleGNsdWRlUGF0dGVybnMiLCJzcGxpdCIsInBsaXN0UGF0aCIsImdldExhdW5jaERhZW1vbnNSb290Iiwic3Bhd24iLCJ1bnppcEFyZ3MiLCJmbGF0TWFwIiwiY2xlYXJLZXljaGFpbnMiLCJzZXRQZXJtaXNzaW9uIiwicGVybWlzc2lvbiIsInZhbHVlIiwic2V0UGVybWlzc2lvbnMiLCJwZXJtaXNzaW9uc01hcHBpbmciLCJzZXRBY2Nlc3MiLCJKU09OIiwic3RyaW5naWZ5IiwiZ2V0UGVybWlzc2lvbiIsInNlcnZpY2VOYW1lIiwicmVzdWx0IiwiZ2V0QWNjZXNzIiwiZGV2Um9vdCIsIl9nZXREZXZpY2VTdHJpbmdQbGF0Zm9ybVZlcnNpb24iLCJyZXFWZXJzaW9uIiwieGNvZGUiLCJnZXRNYXhJT1NTREsiLCJfZ2V0RGV2aWNlU3RyaW5nVmVyc2lvblN0cmluZyIsIl9nZXREZXZpY2VTdHJpbmdDb25maWdGaXgiLCJnZXREZXZpY2VTdHJpbmciLCJkZXZpY2VOYW1lIiwiZm9yY2VJcGhvbmUiLCJmb3JjZUlwYWQiLCJsb2dPcHRzIiwiaXNpUGhvbmUiLCJpbmRleE9mIiwiaW9zRGV2aWNlU3RyaW5nIiwidGVzdCIsIkNPTkZJR19GSVgiLCJjb25maWdGaXgiLCJnZXRXZWJJbnNwZWN0b3JTb2NrZXQiLCJjbWQiLCJmbiIsImV4dGVuc2lvbnMiLCJwcm90b3R5cGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFHQSxNQUFNQSxlQUFlLEdBQUcsS0FBSyxJQUE3QjtBQUNBLE1BQU1DLGtCQUFrQixHQUFHLElBQTNCO0FBQ0EsTUFBTUMsc0JBQXNCLEdBQUcsSUFBSUMsa0JBQUosRUFBL0I7QUFDQSxNQUFNQyxtQkFBbUIsR0FBRywyQkFBNUI7QUFDQSxNQUFNQyxxQkFBcUIsR0FBRyx1QkFBOUI7O0FBVUEsTUFBTUMsb0JBQW9CLEdBQUcsZUFBN0I7OztBQUdBLE1BQU1DLGVBQU4sU0FBOEJDLG9CQUE5QixDQUEyQztBQVF6Q0MsRUFBQUEsV0FBVyxDQUFFQyxJQUFGLEVBQVFDLFlBQVIsRUFBc0I7QUFDL0I7QUFFQSxTQUFLRCxJQUFMLEdBQVlFLE1BQU0sQ0FBQ0YsSUFBRCxDQUFsQjtBQUNBLFNBQUtDLFlBQUwsR0FBb0JBLFlBQXBCO0FBS0EsU0FBS0UsZ0JBQUwsR0FBd0IsSUFBeEI7QUFFQSxTQUFLQyxZQUFMLEdBQW9CQyxjQUFLQyxPQUFMLENBQWEsS0FBS0MsTUFBTCxFQUFiLEVBQTRCLFNBQTVCLEVBQXVDLFdBQXZDLENBQXBCO0FBQ0EsU0FBS0MsWUFBTCxHQUFvQixtQkFB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QUFqQjs7QUFFQSxRQUFJVyxTQUFTLEdBQUdELFVBQWhCOztBQUNBLFFBQUlDLFNBQVMsQ0FBQ0gsZUFBRCxDQUFiLEVBQWdDO0FBQzlCQSxNQUFBQSxlQUFlLEdBQUdHLFNBQVMsQ0FBQ0gsZUFBRCxDQUEzQjs7QUFDQTVQLHNCQUFJQyxLQUFKLENBQVcsZ0NBQStCNkYsSUFBSSxDQUFDd0osVUFBVyxJQUFoRCxHQUNDLE9BQU1NLGVBQWdCLEdBRGpDO0FBRUQ7O0FBRUQ1UCxvQkFBSUMsS0FBSixDQUFXLDJCQUEwQjJQLGVBQWdCLEdBQXJEOztBQUNBLFdBQU9BLGVBQVA7QUFDRDs7QUFNRCxRQUFNSSxxQkFBTixHQUErQjtBQUU3QixXQUFPLElBQVA7QUFDRDs7QUF6eUN3Qzs7OztBQTR5QzNDLEtBQUssSUFBSSxDQUFDQyxHQUFELEVBQU1DLEVBQU4sQ0FBVCxJQUFzQi9QLGdCQUFFbUUsT0FBRixDQUFVNkwsY0FBVixDQUF0QixFQUE2QztBQUMzQzdSLEVBQUFBLGVBQWUsQ0FBQzhSLFNBQWhCLENBQTBCSCxHQUExQixJQUFpQ0MsRUFBakM7QUFDRDs7ZUFFYzVSLGUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCAqIGFzIHNpbWN0bCBmcm9tICdub2RlLXNpbWN0bCc7XG5pbXBvcnQgeyBkZWZhdWx0IGFzIHhjb2RlLCBnZXRQYXRoIGFzIGdldFhjb2RlUGF0aCB9IGZyb20gJ2FwcGl1bS14Y29kZSc7XG5pbXBvcnQgbG9nIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCB7IGZzLCB0ZW1wRGlyLCBta2RpcnAsIHBsaXN0IH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBBc3luY0xvY2sgZnJvbSAnYXN5bmMtbG9jayc7XG5pbXBvcnQgeyBraWxsQWxsU2ltdWxhdG9ycywgc2FmZVJpbVJhZiwgZ2V0RGV2ZWxvcGVyUm9vdCB9IGZyb20gJy4vdXRpbHMuanMnO1xuaW1wb3J0IHsgYXN5bmNtYXAsIHJldHJ5SW50ZXJ2YWwsIHdhaXRGb3JDb25kaXRpb24sIHJldHJ5IH0gZnJvbSAnYXN5bmNib3gnO1xuaW1wb3J0ICogYXMgc2V0dGluZ3MgZnJvbSAnLi9zZXR0aW5ncyc7XG5pbXBvcnQgeyBleGVjIH0gZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCB7IHRhaWxVbnRpbCB9IGZyb20gJy4vdGFpbC11bnRpbC5qcyc7XG5pbXBvcnQgZXh0ZW5zaW9ucyBmcm9tICcuL2V4dGVuc2lvbnMvaW5kZXgnO1xuaW1wb3J0IHsgRXZlbnRFbWl0dGVyIH0gZnJvbSAnZXZlbnRzJztcbmltcG9ydCBDYWxlbmRhciBmcm9tICcuL2NhbGVuZGFyJztcbmltcG9ydCBQZXJtaXNzaW9ucyBmcm9tICcuL3Blcm1pc3Npb25zJztcblxuXG5jb25zdCBTVEFSVFVQX1RJTUVPVVQgPSA2MCAqIDEwMDA7XG5jb25zdCBFWFRSQV9TVEFSVFVQX1RJTUUgPSAyMDAwO1xuY29uc3QgVUlfQ0xJRU5UX0FDQ0VTU19HVUFSRCA9IG5ldyBBc3luY0xvY2soKTtcbmNvbnN0IFVJX0NMSUVOVF9CVU5ETEVfSUQgPSAnY29tLmFwcGxlLmlwaG9uZXNpbXVsYXRvcic7XG5jb25zdCBTUFJJTkdCT0FSRF9CVU5ETEVfSUQgPSAnY29tLmFwcGxlLlNwcmluZ0JvYXJkJztcblxuLypcbiAqIFRoaXMgZXZlbnQgaXMgZW1pdHRlZCBhcyBzb29uIGFzIGlPUyBTaW11bGF0b3JcbiAqIGhhcyBmaW5pc2hlZCBib290aW5nIGFuZCBpdCBpcyByZWFkeSB0byBhY2NlcHQgeGNydW4gY29tbWFuZHMuXG4gKiBUaGUgZXZlbnQgaGFuZGxlciBpcyBjYWxsZWQgYWZ0ZXIgJ3J1bicgbWV0aG9kIGlzIGNvbXBsZXRlZFxuICogZm9yIFhjb2RlIDcgYW5kIG9sZGVyIGFuZCBpcyBvbmx5IHVzZWZ1bCBpbiBYY29kZSA4KyxcbiAqIHNpbmNlIG9uZSBjYW4gc3RhcnQgZG9pbmcgc3R1ZmYgKGZvciBleGFtcGxlIGluc3RhbGwvdW5pbnN0YWxsIGFuIGFwcCkgaW4gcGFyYWxsZWxcbiAqIHdpdGggU2ltdWxhdG9yIFVJIHN0YXJ0dXAsIHdoaWNoIHNob3J0ZW5zIHNlc3Npb24gc3RhcnR1cCB0aW1lLlxuICovXG5jb25zdCBCT09UX0NPTVBMRVRFRF9FVkVOVCA9ICdib290Q29tcGxldGVkJztcblxuXG5jbGFzcyBTaW11bGF0b3JYY29kZTYgZXh0ZW5kcyBFdmVudEVtaXR0ZXIge1xuXG4gIC8qKlxuICAgKiBDb25zdHJ1Y3RzIHRoZSBvYmplY3Qgd2l0aCB0aGUgYHVkaWRgIGFuZCB2ZXJzaW9uIG9mIFhjb2RlLiBVc2UgdGhlIGV4cG9ydGVkIGBnZXRTaW11bGF0b3IodWRpZClgIG1ldGhvZCBpbnN0ZWFkLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gdWRpZCAtIFRoZSBTaW11bGF0b3IgSUQuXG4gICAqIEBwYXJhbSB7b2JqZWN0fSB4Y29kZVZlcnNpb24gLSBUaGUgdGFyZ2V0IFhjb2RlIHZlcnNpb24gaW4gZm9ybWF0IHttYWpvciwgbWlub3IsIGJ1aWxkfS5cbiAgICovXG4gIGNvbnN0cnVjdG9yICh1ZGlkLCB4Y29kZVZlcnNpb24pIHtcbiAgICBzdXBlcigpO1xuXG4gICAgdGhpcy51ZGlkID0gU3RyaW5nKHVkaWQpO1xuICAgIHRoaXMueGNvZGVWZXJzaW9uID0geGNvZGVWZXJzaW9uO1xuXG4gICAgLy8gcGxhdGZvcm1WZXJzaW9uIGNhbm5vdCBiZSBmb3VuZCBpbml0aWFsbHksIHNpbmNlIGdldHRpbmcgaXQgaGFzIHNpZGUgZWZmZWN0cyBmb3JcbiAgICAvLyBvdXIgbG9naWMgZm9yIGZpZ3VyaW5nIG91dCBpZiBhIHNpbSBoYXMgYmVlbiBydW5cbiAgICAvLyBpdCB3aWxsIGJlIHNldCB3aGVuIGl0IGlzIG5lZWRlZFxuICAgIHRoaXMuX3BsYXRmb3JtVmVyc2lvbiA9IG51bGw7XG5cbiAgICB0aGlzLmtleWNoYWluUGF0aCA9IHBhdGgucmVzb2x2ZSh0aGlzLmdldERpcigpLCAnTGlicmFyeScsICdLZXljaGFpbnMnKTtcbiAgICB0aGlzLnNpbXVsYXRvckFwcCA9ICdpT1MgU2ltdWxhdG9yLmFwcCc7XG5cbiAgICB0aGlzLmFwcERhdGFCdW5kbGVQYXRocyA9IHt9O1xuXG4gICAgLy8gbGlzdCBvZiBmaWxlcyB0byBjaGVjayBmb3Igd2hlbiBzZWVpbmcgaWYgYSBzaW11bGF0b3IgaXMgXCJmcmVzaFwiXG4gICAgLy8gKG1lYW5pbmcgaXQgaGFzIG5ldmVyIGJlZW4gYm9vdGVkKS5cbiAgICAvLyBJZiB0aGVzZSBmaWxlcyBhcmUgcHJlc2VudCwgd2UgYXNzdW1lIGl0J3MgYmVlbiBzdWNjZXNzZnVsbHkgYm9vdGVkXG4gICAgdGhpcy5pc0ZyZXNoRmlsZXMgPSBbXG4gICAgICAnTGlicmFyeS9Db25maWd1cmF0aW9uUHJvZmlsZXMnLFxuICAgICAgJ0xpYnJhcnkvQ29va2llcycsXG4gICAgICAnTGlicmFyeS9QcmVmZXJlbmNlcy8uR2xvYmFsUHJlZmVyZW5jZXMucGxpc3QnLFxuICAgICAgJ0xpYnJhcnkvUHJlZmVyZW5jZXMvY29tLmFwcGxlLnNwcmluZ2JvYXJkLnBsaXN0JyxcbiAgICAgICd2YXIvcnVuL3N5c2xvZy5waWQnXG4gICAgXTtcblxuICAgIC8vIGV4dHJhIHRpbWUgdG8gd2FpdCBmb3Igc2ltdWxhdG9yIHRvIGJlIGRlZW1lZCBib290ZWRcbiAgICB0aGlzLmV4dHJhU3RhcnR1cFRpbWUgPSBFWFRSQV9TVEFSVFVQX1RJTUU7XG5cbiAgICB0aGlzLmNhbGVuZGFyID0gbmV3IENhbGVuZGFyKHhjb2RlVmVyc2lvbiwgdGhpcy5nZXREaXIoKSk7XG4gICAgdGhpcy5wZXJtaXNzaW9ucyA9IG5ldyBQZXJtaXNzaW9ucyh4Y29kZVZlcnNpb24sIHRoaXMuZ2V0RGlyKCksIHRoaXMudWRpZCk7XG4gIH1cblxuICAvKipcbiAgICogQHJldHVybiB7c3RyaW5nfSBCdW5kbGUgaWRlbnRpZmllciBvZiBTaW11bGF0b3IgVUkgY2xpZW50LlxuICAgKi9cbiAgZ2V0IHVpQ2xpZW50QnVuZGxlSWQgKCkge1xuICAgIHJldHVybiBVSV9DTElFTlRfQlVORExFX0lEO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyB0aGUgY3VycmVudCBwcm9jZXNzIGlkIG9mIHRoZSBVSSBjbGllbnRcbiAgICpcbiAgICogQHJldHVybiB7P3N0cmluZ30gVGhlIHByb2Nlc3MgSUQgb3IgbnVsbCBpZiB0aGUgVUkgY2xpZW50IGlzIG5vdCBydW5uaW5nXG4gICAqL1xuICBhc3luYyBnZXRVSUNsaWVudFBpZCAoKSB7XG4gICAgbGV0IHN0ZG91dDtcbiAgICB0cnkge1xuICAgICAgKHtzdGRvdXR9ID0gYXdhaXQgZXhlYygncGdyZXAnLCBbJy1mbicsIGAke3RoaXMuc2ltdWxhdG9yQXBwfS9Db250ZW50cy9NYWNPUy9gXSkpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBpZiAoaXNOYU4ocGFyc2VJbnQoc3Rkb3V0LCAxMCkpKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgc3Rkb3V0ID0gc3Rkb3V0LnRyaW0oKTtcbiAgICBsb2cuZGVidWcoYEdvdCBTaW11bGF0b3IgVUkgY2xpZW50IFBJRDogJHtzdGRvdXR9YCk7XG4gICAgcmV0dXJuIHN0ZG91dDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayB0aGUgc3RhdGUgb2YgU2ltdWxhdG9yIFVJIGNsaWVudC5cbiAgICpcbiAgICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBvZiBpZiBVSSBjbGllbnQgaXMgcnVubmluZyBvciBmYWxzZSBvdGhlcndpc2UuXG4gICAqL1xuICBhc3luYyBpc1VJQ2xpZW50UnVubmluZyAoKSB7XG4gICAgcmV0dXJuICFfLmlzTnVsbChhd2FpdCB0aGlzLmdldFVJQ2xpZW50UGlkKCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEhvdyBsb25nIHRvIHdhaXQgYmVmb3JlIHRocm93aW5nIGFuIGVycm9yIGFib3V0IFNpbXVsYXRvciBzdGFydHVwIHRpbWVvdXQgaGFwcGVuZWQuXG4gICAqXG4gICAqIEByZXR1cm4ge251bWJlcn0gVGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMuXG4gICAqL1xuICBnZXQgc3RhcnR1cFRpbWVvdXQgKCkge1xuICAgIHJldHVybiBTVEFSVFVQX1RJTUVPVVQ7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBwbGF0Zm9ybSB2ZXJzaW9uIG9mIHRoZSBjdXJyZW50IFNpbXVsYXRvci5cbiAgICpcbiAgICogQHJldHVybiB7c3RyaW5nfSBTREsgdmVyc2lvbiwgZm9yIGV4YW1wbGUgJzguMycuXG4gICAqL1xuICBhc3luYyBnZXRQbGF0Zm9ybVZlcnNpb24gKCkge1xuICAgIGlmICghdGhpcy5fcGxhdGZvcm1WZXJzaW9uKSB7XG4gICAgICBsZXQge3Nka30gPSBhd2FpdCB0aGlzLnN0YXQoKTtcbiAgICAgIHRoaXMuX3BsYXRmb3JtVmVyc2lvbiA9IHNkaztcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX3BsYXRmb3JtVmVyc2lvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSB0aGUgZnVsbCBwYXRoIHRvIHRoZSBkaXJlY3Rvcnkgd2hlcmUgU2ltdWxhdG9yIHN0dWZmIGlzIGxvY2F0ZWQuXG4gICAqXG4gICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIHBhdGggc3RyaW5nLlxuICAgKi9cbiAgZ2V0Um9vdERpciAoKSB7XG4gICAgbGV0IGhvbWUgPSBwcm9jZXNzLmVudi5IT01FO1xuICAgIHJldHVybiBwYXRoLnJlc29sdmUoaG9tZSwgJ0xpYnJhcnknLCAnRGV2ZWxvcGVyJywgJ0NvcmVTaW11bGF0b3InLCAnRGV2aWNlcycpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlIHRoZSBmdWxsIHBhdGggdG8gdGhlIGRpcmVjdG9yeSB3aGVyZSBTaW11bGF0b3IgYXBwbGljYXRpb25zIGRhdGEgaXMgbG9jYXRlZC5cbiAgICpcbiAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgcGF0aCBzdHJpbmcuXG4gICAqL1xuICBnZXREaXIgKCkge1xuICAgIHJldHVybiBwYXRoLnJlc29sdmUodGhpcy5nZXRSb290RGlyKCksIHRoaXMudWRpZCwgJ2RhdGEnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSB0aGUgZnVsbCBwYXRoIHRvIHRoZSBkaXJlY3Rvcnkgd2hlcmUgU2ltdWxhdG9yIGxvZ3MgYXJlIHN0b3JlZC5cbiAgICpcbiAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgcGF0aCBzdHJpbmcuXG4gICAqL1xuICBnZXRMb2dEaXIgKCkge1xuICAgIGxldCBob21lID0gcHJvY2Vzcy5lbnYuSE9NRTtcbiAgICByZXR1cm4gcGF0aC5yZXNvbHZlKGhvbWUsICdMaWJyYXJ5JywgJ0xvZ3MnLCAnQ29yZVNpbXVsYXRvcicsIHRoaXMudWRpZCk7XG4gIH1cblxuICAvKipcbiAgICogSW5zdGFsbCB2YWxpZCAuYXBwIHBhY2thZ2Ugb24gU2ltdWxhdG9yLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYXBwIC0gVGhlIHBhdGggdG8gdGhlIC5hcHAgcGFja2FnZS5cbiAgICovXG4gIGFzeW5jIGluc3RhbGxBcHAgKGFwcCkge1xuICAgIHJldHVybiBhd2FpdCBzaW1jdGwuaW5zdGFsbEFwcCh0aGlzLnVkaWQsIGFwcCk7XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZ5IHdoZXRoZXIgdGhlIHBhcnRpY3VsYXIgYXBwbGljYXRpb24gaXMgaW5zdGFsbGVkIG9uIFNpbXVsYXRvci5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gVGhlIGJ1bmRsZSBpZCBvZiB0aGUgYXBwbGljYXRpb24gdG8gYmUgY2hlY2tlZC5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGFwcEZ1bGUgLSBBcHBsaWNhdGlvbiBuYW1lIG1pbnVzIFwiLmFwcFwiIChmb3IgaU9TIDcuMSlcbiAgICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgZ2l2ZW4gYXBwbGljYXRpb24gaXMgaW5zdGFsbGVkXG4gICAqL1xuICBhc3luYyBpc0FwcEluc3RhbGxlZCAoYnVuZGxlSWQsIGFwcEZpbGUgPSBudWxsKSB7XG4gICAgLy8gYGFwcEZpbGVgIGFyZ3VtZW50IG9ubHkgbmVjZXNzYXJ5IGZvciBpT1MgYmVsb3cgdmVyc2lvbiA4XG4gICAgbGV0IGFwcERpcnMgPSBhd2FpdCB0aGlzLmdldEFwcERpcnMoYXBwRmlsZSwgYnVuZGxlSWQpO1xuICAgIHJldHVybiBhcHBEaXJzLmxlbmd0aCAhPT0gMDtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHVzZXIgaW5zdGFsbGVkIGJ1bmRsZSBpZHMgd2hpY2ggaGFzICdidW5kbGVOYW1lJyBpbiB0aGVpciBJbmZvLlBsaXN0IGFzICdDRkJ1bmRsZU5hbWUnXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJZCAtIFRoZSBidW5kbGUgaWQgb2YgdGhlIGFwcGxpY2F0aW9uIHRvIGJlIGNoZWNrZWQuXG4gICAqIEByZXR1cm4ge2FycmF5PHN0cmluZz59IC0gVGhlIGxpc3Qgb2YgYnVuZGxlIGlkcyB3aGljaCBoYXZlICdidW5kbGVOYW1lJ1xuICAgKi9cbiAgYXN5bmMgZ2V0VXNlckluc3RhbGxlZEJ1bmRsZUlkc0J5QnVuZGxlTmFtZSAoYnVuZGxlTmFtZSkge1xuICAgIGNvbnN0IHJvb3RVc2VyQXBwRGlyID0gYXdhaXQgdGhpcy5idWlsZEJ1bmRsZVBhdGhNYXAoJ0J1bmRsZScpO1xuICAgIGNvbnN0IGJ1bmRsZUlkcyA9IFtdO1xuICAgIGlmIChfLmlzRW1wdHkocm9vdFVzZXJBcHBEaXIpKSB7XG4gICAgICByZXR1cm4gYnVuZGxlSWRzO1xuICAgIH1cblxuICAgIGZvciAoY29uc3QgW2J1bmRsZUlkLCB1c2VyQXBwRGlyUGF0aF0gb2YgT2JqZWN0LmVudHJpZXMocm9vdFVzZXJBcHBEaXIpKSB7XG4gICAgICBjb25zdCBhcHBGaWxlID0gKGF3YWl0IGZzLnJlYWRkaXIodXNlckFwcERpclBhdGgpKS5maW5kKFxuICAgICAgICAoZmlsZSkgPT4gcGF0aC5leHRuYW1lKGZpbGUpLnRvTG93ZXJDYXNlKCkgPT09ICcuYXBwJyk7XG4gICAgICBjb25zdCBpbmZvUGxpc3RQYXRoID0gcGF0aC5yZXNvbHZlKHVzZXJBcHBEaXJQYXRoLCBhcHBGaWxlLCAnSW5mby5wbGlzdCcpO1xuICAgICAgaWYgKCFhd2FpdCBmcy5leGlzdHMoaW5mb1BsaXN0UGF0aCkpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBpbmZvUGxpc3QgPSBhd2FpdCBwbGlzdC5wYXJzZVBsaXN0RmlsZShpbmZvUGxpc3RQYXRoLCBmYWxzZSk7XG4gICAgICAgIGlmIChpbmZvUGxpc3QuQ0ZCdW5kbGVOYW1lID09PSBidW5kbGVOYW1lKSB7XG4gICAgICAgICAgYnVuZGxlSWRzLnB1c2goYnVuZGxlSWQpO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgbG9nLndhcm4oYEZhaWxlZCB0byByZWFkIHBsaXN0ICR7aW5mb1BsaXN0UGF0aH0uIE9yaWdpbmFsIGVycm9yICcke2Vyci5tZXNzYWdlfSdgKTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgfVxuICAgIGxvZy5kZWJ1ZyhgVGhlIHNpbXVsYXRvciBoYXMgJyR7YnVuZGxlSWRzLmxlbmd0aH0nIGJ1bmRsZXMgd2hpY2ggaGF2ZSAnJHtidW5kbGVOYW1lfScgYXMgdGhlaXIgJ0NGQnVuZGxlTmFtZSc6YCk7XG4gICAgZm9yIChjb25zdCBidW5kbGVJZCBvZiBidW5kbGVJZHMpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgICAgICcke2J1bmRsZUlkfSdgKTtcbiAgICB9XG4gICAgcmV0dXJuIGJ1bmRsZUlkcztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSB0aGUgZGlyZWN0b3J5IGZvciBhIHBhcnRpY3VsYXIgYXBwbGljYXRpb24ncyBkYXRhLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gaWQgLSBFaXRoZXIgYSBidW5kbGVJZCAoZS5nLiwgY29tLmFwcGxlLm1vYmlsZXNhZmFyaSkgb3IsIGZvciBpT1MgNy4xLCB0aGUgYXBwIG5hbWUgd2l0aG91dCBgLmFwcGAgKGUuZy4sIE1vYmlsZVNhZmFyaSlcbiAgICogQHBhcmFtIHtzdHJpbmd9IHN1YmRpciAtIFRoZSBzdWItZGlyZWN0b3J5IHdlIGV4cGVjdCB0byBiZSB3aXRoaW4gdGhlIGFwcGxpY2F0aW9uIGRpcmVjdG9yeS4gRGVmYXVsdHMgdG8gXCJEYXRhXCIuXG4gICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIHJvb3QgYXBwbGljYXRpb24gZm9sZGVyLlxuICAgKi9cbiAgYXN5bmMgZ2V0QXBwRGlyIChpZCwgc3ViRGlyID0gJ0RhdGEnKSB7XG4gICAgdGhpcy5hcHBEYXRhQnVuZGxlUGF0aHNbc3ViRGlyXSA9IHRoaXMuYXBwRGF0YUJ1bmRsZVBhdGhzW3N1YkRpcl0gfHwge307XG4gICAgaWYgKF8uaXNFbXB0eSh0aGlzLmFwcERhdGFCdW5kbGVQYXRoc1tzdWJEaXJdKSAmJiAhYXdhaXQgdGhpcy5pc0ZyZXNoKCkpIHtcbiAgICAgIHRoaXMuYXBwRGF0YUJ1bmRsZVBhdGhzW3N1YkRpcl0gPSBhd2FpdCB0aGlzLmJ1aWxkQnVuZGxlUGF0aE1hcChzdWJEaXIpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5hcHBEYXRhQnVuZGxlUGF0aHNbc3ViRGlyXVtpZF07XG4gIH1cblxuICAvKipcbiAgICogVGhlIHhjb2RlIDYgc2ltdWxhdG9ycyBhcmUgcmVhbGx5IGFubm95aW5nLCBhbmQgYnVyeSB0aGUgbWFpbiBhcHBcbiAgICogZGlyZWN0b3JpZXMgaW5zaWRlIGRpcmVjdG9yaWVzIGp1c3QgbmFtZWQgd2l0aCBIYXNoZXMuXG4gICAqIFRoaXMgZnVuY3Rpb24gZmluZHMgdGhlIHByb3BlciBkaXJlY3RvcnkgYnkgdHJhdmVyc2luZyBhbGwgb2YgdGhlbVxuICAgKiBhbmQgcmVhZGluZyBhIG1ldGFkYXRhIHBsaXN0IChNb2JpbGUgQ29udGFpbmVyIE1hbmFnZXIpIHRvIGdldCB0aGVcbiAgICogYnVuZGxlIGlkLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gc3ViZGlyIC0gVGhlIHN1Yi1kaXJlY3Rvcnkgd2UgZXhwZWN0IHRvIGJlIHdpdGhpbiB0aGUgYXBwbGljYXRpb24gZGlyZWN0b3J5LiBEZWZhdWx0cyB0byBcIkRhdGFcIi5cbiAgICogQHJldHVybiB7b2JqZWN0fSBUaGUgbGlzdCBvZiBwYXRoLWJ1bmRsZSBwYWlycyB0byBhbiBvYmplY3Qgd2hlcmUgYnVuZGxlSWRzIGFyZSBtYXBwZWQgdG8gcGF0aHMuXG4gICAqL1xuICBhc3luYyBidWlsZEJ1bmRsZVBhdGhNYXAgKHN1YkRpciA9ICdEYXRhJykge1xuICAgIGxvZy5kZWJ1ZygnQnVpbGRpbmcgYnVuZGxlIHBhdGggbWFwJyk7XG4gICAgbGV0IGFwcGxpY2F0aW9uTGlzdDtcbiAgICBsZXQgcGF0aEJ1bmRsZVBhaXI7XG4gICAgaWYgKGF3YWl0IHRoaXMuZ2V0UGxhdGZvcm1WZXJzaW9uKCkgPT09ICc3LjEnKSB7XG4gICAgICAvLyBhcHBzIGF2YWlsYWJsZVxuICAgICAgLy8gICBXZWIuYXBwLFxuICAgICAgLy8gICBXZWJWaWV3U2VydmljZS5hcHAsXG4gICAgICAvLyAgIE1vYmlsZVNhZmFyaS5hcHAsXG4gICAgICAvLyAgIFdlYkNvbnRlbnRBbmFseXNpc1VJLmFwcCxcbiAgICAgIC8vICAgRERBY3Rpb25zU2VydmljZS5hcHAsXG4gICAgICAvLyAgIFN0b3JlS2l0VUlTZXJ2aWNlLmFwcFxuICAgICAgYXBwbGljYXRpb25MaXN0ID0gcGF0aC5yZXNvbHZlKHRoaXMuZ2V0RGlyKCksICdBcHBsaWNhdGlvbnMnKTtcbiAgICAgIHBhdGhCdW5kbGVQYWlyID0gYXN5bmMgKGRpcikgPT4ge1xuICAgICAgICBkaXIgPSBwYXRoLnJlc29sdmUoYXBwbGljYXRpb25MaXN0LCBkaXIpO1xuICAgICAgICBsZXQgYXBwRmlsZXMgPSBhd2FpdCBmcy5nbG9iKGAke2Rpcn0vKi5hcHBgKTtcbiAgICAgICAgbGV0IGJ1bmRsZUlkID0gYXBwRmlsZXNbMF0ubWF0Y2goLy4qXFwvKC4qKVxcLmFwcC8pWzFdO1xuICAgICAgICByZXR1cm4ge3BhdGg6IGRpciwgYnVuZGxlSWR9O1xuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXBwbGljYXRpb25MaXN0ID0gcGF0aC5yZXNvbHZlKHRoaXMuZ2V0RGlyKCksICdDb250YWluZXJzJywgc3ViRGlyLCAnQXBwbGljYXRpb24nKTtcbiAgICAgIC8vIGdpdmVuIGEgZGlyZWN0b3J5LCBmaW5kIHRoZSBwbGlzdCBmaWxlIGFuZCBwdWxsIHRoZSBidW5kbGUgaWQgZnJvbSBpdFxuICAgICAgbGV0IHJlYWRCdW5kbGVJZCA9IGFzeW5jIChkaXIpID0+IHtcbiAgICAgICAgbGV0IHBsaXN0ID0gcGF0aC5yZXNvbHZlKGRpciwgJy5jb20uYXBwbGUubW9iaWxlX2NvbnRhaW5lcl9tYW5hZ2VyLm1ldGFkYXRhLnBsaXN0Jyk7XG4gICAgICAgIGxldCBtZXRhZGF0YSA9IGF3YWl0IHNldHRpbmdzLnJlYWQocGxpc3QpO1xuICAgICAgICByZXR1cm4gbWV0YWRhdGEuTUNNTWV0YWRhdGFJZGVudGlmaWVyO1xuICAgICAgfTtcbiAgICAgIC8vIGdpdmVuIGEgZGlyZWN0b3J5LCByZXR1cm4gdGhlIHBhdGggYW5kIGJ1bmRsZSBpZCBhc3NvY2lhdGVkIHdpdGggaXRcbiAgICAgIHBhdGhCdW5kbGVQYWlyID0gYXN5bmMgKGRpcikgPT4ge1xuICAgICAgICBkaXIgPSBwYXRoLnJlc29sdmUoYXBwbGljYXRpb25MaXN0LCBkaXIpO1xuICAgICAgICBsZXQgYnVuZGxlSWQgPSBhd2FpdCByZWFkQnVuZGxlSWQoZGlyKTtcbiAgICAgICAgcmV0dXJuIHtwYXRoOiBkaXIsIGJ1bmRsZUlkfTtcbiAgICAgIH07XG4gICAgfVxuXG4gICAgaWYgKCFhd2FpdCBmcy5leGlzdHMoYXBwbGljYXRpb25MaXN0KSkge1xuICAgICAgbG9nLndhcm4oYE5vIGRpcmVjdG9yeSBwYXRoICcke2FwcGxpY2F0aW9uTGlzdH0nYCk7XG4gICAgICByZXR1cm4ge307XG4gICAgfVxuXG4gICAgbGV0IGJ1bmRsZVBhdGhEaXJzID0gYXdhaXQgZnMucmVhZGRpcihhcHBsaWNhdGlvbkxpc3QpO1xuICAgIGxldCBidW5kbGVQYXRoUGFpcnMgPSBhd2FpdCBhc3luY21hcChidW5kbGVQYXRoRGlycywgYXN5bmMgKGRpcikgPT4ge1xuICAgICAgcmV0dXJuIGF3YWl0IHBhdGhCdW5kbGVQYWlyKGRpcik7XG4gICAgfSwgZmFsc2UpO1xuXG4gICAgLy8gcmVkdWNlIHRoZSBsaXN0IG9mIHBhdGgtYnVuZGxlIHBhaXJzIHRvIGFuIG9iamVjdCB3aGVyZSBidW5kbGVJZHMgYXJlIG1hcHBlZCB0byBwYXRoc1xuICAgIHJldHVybiBidW5kbGVQYXRoUGFpcnMucmVkdWNlKChidW5kbGVNYXAsIGJ1bmRsZVBhdGgpID0+IHtcbiAgICAgIGJ1bmRsZU1hcFtidW5kbGVQYXRoLmJ1bmRsZUlkXSA9IGJ1bmRsZVBhdGgucGF0aDtcbiAgICAgIHJldHVybiBidW5kbGVNYXA7XG4gICAgfSwge30pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgc3RhdGUgYW5kIHNwZWNpZmljcyBvZiB0aGlzIHNpbS5cbiAgICpcbiAgICogQHJldHVybiB7b2JqZWN0fSBTaW11bGF0b3Igc3RhdHMgbWFwcGluZywgZm9yIGV4YW1wbGU6XG4gICAqIHsgbmFtZTogJ2lQaG9uZSA0cycsXG4gICAqICAgdWRpZDogJ0MwOUIzNEU1LTdEQ0ItNDQyRS1CNzlDLUFCNkJDMDM1NzQxNycsXG4gICAqICAgc3RhdGU6ICdTaHV0ZG93bicsXG4gICAqICAgc2RrOiAnOC4zJ1xuICAgKiB9XG4gICAqL1xuICBhc3luYyBzdGF0ICgpIHtcbiAgICBmb3IgKGxldCBbc2RrLCBkZXZpY2VBcnJdIG9mIF8udG9QYWlycyhhd2FpdCBzaW1jdGwuZ2V0RGV2aWNlcygpKSkge1xuICAgICAgZm9yIChsZXQgZGV2aWNlIG9mIGRldmljZUFycikge1xuICAgICAgICBpZiAoZGV2aWNlLnVkaWQgPT09IHRoaXMudWRpZCkge1xuICAgICAgICAgIGRldmljZS5zZGsgPSBzZGs7XG4gICAgICAgICAgcmV0dXJuIGRldmljZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7fTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGlzIGlzIGEgYmVzdC1iZXQgaGV1cmlzdGljIGZvciB3aGV0aGVyIG9yIG5vdCBhIHNpbSBoYXMgYmVlbiBib290ZWRcbiAgICogYmVmb3JlLiBXZSB1c3VhbGx5IHdhbnQgdG8gc3RhcnQgYSBzaW11bGF0b3IgdG8gXCJ3YXJtXCIgaXQgdXAsIGhhdmVcbiAgICogWGNvZGUgcG9wdWxhdGUgaXQgd2l0aCBwbGlzdHMgZm9yIHVzIHRvIG1hbmlwdWxhdGUgYmVmb3JlIGEgcmVhbFxuICAgKiB0ZXN0IHJ1bi5cbiAgICpcbiAgICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgY3VycmVudCBTaW11bGF0b3IgaGFzIG5ldmVyIGJlZW4gc3RhcnRlZCBiZWZvcmVcbiAgICovXG4gIGFzeW5jIGlzRnJlc2ggKCkge1xuICAgIC8vIGlmIHRoZSBmb2xsb3dpbmcgZmlsZXMgZG9uJ3QgZXhpc3QsIGl0IGhhc24ndCBiZWVuIGJvb3RlZC5cbiAgICAvLyBUSElTIElTIE5PVCBBTiBFWEhBVVNUSVZFIExJU1RcbiAgICBsZXQgZmlsZXMgPSB0aGlzLmlzRnJlc2hGaWxlcztcblxuICAgIGxldCBwdiA9IGF3YWl0IHRoaXMuZ2V0UGxhdGZvcm1WZXJzaW9uKCk7XG4gICAgaWYgKHB2ICE9PSAnNy4xJykge1xuICAgICAgZmlsZXMucHVzaCgnTGlicmFyeS9QcmVmZXJlbmNlcy9jb20uYXBwbGUuUHJlZmVyZW5jZXMucGxpc3QnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZmlsZXMucHVzaCgnQXBwbGljYXRpb25zJyk7XG4gICAgfVxuXG4gICAgY29uc3QgZGlyID0gdGhpcy5nZXREaXIoKTtcbiAgICBmaWxlcyA9IGZpbGVzLm1hcCgocykgPT4gcGF0aC5yZXNvbHZlKGRpciwgcykpO1xuXG4gICAgY29uc3QgZXhpc3RlbmNlcyA9IGF3YWl0IGFzeW5jbWFwKGZpbGVzLCBhc3luYyAoZikgPT4gYXdhaXQgZnMuaGFzQWNjZXNzKGYpKTtcbiAgICBjb25zdCBmcmVzaCA9IF8uY29tcGFjdChleGlzdGVuY2VzKS5sZW5ndGggIT09IGZpbGVzLmxlbmd0aDtcbiAgICBsb2cuZGVidWcoYENoZWNraW5nIHdoZXRoZXIgc2ltdWxhdG9yIGhhcyBiZWVuIHJ1biBiZWZvcmU6ICR7ZnJlc2ggPyAnbm8nIDogJ3llcyd9YCk7XG5cbiAgICByZXR1cm4gZnJlc2g7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmVzIHRoZSBzdGF0ZSBvZiB0aGUgY3VycmVudCBTaW11bGF0b3IuIE9uZSBzaG91bGQgZGlzdGluZ3Vpc2ggdGhlXG4gICAqIHN0YXRlcyBvZiBTaW11bGF0b3IgVUkgYW5kIHRoZSBTaW11bGF0b3IgaXRzZWxmLlxuICAgKlxuICAgKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSBjdXJyZW50IFNpbXVsYXRvciBpcyBydW5uaW5nLlxuICAgKi9cbiAgYXN5bmMgaXNSdW5uaW5nICgpIHtcbiAgICBsZXQgc3RhdCA9IGF3YWl0IHRoaXMuc3RhdCgpO1xuICAgIHJldHVybiBzdGF0LnN0YXRlID09PSAnQm9vdGVkJztcbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZnkgd2hldGhlciB0aGUgU2ltdWxhdG9yIGJvb3RpbmcgaXMgY29tcGxldGVkIGFuZC9vciB3YWl0IGZvciBpdFxuICAgKiB1bnRpbCB0aGUgdGltZW91dCBleHBpcmVzLlxuICAgKlxuICAgKiBAcGFyYW0ge251bWJlcn0gc3RhcnR1cFRpbWVvdXQgLSB0aGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byB3YWl0IHVudGlsIGJvb3RpbmcgaXMgY29tcGxldGVkLlxuICAgKiBAZW1pdHMgQk9PVF9DT01QTEVURURfRVZFTlQgaWYgdGhlIGN1cnJlbnQgU2ltdWxhdG9yIGlzIHJlYWR5IHRvIGFjY2VwdCBzaW1jdGwgY29tbWFuZHMsIGxpa2UgJ2luc3RhbGwnLlxuICAgKi9cbiAgYXN5bmMgd2FpdEZvckJvb3QgKHN0YXJ0dXBUaW1lb3V0KSB7XG4gICAgLy8gd2FpdCBmb3IgdGhlIHNpbXVsYXRvciB0byBib290XG4gICAgLy8gd2FpdGluZyBmb3IgdGhlIHNpbXVsYXRvciBzdGF0dXMgdG8gYmUgJ2Jvb3RlZCcgaXNuJ3QgZ29vZCBlbm91Z2hcbiAgICAvLyBpdCBjbGFpbXMgdG8gYmUgYm9vdGVkIHdheSBiZWZvcmUgZmluaXNoaW5nIGxvYWRpbmdcbiAgICAvLyBsZXQncyB0YWlsIHRoZSBzaW11bGF0b3Igc3lzdGVtIGxvZyB1bnRpbCB3ZSBzZWUgYSBtYWdpYyBsaW5lICh0aGlzLmJvb3RlZEluZGljYXRvcilcbiAgICBsZXQgYm9vdGVkSW5kaWNhdG9yID0gYXdhaXQgdGhpcy5nZXRCb290ZWRJbmRpY2F0b3JTdHJpbmcoKTtcbiAgICBhd2FpdCB0aGlzLnRhaWxMb2dzVW50aWwoYm9vdGVkSW5kaWNhdG9yLCBzdGFydHVwVGltZW91dCk7XG5cbiAgICAvLyBzbyBzb3JyeSwgYnV0IHdlIHNob3VsZCB3YWl0IGFub3RoZXIgdHdvIHNlY29uZHMsIGp1c3QgdG8gbWFrZSBzdXJlIHdlJ3ZlIHJlYWxseSBzdGFydGVkXG4gICAgLy8gd2UgY2FuJ3QgbG9vayBmb3IgYW5vdGhlciBtYWdpYyBsb2cgbGluZSwgYmVjYXVzZSB0aGV5IHNlZW0gdG8gYmUgYXBwLWRlcGVuZGVudCAobm90IHN5c3RlbSBkZXBlbmRlbnQpXG4gICAgbG9nLmRlYnVnKGBXYWl0aW5nIGFuIGV4dHJhICR7dGhpcy5leHRyYVN0YXJ0dXBUaW1lfW1zIGZvciB0aGUgc2ltdWxhdG9yIHRvIHJlYWxseSBmaW5pc2ggYm9vdGluZ2ApO1xuICAgIGF3YWl0IEIuZGVsYXkodGhpcy5leHRyYVN0YXJ0dXBUaW1lKTtcbiAgICBsb2cuZGVidWcoJ0RvbmUgd2FpdGluZyBleHRyYSB0aW1lIGZvciBzaW11bGF0b3InKTtcblxuICAgIHRoaXMuZW1pdChCT09UX0NPTVBMRVRFRF9FVkVOVCk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhIG1hZ2ljIHN0cmluZywgd2hpY2gsIGlmIHByZXNlbnQgaW4gbG9ncywgcmVmbGVjdHMgdGhlIGZhY3QgdGhhdCBzaW11bGF0b3IgYm9vdGluZyBoYXMgYmVlbiBjb21wbGV0ZWQuXG4gICAqXG4gICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIG1hZ2ljIGxvZyBzdHJpbmcuXG4gICAqL1xuICBhc3luYyBnZXRCb290ZWRJbmRpY2F0b3JTdHJpbmcgKCkge1xuICAgIGxldCBpbmRpY2F0b3I7XG4gICAgbGV0IHBsYXRmb3JtVmVyc2lvbiA9IGF3YWl0IHRoaXMuZ2V0UGxhdGZvcm1WZXJzaW9uKCk7XG4gICAgc3dpdGNoIChwbGF0Zm9ybVZlcnNpb24pIHtcbiAgICAgIGNhc2UgJzcuMSc6XG4gICAgICBjYXNlICc4LjEnOlxuICAgICAgY2FzZSAnOC4yJzpcbiAgICAgIGNhc2UgJzguMyc6XG4gICAgICBjYXNlICc4LjQnOlxuICAgICAgICBpbmRpY2F0b3IgPSAncHJvZmlsZWQ6IFNlcnZpY2Ugc3RhcnRpbmcuLi4nO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJzkuMCc6XG4gICAgICBjYXNlICc5LjEnOlxuICAgICAgY2FzZSAnOS4yJzpcbiAgICAgIGNhc2UgJzkuMyc6XG4gICAgICAgIGluZGljYXRvciA9ICdTeXN0ZW0gYXBwIFwiY29tLmFwcGxlLnNwcmluZ2JvYXJkXCIgZmluaXNoZWQgc3RhcnR1cCc7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnMTAuMCc6XG4gICAgICAgIGluZGljYXRvciA9ICdTd2l0Y2hpbmcgdG8ga2V5Ym9hcmQnO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGxvZy53YXJuKGBObyBib290IGluZGljYXRvciBjYXNlIGZvciBwbGF0Zm9ybSB2ZXJzaW9uICcke3BsYXRmb3JtVmVyc2lvbn0nYCk7XG4gICAgICAgIGluZGljYXRvciA9ICdubyBib290IGluZGljYXRvciBzdHJpbmcgYXZhaWxhYmxlJztcbiAgICB9XG4gICAgcmV0dXJuIGluZGljYXRvcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBTdGFydCB0aGUgU2ltdWxhdG9yIFVJIGNsaWVudCB3aXRoIHRoZSBnaXZlbiBhcmd1bWVudHNcbiAgICpcbiAgICogQHBhcmFtIHtvYmplY3R9IG9wdHMgLSBPbmUgb3IgbW9yZSBvZiBhdmFpbGFibGUgU2ltdWxhdG9yIFVJIGNsaWVudCBvcHRpb25zOlxuICAgKiAgIC0ge3N0cmluZ30gc2NhbGVGYWN0b3I6IGNhbiBiZSBvbmUgb2YgWycxLjAnLCAnMC43NScsICcwLjUnLCAnMC4zMycsICcwLjI1J10uXG4gICAqICAgRGVmaW5lcyB0aGUgd2luZG93IHNjYWxlIHZhbHVlIGZvciB0aGUgVUkgY2xpZW50IHdpbmRvdyBmb3IgdGhlIGN1cnJlbnQgU2ltdWxhdG9yLlxuICAgKiAgIEVxdWFscyB0byBudWxsIGJ5IGRlZmF1bHQsIHdoaWNoIGtlZXBzIHRoZSBjdXJyZW50IHNjYWxlIHVuY2hhbmdlZC5cbiAgICogICAtIHtib29sZWFufSBjb25uZWN0SGFyZHdhcmVLZXlib2FyZDogd2hldGhlciB0byBjb25uZWN0IHRoZSBoYXJkd2FyZSBrZXlib2FyZCB0byB0aGVcbiAgICogICBTaW11bGF0b3IgVUkgY2xpZW50LiBFcXVhbHMgdG8gZmFsc2UgYnkgZGVmYXVsdC5cbiAgICogICAtIHtudW1iZXJ9IHN0YXJ0dXBUaW1lb3V0OiBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXQgdW50aWwgU2ltdWxhdG9yIGJvb3RpbmdcbiAgICogICBwcm9jZXNzIGlzIGNvbXBsZXRlZC4gVGhlIGRlZmF1bHQgdGltZW91dCB3aWxsIGJlIHVzZWQgaWYgbm90IHNldCBleHBsaWNpdGx5LlxuICAgKi9cbiAgYXN5bmMgc3RhcnRVSUNsaWVudCAob3B0cyA9IHt9KSB7XG4gICAgb3B0cyA9IE9iamVjdC5hc3NpZ24oe1xuICAgICAgc2NhbGVGYWN0b3I6IG51bGwsXG4gICAgICBjb25uZWN0SGFyZHdhcmVLZXlib2FyZDogZmFsc2UsXG4gICAgICBzdGFydHVwVGltZW91dDogdGhpcy5zdGFydHVwVGltZW91dCxcbiAgICB9LCBvcHRzKTtcblxuICAgIGNvbnN0IHNpbXVsYXRvckFwcCA9IHBhdGgucmVzb2x2ZShhd2FpdCBnZXRYY29kZVBhdGgoKSwgJ0FwcGxpY2F0aW9ucycsIHRoaXMuc2ltdWxhdG9yQXBwKTtcbiAgICBjb25zdCBhcmdzID0gWyctRm4nLCBzaW11bGF0b3JBcHAsICctLWFyZ3MnLCAnLUN1cnJlbnREZXZpY2VVRElEJywgdGhpcy51ZGlkXTtcblxuICAgIGlmIChvcHRzLnNjYWxlRmFjdG9yKSB7XG4gICAgICBjb25zdCBzdGF0ID0gYXdhaXQgdGhpcy5zdGF0KCk7XG4gICAgICBjb25zdCBmb3JtYXR0ZWREZXZpY2VOYW1lID0gc3RhdC5uYW1lLnJlcGxhY2UoL1xccysvZywgJy0nKTtcbiAgICAgIGNvbnN0IGFyZ3VtZW50TmFtZSA9IGAtU2ltdWxhdG9yV2luZG93TGFzdFNjYWxlLWNvbS5hcHBsZS5Db3JlU2ltdWxhdG9yLlNpbURldmljZVR5cGUuJHtmb3JtYXR0ZWREZXZpY2VOYW1lfWA7XG4gICAgICBhcmdzLnB1c2goYXJndW1lbnROYW1lLCBvcHRzLnNjYWxlRmFjdG9yKTtcbiAgICB9XG5cbiAgICBpZiAoXy5pc0Jvb2xlYW4ob3B0cy5jb25uZWN0SGFyZHdhcmVLZXlib2FyZCkpIHtcbiAgICAgIGFyZ3MucHVzaCgnLUNvbm5lY3RIYXJkd2FyZUtleWJvYXJkJywgb3B0cy5jb25uZWN0SGFyZHdhcmVLZXlib2FyZCA/ICcxJyA6ICcwJyk7XG4gICAgfVxuXG4gICAgbG9nLmluZm8oYFN0YXJ0aW5nIFNpbXVsYXRvciBVSSB3aXRoIGNvbW1hbmQ6IG9wZW4gJHthcmdzLmpvaW4oJyAnKX1gKTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgZXhlYygnb3BlbicsIGFyZ3MsIHt0aW1lb3V0OiBvcHRzLnN0YXJ0dXBUaW1lb3V0fSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBpZiAoIShlcnIuc3Rkb3V0IHx8ICcnKS5pbmNsdWRlcygnLTEwODI1JykgJiYgIShlcnIuc3RkZXJyIHx8ICcnKS5pbmNsdWRlcygnLTEwODI1JykpIHtcbiAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgfVxuICAgICAgbG9nLndhcm4oYEVycm9yIHdoaWxlIG9wZW5pbmcgVUk6ICR7ZXJyLnN0ZG91dCB8fCBlcnIuc3RkZXJyfS4gQ29udGludWluZ2ApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFeGVjdXRlcyBnaXZlbiBTaW11bGF0b3Igd2l0aCBvcHRpb25zLiBUaGUgU2ltdWxhdG9yIHdpbGwgbm90IGJlIHJlc3RhcnRlZCBpZlxuICAgKiBpdCBpcyBhbHJlYWR5IHJ1bm5pbmcuXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBvcHRzIC0gT25lIG9yIG1vcmUgb2YgYXZhaWxhYmxlIFNpbXVsYXRvciBvcHRpb25zLlxuICAgKiAgIFNlZSB7I3N0YXJ0VUlDbGllbnQob3B0cyl9IGRvY3VtZW50YXRpb24gZm9yIG1vcmUgZGV0YWlscyBvbiBvdGhlciBzdXBwb3J0ZWQga2V5cy5cbiAgICovXG4gIGFzeW5jIHJ1biAob3B0cyA9IHt9KSB7XG4gICAgb3B0cyA9IE9iamVjdC5hc3NpZ24oe1xuICAgICAgc3RhcnR1cFRpbWVvdXQ6IHRoaXMuc3RhcnR1cFRpbWVvdXQsXG4gICAgfSwgb3B0cyk7XG4gICAgY29uc3Qge3N0YXRlfSA9IGF3YWl0IHRoaXMuc3RhdCgpO1xuICAgIGNvbnN0IGlzU2VydmVyUnVubmluZyA9IHN0YXRlID09PSAnQm9vdGVkJztcbiAgICBjb25zdCBpc1VJQ2xpZW50UnVubmluZyA9IGF3YWl0IHRoaXMuaXNVSUNsaWVudFJ1bm5pbmcoKTtcbiAgICBpZiAoaXNTZXJ2ZXJSdW5uaW5nICYmIGlzVUlDbGllbnRSdW5uaW5nKSB7XG4gICAgICBsb2cuaW5mbyhgQm90aCBTaW11bGF0b3Igd2l0aCBVRElEICR7dGhpcy51ZGlkfSBhbmQgdGhlIFVJIGNsaWVudCBhcmUgY3VycmVudGx5IHJ1bm5pbmdgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gcHJvY2Vzcy5ocnRpbWUoKTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5zaHV0ZG93bigpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nLndhcm4oYEVycm9yIG9uIFNpbXVsYXRvciBzaHV0ZG93bjogJHtlcnIubWVzc2FnZX1gKTtcbiAgICB9XG4gICAgYXdhaXQgdGhpcy5zdGFydFVJQ2xpZW50KG9wdHMpO1xuXG4gICAgYXdhaXQgdGhpcy53YWl0Rm9yQm9vdChvcHRzLnN0YXJ0dXBUaW1lb3V0KTtcbiAgICBsb2cuaW5mbyhgU2ltdWxhdG9yIHdpdGggVURJRCAke3RoaXMudWRpZH0gYm9vdGVkIGluICR7cHJvY2Vzcy5ocnRpbWUoc3RhcnRUaW1lKVswXX0gc2Vjb25kc2ApO1xuICB9XG5cbiAgLy8gVE9ETyBrZWVwIGtleWNoYWluc1xuICAvKipcbiAgICogUmVzZXQgdGhlIGN1cnJlbnQgU2ltdWxhdG9yIHRvIHRoZSBjbGVhbiBzdGF0ZS5cbiAgICovXG4gIGFzeW5jIGNsZWFuICgpIHtcbiAgICBhd2FpdCB0aGlzLmVuZFNpbXVsYXRvckRhZW1vbigpO1xuICAgIGxvZy5pbmZvKGBDbGVhbmluZyBzaW11bGF0b3IgJHt0aGlzLnVkaWR9YCk7XG4gICAgYXdhaXQgc2ltY3RsLmVyYXNlRGV2aWNlKHRoaXMudWRpZCwgMTAwMDApO1xuICB9XG5cbiAgLyoqXG4gICAqIFNjcnViIChkZWxldGUgdGhlIHByZWZlcmVuY2VzIGFuZCBjaGFuZ2VkIGZpbGVzKSB0aGUgcGFydGljdWxhciBhcHBsaWNhdGlvbiBvbiBTaW11bGF0b3IuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhcHBGaWxlIC0gQXBwbGljYXRpb24gbmFtZSBtaW51cyBcIi5hcHBcIi5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGFwcEJ1bmRsZUlkIC0gQnVuZGxlIGlkZW50aWZpZXIgb2YgdGhlIGFwcGxpY2F0aW9uLlxuICAgKi9cbiAgYXN5bmMgc2NydWJDdXN0b21BcHAgKGFwcEZpbGUsIGFwcEJ1bmRsZUlkKSB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuY2xlYW5DdXN0b21BcHAoYXBwRmlsZSwgYXBwQnVuZGxlSWQsIHRydWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFuL3NjcnViIHRoZSBwYXJ0aWN1bGFyIGFwcGxpY2F0aW9uIG9uIFNpbXVsYXRvci5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGFwcEZpbGUgLSBBcHBsaWNhdGlvbiBuYW1lIG1pbnVzIFwiLmFwcFwiLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYXBwQnVuZGxlSWQgLSBCdW5kbGUgaWRlbnRpZmllciBvZiB0aGUgYXBwbGljYXRpb24uXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gc2NydWIgLSBJZiBgc2NydWJgIGlzIGZhbHNlLCB3ZSB3YW50IHRvIGNsZWFuIGJ5IGRlbGV0aW5nIHRoZSBhcHAgYW5kIGFsbFxuICAgKiAgIGZpbGVzIGFzc29jaWF0ZWQgd2l0aCBpdC4gSWYgYHNjcnViYCBpcyB0cnVlLCB3ZSBqdXN0IHdhbnQgdG8gZGVsZXRlIHRoZSBwcmVmZXJlbmNlcyBhbmRcbiAgICogICBjaGFuZ2VkIGZpbGVzLlxuICAgKi9cbiAgYXN5bmMgY2xlYW5DdXN0b21BcHAgKGFwcEZpbGUsIGFwcEJ1bmRsZUlkLCBzY3J1YiA9IGZhbHNlKSB7XG4gICAgbG9nLmRlYnVnKGBDbGVhbmluZyBhcHAgZGF0YSBmaWxlcyBmb3IgJyR7YXBwRmlsZX0nLCAnJHthcHBCdW5kbGVJZH0nYCk7XG4gICAgaWYgKCFzY3J1Yikge1xuICAgICAgbG9nLmRlYnVnKGBEZWxldGluZyBhcHAgYWx0b2dldGhlcmApO1xuICAgIH1cblxuICAgIC8vIGdldCB0aGUgZGlyZWN0b3JpZXMgdG8gYmUgZGVsZXRlZFxuICAgIGxldCBhcHBEaXJzID0gYXdhaXQgdGhpcy5nZXRBcHBEaXJzKGFwcEZpbGUsIGFwcEJ1bmRsZUlkLCBzY3J1Yik7XG5cbiAgICBpZiAoYXBwRGlycy5sZW5ndGggPT09IDApIHtcbiAgICAgIGxvZy5kZWJ1ZygnQ291bGQgbm90IGZpbmQgYXBwIGRpcmVjdG9yaWVzIHRvIGRlbGV0ZS4gSXQgaXMgcHJvYmFibHkgbm90IGluc3RhbGxlZCcpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGxldCBkZWxldGVQcm9taXNlcyA9IFtdO1xuXG4gICAgZm9yIChsZXQgZGlyIG9mIGFwcERpcnMpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgRGVsZXRpbmcgZGlyZWN0b3J5OiAnJHtkaXJ9J2ApO1xuICAgICAgZGVsZXRlUHJvbWlzZXMucHVzaChmcy5yaW1yYWYoZGlyKSk7XG4gICAgfVxuXG4gICAgaWYgKGF3YWl0IHRoaXMuZ2V0UGxhdGZvcm1WZXJzaW9uKCkgPj0gOCkge1xuICAgICAgbGV0IHJlbFJtUGF0aCA9IGBMaWJyYXJ5L1ByZWZlcmVuY2VzLyR7YXBwQnVuZGxlSWR9LnBsaXN0YDtcbiAgICAgIGxldCBybVBhdGggPSBwYXRoLnJlc29sdmUodGhpcy5nZXRSb290RGlyKCksIHJlbFJtUGF0aCk7XG4gICAgICBsb2cuZGVidWcoYERlbGV0aW5nIGZpbGU6ICcke3JtUGF0aH0nYCk7XG4gICAgICBkZWxldGVQcm9taXNlcy5wdXNoKGZzLnJpbXJhZihybVBhdGgpKTtcbiAgICB9XG5cbiAgICBhd2FpdCBCLmFsbChkZWxldGVQcm9taXNlcyk7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmUgcGF0aHMgdG8gZGlycyB3aGVyZSBhcHBsaWNhdGlvbiBkYXRhIGlzIHN0b3JlZC4gaU9TIDgrIHN0b3JlcyBhcHAgZGF0YSBpbiB0d28gcGxhY2VzLFxuICAgKiBhbmQgaU9TIDcuMSBoYXMgb25seSBvbmUgZGlyZWN0b3J5XG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhcHBGaWxlIC0gQXBwbGljYXRpb24gbmFtZSBtaW51cyBcIi5hcHBcIi5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGFwcEJ1bmRsZUlkIC0gQnVuZGxlIGlkZW50aWZpZXIgb2YgdGhlIGFwcGxpY2F0aW9uLlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IHNjcnViIC0gVGhlIGBCdW5kbGVgIGRpcmVjdG9yeSBoYXMgdGhlIGFjdHVhbCBhcHAgaW4gaXQuIElmIHdlIGFyZSBqdXN0IHNjcnViYmluZyxcbiAgICogICB3ZSB3YW50IHRoaXMgdG8gc3RheS4gSWYgd2UgYXJlIGNsZWFuaW5nIHdlIGRlbGV0ZS5cbiAgICogQHJldHVybiB7YXJyYXk8c3RyaW5nPn0gQXJyYXkgb2YgYXBwbGljYXRpb24gZGF0YSBwYXRocy5cbiAgICovXG4gIGFzeW5jIGdldEFwcERpcnMgKGFwcEZpbGUsIGFwcEJ1bmRsZUlkLCBzY3J1YiA9IGZhbHNlKSB7XG4gICAgbGV0IGRpcnMgPSBbXTtcbiAgICBpZiAoYXdhaXQgdGhpcy5nZXRQbGF0Zm9ybVZlcnNpb24oKSA+PSA4KSB7XG4gICAgICBsZXQgZGF0YSA9IGF3YWl0IHRoaXMuZ2V0QXBwRGlyKGFwcEJ1bmRsZUlkKTtcbiAgICAgIGlmICghZGF0YSkgcmV0dXJuIGRpcnM7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY3VybHlcblxuICAgICAgbGV0IGJ1bmRsZSA9ICFzY3J1YiA/IGF3YWl0IHRoaXMuZ2V0QXBwRGlyKGFwcEJ1bmRsZUlkLCAnQnVuZGxlJykgOiB1bmRlZmluZWQ7XG5cbiAgICAgIGZvciAobGV0IHNyYyBvZiBbZGF0YSwgYnVuZGxlXSkge1xuICAgICAgICBpZiAoc3JjKSB7XG4gICAgICAgICAgZGlycy5wdXNoKHNyYyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IGRhdGEgPSBhd2FpdCB0aGlzLmdldEFwcERpcihhcHBGaWxlKTtcbiAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgIGRpcnMucHVzaChkYXRhKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGRpcnM7XG4gIH1cblxuICAvKipcbiAgICogRXhlY3V0ZSB0aGUgU2ltdWxhdG9yIGluIG9yZGVyIHRvIGhhdmUgdGhlIGluaXRpYWwgZmlsZSBzdHJ1Y3R1cmUgY3JlYXRlZCBhbmQgc2h1dGRvd24gaXQgYWZ0ZXJ3YXJkcy5cbiAgICpcbiAgICogQHBhcmFtIHtib29sZWFufSBzYWZhcmkgLSBXaGV0aGVyIHRvIGV4ZWN1dGUgbW9iaWxlIFNhZmFyaSBhZnRlciBzdGFydHVwLlxuICAgKiBAcGFyYW0ge251bWJlcn0gc3RhcnR1cFRpbWVvdXQgLSBIb3cgbG9uZyB0byB3YWl0IHVudGlsIFNpbXVsYXRvciBib290aW5nIGlzIGNvbXBsZXRlZCAoaW4gbWlsbGlzZWNvbmRzKS5cbiAgICovXG4gIGFzeW5jIGxhdW5jaEFuZFF1aXQgKHNhZmFyaSA9IGZhbHNlLCBzdGFydHVwVGltZW91dCA9IHRoaXMuc3RhcnR1cFRpbWVvdXQpIHtcbiAgICBsb2cuZGVidWcoJ0F0dGVtcHRpbmcgdG8gbGF1bmNoIGFuZCBxdWl0IHRoZSBzaW11bGF0b3IsIHRvIGNyZWF0ZSBkaXJlY3Rvcnkgc3RydWN0dXJlJyk7XG4gICAgbG9nLmRlYnVnKGBXaWxsIGxhdW5jaCB3aXRoIFNhZmFyaT8gJHtzYWZhcml9YCk7XG5cbiAgICBhd2FpdCB0aGlzLnJ1bihzdGFydHVwVGltZW91dCk7XG5cbiAgICBpZiAoc2FmYXJpKSB7XG4gICAgICBhd2FpdCB0aGlzLm9wZW5VcmwoJ2h0dHA6Ly93d3cuYXBwaXVtLmlvJyk7XG4gICAgfVxuXG4gICAgLy8gd2FpdCBmb3IgdGhlIHN5c3RlbSB0byBjcmVhdGUgdGhlIGZpbGVzIHdlIHdpbGwgbWFuaXB1bGF0ZVxuICAgIC8vIG5lZWQgcXVpdGUgYSBoaWdoIHJldHJ5IG51bWJlciwgaW4gb3JkZXIgdG8gYWNjb21tb2RhdGUgaU9TIDcuMVxuICAgIC8vIGxvY2FsbHksIDcuMSBhdmVyYWdlcyA4LjUgcmV0cmllcyAoZnJvbSA2IC0gMTIpXG4gICAgLy8gICAgICAgICAgOCBhdmVyYWdlcyAwLjYgcmV0cmllcyAoZnJvbSAwIC0gMilcbiAgICAvLyAgICAgICAgICA5IGF2ZXJhZ2VzIDE0IHJldHJpZXNcbiAgICB0cnkge1xuICAgICAgYXdhaXQgcmV0cnlJbnRlcnZhbCg2MCwgMjUwLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGlmIChhd2FpdCB0aGlzLmlzRnJlc2goKSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignU2ltdWxhdG9yIGZpbGVzIG5vdCBmdWxseSBjcmVhdGVkLiBXYWl0aW5nIGEgYml0Jyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nLndhcm4oYFRpbWVvdXQgd2FpdGluZyBmb3Igc2ltdWxhdG9yIGZpbGVzIHRvIGJlIGNyZWF0ZWQuIENvbnRpbnVpbmdgKTtcbiAgICB9XG5cbiAgICAvLyBhbmQgcXVpdFxuICAgIGF3YWl0IHRoaXMuc2h1dGRvd24oKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMb29rcyBmb3IgbGF1bmNoZCBkYWVtb25zIGNvcnJlc3BvbmRpbmcgdG8gdGhlIHNpbSB1ZGlkIGFuZCB0cmllcyB0byBzdG9wIHRoZW0gY2xlYW5seVxuICAgKiBUaGlzIHByZXZlbnRzIHhjcnVuIHNpbWN0bCBlcmFzZSBmcm9tIGhhbmdpbmcuXG4gICAqL1xuICBhc3luYyBlbmRTaW11bGF0b3JEYWVtb24gKCkge1xuICAgIGxvZy5kZWJ1ZyhgS2lsbGluZyBhbnkgc2ltdWxhdG9yIGRhZW1vbnMgZm9yICR7dGhpcy51ZGlkfWApO1xuXG4gICAgbGV0IGxhdW5jaGN0bENtZCA9IGBsYXVuY2hjdGwgbGlzdCB8IGdyZXAgJHt0aGlzLnVkaWR9IHwgY3V0IC1mIDMgfCB4YXJncyAtbiAxIGxhdW5jaGN0bGA7XG4gICAgdHJ5IHtcbiAgICAgIGxldCBzdG9wQ21kID0gYCR7bGF1bmNoY3RsQ21kfSBzdG9wYDtcbiAgICAgIGF3YWl0IGV4ZWMoJ2Jhc2gnLCBbJy1jJywgc3RvcENtZF0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nLndhcm4oYENvdWxkIG5vdCBzdG9wIHNpbXVsYXRvciBkYWVtb25zOiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgbG9nLmRlYnVnKCdDYXJyeWluZyBvbiBhbnl3YXkhJyk7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICBsZXQgcmVtb3ZlQ21kID0gYCR7bGF1bmNoY3RsQ21kfSByZW1vdmVgO1xuICAgICAgYXdhaXQgZXhlYygnYmFzaCcsIFsnLWMnLCByZW1vdmVDbWRdKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZy53YXJuKGBDb3VsZCBub3QgcmVtb3ZlIHNpbXVsYXRvciBkYWVtb25zOiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgbG9nLmRlYnVnKCdDYXJyeWluZyBvbiBhbnl3YXkhJyk7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAvLyBXYWl0cyAxMCBzZWMgZm9yIHRoZSBzaW11bGF0b3IgbGF1bmNoZCBzZXJ2aWNlcyB0byBzdG9wLlxuICAgICAgYXdhaXQgd2FpdEZvckNvbmRpdGlvbihhc3luYyAoKSA9PiB7XG4gICAgICAgIGxldCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWMoJ2Jhc2gnLCBbJy1jJyxcbiAgICAgICAgICBgcHMgLWUgIHwgZ3JlcCAke3RoaXMudWRpZH0gfCBncmVwIGxhdW5jaGRfc2ltIHwgZ3JlcCAtdiBiYXNoIHwgZ3JlcCAtdiBncmVwIHwgYXdrIHsncHJpbnQkMSd9YF0pO1xuICAgICAgICByZXR1cm4gc3Rkb3V0LnRyaW0oKS5sZW5ndGggPT09IDA7XG4gICAgICB9LCB7d2FpdE1zOiAxMDAwMCwgaW50ZXJ2YWxNczogNTAwfSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2cud2FybihgQ291bGQgbm90IGVuZCBzaW11bGF0b3IgZGFlbW9uIGZvciAke3RoaXMudWRpZH06ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgICBsb2cuZGVidWcoJ0NhcnJ5aW5nIG9uIGFueXdheSEnKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2h1dGRvd24gYWxsIHRoZSBydW5uaW5nIFNpbXVsYXRvcnMgYW5kIHRoZSBVSSBjbGllbnQuXG4gICAqL1xuICBhc3luYyBzaHV0ZG93biAoKSB7XG4gICAgYXdhaXQga2lsbEFsbFNpbXVsYXRvcnMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxldGUgdGhlIHBhcnRpY3VsYXIgU2ltdWxhdG9yIGZyb20gZGV2aWNlcyBsaXN0XG4gICAqL1xuICBhc3luYyBkZWxldGUgKCkge1xuICAgIGF3YWl0IHNpbWN0bC5kZWxldGVEZXZpY2UodGhpcy51ZGlkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgdGhlIHBhcnRpY3VsYXIgcHJlZmVyZW5jZSBmaWxlIHdpdGggdGhlIGdpdmVuIGtleS92YWx1ZSBwYWlycy5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHBsaXN0IC0gVGhlIHByZWZlcmVuY2VzIGZpbGUgdG8gdXBkYXRlLlxuICAgKiBAcGFyYW0ge29iamVjdH0gdXBkYXRlcyAtIFRoZSBrZXkvdmFsdWUgcGFpcnMgdG8gdXBkYXRlLlxuICAgKi9cbiAgYXN5bmMgdXBkYXRlU2V0dGluZ3MgKHBsaXN0LCB1cGRhdGVzKSB7XG4gICAgcmV0dXJuIGF3YWl0IHNldHRpbmdzLnVwZGF0ZVNldHRpbmdzKHRoaXMsIHBsaXN0LCB1cGRhdGVzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBdXRob3JpemUvZGUtYXV0aG9yaXplIGxvY2F0aW9uIHNldHRpbmdzIGZvciBhIHBhcnRpY3VsYXIgYXBwbGljYXRpb24uXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJZCAtIFRoZSBhcHBsaWNhdGlvbiBJRCB0byB1cGRhdGUuXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gYXV0aG9yaXplZCAtIFdoZXRoZXIgb3Igbm90IHRvIGF1dGhvcml6ZS5cbiAgICovXG4gIGFzeW5jIHVwZGF0ZUxvY2F0aW9uU2V0dGluZ3MgKGJ1bmRsZUlkLCBhdXRob3JpemVkKSB7XG4gICAgcmV0dXJuIGF3YWl0IHNldHRpbmdzLnVwZGF0ZUxvY2F0aW9uU2V0dGluZ3ModGhpcywgYnVuZGxlSWQsIGF1dGhvcml6ZWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEVuYWJsZS9EaXNhYmxlIHJlZHVjZSBtb3Rpb24uXG4gICAqXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gcmVkdWNlTW90aW9uIC0gV2hldGhlciBvciBub3QgdG8gZW5hYmxlIGl0LlxuICAgKi9cbiAgYXN5bmMgc2V0UmVkdWNlTW90aW9uIChyZWR1Y2VNb3Rpb24gPSB0cnVlKSB7XG4gICAgaWYgKGF3YWl0IHRoaXMuaXNGcmVzaCgpKSB7XG4gICAgICBhd2FpdCB0aGlzLmxhdW5jaEFuZFF1aXQoZmFsc2UsIFNUQVJUVVBfVElNRU9VVCk7XG4gICAgfVxuXG4gICAgYXdhaXQgc2V0dGluZ3Muc2V0UmVkdWNlTW90aW9uKHRoaXMsIHJlZHVjZU1vdGlvbik7XG4gIH1cblxuICAvKipcbiAgICogRW5hYmxlL0Rpc2FibGUgZGFyayBtb2RlLiBUaGlzIG9ubHkgd29ya3Mgb24gWGNvZGUgMTErL2lPUyAxMysuXG4gICAqIFRoaXMgZnVuY3Rpb24gY2FuIGJlIGNhbGxlZCBiZWZvcmUgdGhlIHNpbXVsYXRvciBoYXMgYmVlbiBydW4uXG4gICAqXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gaXNFbmFibGVkIC0gV2hldGhlciBvciBub3QgdG8gZW5hYmxlIGl0ICh0cnVlIGJ5IGRlZmF1bHQpXG4gICAqL1xuICBhc3luYyBzZXREYXJrTW9kZSAoLyppc0VuYWJsZWQgPSB0cnVlKi8pIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgbG9nLmluZm8oYFVuYWJsZSB0byBzZXQgZGFyayBtb2RlIGluIFhjb2RlIHZlcnNpb24gJyR7dGhpcy54Y29kZVZlcnNpb259J2ApO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBzZXR0aW5ncyBmb3IgU2FmYXJpLlxuICAgKlxuICAgKiBAcGFyYW0ge29iamVjdH0gdXBkYXRlcyAtIFRoZSBoYXNoIG9mIGtleS92YWx1ZSBwYWlycyB0byB1cGRhdGUgZm9yIFNhZmFyaS5cbiAgICovXG4gIGFzeW5jIHVwZGF0ZVNhZmFyaVNldHRpbmdzICh1cGRhdGVzKSB7XG4gICAgbGV0IHVwZGF0ZWQgPSBhd2FpdCBzZXR0aW5ncy51cGRhdGVTYWZhcmlVc2VyU2V0dGluZ3ModGhpcywgdXBkYXRlcyk7XG4gICAgcmV0dXJuIGF3YWl0IHNldHRpbmdzLnVwZGF0ZVNldHRpbmdzKHRoaXMsICdtb2JpbGVTYWZhcmknLCB1cGRhdGVzKSB8fCB1cGRhdGVkO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBnbG9iYWwgc2V0dGluZ3MgZm9yIFNhZmFyaS5cbiAgICpcbiAgICogQHBhcmFtIHtvYmplY3R9IHVwZGF0ZXMgLSBUaGUgaGFzaCBvZiBrZXkvdmFsdWUgcGFpcnMgdG8gdXBkYXRlIGZvciBTYWZhcmkuXG4gICAqL1xuICBhc3luYyB1cGRhdGVTYWZhcmlHbG9iYWxTZXR0aW5ncyAodXBkYXRlcykge1xuICAgIHJldHVybiBhd2FpdCBzZXR0aW5ncy51cGRhdGVTYWZhcmlHbG9iYWxTZXR0aW5ncyh0aGlzLCB1cGRhdGVzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgdGhlIGxvY2FsZSBmb3IgdGhlIFNpbXVsYXRvci5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGxhbmd1YWdlIC0gVGhlIGxhbmd1YWdlIGZvciB0aGUgc2ltdWxhdG9yLiBFLmcuLCBgXCJmcl9VU1wiYC5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGxvY2FsZSAtIFRoZSBsb2NhbGUgdG8gc2V0IGZvciB0aGUgc2ltdWxhdG9yLiBFLmcuLCBgXCJlblwiYC5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGNhbGVuZGFyRm9ybWF0IC0gVGhlIGZvcm1hdCBvZiB0aGUgY2FsZW5kYXIuXG4gICAqL1xuICBhc3luYyB1cGRhdGVMb2NhbGUgKGxhbmd1YWdlLCBsb2NhbGUsIGNhbGVuZGFyRm9ybWF0KSB7XG4gICAgcmV0dXJuIGF3YWl0IHNldHRpbmdzLnVwZGF0ZUxvY2FsZSh0aGlzLCBsYW5ndWFnZSwgbG9jYWxlLCBjYWxlbmRhckZvcm1hdCk7XG4gIH1cblxuICAvKipcbiAgICogQ29tcGxldGVseSBkZWxldGUgbW9iaWxlIFNhZmFyaSBhcHBsaWNhdGlvbiBmcm9tIHRoZSBjdXJyZW50IFNpbXVsYXRvci5cbiAgICovXG4gIGFzeW5jIGRlbGV0ZVNhZmFyaSAoKSB7XG4gICAgbG9nLmRlYnVnKCdEZWxldGluZyBTYWZhcmkgYXBwcyBmcm9tIHNpbXVsYXRvcicpO1xuXG4gICAgbGV0IGRpcnMgPSBbXTtcblxuICAgIC8vIGdldCB0aGUgZGF0YSBkaXJlY3RvcnlcbiAgICBkaXJzLnB1c2goYXdhaXQgdGhpcy5nZXRBcHBEaXIoJ2NvbS5hcHBsZS5tb2JpbGVzYWZhcmknKSk7XG5cbiAgICBsZXQgcHYgPSBhd2FpdCB0aGlzLmdldFBsYXRmb3JtVmVyc2lvbigpO1xuICAgIGlmIChwdiA+PSA4KSB7XG4gICAgICAvLyBnZXQgdGhlIGJ1bmRsZSBkaXJlY3RvcnlcbiAgICAgIGRpcnMucHVzaChhd2FpdCB0aGlzLmdldEFwcERpcignY29tLmFwcGxlLm1vYmlsZXNhZmFyaScsICdCdW5kbGUnKSk7XG4gICAgfVxuXG4gICAgbGV0IGRlbGV0ZVByb21pc2VzID0gW107XG4gICAgZm9yIChsZXQgZGlyIG9mIF8uY29tcGFjdChkaXJzKSkge1xuICAgICAgbG9nLmRlYnVnKGBEZWxldGluZyBkaXJlY3Rvcnk6ICcke2Rpcn0nYCk7XG4gICAgICBkZWxldGVQcm9taXNlcy5wdXNoKGZzLnJpbXJhZihkaXIpKTtcbiAgICB9XG4gICAgYXdhaXQgQi5hbGwoZGVsZXRlUHJvbWlzZXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFuIHVwIHRoZSBkaXJlY3RvcmllcyBmb3IgbW9iaWxlIFNhZmFyaS5cbiAgICpcbiAgICogQHBhcmFtIHtib29sZWFufSBrZWVwUHJlZnMgLSBXaGV0aGVyIHRvIGtlZXAgU2FmYXJpIHByZWZlcmVuY2VzIGZyb20gYmVpbmcgZGVsZXRlZC5cbiAgICovXG4gIGFzeW5jIGNsZWFuU2FmYXJpIChrZWVwUHJlZnMgPSB0cnVlKSB7XG4gICAgbG9nLmRlYnVnKCdDbGVhbmluZyBtb2JpbGUgc2FmYXJpIGRhdGEgZmlsZXMnKTtcbiAgICBpZiAoYXdhaXQgdGhpcy5pc0ZyZXNoKCkpIHtcbiAgICAgIGxvZy5pbmZvKCdDb3VsZCBub3QgZmluZCBTYWZhcmkgc3VwcG9ydCBkaXJlY3RvcmllcyB0byBjbGVhbiBvdXQgb2xkICcgK1xuICAgICAgICAgICAgICAgJ2RhdGEuIFByb2JhYmx5IHRoZXJlIGlzIG5vdGhpbmcgdG8gY2xlYW4gb3V0Jyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbGV0IGxpYnJhcnlEaXIgPSBwYXRoLnJlc29sdmUodGhpcy5nZXREaXIoKSwgJ0xpYnJhcnknKTtcbiAgICBsZXQgc2FmYXJpUm9vdCA9IGF3YWl0IHRoaXMuZ2V0QXBwRGlyKCdjb20uYXBwbGUubW9iaWxlc2FmYXJpJyk7XG4gICAgaWYgKCFzYWZhcmlSb290KSB7XG4gICAgICBsb2cuaW5mbygnQ291bGQgbm90IGZpbmQgU2FmYXJpIHN1cHBvcnQgZGlyZWN0b3JpZXMgdG8gY2xlYW4gb3V0IG9sZCAnICtcbiAgICAgICAgICAgICAgICdkYXRhLiBQcm9iYWJseSB0aGVyZSBpcyBub3RoaW5nIHRvIGNsZWFuIG91dCcpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBsZXQgc2FmYXJpTGlicmFyeURpciA9IHBhdGgucmVzb2x2ZShzYWZhcmlSb290LCAnTGlicmFyeScpO1xuICAgIGxldCBmaWxlc1RvRGVsZXRlID0gW1xuICAgICAgJ0NhY2hlcy9TbmFwc2hvdHMvY29tLmFwcGxlLm1vYmlsZXNhZmFyaScsXG4gICAgICAnQ2FjaGVzL2NvbS5hcHBsZS5tb2JpbGVzYWZhcmkvKicsXG4gICAgICAnQ2FjaGVzL2NvbS5hcHBsZS5XZWJBcHBDYWNoZS8qJyxcbiAgICAgICdDYWNoZXMvY29tLmFwcGxlLldlYktpdC5OZXR3b3JraW5nLyonLFxuICAgICAgJ0NhY2hlcy9jb20uYXBwbGUuV2ViS2l0LldlYkNvbnRlbnQvKicsXG4gICAgICAnSW1hZ2UgQ2FjaGUvKicsXG4gICAgICAnV2ViS2l0L2NvbS5hcHBsZS5tb2JpbGVzYWZhcmkvKicsXG4gICAgICAnV2ViS2l0L0dlb2xvY2F0aW9uU2l0ZXMucGxpc3QnLFxuICAgICAgJ1dlYktpdC9Mb2NhbFN0b3JhZ2UvKi4qJyxcbiAgICAgICdTYWZhcmkvKicsXG4gICAgICAnQ29va2llcy8qLmJpbmFyeWNvb2tpZXMnLFxuICAgICAgJ0NhY2hlcy9jb20uYXBwbGUuVUlTdGF0dXNCYXIvKicsXG4gICAgICAnQ2FjaGVzL2NvbS5hcHBsZS5rZXlib2FyZHMvaW1hZ2VzLyonLFxuICAgICAgJ0NhY2hlcy9jb20uYXBwbGUuU2FmYXJpLlNhZmVCcm93c2luZy8qJyxcbiAgICAgICcuLi90bXAvY29tLmFwcGxlLm1vYmlsZXNhZmFyaS8qJ1xuICAgIF07XG4gICAgbGV0IGRlbGV0ZVByb21pc2VzID0gW107XG5cbiAgICBmb3IgKGxldCBmaWxlIG9mIGZpbGVzVG9EZWxldGUpIHtcbiAgICAgIGRlbGV0ZVByb21pc2VzLnB1c2goZnMucmltcmFmKHBhdGgucmVzb2x2ZShsaWJyYXJ5RGlyLCBmaWxlKSkpO1xuICAgICAgZGVsZXRlUHJvbWlzZXMucHVzaChmcy5yaW1yYWYocGF0aC5yZXNvbHZlKHNhZmFyaUxpYnJhcnlEaXIsIGZpbGUpKSk7XG4gICAgfVxuXG4gICAgaWYgKCFrZWVwUHJlZnMpIHtcbiAgICAgIGRlbGV0ZVByb21pc2VzLnB1c2goZnMucmltcmFmKHBhdGgucmVzb2x2ZShzYWZhcmlMaWJyYXJ5RGlyLCAnUHJlZmVyZW5jZXMvKi5wbGlzdCcpKSk7XG4gICAgfVxuXG4gICAgYXdhaXQgQi5hbGwoZGVsZXRlUHJvbWlzZXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVuaW5zdGFsbCB0aGUgZ2l2ZW4gYXBwbGljYXRpb24gZnJvbSB0aGUgY3VycmVudCBTaW11bGF0b3IuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJZCAtIFRoZSBidWluZGxlIElEIG9mIHRoZSBhcHBsaWNhdGlvbiB0byBiZSByZW1vdmVkLlxuICAgKi9cbiAgYXN5bmMgcmVtb3ZlQXBwIChidW5kbGVJZCkge1xuICAgIGF3YWl0IHNpbWN0bC5yZW1vdmVBcHAodGhpcy51ZGlkLCBidW5kbGVJZCk7XG4gIH1cblxuICAvKipcbiAgICogTW92ZSBhIGJ1aWx0LWluIGFwcGxpY2F0aW9uIHRvIGEgbmV3IHBsYWNlIChhY3R1YWxseSwgcmVuYW1lIGl0KS5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGFwcE5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgYXBwIHRvIGJlIG1vdmVkLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYXBwUGF0aCAtIFRoZSBjdXJyZW50IHBhdGggdG8gdGhlIGFwcGxpY2F0aW9uLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gbmV3QXBwUGF0aCAtIFRoZSBuZXcgcGF0aCB0byB0aGUgYXBwbGljYXRpb24uXG4gICAqICAgSWYgc29tZSBhcHBsaWNhdGlvbiBhbHJlYWR5IGV4aXN0cyBieSB0aGlzIHBhdGggdGhlbiBpdCdzIGdvaW5nIHRvIGJlIHJlbW92ZWQuXG4gICAqL1xuICBhc3luYyBtb3ZlQnVpbHRJbkFwcCAoYXBwTmFtZSwgYXBwUGF0aCwgbmV3QXBwUGF0aCkge1xuICAgIGF3YWl0IHNhZmVSaW1SYWYobmV3QXBwUGF0aCk7XG4gICAgYXdhaXQgZnMuY29weUZpbGUoYXBwUGF0aCwgbmV3QXBwUGF0aCk7XG4gICAgbG9nLmRlYnVnKGBDb3BpZWQgJyR7YXBwTmFtZX0nIHRvICcke25ld0FwcFBhdGh9J2ApO1xuXG4gICAgYXdhaXQgZnMucmltcmFmKGFwcFBhdGgpO1xuICAgIGxvZy5kZWJ1ZyhgVGVtcG9yYXJpbHkgZGVsZXRlZCBvcmlnaW5hbCBhcHAgYXQgJyR7YXBwUGF0aH0nYCk7XG5cbiAgICByZXR1cm4gW25ld0FwcFBhdGgsIGFwcFBhdGhdO1xuICB9XG5cbiAgLyoqXG4gICAqIE9wZW4gdGhlIGdpdmVuIFVSTCBpbiBtb2JpbGUgU2FmYXJpIGJyb3dzZXIuXG4gICAqIFRoZSBicm93c2VyIHdpbGwgYmUgc3RhcnRlZCBhdXRvbWF0aWNhbGx5IGlmIGl0IGlzIG5vdCBydW5uaW5nLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsIC0gVGhlIFVSTCB0byBiZSBvcGVuZWQuXG4gICAqL1xuICBhc3luYyBvcGVuVXJsICh1cmwpIHtcbiAgICBjb25zdCBTQUZBUklfQk9PVEVEX0lORElDQVRPUiA9ICdNb2JpbGVTYWZhcmlbJztcbiAgICBjb25zdCBTQUZBUklfU1RBUlRVUF9USU1FT1VUID0gMTUgKiAxMDAwO1xuICAgIGNvbnN0IEVYVFJBX1NUQVJUVVBfVElNRSA9IDMgKiAxMDAwO1xuXG4gICAgaWYgKGF3YWl0IHRoaXMuaXNSdW5uaW5nKCkpIHtcbiAgICAgIGF3YWl0IHJldHJ5KDUwMDAsIHNpbWN0bC5vcGVuVXJsLCB0aGlzLnVkaWQsIHVybCk7XG4gICAgICBhd2FpdCB0aGlzLnRhaWxMb2dzVW50aWwoU0FGQVJJX0JPT1RFRF9JTkRJQ0FUT1IsIFNBRkFSSV9TVEFSVFVQX1RJTUVPVVQpO1xuICAgICAgLy8gU28gc29ycnksIGJ1dCB0aGUgbG9ncyBoYXZlIG5vdGhpbmcgZWxzZSBmb3IgU2FmYXJpIHN0YXJ0aW5nLi4ganVzdCBkZWxheSBhIGxpdHRsZSBiaXRcbiAgICAgIGxvZy5kZWJ1ZyhgU2FmYXJpIHN0YXJ0ZWQsIHdhaXRpbmcgJHtFWFRSQV9TVEFSVFVQX1RJTUV9bXMgZm9yIGl0IHRvIGZ1bGx5IHN0YXJ0YCk7XG4gICAgICBhd2FpdCBCLmRlbGF5KEVYVFJBX1NUQVJUVVBfVElNRSk7XG4gICAgICBsb2cuZGVidWcoJ0RvbmUgd2FpdGluZyBmb3IgU2FmYXJpJyk7XG4gICAgICByZXR1cm47XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignVHJpZWQgdG8gb3BlbiBhIHVybCwgYnV0IHRoZSBTaW11bGF0b3IgaXMgbm90IEJvb3RlZCcpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBQZXJmb3JtIFNpbXVsYXRvciBjYWNoZXMgY2xlYW51cC5cbiAgICpcbiAgICogQHBhcmFtIHsuLi5zdHJpbmd9IGZvbGRlck5hbWVzIC0gVGhlIG5hbWVzIG9mIENhY2hlcyBzdWJmb2xkZXJzIHRvIGJlIGNsZWFuZWQuXG4gICAqICAgTm9uLWFjY2Vzc2libGUvbm9uLWV4aXN0aW5nIHN1YmZvbGRlcnMgd2lsbCBiZSBza2lwcGVkLlxuICAgKiAgIEFsbCBleGlzdGluZyBzdWJmb2xkZXJzIHVuZGVyIENhY2hlcyB3aWxsIGJlIGRlbGV0ZWQgaWYgdGhpcyBwYXJhbWV0ZXIgaXMgb21pdHRlZC5cbiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGNvdW50IG9mIGNsZWFuZWQgY2FjaGUgaXRlbXMuXG4gICAqICAgWmVybyBpcyByZXR1cm5lZCBpZiBubyBpdGVtcyB3ZXJlIG1hdGNoZWQgZm9yIGNsZWFudXAgKGVpdGhlciBub3QgYWNjZXNzaWJsZSBvciBub3QgZGlyZWN0b3JpZXMpLlxuICAgKi9cbiAgYXN5bmMgY2xlYXJDYWNoZXMgKC4uLmZvbGRlck5hbWVzKSB7XG4gICAgY29uc3QgY2FjaGVzUm9vdCA9IHBhdGgucmVzb2x2ZSh0aGlzLmdldERpcigpLCAnTGlicmFyeScsICdDYWNoZXMnKTtcbiAgICBpZiAoIShhd2FpdCBmcy5oYXNBY2Nlc3MoY2FjaGVzUm9vdCkpKSB7XG4gICAgICBsb2cuZGVidWcoYENhY2hlcyByb290IGF0ICcke2NhY2hlc1Jvb3R9JyBkb2VzIG5vdCBleGlzdCBvciBpcyBub3QgYWNjZXNzaWJsZS4gTm90aGluZyB0byBkbyB0aGVyZWApO1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuXG4gICAgbGV0IGl0ZW1zVG9SZW1vdmUgPSBmb2xkZXJOYW1lcy5sZW5ndGggPyBmb2xkZXJOYW1lcyA6IChhd2FpdCBmcy5yZWFkZGlyKGNhY2hlc1Jvb3QpKTtcbiAgICBpdGVtc1RvUmVtb3ZlID0gaXRlbXNUb1JlbW92ZS5tYXAoKHgpID0+IHBhdGgucmVzb2x2ZShjYWNoZXNSb290LCB4KSk7XG4gICAgaWYgKGZvbGRlck5hbWVzLmxlbmd0aCkge1xuICAgICAgaXRlbXNUb1JlbW92ZSA9IGF3YWl0IEIuZmlsdGVyKGl0ZW1zVG9SZW1vdmUsICh4KSA9PiBmcy5oYXNBY2Nlc3MoeCkpO1xuICAgIH1cbiAgICBpdGVtc1RvUmVtb3ZlID0gYXdhaXQgQi5maWx0ZXIoaXRlbXNUb1JlbW92ZSwgYXN5bmMgKHgpID0+IChhd2FpdCBmcy5zdGF0KHgpKS5pc0RpcmVjdG9yeSgpKTtcbiAgICBpZiAoIWl0ZW1zVG9SZW1vdmUubGVuZ3RoKSB7XG4gICAgICBsb2cuZGVidWcoYE5vIFNpbXVsYXRvciBjYWNoZSBpdGVtcyBmb3IgY2xlYW51cCB3ZXJlIG1hdGNoZWQgaW4gJyR7Y2FjaGVzUm9vdH0nYCk7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG5cbiAgICBsb2cuZGVidWcoYE1hdGNoZWQgJHtpdGVtc1RvUmVtb3ZlLmxlbmd0aH0gU2ltdWxhdG9yIGNhY2hlIGAgK1xuICAgICAgYGl0ZW0ke2l0ZW1zVG9SZW1vdmUubGVuZ3RoID09PSAxID8gJycgOiAncyd9IGZvciBjbGVhbnVwOiAke2l0ZW1zVG9SZW1vdmV9YCk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IEIuYWxsKGl0ZW1zVG9SZW1vdmUsICh4KSA9PiBmcy5yaW1yYWYoeCkpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGxvZy53YXJuKGBHb3QgYW4gZXhjZXB0aW9uIHdoaWxlIGNsZWFuaW5nIFNpbXVsYXRvciBjYWNoZXM6ICR7ZS5tZXNzYWdlfWApO1xuICAgIH1cbiAgICByZXR1cm4gaXRlbXNUb1JlbW92ZS5sZW5ndGg7XG4gIH1cblxuICAvKipcbiAgICogQmxvY2tzIHVudGlsIHRoZSBnaXZlbiBpbmRpY2F0ZXIgc3RyaW5nIGFwcGVhcnMgaW4gU2ltdWxhdG9yIGxvZ3MuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBib290ZWRJbmRpY2F0b3IgLSBUaGUgbWFnaWMgc3RyaW5nLCB3aGljaCBhcHBlYXJzIGluIGxvZ3MgYWZ0ZXIgU2ltdWxhdG9yIGJvb3RpbmcgaXMgY29tcGxldGVkLlxuICAgKiBAcGFyYW0ge251bWJlcn0gdGltZW91dE1zIC0gVGhlIG1heGltdW1tIG51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCBmb3IgdGhlIHN0cmluZyBpbmRpY2F0b3IgcHJlc2VuY2UuXG4gICAqIEByZXR1cm5zIHtQcm9taXNlfSBBIHByb21pc2UgdGhhdCByZXNvbHZlcyB3aGVuIHRoZSBpb3Mgc2ltdWxhdG9yIGxvZ3Mgb3V0cHV0IGEgbGluZSBtYXRjaGluZyBgYm9vdGVkSW5kaWNhdG9yYFxuICAgKiB0aW1lcyBvdXQgYWZ0ZXIgdGltZW91dE1zXG4gICAqL1xuICBhc3luYyB0YWlsTG9nc1VudGlsIChib290ZWRJbmRpY2F0b3IsIHRpbWVvdXRNcykge1xuICAgIGxldCBzaW1Mb2cgPSBwYXRoLnJlc29sdmUodGhpcy5nZXRMb2dEaXIoKSwgJ3N5c3RlbS5sb2cnKTtcblxuICAgIC8vIHdlIG5lZWQgdG8gbWFrZSBzdXJlIGxvZyBmaWxlIGV4aXN0cyBiZWZvcmUgd2UgY2FuIHRhaWwgaXRcbiAgICBhd2FpdCByZXRyeUludGVydmFsKDIwMCwgMjAwLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgZXhpc3RzID0gYXdhaXQgZnMuZXhpc3RzKHNpbUxvZyk7XG4gICAgICBpZiAoIWV4aXN0cykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENvdWxkIG5vdCBmaW5kIFNpbXVsYXRvciBsb2c6ICcke3NpbUxvZ30nYCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBsb2cuaW5mbyhgU2ltdWxhdG9yIGxvZyBhdCAnJHtzaW1Mb2d9J2ApO1xuICAgIGxvZy5pbmZvKGBUYWlsaW5nIHNpbXVsYXRvciBsb2dzIHVudGlsIHdlIGVuY291bnRlciB0aGUgc3RyaW5nIFwiJHtib290ZWRJbmRpY2F0b3J9XCJgKTtcbiAgICBsb2cuaW5mbyhgV2Ugd2lsbCB0aW1lIG91dCBhZnRlciAke3RpbWVvdXRNc31tc2ApO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0YWlsVW50aWwoc2ltTG9nLCBib290ZWRJbmRpY2F0b3IsIHRpbWVvdXRNcyk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2cuZGVidWcoJ1NpbXVsYXRvciBzdGFydHVwIHRpbWVkIG91dC4gQ29udGludWluZyBhbnl3YXkuJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEVuYWJsZSBDYWxlbmRhciBhY2Nlc3MgZm9yIHRoZSBnaXZlbiBhcHBsaWNhdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlEIC0gQnVuZGxlIElEIG9mIHRoZSBhcHBsaWNhdGlvbiwgZm9yIHdoaWNoIHRoZSBhY2Nlc3Mgc2hvdWxkIGJlIGdyYW50ZWQuXG4gICAqL1xuICBhc3luYyBlbmFibGVDYWxlbmRhckFjY2VzcyAoYnVuZGxlSUQpIHtcbiAgICBhd2FpdCB0aGlzLmNhbGVuZGFyLmVuYWJsZUNhbGVuZGFyQWNjZXNzKGJ1bmRsZUlEKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEaXNhYmxlIENhbGVuZGFyIGFjY2VzcyBmb3IgdGhlIGdpdmVuIGFwcGxpY2F0aW9uLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYnVuZGxlSUQgLSBCdW5kbGUgSUQgb2YgdGhlIGFwcGxpY2F0aW9uLCBmb3Igd2hpY2ggdGhlIGFjY2VzcyBzaG91bGQgYmUgZGVuaWVkLlxuICAgKi9cbiAgYXN5bmMgZGlzYWJsZUNhbGVuZGFyQWNjZXNzIChidW5kbGVJRCkge1xuICAgIGF3YWl0IHRoaXMuY2FsZW5kYXIuZGlzYWJsZUNhbGVuZGFyQWNjZXNzKGJ1bmRsZUlEKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayB3aGV0aGVyIHRoZSBnaXZlbiBhcHBsaWNhdGlvbiBoYXMgYWNjZXNzIHRvIENhbGVuZGFyLlxuICAgKlxuICAgKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSBnaXZlbiBhcHBsaWNhdGlvbiBoYXMgdGhlIGFjY2Vzcy5cbiAgICovXG4gIGFzeW5jIGhhc0NhbGVuZGFyQWNjZXNzIChidW5kbGVJRCkge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmNhbGVuZGFyLmhhc0NhbGVuZGFyQWNjZXNzKGJ1bmRsZUlEKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBY3RpdmF0ZXMgU2ltdWxhdG9yIHdpbmRvdy5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHJldHVybnMgez9zdHJpbmd9IElmIHRoZSBtZXRob2QgcmV0dXJucyBhIHN0cmluZyB0aGVuIGl0IHNob3VsZCBiZSBhIHZhbGlkIEFwcGxlIFNjcmlwdCB3aGljaFxuICAgKiBpcyBhcHBlbmRlZCBiZWZvcmUgZWFjaCBVSSBjbGllbnQgY29tbWFuZCBpcyBleGVjdXRlZC4gT3RoZXJ3aXNlIHRoZSBtZXRob2Qgc2hvdWxkIGFjdGl2YXRlIHRoZSB3aW5kb3dcbiAgICogaXRzZWxmIGFuZCByZXR1cm4gbm90aGluZy5cbiAgICovXG4gIGFzeW5jIF9hY3RpdmF0ZVdpbmRvdyAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICAgIHJldHVybiBgXG4gICAgICB0ZWxsIGFwcGxpY2F0aW9uIFwiU3lzdGVtIEV2ZW50c1wiXG4gICAgICAgIHRlbGwgcHJvY2VzcyBcIlNpbXVsYXRvclwiXG4gICAgICAgICAgc2V0IGZyb250bW9zdCB0byBmYWxzZVxuICAgICAgICAgIHNldCBmcm9udG1vc3QgdG8gdHJ1ZVxuICAgICAgICBlbmQgdGVsbFxuICAgICAgZW5kIHRlbGxcbiAgICBgO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4ZWN1dGUgZ2l2ZW4gQXBwbGUgU2NyaXB0IGluc2lkZSBhIGNyaXRpY2FsIHNlY3Rpb24sIHNvIG90aGVyXG4gICAqIHNlc3Npb25zIGNhbm5vdCBpbmZsdWVuY2UgdGhlIFVJIGNsaWVudCBhdCB0aGUgc2FtZSB0aW1lLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYXBwbGVTY3JpcHQgLSBUaGUgdmFsaWQgQXBwbGUgU2NyaXB0IHNuaXBwZXQgdG8gYmUgZXhlY3V0ZWQuXG4gICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIHN0ZG91dCBvdXRwdXQgcHJvZHVjZWQgYnkgdGhlIHNjcmlwdC5cbiAgICogQHRocm93cyB7RXJyb3J9IElmIG9zYXNjcmlwdCB0b29sIHJldHVybnMgbm9uLXplcm8gZXhpdCBjb2RlLlxuICAgKi9cbiAgYXN5bmMgZXhlY3V0ZVVJQ2xpZW50U2NyaXB0IChhcHBsZVNjcmlwdCkge1xuICAgIGNvbnN0IHdpbmRvd0FjdGl2YXRpb25TY3JpcHQgPSBhd2FpdCB0aGlzLl9hY3RpdmF0ZVdpbmRvdygpO1xuICAgIGNvbnN0IHJlc3VsdFNjcmlwdCA9IGAke3dpbmRvd0FjdGl2YXRpb25TY3JpcHQgPyB3aW5kb3dBY3RpdmF0aW9uU2NyaXB0ICsgJ1xcbicgOiAnJ30ke2FwcGxlU2NyaXB0fWA7XG4gICAgbG9nLmRlYnVnKGBFeGVjdXRpbmcgVUkgQXBwbGUgU2NyaXB0IG9uIFNpbXVsYXRvciB3aXRoIFVESUQgJHt0aGlzLnVkaWR9OiAke3Jlc3VsdFNjcmlwdH1gKTtcbiAgICByZXR1cm4gYXdhaXQgVUlfQ0xJRU5UX0FDQ0VTU19HVUFSRC5hY3F1aXJlKHRoaXMuc2ltdWxhdG9yQXBwLCBhc3luYyAoKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWMoJ29zYXNjcmlwdCcsIFsnLWUnLCByZXN1bHRTY3JpcHRdKTtcbiAgICAgICAgcmV0dXJuIHN0ZG91dDtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBsb2cuZXJyb3JBbmRUaHJvdyhgQ291bGQgbm90IGNvbXBsZXRlIG9wZXJhdGlvbi4gTWFrZSBzdXJlIFNpbXVsYXRvciBVSSBpcyBydW5uaW5nIGFuZCB0aGUgcGFyZW50IEFwcGl1bSBhcHBsaWNhdGlvbiAoZS4gZy4gQXBwaXVtLmFwcCBvciBUZXJtaW5hbC5hcHApIGAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICBgaXMgcHJlc2VudCBpbiBTeXN0ZW0gUHJlZmVyZW5jZXMgPiBTZWN1cml0eSAmIFByaXZhY3kgPiBQcml2YWN5ID4gQWNjZXNzaWJpbGl0eSBsaXN0LiBJZiB0aGUgb3BlcmF0aW9uIGlzIHN0aWxsIHVuc3VjY2Vzc2Z1bCB0aGVuIGAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICBgaXQgaXMgbm90IHN1cHBvcnRlZCBieSB0aGlzIFNpbXVsYXRvci4gYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGBPcmlnaW5hbCBlcnJvcjogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGN1cnJlbnQgc3RhdGUgb2YgQmlvbWV0cmljIEVucm9sbG1lbnQgZmVhdHVyZS5cbiAgICpcbiAgICogQHJldHVybnMge2Jvb2xlYW59IEVpdGhlciB0cnVlIG9yIGZhbHNlXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBJZiBFbnJvbGxtZW50IHN0YXRlIGNhbm5vdCBiZSBkZXRlcm1pbmVkXG4gICAqL1xuICBhc3luYyBpc0Jpb21ldHJpY0Vucm9sbGVkICgpIHtcbiAgICBjb25zdCBvdXRwdXQgPSBhd2FpdCB0aGlzLmV4ZWN1dGVVSUNsaWVudFNjcmlwdChgXG4gICAgICB0ZWxsIGFwcGxpY2F0aW9uIFwiU3lzdGVtIEV2ZW50c1wiXG4gICAgICAgIHRlbGwgcHJvY2VzcyBcIlNpbXVsYXRvclwiXG4gICAgICAgICAgc2V0IGRzdE1lbnVJdGVtIHRvIG1lbnUgaXRlbSBcIlRvdWNoIElEIEVucm9sbGVkXCIgb2YgbWVudSAxIG9mIG1lbnUgYmFyIGl0ZW0gXCJIYXJkd2FyZVwiIG9mIG1lbnUgYmFyIDFcbiAgICAgICAgICBzZXQgaXNDaGVja2VkIHRvICh2YWx1ZSBvZiBhdHRyaWJ1dGUgXCJBWE1lbnVJdGVtTWFya0NoYXJcIiBvZiBkc3RNZW51SXRlbSkgaXMgXCLinJNcIlxuICAgICAgICBlbmQgdGVsbFxuICAgICAgZW5kIHRlbGxcbiAgICBgKTtcbiAgICBsb2cuZGVidWcoYFRvdWNoIElEIGVucm9sbGVkIHN0YXRlOiAke291dHB1dH1gKTtcbiAgICByZXR1cm4gXy5pc1N0cmluZyhvdXRwdXQpICYmIG91dHB1dC50cmltKCkgPT09ICd0cnVlJztcbiAgfVxuXG4gIC8qKlxuICAgKiBFbnJvbGxzIGJpb21ldHJpYyAoVG91Y2hJZCwgRmFjZUlkKSBmZWF0dXJlIHRlc3RpbmcgaW4gU2ltdWxhdG9yIFVJIGNsaWVudC5cbiAgICpcbiAgICogQHBhcmFtIHtib29sZWFufSBpc0VuYWJsZWQgLSBEZWZpbmVzIHdoZXRoZXIgYmlvbWV0cmljIHN0YXRlIGlzIGVuYWJsZWQvZGlzYWJsZWRcbiAgICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBlbnJvbGxlZCBzdGF0ZSBjYW5ub3QgYmUgY2hhbmdlZFxuICAgKi9cbiAgYXN5bmMgZW5yb2xsQmlvbWV0cmljIChpc0VuYWJsZWQgPSB0cnVlKSB7XG4gICAgYXdhaXQgdGhpcy5leGVjdXRlVUlDbGllbnRTY3JpcHQoYFxuICAgICAgdGVsbCBhcHBsaWNhdGlvbiBcIlN5c3RlbSBFdmVudHNcIlxuICAgICAgICB0ZWxsIHByb2Nlc3MgXCJTaW11bGF0b3JcIlxuICAgICAgICAgIHNldCBkc3RNZW51SXRlbSB0byBtZW51IGl0ZW0gXCJUb3VjaCBJRCBFbnJvbGxlZFwiIG9mIG1lbnUgMSBvZiBtZW51IGJhciBpdGVtIFwiSGFyZHdhcmVcIiBvZiBtZW51IGJhciAxXG4gICAgICAgICAgc2V0IGlzQ2hlY2tlZCB0byAodmFsdWUgb2YgYXR0cmlidXRlIFwiQVhNZW51SXRlbU1hcmtDaGFyXCIgb2YgZHN0TWVudUl0ZW0pIGlzIFwi4pyTXCJcbiAgICAgICAgICBpZiAke2lzRW5hYmxlZCA/ICdub3QgJyA6ICcnfWlzQ2hlY2tlZCB0aGVuXG4gICAgICAgICAgICBjbGljayBkc3RNZW51SXRlbVxuICAgICAgICAgIGVuZCBpZlxuICAgICAgICBlbmQgdGVsbFxuICAgICAgZW5kIHRlbGxcbiAgICBgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kcyBhIG5vdGlmaWNhdGlvbiB0byBtYXRjaC9ub3QgbWF0Y2ggdGhlIHRvdWNoIGlkLlxuICAgKlxuICAgKiBAcGFyYW0gez9ib29sZWFufSBzaG91bGRNYXRjaCBbdHJ1ZV0gLSBTZXQgaXQgdG8gdHJ1ZSBvciBmYWxzZSBpbiBvcmRlciB0byBlbXVsYXRlXG4gICAqIG1hdGNoaW5nL25vdCBtYXRjaGluZyB0aGUgY29ycmVzcG9uZGluZyBiaW9tZXRyaWNcbiAgICovXG4gIGFzeW5jIHNlbmRCaW9tZXRyaWNNYXRjaCAoc2hvdWxkTWF0Y2ggPSB0cnVlKSB7XG4gICAgYXdhaXQgdGhpcy5leGVjdXRlVUlDbGllbnRTY3JpcHQoYFxuICAgICAgdGVsbCBhcHBsaWNhdGlvbiBcIlN5c3RlbSBFdmVudHNcIlxuICAgICAgICB0ZWxsIHByb2Nlc3MgXCJTaW11bGF0b3JcIlxuICAgICAgICAgIHNldCBkc3RNZW51SXRlbSB0byBtZW51IGl0ZW0gXCIke3Nob3VsZE1hdGNoID8gJ01hdGNoaW5nJyA6ICdOb24tbWF0Y2hpbmcnfVwiIG9mIG1lbnUgMSBvZiBtZW51IGl0ZW0gXCJTaW11bGF0ZSBGaW5nZXIgVG91Y2hcIiBvZiBtZW51IDEgb2YgbWVudSBiYXIgaXRlbSBcIkhhcmR3YXJlXCIgb2YgbWVudSBiYXIgMVxuICAgICAgICAgIGNsaWNrIGRzdE1lbnVJdGVtXG4gICAgICAgIGVuZCB0ZWxsXG4gICAgICBlbmQgdGVsbFxuICAgIGApO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4ZWN1dGUgYSBzcGVjaWFsIEFwcGxlIHNjcmlwdCwgd2hpY2ggY2xpY2tzIHRoZSBwYXJ0aWN1bGFyIGJ1dHRvbiBvbiBEYXRhYmFzZSBhbGVydC5cbiAgICpcbiAgICogQHBhcmFtIHtib29sZWFufSBpbmNyZWFzZSAtIENsaWNrIHRoZSBidXR0b24gd2l0aCAnSW5jcmVhc2UnIHRpdGxlIG9uIHRoZSBhbGVydCBpZiB0aGlzXG4gICAqICAgcGFyYW1ldGVyIGlzIHRydWUuIFRoZSAnQ2FuY2VsJyBidXR0b24gd2lsbCBiZSBjbGlja2VkIG90aGVyd2lzZS5cbiAgICovXG4gIGFzeW5jIGRpc21pc3NEYXRhYmFzZUFsZXJ0IChpbmNyZWFzZSA9IHRydWUpIHtcbiAgICBsZXQgYnV0dG9uID0gaW5jcmVhc2UgPyAnSW5jcmVhc2UnIDogJ0NhbmNlbCc7XG4gICAgbG9nLmRlYnVnKGBBdHRlbXB0aW5nIHRvIGRpc21pc3MgZGF0YWJhc2UgYWxlcnQgd2l0aCAnJHtidXR0b259JyBidXR0b25gKTtcbiAgICBhd2FpdCB0aGlzLmV4ZWN1dGVVSUNsaWVudFNjcmlwdChgXG4gICAgICB0ZWxsIGFwcGxpY2F0aW9uIFwiU3lzdGVtIEV2ZW50c1wiXG4gICAgICAgIHRlbGwgcHJvY2VzcyBcIlNpbXVsYXRvclwiXG4gICAgICAgICAgY2xpY2sgYnV0dG9uIFwiJHtidXR0b259XCIgb2Ygd2luZG93IDFcbiAgICAgICAgZW5kIHRlbGxcbiAgICAgIGVuZCB0ZWxsXG4gICAgYCk7XG4gIH1cblxuICAvL3JlZ2lvbiBLZXljaGFpbnMgSW50ZXJhY3Rpb25cbiAgLyoqXG4gICAqIENyZWF0ZSB0aGUgYmFja3VwIG9mIGtleWNoYWlucyBmb2xkZXIuXG4gICAqIFRoZSBwcmV2aW91c2x5IGNyZWF0ZWQgYmFja3VwIHdpbGwgYmUgYXV0b21hdGljYWxseVxuICAgKiBkZWxldGVkIGlmIHRoaXMgbWV0aG9kIHdhcyBjYWxsZWQgdHdpY2UgaW4gYSByb3cgd2l0aG91dFxuICAgKiBgcmVzdG9yZUtleWNoYWluc2AgYmVpbmcgaW52b2tlZC5cbiAgICpcbiAgICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgdGhlIGJhY2t1cCBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWxsLlxuICAgKi9cbiAgYXN5bmMgYmFja3VwS2V5Y2hhaW5zICgpIHtcbiAgICBpZiAoIWF3YWl0IGZzLmV4aXN0cyh0aGlzLmtleWNoYWluUGF0aCkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBjb25zdCBiYWNrdXBQYXRoID0gYXdhaXQgdGVtcERpci5wYXRoKHtcbiAgICAgIHByZWZpeDogYGtleWNoYWluc19iYWNrdXBfJHtNYXRoLmZsb29yKCgxICsgTWF0aC5yYW5kb20oKSkgKiAweDEwMDAwKS50b1N0cmluZygxNikuc3Vic3RyaW5nKDEpfWAsXG4gICAgICBzdWZmaXg6ICcuemlwJyxcbiAgICB9KTtcbiAgICBjb25zdCB6aXBBcmdzID0gW1xuICAgICAgJy1yJywgYmFja3VwUGF0aCxcbiAgICAgIGAke3RoaXMua2V5Y2hhaW5QYXRofSR7cGF0aC5zZXB9YFxuICAgIF07XG4gICAgbG9nLmRlYnVnKGBDcmVhdGluZyBrZXljaGFpbnMgYmFja3VwIHdpdGggJ3ppcCAke3ppcEFyZ3Muam9pbignICcpfScgY29tbWFuZGApO1xuICAgIGF3YWl0IGV4ZWMoJ3ppcCcsIHppcEFyZ3MpO1xuICAgIGlmIChfLmlzU3RyaW5nKHRoaXMuX2tleWNoYWluc0JhY2t1cFBhdGgpICYmIGF3YWl0IGZzLmV4aXN0cyh0aGlzLl9rZXljaGFpbnNCYWNrdXBQYXRoKSkge1xuICAgICAgYXdhaXQgZnMudW5saW5rKHRoaXMuX2tleWNoYWluc0JhY2t1cFBhdGgpO1xuICAgIH1cbiAgICB0aGlzLl9rZXljaGFpbnNCYWNrdXBQYXRoID0gYmFja3VwUGF0aDtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXN0b3JlIHRoZSBwcmV2aXNvdWx5IGNyZWF0ZWQga2V5Y2hhaW5zIGJhY2t1cC5cbiAgICpcbiAgICogQHBhcmFtIHs/c3RyaW5nfEFycmF5PHN0cmluZz59IGV4Y2x1ZGVQYXR0ZXJucyAtIFRoZSBsaXN0XG4gICAqIG9mIGZpbGUgbmFtZSBwYXR0ZXJucyB0byBiZSBleGNsdWRlZCBmcm9tIHJlc3RvcmUuIFRoZSBmb3JtYXRcbiAgICogb2YgZWFjaCBpdGVtIHNob3VsZCBiZSB0aGUgc2FtZSBhcyAnLXgnIG9wdGlvbiBmb3JtYXQgZm9yXG4gICAqICd1bnppcCcgdXRpbGl0eS4gVGhpcyBjYW4gYWxzbyBiZSBhIGNvbW1hLXNlcGFyYXRlZCBzdHJpbmcsXG4gICAqIHdoaWNoIGlzIGdvaW5nIGJlIHRyYW5zZm9ybWVkIGludG8gYSBsaXN0IGF1dG9tYXRpY2FsbHksXG4gICAqIGZvciBleGFtcGxlOiAnKi5kYiosYmxhYmxhLnNxbGl0ZSdcbiAgICogQHJldHVybnMge2Jvb2xlYW59IElmIHRoZSByZXN0b3JlIG9wcmF0aW9uIHdhcyBzdWNjZXNzZnVsLlxuICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlcmUgaXMgbm8ga2V5Y2hhaW5zIGJhY2t1cCBhdmFpbGFibGUgZm9yIHJlc3RvcmUuXG4gICAqL1xuICBhc3luYyByZXN0b3JlS2V5Y2hhaW5zIChleGNsdWRlUGF0dGVybnMgPSBbXSkge1xuICAgIGlmICghXy5pc1N0cmluZyh0aGlzLl9rZXljaGFpbnNCYWNrdXBQYXRoKSB8fCAhYXdhaXQgZnMuZXhpc3RzKHRoaXMuX2tleWNoYWluc0JhY2t1cFBhdGgpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSBrZXljaGFpbnMgYmFja3VwIGFyY2hpdmUgZG9lcyBub3QgZXhpc3QuIGAgK1xuICAgICAgICAgICAgICAgICAgICAgIGBBcmUgeW91IHN1cmUgaXQgd2FzIGNyZWF0ZWQgYmVmb3JlP2ApO1xuICAgIH1cblxuICAgIGlmIChfLmlzU3RyaW5nKGV4Y2x1ZGVQYXR0ZXJucykpIHtcbiAgICAgIGV4Y2x1ZGVQYXR0ZXJucyA9IGV4Y2x1ZGVQYXR0ZXJucy5zcGxpdCgnLCcpLm1hcCgoeCkgPT4geC50cmltKCkpO1xuICAgIH1cbiAgICBjb25zdCB7c3RhdGV9ID0gYXdhaXQgdGhpcy5zdGF0KCk7XG4gICAgY29uc3QgaXNTZXJ2ZXJSdW5uaW5nID0gc3RhdGUgPT09ICdCb290ZWQnO1xuICAgIGxldCBwbGlzdFBhdGg7XG4gICAgaWYgKGlzU2VydmVyUnVubmluZykge1xuICAgICAgcGxpc3RQYXRoID0gcGF0aC5yZXNvbHZlKGF3YWl0IHRoaXMuZ2V0TGF1bmNoRGFlbW9uc1Jvb3QoKSwgJ2NvbS5hcHBsZS5zZWN1cml0eWQucGxpc3QnKTtcbiAgICAgIGlmICghYXdhaXQgZnMuZXhpc3RzKHBsaXN0UGF0aCkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgY2xlYXIga2V5Y2hhaW5zIGJlY2F1c2UgJyR7cGxpc3RQYXRofScgZG9lcyBub3QgZXhpc3RgKTtcbiAgICAgIH1cbiAgICAgIGF3YWl0IHNpbWN0bC5zcGF3bih0aGlzLnVkaWQsIFsnbGF1bmNoY3RsJywgJ3VubG9hZCcsIHBsaXN0UGF0aF0pO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgYXdhaXQgZnMucmltcmFmKHRoaXMua2V5Y2hhaW5QYXRoKTtcbiAgICAgIGF3YWl0IG1rZGlycCh0aGlzLmtleWNoYWluUGF0aCk7XG4gICAgICBjb25zdCB1bnppcEFyZ3MgPSBbXG4gICAgICAgICctbycsIHRoaXMuX2tleWNoYWluc0JhY2t1cFBhdGgsXG4gICAgICAgIC4uLihfLmZsYXRNYXAoZXhjbHVkZVBhdHRlcm5zLm1hcCgoeCkgPT4gWycteCcsIHhdKSkpLFxuICAgICAgICAnLWQnLCAnLydcbiAgICAgIF07XG4gICAgICBsb2cuZGVidWcoYFJlc3RvcmluZyBrZXljaGFpbnMgd2l0aCAndW56aXAgJHt1bnppcEFyZ3Muam9pbignICcpfScgY29tbWFuZGApO1xuICAgICAgYXdhaXQgZXhlYygndW56aXAnLCB1bnppcEFyZ3MpO1xuICAgICAgYXdhaXQgZnMudW5saW5rKHRoaXMuX2tleWNoYWluc0JhY2t1cFBhdGgpO1xuICAgICAgdGhpcy5fa2V5Y2hhaW5zQmFja3VwUGF0aCA9IG51bGw7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGlmIChpc1NlcnZlclJ1bm5pbmcgJiYgcGxpc3RQYXRoKSB7XG4gICAgICAgIGF3YWl0IHNpbWN0bC5zcGF3bih0aGlzLnVkaWQsIFsnbGF1bmNoY3RsJywgJ2xvYWQnLCBwbGlzdFBhdGhdKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvKipcbiAgICogQ2xlYXJzIEtleWNoYWlucyBmb3IgdGhlIHBhcnRpY3VsYXIgc2ltdWxhdG9yIGluIHJ1bnRpbWUgKHRoZXJlIGlzIG5vIG5lZWQgdG8gc3RvcCBpdCkuXG4gICAqXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBJZiBrZXljaGFpbiBjbGVhbnVwIGhhcyBmYWlsZWQuXG4gICAqL1xuICBhc3luYyBjbGVhcktleWNoYWlucyAoKSB7XG4gICAgY29uc3QgcGxpc3RQYXRoID0gcGF0aC5yZXNvbHZlKGF3YWl0IHRoaXMuZ2V0TGF1bmNoRGFlbW9uc1Jvb3QoKSwgJ2NvbS5hcHBsZS5zZWN1cml0eWQucGxpc3QnKTtcbiAgICBpZiAoIWF3YWl0IGZzLmV4aXN0cyhwbGlzdFBhdGgpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBjbGVhciBrZXljaGFpbnMgYmVjYXVzZSAnJHtwbGlzdFBhdGh9JyBkb2VzIG5vdCBleGlzdGApO1xuICAgIH1cbiAgICBhd2FpdCBzaW1jdGwuc3Bhd24odGhpcy51ZGlkLCBbJ2xhdW5jaGN0bCcsICd1bmxvYWQnLCBwbGlzdFBhdGhdKTtcbiAgICB0cnkge1xuICAgICAgaWYgKGF3YWl0IGZzLmV4aXN0cyh0aGlzLmtleWNoYWluUGF0aCkpIHtcbiAgICAgICAgYXdhaXQgZnMucmltcmFmKHRoaXMua2V5Y2hhaW5QYXRoKTtcbiAgICAgICAgYXdhaXQgbWtkaXJwKHRoaXMua2V5Y2hhaW5QYXRoKTtcbiAgICAgIH1cbiAgICB9IGZpbmFsbHkge1xuICAgICAgYXdhaXQgc2ltY3RsLnNwYXduKHRoaXMudWRpZCwgWydsYXVuY2hjdGwnLCAnbG9hZCcsIHBsaXN0UGF0aF0pO1xuICAgIH1cbiAgfVxuXG4gIC8vZW5kcmVnaW9uXG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIHBhcnRpY3VsYXIgcGVybWlzc2lvbiB0byB0aGUgYXBwbGljYXRpb24gYnVuZGxlLiBTZWVcbiAgICogaHR0cHM6Ly9naXRodWIuY29tL3dpeC9BcHBsZVNpbXVsYXRvclV0aWxzIGZvciBtb3JlIGRldGFpbHMgb25cbiAgICogdGhlIGF2YWlsYWJsZSBzZXJ2aWNlIG5hbWVzIGFuZCBzdGF0dXNlcy5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gQXBwbGljYXRpb24gYnVuZGxlIGlkZW50aWZpZXIuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBwZXJtaXNzaW9uIC0gU2VydmljZSBuYW1lIHRvIGJlIHNldC5cbiAgICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlIC0gVGhlIGRlc2lyZWQgc3RhdHVzIGZvciB0aGUgc2VydmljZS5cbiAgICogQHRocm93cyB7RXJyb3J9IElmIHRoZXJlIHdhcyBhbiBlcnJvciB3aGlsZSBjaGFuZ2luZyBwZXJtaXNzaW9uLlxuICAgKi9cbiAgYXN5bmMgc2V0UGVybWlzc2lvbiAoYnVuZGxlSWQsIHBlcm1pc3Npb24sIHZhbHVlKSB7XG4gICAgYXdhaXQgdGhpcy5zZXRQZXJtaXNzaW9ucyhidW5kbGVJZCwge1twZXJtaXNzaW9uXTogdmFsdWV9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBwZXJtaXNzaW9ucyBmb3IgdGhlIHBhcnRpY3VsYXIgYXBwbGljYXRpb24gYnVuZGxlLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYnVuZGxlSWQgLSBBcHBsaWNhdGlvbiBidW5kbGUgaWRlbnRpZmllci5cbiAgICogQHBhcmFtIHtPYmplY3R9IHBlcm1pc3Npb25zTWFwcGluZyAtIEEgbWFwcGluZyB3aGVyZSBrYXlzXG4gICAqIGFyZSBzZXJ2aWNlIG5hbWVzIGFuZCB2YWx1ZXMgYXJlIHRoZWlyIGNvcnJlc3BvbmRpbmcgc3RhdHVzIHZhbHVlcy5cbiAgICogU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS93aXgvQXBwbGVTaW11bGF0b3JVdGlsc1xuICAgKiBmb3IgbW9yZSBkZXRhaWxzIG9uIGF2YWlsYWJsZSBzZXJ2aWNlIG5hbWVzIGFuZCBzdGF0dXNlcy5cbiAgICogQHRocm93cyB7RXJyb3J9IElmIHRoZXJlIHdhcyBhbiBlcnJvciB3aGlsZSBjaGFuZ2luZyBwZXJtaXNzaW9ucy5cbiAgICovXG4gIGFzeW5jIHNldFBlcm1pc3Npb25zIChidW5kbGVJZCwgcGVybWlzc2lvbnNNYXBwaW5nKSB7XG4gICAgYXdhaXQgdGhpcy5wZXJtaXNzaW9ucy5zZXRBY2Nlc3MoYnVuZGxlSWQsIHBlcm1pc3Npb25zTWFwcGluZyk7XG4gICAgbG9nLmRlYnVnKGBTZXQgJHtKU09OLnN0cmluZ2lmeShwZXJtaXNzaW9uc01hcHBpbmcpfSBhY2Nlc3MgZm9yICcke2J1bmRsZUlkfSdgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgY3VycmVudCBwZXJtaXNzaW9uIHN0YXR1cyBmb3IgdGhlIGdpdmVuIGFwcGxpY2F0aW9uIGJ1bmRsZS5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gQXBwbGljYXRpb24gYnVuZGxlIGlkZW50aWZpZXIuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBzZXJ2aWNlTmFtZSAtIE9uZSBvZiBhdmFpbGFibGUgc2VydmljZSBuYW1lcy5cbiAgICogQHRocm93cyB7RXJyb3J9IElmIHRoZXJlIHdhcyBhbiBlcnJvciB3aGlsZSByZXRyaWV2aW5nIHBlcm1pc3Npb25zLlxuICAgKi9cbiAgYXN5bmMgZ2V0UGVybWlzc2lvbiAoYnVuZGxlSWQsIHNlcnZpY2VOYW1lKSB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5wZXJtaXNzaW9ucy5nZXRBY2Nlc3MoYnVuZGxlSWQsIHNlcnZpY2VOYW1lKTtcbiAgICBsb2cuZGVidWcoYEdvdCAke3NlcnZpY2VOYW1lfSBhY2Nlc3Mgc3RhdHVzIGZvciAnJHtidW5kbGVJZH0nOiAke3Jlc3VsdH1gKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgYXN5bmMgZ2V0TGF1bmNoRGFlbW9uc1Jvb3QgKCkge1xuICAgIGNvbnN0IGRldlJvb3QgPSBhd2FpdCBnZXREZXZlbG9wZXJSb290KCk7XG4gICAgcmV0dXJuIHBhdGgucmVzb2x2ZShkZXZSb290LFxuICAgICAgJ1BsYXRmb3Jtcy9pUGhvbmVTaW11bGF0b3IucGxhdGZvcm0vRGV2ZWxvcGVyL1NES3MvaVBob25lU2ltdWxhdG9yLnNkay9TeXN0ZW0vTGlicmFyeS9MYXVuY2hEYWVtb25zJyk7XG4gIH1cblxuICBzdGF0aWMgYXN5bmMgX2dldERldmljZVN0cmluZ1BsYXRmb3JtVmVyc2lvbiAocGxhdGZvcm1WZXJzaW9uKSB7XG4gICAgbGV0IHJlcVZlcnNpb24gPSBwbGF0Zm9ybVZlcnNpb247XG4gICAgaWYgKCFyZXFWZXJzaW9uKSB7XG4gICAgICByZXFWZXJzaW9uID0gYXdhaXQgeGNvZGUuZ2V0TWF4SU9TU0RLKCk7XG4gICAgICBsb2cud2FybihgTm8gcGxhdGZvcm0gdmVyc2lvbiBzZXQuIFVzaW5nIG1heCBTREsgdmVyc2lvbjogJHtyZXFWZXJzaW9ufWApO1xuICAgICAgLy8gdGhpcyB3aWxsIGJlIGEgbnVtYmVyLCBhbmQgcG9zc2libHkgYW4gaW50ZWdlciAoZS5nLiwgaWYgbWF4IGlPUyBTREsgaXMgOSlcbiAgICAgIC8vIHNvIHR1cm4gaXQgaW50byBhIHN0cmluZyBhbmQgYWRkIGEgLjAgaWYgbmVjZXNzYXJ5XG4gICAgICBpZiAoIV8uaXNTdHJpbmcocmVxVmVyc2lvbikpIHtcbiAgICAgICAgcmVxVmVyc2lvbiA9IChyZXFWZXJzaW9uICUgMSkgPyBTdHJpbmcocmVxVmVyc2lvbikgOiBgJHtyZXFWZXJzaW9ufS4wYDtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlcVZlcnNpb247XG4gIH1cblxuICAvLyBjaGFuZ2UgdGhlIGZvcm1hdCBpbiBzdWJjbGFzc2VzLCBhcyBuZWNlc3NhcnlcbiAgc3RhdGljIGFzeW5jIF9nZXREZXZpY2VTdHJpbmdWZXJzaW9uU3RyaW5nIChwbGF0Zm9ybVZlcnNpb24pIHtcbiAgICBsZXQgcmVxVmVyc2lvbiA9IGF3YWl0IHRoaXMuX2dldERldmljZVN0cmluZ1BsYXRmb3JtVmVyc2lvbihwbGF0Zm9ybVZlcnNpb24pO1xuXG4gICAgcmV0dXJuIGAoJHtyZXFWZXJzaW9ufSBTaW11bGF0b3IpYDtcbiAgfVxuXG4gIC8vIGNoYW5nZSB0aGUgZm9ybWF0IGluIHN1YmNsYXNzZXMsIGFzIG5lY2Vzc2FyeVxuICBzdGF0aWMgX2dldERldmljZVN0cmluZ0NvbmZpZ0ZpeCAoKSB7XG4gICAgLy8gc29tZSBkZXZpY2VzIG5lZWQgdG8gYmUgdXBkYXRlZFxuICAgIHJldHVybiB7XG4gICAgICAnaVBhZCBTaW11bGF0b3IgKDcuMSBTaW11bGF0b3IpJzogJ2lQYWQgMiAoNy4xIFNpbXVsYXRvciknLFxuICAgICAgJ2lQYWQgU2ltdWxhdG9yICg4LjAgU2ltdWxhdG9yKSc6ICdpUGFkIDIgKDguMCBTaW11bGF0b3IpJyxcbiAgICAgICdpUGFkIFNpbXVsYXRvciAoOC4xIFNpbXVsYXRvciknOiAnaVBhZCAyICg4LjEgU2ltdWxhdG9yKScsXG4gICAgICAnaVBhZCBTaW11bGF0b3IgKDguMiBTaW11bGF0b3IpJzogJ2lQYWQgMiAoOC4yIFNpbXVsYXRvciknLFxuICAgICAgJ2lQYWQgU2ltdWxhdG9yICg4LjMgU2ltdWxhdG9yKSc6ICdpUGFkIDIgKDguMyBTaW11bGF0b3IpJyxcbiAgICAgICdpUGFkIFNpbXVsYXRvciAoOC40IFNpbXVsYXRvciknOiAnaVBhZCAyICg4LjQgU2ltdWxhdG9yKScsXG4gICAgICAnaVBob25lIFNpbXVsYXRvciAoNy4xIFNpbXVsYXRvciknOiAnaVBob25lIDVzICg3LjEgU2ltdWxhdG9yKScsXG4gICAgICAnaVBob25lIFNpbXVsYXRvciAoOC40IFNpbXVsYXRvciknOiAnaVBob25lIDYgKDguNCBTaW11bGF0b3IpJyxcbiAgICAgICdpUGhvbmUgU2ltdWxhdG9yICg4LjMgU2ltdWxhdG9yKSc6ICdpUGhvbmUgNiAoOC4zIFNpbXVsYXRvciknLFxuICAgICAgJ2lQaG9uZSBTaW11bGF0b3IgKDguMiBTaW11bGF0b3IpJzogJ2lQaG9uZSA2ICg4LjIgU2ltdWxhdG9yKScsXG4gICAgICAnaVBob25lIFNpbXVsYXRvciAoOC4xIFNpbXVsYXRvciknOiAnaVBob25lIDYgKDguMSBTaW11bGF0b3IpJyxcbiAgICAgICdpUGhvbmUgU2ltdWxhdG9yICg4LjAgU2ltdWxhdG9yKSc6ICdpUGhvbmUgNiAoOC4wIFNpbXVsYXRvciknXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUYWtlcyBhIHNldCBvZiBvcHRpb25zIGFuZCBmaW5kcyB0aGUgY29ycmVjdCBkZXZpY2Ugc3RyaW5nIGluIG9yZGVyIGZvciBJbnN0cnVtZW50cyB0b1xuICAgKiBpZGVudGlmeSB0aGUgY29ycmVjdCBzaW11bGF0b3IuXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBvcHRzIC0gVGhlIG9wdGlvbnMgYXZhaWxhYmxlIGFyZTpcbiAgICogICAtIGBkZXZpY2VOYW1lYCAtIGEgbmFtZSBmb3IgdGhlIGRldmljZS4gSWYgdGhlIGdpdmVuIGRldmljZSBuYW1lIHN0YXJ0cyB3aXRoIGA9YCwgdGhlIG5hbWUsIGxlc3MgdGhlIGVxdWFscyBzaWduLCBpcyByZXR1cm5lZC5cbiAgICogICAtIGBwbGF0Zm9ybVZlcnNpb25gIC0gdGhlIHZlcnNpb24gb2YgaU9TIHRvIHVzZS4gRGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgWGNvZGUncyBtYXhpbXVtIFNESyB2ZXJzaW9uLlxuICAgKiAgIC0gYGZvcmNlSXBob25lYCAtIGZvcmNlIHRoZSBjb25maWd1cmF0aW9uIG9mIHRoZSBkZXZpY2Ugc3RyaW5nIHRvIGlQaG9uZS4gRGVmYXVsdHMgdG8gYGZhbHNlYC5cbiAgICogICAtIGBmb3JjZUlwYWRgIC0gZm9yY2UgdGhlIGNvbmZpZ3VyYXRpb24gb2YgdGhlIGRldmljZSBzdHJpbmcgdG8gaVBhZC4gRGVmYXVsdHMgdG8gYGZhbHNlYC5cbiAgICogICBJZiBib3RoIGBmb3JjZUlwaG9uZWAgYW5kIGBmb3JjZUlwYWRgIGFyZSB0cnVlLCB0aGUgZGV2aWNlIHdpbGwgYmUgZm9yY2VkIHRvIGlQaG9uZS5cbiAgICpcbiAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgZm91bmQgZGV2aWNlIHN0cmluZy5cbiAgICovXG4gIHN0YXRpYyBhc3luYyBnZXREZXZpY2VTdHJpbmcgKG9wdHMpIHtcbiAgICBvcHRzID0gT2JqZWN0LmFzc2lnbih7fSwge1xuICAgICAgZGV2aWNlTmFtZTogbnVsbCxcbiAgICAgIHBsYXRmb3JtVmVyc2lvbjogbnVsbCxcbiAgICAgIGZvcmNlSXBob25lOiBmYWxzZSxcbiAgICAgIGZvcmNlSXBhZDogZmFsc2VcbiAgICB9LCBvcHRzKTtcbiAgICBsZXQgbG9nT3B0cyA9IHtcbiAgICAgIGRldmljZU5hbWU6IG9wdHMuZGV2aWNlTmFtZSxcbiAgICAgIHBsYXRmb3JtVmVyc2lvbjogb3B0cy5wbGF0Zm9ybVZlcnNpb24sXG4gICAgICBmb3JjZUlwaG9uZTogb3B0cy5mb3JjZUlwaG9uZSxcbiAgICAgIGZvcmNlSXBhZDogb3B0cy5mb3JjZUlwYWRcbiAgICB9O1xuICAgIGxvZy5kZWJ1ZyhgR2V0dGluZyBkZXZpY2Ugc3RyaW5nIGZyb20gb3B0aW9uczogJHtKU09OLnN0cmluZ2lmeShsb2dPcHRzKX1gKTtcblxuICAgIC8vIHNob3J0IGNpcmN1aXQgaWYgd2UgYWxyZWFkeSBoYXZlIGEgZGV2aWNlIG5hbWVcbiAgICBpZiAoKG9wdHMuZGV2aWNlTmFtZSB8fCAnJylbMF0gPT09ICc9Jykge1xuICAgICAgcmV0dXJuIG9wdHMuZGV2aWNlTmFtZS5zdWJzdHJpbmcoMSk7XG4gICAgfVxuXG4gICAgbGV0IGlzaVBob25lID0gISFvcHRzLmZvcmNlSXBob25lIHx8ICFvcHRzLmZvcmNlSXBhZDtcblxuICAgIGlmIChvcHRzLmRldmljZU5hbWUpIHtcbiAgICAgIGxldCBkZXZpY2UgPSBvcHRzLmRldmljZU5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICAgIGlmIChkZXZpY2UuaW5kZXhPZignaXBob25lJykgIT09IC0xKSB7XG4gICAgICAgIGlzaVBob25lID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSBpZiAoZGV2aWNlLmluZGV4T2YoJ2lwYWQnKSAhPT0gLTEpIHtcbiAgICAgICAgaXNpUGhvbmUgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBsZXQgaW9zRGV2aWNlU3RyaW5nID0gb3B0cy5kZXZpY2VOYW1lIHx8IChpc2lQaG9uZSA/ICdpUGhvbmUgU2ltdWxhdG9yJyA6ICdpUGFkIFNpbXVsYXRvcicpO1xuXG4gICAgLy8gaWYgc29tZW9uZSBwYXNzZXMgaW4ganVzdCBcImlQaG9uZVwiLCBtYWtlIHRoYXQgXCJpUGhvbmUgU2ltdWxhdG9yXCIgdG9cbiAgICAvLyBjb25mb3JtIHRvIGFsbCB0aGUgbG9naWMgYmVsb3dcbiAgICBpZiAoL14oaVBob25lfGlQYWQpJC8udGVzdChpb3NEZXZpY2VTdHJpbmcpKSB7XG4gICAgICBpb3NEZXZpY2VTdHJpbmcgKz0gJyBTaW11bGF0b3InO1xuICAgIH1cblxuICAgIC8vIHdlIHN1cHBvcnQgZGV2aWNlTmFtZTogXCJpUGhvbmUgU2ltdWxhdG9yXCIsIGFuZCBhbHNvIHdhbnQgdG8gc3VwcG9ydFxuICAgIC8vIFwiaVBob25lIFhZWiBTaW11bGF0b3JcIiwgYnV0IHRoZXNlIHN0cmluZ3MgYXJlbid0IGluIHRoZSBkZXZpY2UgbGlzdC5cbiAgICAvLyBTbywgaWYgc29tZW9uZSBzZW50IGluIFwiaVBob25lIFhZWiBTaW11bGF0b3JcIiwgc3RyaXAgb2ZmIFwiIFNpbXVsYXRvclwiXG4gICAgLy8gaW4gb3JkZXIgdG8gYWxsb3cgdGhlIGRlZmF1bHQgXCJpUGhvbmUgWFlaXCIgbWF0Y2hcbiAgICBpZiAoL1teKGlQaG9uZXxpUGFkKV0gU2ltdWxhdG9yLy50ZXN0KGlvc0RldmljZVN0cmluZykpIHtcbiAgICAgIGlvc0RldmljZVN0cmluZyA9IGlvc0RldmljZVN0cmluZy5yZXBsYWNlKCcgU2ltdWxhdG9yJywgJycpO1xuICAgIH1cbiAgICBpb3NEZXZpY2VTdHJpbmcgKz0gYCAke2F3YWl0IHRoaXMuX2dldERldmljZVN0cmluZ1ZlcnNpb25TdHJpbmcob3B0cy5wbGF0Zm9ybVZlcnNpb24pfWA7XG5cbiAgICBsZXQgQ09ORklHX0ZJWCA9IHRoaXMuX2dldERldmljZVN0cmluZ0NvbmZpZ0ZpeCgpO1xuXG4gICAgbGV0IGNvbmZpZ0ZpeCA9IENPTkZJR19GSVg7XG4gICAgaWYgKGNvbmZpZ0ZpeFtpb3NEZXZpY2VTdHJpbmddKSB7XG4gICAgICBpb3NEZXZpY2VTdHJpbmcgPSBjb25maWdGaXhbaW9zRGV2aWNlU3RyaW5nXTtcbiAgICAgIGxvZy5kZWJ1ZyhgRml4aW5nIGRldmljZS4gQ2hhbmdlZCBmcm9tICcke29wdHMuZGV2aWNlTmFtZX0nIGAgK1xuICAgICAgICAgICAgICAgIGB0byAnJHtpb3NEZXZpY2VTdHJpbmd9J2ApO1xuICAgIH1cblxuICAgIGxvZy5kZWJ1ZyhgRmluYWwgZGV2aWNlIHN0cmluZyBpcyAnJHtpb3NEZXZpY2VTdHJpbmd9J2ApO1xuICAgIHJldHVybiBpb3NEZXZpY2VTdHJpbmc7XG4gIH1cblxuICAvKipcbiAgICogQHJldHVybiB7P3N0cmluZ30gVGhlIGZ1bGwgcGF0aCB0byB0aGUgc2ltdWxhdG9yJ3MgV2ViSW5zcGVjdG9yIFVuaXggRG9tYWluIFNvY2tldFxuICAgKiAgIG9yIGBudWxsYCBpZiB0aGVyZSBpcyBubyBzb2NrZXQuXG4gICAqL1xuICBhc3luYyBnZXRXZWJJbnNwZWN0b3JTb2NrZXQgKCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgICAvLyB0aGVyZSBpcyBubyBXZWJJbnNwZWN0b3Igc29ja2V0IGZvciB0aGlzIHZlcnNpb24gb2YgWGNvZGVcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG5mb3IgKGxldCBbY21kLCBmbl0gb2YgXy50b1BhaXJzKGV4dGVuc2lvbnMpKSB7XG4gIFNpbXVsYXRvclhjb2RlNi5wcm90b3R5cGVbY21kXSA9IGZuO1xufVxuXG5leHBvcnQgZGVmYXVsdCBTaW11bGF0b3JYY29kZTY7XG5leHBvcnQgeyBTaW11bGF0b3JYY29kZTYsIEJPT1RfQ09NUExFVEVEX0VWRU5ULCBTUFJJTkdCT0FSRF9CVU5ETEVfSUQgfTtcbiJdLCJmaWxlIjoibGliL3NpbXVsYXRvci14Y29kZS02LmpzIiwic291cmNlUm9vdCI6Ii4uLy4uIn0=
