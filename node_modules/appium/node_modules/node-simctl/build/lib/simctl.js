"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.installApp = installApp;
exports.removeApp = removeApp;
exports.launch = launch;
exports.spawn = spawn;
exports.spawnSubProcess = spawnSubProcess;
exports.openUrl = openUrl;
exports.terminate = terminate;
exports.shutdown = shutdown;
exports.createDevice = createDevice;
exports.getAppContainer = getAppContainer;
exports.getScreenshot = getScreenshot;
exports.deleteDevice = deleteDevice;
exports.eraseDevice = eraseDevice;
exports.getDevices = getDevices;
exports.getRuntimeForPlatformVersion = getRuntimeForPlatformVersion;
exports.bootDevice = bootDevice;
exports.setPasteboard = setPasteboard;
exports.getPasteboard = getPasteboard;
exports.addMedia = addMedia;
exports.appInfo = appInfo;
exports.getDeviceTypes = getDeviceTypes;
exports.startBootMonitor = startBootMonitor;
exports.getSimctlList = getSimctlList;

require("source-map-support/register");

var _teen_process = require("teen_process");

var _asyncbox = require("asyncbox");

var _appiumSupport = require("appium-support");

var _lodash = _interopRequireDefault(require("lodash"));

var _semver = _interopRequireDefault(require("semver"));

const log = _appiumSupport.logger.getLogger('simctl');

const SIM_RUNTIME_NAME = 'com.apple.CoreSimulator.SimRuntime.';
const SIM_RUNTIME_NAME_SUFFIX_IOS = 'iOS';
const DEFAULT_CREATE_SIMULATOR_TIMEOUT = 10000;

async function simCommand(command, timeout, args = [], env = {}, executingFunction = _teen_process.exec, logErrors = true) {
  args = ['simctl', command, ...args];
  env = _lodash.default.defaults(_lodash.default.mapKeys(env, (value, key) => {
    return `SIMCTL_CHILD_${key}`;
  }), process.env);

  try {
    return await executingFunction('xcrun', args, {
      timeout,
      env
    });
  } catch (e) {
    if (!logErrors) {
      throw e;
    } else if (e.stderr) {
      log.errorAndThrow(`simctl error running '${command}': ${e.stderr.trim()}`);
    } else {
      log.errorAndThrow(e);
    }
  }
}

async function simExec(command, timeout, args = [], env = {}, logErrors = true) {
  return await simCommand(command, timeout, args, env, async (c, a, ob) => {
    return await (0, _teen_process.exec)(c, a, ob);
  }, logErrors);
}

async function simSubProcess(command, timeout, args = [], env = {}) {
  return await simCommand(command, timeout, args, env, (c, a, ob) => {
    return new _teen_process.SubProcess(c, a, ob);
  });
}

async function installApp(udid, appPath) {
  await simExec('install', 0, [udid, appPath]);
}

async function bootDevice(udid) {
  try {
    await simExec('boot', 0, [udid]);
  } catch (err) {
    if ((err.message || '').indexOf('Unable to boot device in current state: Booted') === -1) {
      throw err;
    }

    log.debug(`Simulator already in 'Booted' state. Continuing`);
  }
}

async function removeApp(udid, bundleId) {
  await simExec('uninstall', 0, [udid, bundleId]);
}

async function launch(udid, bundleId, tries = 5) {
  await (0, _asyncbox.retryInterval)(tries, 1000, async () => {
    await simExec('launch', 0, [udid, bundleId]);
  });
}

async function spawn(udid, args, env = {}) {
  return await simExec('spawn', 0, [udid, ...(_lodash.default.isArray(args) ? args : [args])], env);
}

async function spawnSubProcess(udid, args, env = {}) {
  return await simSubProcess('spawn', 0, [udid, ...(_lodash.default.isArray(args) ? args : [args])], env);
}

async function openUrl(udid, url) {
  return await simExec('openurl', 0, [udid, url]);
}

async function appInfo(udid, bundleId) {
  const {
    stdout
  } = await simExec('appinfo', 0, [udid, bundleId]);
  return (stdout || '').trim();
}

async function addMedia(udid, path) {
  return await simExec('addmedia', 0, [udid, path]);
}

async function terminate(udid, bundleId) {
  await simExec('terminate', 0, [udid, bundleId]);
}

async function getAppContainer(udid, bundleId, logErrors = true, containerType = null) {
  const args = [udid, bundleId];

  if (containerType) {
    args.push(containerType);
  }

  const {
    stdout
  } = await simExec('get_app_container', 0, args, {}, logErrors);
  return (stdout || '').trim();
}

async function shutdown(udid) {
  try {
    await simExec('shutdown', 0, [udid]);
  } catch (err) {
    if (!(err + '').includes('current state: Shutdown')) {
      throw err;
    }

    log.debug(`Simulator already in 'Shutdown' state. Continuing`);
  }
}

async function createDevice(name, deviceTypeId, platformVersion, opts = {}) {
  const {
    platform = SIM_RUNTIME_NAME_SUFFIX_IOS,
    timeout = DEFAULT_CREATE_SIMULATOR_TIMEOUT
  } = opts;
  let runtimeIds = [];

  try {
    runtimeIds.push((await getRuntimeForPlatformVersionViaJson(platformVersion, platform)));
  } catch (ign) {}

  if (_lodash.default.isEmpty(runtimeIds)) {
    let runtimeId;

    try {
      runtimeId = await getRuntimeForPlatformVersion(platformVersion, platform);
    } catch (err) {
      log.warn(`Unable to find runtime for iOS '${platformVersion}'. Continuing`);
      runtimeId = platformVersion;
    }

    const runtimeIdSemver = _semver.default.coerce(runtimeId);

    if (_lodash.default.isNil(runtimeIdSemver)) {
      throw new Error(`Unable to parse runtime id '${runtimeId}'`);
    }

    let potentialRuntimeIds = [`${runtimeIdSemver.major}.${runtimeIdSemver.minor}`];

    if (runtimeId.split('.').length === 3) {
      potentialRuntimeIds.push(runtimeId);
    }

    runtimeIds.push(...potentialRuntimeIds.map(id => `${SIM_RUNTIME_NAME}${platform}-${id.replace(/\./g, '-')}`), ...potentialRuntimeIds);
  }

  let udid;

  for (const runtimeId of runtimeIds) {
    log.debug(`Creating simulator with name '${name}', device type id '${deviceTypeId}' and runtime id '${runtimeId}'`);

    try {
      const out = await simExec('create', 0, [name, deviceTypeId, runtimeId]);
      udid = out.stdout.trim();
      break;
    } catch (ign) {}
  }

  if (!udid) {
    log.errorAndThrow(`Could not create simulator with name '${name}', device ` + `type id '${deviceTypeId}', with runtime ids ` + `${runtimeIds.map(id => `'${id}'`).join(', ')}`);
  }

  const retries = parseInt(timeout / 1000, 10);
  await (0, _asyncbox.retryInterval)(retries, 1000, async () => {
    const devices = _lodash.default.values((await getDevices()));

    for (const deviceArr of _lodash.default.values(devices)) {
      for (const device of deviceArr) {
        if (device.udid === udid) {
          if (device.state === 'Creating') {
            throw new Error(`Device with udid '${udid}' still being created`);
          } else {
            return;
          }
        }
      }
    }

    throw new Error(`Device with udid '${udid}' not yet created`);
  });
  return udid;
}

async function deleteDevice(udid) {
  await simExec('delete', 0, [udid]);
}

async function eraseDevice(udid, timeout = 1000) {
  let loopFn = async () => {
    await simExec('erase', 10000, [udid]);
  };

  let retries = parseInt(timeout / 200, 10);
  await (0, _asyncbox.retryInterval)(retries, 200, loopFn);
}

async function getDevicesByParsing(platform) {
  const {
    stdout
  } = await simExec('list', 0, ['devices']);
  const deviceSectionRe = _lodash.default.isEmpty(platform) ? new RegExp(`\\-\\-\\s+(\\S+)\\s+(\\S+)\\s+\\-\\-(\\n\\s{4}.+)*`, 'mgi') : new RegExp(`\\-\\-\\s+${_lodash.default.escapeRegExp(platform)}\\s+(\\S+)\\s+\\-\\-(\\n\\s{4}.+)*`, 'mgi');
  const matches = [];
  let match;

  while (match = deviceSectionRe.exec(stdout)) {
    matches.push(match);
  }

  if (_lodash.default.isEmpty(matches)) {
    throw new Error('Could not find device section');
  }

  const lineRe = /([^\s].+) \((\w+-.+\w+)\) \((\w+\s?\w+)\)/;
  const devices = {};

  for (match of matches) {
    const sdk = platform ? match[1] : match[2];
    devices[sdk] = devices[sdk] || [];

    for (const line of match[0].split('\n').slice(1)) {
      if (line.includes('(unavailable, ')) {
        continue;
      }

      const lineMatch = lineRe.exec(line);

      if (!lineMatch) {
        throw new Error(`Could not match line: ${line}`);
      }

      devices[sdk].push({
        name: lineMatch[1],
        udid: lineMatch[2],
        state: lineMatch[3],
        sdk,
        platform: platform || match[1]
      });
    }
  }

  return devices;
}

async function getDevices(forSdk, platform) {
  let devices = {};

  try {
    const {
      stdout
    } = await simExec('list', 0, ['devices', '-j']);
    const versionMatchRe = _lodash.default.isEmpty(platform) ? new RegExp(`^([^\\s-]+)[\\s-](\\S+)`, 'i') : new RegExp(`^${_lodash.default.escapeRegExp(platform)}[\\s-](\\S+)`, 'i');

    for (let [sdkName, entries] of _lodash.default.toPairs(JSON.parse(stdout).devices)) {
      sdkName = sdkName.replace(SIM_RUNTIME_NAME, '');
      const versionMatch = versionMatchRe.exec(sdkName);

      if (!versionMatch) {
        continue;
      }

      const sdk = (platform ? versionMatch[1] : versionMatch[2]).replace('-', '.');
      devices[sdk] = devices[sdk] || [];
      devices[sdk].push(...entries.filter(el => _lodash.default.isUndefined(el.isAvailable) || el.isAvailable).map(el => {
        delete el.availability;
        return {
          sdk,
          ...el,
          platform: platform || versionMatch[1]
        };
      }));
    }
  } catch (err) {
    log.debug(`Unable to get JSON device list: ${err.stack}`);
    log.debug('Falling back to manual parsing');
    devices = await getDevicesByParsing(platform);
  }

  if (!forSdk) {
    return devices;
  }

  if (devices[forSdk]) {
    return devices[forSdk];
  }

  let errMsg = `'${forSdk}' does not exist in the list of simctl SDKs.`;

  const availableSDKs = _lodash.default.keys(devices);

  errMsg += availableSDKs.length ? ` Only the following Simulator SDK versions are available on your system: ${availableSDKs.join(', ')}` : ` No Simulator SDK versions are available on your system. Please install some via Xcode preferences.`;
  throw new Error(errMsg);
}

async function getRuntimeForPlatformVersionViaJson(platformVersion, platform = 'iOS') {
  const {
    stdout
  } = await simExec('list', 0, ['runtimes', '--json']);

  for (const {
    version,
    identifier,
    name
  } of JSON.parse(stdout).runtimes) {
    if (version === platformVersion && name.toLowerCase().startsWith(platform.toLowerCase())) {
      return identifier;
    }
  }

  throw new Error(`Could not use --json flag to parse platform version`);
}

async function getRuntimeForPlatformVersion(platformVersion, platform = 'iOS') {
  try {
    const {
      stdout
    } = await simExec('list', 0, ['runtimes']);
    const runtimeRe = new RegExp(`${_lodash.default.escapeRegExp(platform)}\\s+(\\d+\\.\\d+)\\s+\\((\\d+\\.\\d+\\.*\\d*)`, 'i');

    for (const line of stdout.split('\n')) {
      const match = runtimeRe.exec(line);

      if (match && match[1] === platformVersion) {
        return match[2];
      }
    }
  } catch (ign) {}

  return platformVersion;
}

async function getScreenshot(udid) {
  let pathToScreenshotPng = await _appiumSupport.tempDir.path({
    prefix: `screenshot-${udid}`,
    suffix: '.png'
  });
  await simExec('io', 0, [udid, 'screenshot', pathToScreenshotPng]);
  let screenshotImg = await _appiumSupport.fs.readFile(pathToScreenshotPng);
  await _appiumSupport.fs.rimraf(pathToScreenshotPng);
  return screenshotImg.toString('base64');
}

async function setPasteboard(udid, content, encoding = 'utf-8') {
  const pbCopySubprocess = new _teen_process.SubProcess('xcrun', ['simctl', 'pbcopy', udid]);
  await pbCopySubprocess.start(0);
  const exitCodeVerifier = pbCopySubprocess.join();
  const stdin = pbCopySubprocess.proc.stdin;
  stdin.setEncoding(encoding);
  stdin.write(content);
  stdin.end();
  await exitCodeVerifier;
}

async function getPasteboard(udid, encoding = 'utf-8') {
  const args = ['simctl', 'pbpaste', udid];

  try {
    const {
      stdout
    } = await (0, _teen_process.exec)('xcrun', args, {
      timeout: 0,
      encoding
    });
    return stdout;
  } catch (e) {
    if (e.stderr) {
      log.errorAndThrow(`Error running 'xcrun ${args.join(' ')}': ${e.stderr.trim()}`);
    } else {
      log.errorAndThrow(e);
    }
  }
}

async function getDeviceTypes() {
  try {
    const {
      stdout
    } = await simExec('list', 0, ['devicetypes', '-j']);
    const deviceTypes = JSON.parse(stdout.trim());
    return deviceTypes.devicetypes.map(type => type.name);
  } catch (err) {
    let msg = `Unable to get list of device types: ${err.message}`;

    if (err.stderr) {
      msg = `${msg}. Stderr: ${err.stderr}`;
    }

    throw new Error(msg);
  }
}

async function getSimctlList() {
  try {
    const {
      stdout
    } = await simExec('list', 0, ['-j']);
    return JSON.parse(stdout);
  } catch (err) {
    let msg = `Unable to get simctl list: ${err.message}`;

    if (err.stderr) {
      msg = `${msg}. Stderr: ${err.stderr}`;
    }

    throw new Error(msg);
  }
}

async function startBootMonitor(udid, opts = {}) {
  const {
    timeout = 240000,
    onWaitingDataMigration,
    onWaitingSystemApp,
    onFinished,
    onError
  } = opts;
  let status = '';
  let isBootingFinished = false;
  let error = null;
  let timeoutHandler = null;
  const bootMonitor = await simSubProcess('bootstatus', 0, [udid]);
  bootMonitor.on('output', (stdout, stderr) => {
    status += stdout || stderr;

    if (stdout) {
      if (stdout.includes('Waiting on Data Migration') && onWaitingDataMigration) {
        onWaitingDataMigration();
      } else if (stdout.includes('Waiting on System App') && onWaitingSystemApp) {
        onWaitingSystemApp();
      }
    }
  });
  bootMonitor.on('exit', (code, signal) => {
    if (timeoutHandler) {
      clearTimeout(timeoutHandler);
    }

    if (code === 0) {
      if (onFinished) {
        onFinished();
      }

      isBootingFinished = true;
    } else {
      status = status || signal;
      error = new Error(status);

      if (onError) {
        onError(error);
      }
    }
  });
  await bootMonitor.start(0);

  const stopMonitor = async () => {
    if (bootMonitor.isRunning) {
      try {
        await bootMonitor.stop();
      } catch (e) {
        log.warn(e.message);
      }
    }
  };

  const timeStarted = process.hrtime();

  if (onFinished) {
    timeoutHandler = setTimeout(stopMonitor, timeout);
  } else {
    try {
      await (0, _asyncbox.waitForCondition)(() => {
        if (error) {
          throw error;
        }

        return isBootingFinished;
      }, {
        waitMs: timeout,
        intervalMs: 500
      });
    } catch (err) {
      await stopMonitor();
      throw new Error(`The simulator ${udid} has failed to finish booting after ${process.hrtime(timeStarted)[0]}s. ` + `Original status: ${status}`);
    }
  }

  return bootMonitor;
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9zaW1jdGwuanMiXSwibmFtZXMiOlsibG9nIiwibG9nZ2VyIiwiZ2V0TG9nZ2VyIiwiU0lNX1JVTlRJTUVfTkFNRSIsIlNJTV9SVU5USU1FX05BTUVfU1VGRklYX0lPUyIsIkRFRkFVTFRfQ1JFQVRFX1NJTVVMQVRPUl9USU1FT1VUIiwic2ltQ29tbWFuZCIsImNvbW1hbmQiLCJ0aW1lb3V0IiwiYXJncyIsImVudiIsImV4ZWN1dGluZ0Z1bmN0aW9uIiwiZXhlYyIsImxvZ0Vycm9ycyIsIl8iLCJkZWZhdWx0cyIsIm1hcEtleXMiLCJ2YWx1ZSIsImtleSIsInByb2Nlc3MiLCJlIiwic3RkZXJyIiwiZXJyb3JBbmRUaHJvdyIsInRyaW0iLCJzaW1FeGVjIiwiYyIsImEiLCJvYiIsInNpbVN1YlByb2Nlc3MiLCJTdWJQcm9jZXNzIiwiaW5zdGFsbEFwcCIsInVkaWQiLCJhcHBQYXRoIiwiYm9vdERldmljZSIsImVyciIsIm1lc3NhZ2UiLCJpbmRleE9mIiwiZGVidWciLCJyZW1vdmVBcHAiLCJidW5kbGVJZCIsImxhdW5jaCIsInRyaWVzIiwic3Bhd24iLCJpc0FycmF5Iiwic3Bhd25TdWJQcm9jZXNzIiwib3BlblVybCIsInVybCIsImFwcEluZm8iLCJzdGRvdXQiLCJhZGRNZWRpYSIsInBhdGgiLCJ0ZXJtaW5hdGUiLCJnZXRBcHBDb250YWluZXIiLCJjb250YWluZXJUeXBlIiwicHVzaCIsInNodXRkb3duIiwiaW5jbHVkZXMiLCJjcmVhdGVEZXZpY2UiLCJuYW1lIiwiZGV2aWNlVHlwZUlkIiwicGxhdGZvcm1WZXJzaW9uIiwib3B0cyIsInBsYXRmb3JtIiwicnVudGltZUlkcyIsImdldFJ1bnRpbWVGb3JQbGF0Zm9ybVZlcnNpb25WaWFKc29uIiwiaWduIiwiaXNFbXB0eSIsInJ1bnRpbWVJZCIsImdldFJ1bnRpbWVGb3JQbGF0Zm9ybVZlcnNpb24iLCJ3YXJuIiwicnVudGltZUlkU2VtdmVyIiwic2VtdmVyIiwiY29lcmNlIiwiaXNOaWwiLCJFcnJvciIsInBvdGVudGlhbFJ1bnRpbWVJZHMiLCJtYWpvciIsIm1pbm9yIiwic3BsaXQiLCJsZW5ndGgiLCJtYXAiLCJpZCIsInJlcGxhY2UiLCJvdXQiLCJqb2luIiwicmV0cmllcyIsInBhcnNlSW50IiwiZGV2aWNlcyIsInZhbHVlcyIsImdldERldmljZXMiLCJkZXZpY2VBcnIiLCJkZXZpY2UiLCJzdGF0ZSIsImRlbGV0ZURldmljZSIsImVyYXNlRGV2aWNlIiwibG9vcEZuIiwiZ2V0RGV2aWNlc0J5UGFyc2luZyIsImRldmljZVNlY3Rpb25SZSIsIlJlZ0V4cCIsImVzY2FwZVJlZ0V4cCIsIm1hdGNoZXMiLCJtYXRjaCIsImxpbmVSZSIsInNkayIsImxpbmUiLCJzbGljZSIsImxpbmVNYXRjaCIsImZvclNkayIsInZlcnNpb25NYXRjaFJlIiwic2RrTmFtZSIsImVudHJpZXMiLCJ0b1BhaXJzIiwiSlNPTiIsInBhcnNlIiwidmVyc2lvbk1hdGNoIiwiZmlsdGVyIiwiZWwiLCJpc1VuZGVmaW5lZCIsImlzQXZhaWxhYmxlIiwiYXZhaWxhYmlsaXR5Iiwic3RhY2siLCJlcnJNc2ciLCJhdmFpbGFibGVTREtzIiwia2V5cyIsInZlcnNpb24iLCJpZGVudGlmaWVyIiwicnVudGltZXMiLCJ0b0xvd2VyQ2FzZSIsInN0YXJ0c1dpdGgiLCJydW50aW1lUmUiLCJnZXRTY3JlZW5zaG90IiwicGF0aFRvU2NyZWVuc2hvdFBuZyIsInRlbXBEaXIiLCJwcmVmaXgiLCJzdWZmaXgiLCJzY3JlZW5zaG90SW1nIiwiZnMiLCJyZWFkRmlsZSIsInJpbXJhZiIsInRvU3RyaW5nIiwic2V0UGFzdGVib2FyZCIsImNvbnRlbnQiLCJlbmNvZGluZyIsInBiQ29weVN1YnByb2Nlc3MiLCJzdGFydCIsImV4aXRDb2RlVmVyaWZpZXIiLCJzdGRpbiIsInByb2MiLCJzZXRFbmNvZGluZyIsIndyaXRlIiwiZW5kIiwiZ2V0UGFzdGVib2FyZCIsImdldERldmljZVR5cGVzIiwiZGV2aWNlVHlwZXMiLCJkZXZpY2V0eXBlcyIsInR5cGUiLCJtc2ciLCJnZXRTaW1jdGxMaXN0Iiwic3RhcnRCb290TW9uaXRvciIsIm9uV2FpdGluZ0RhdGFNaWdyYXRpb24iLCJvbldhaXRpbmdTeXN0ZW1BcHAiLCJvbkZpbmlzaGVkIiwib25FcnJvciIsInN0YXR1cyIsImlzQm9vdGluZ0ZpbmlzaGVkIiwiZXJyb3IiLCJ0aW1lb3V0SGFuZGxlciIsImJvb3RNb25pdG9yIiwib24iLCJjb2RlIiwic2lnbmFsIiwiY2xlYXJUaW1lb3V0Iiwic3RvcE1vbml0b3IiLCJpc1J1bm5pbmciLCJzdG9wIiwidGltZVN0YXJ0ZWQiLCJocnRpbWUiLCJzZXRUaW1lb3V0Iiwid2FpdE1zIiwiaW50ZXJ2YWxNcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBR0EsTUFBTUEsR0FBRyxHQUFHQyxzQkFBT0MsU0FBUCxDQUFpQixRQUFqQixDQUFaOztBQUVBLE1BQU1DLGdCQUFnQixHQUFHLHFDQUF6QjtBQUNBLE1BQU1DLDJCQUEyQixHQUFHLEtBQXBDO0FBQ0EsTUFBTUMsZ0NBQWdDLEdBQUcsS0FBekM7O0FBdUJBLGVBQWVDLFVBQWYsQ0FBMkJDLE9BQTNCLEVBQW9DQyxPQUFwQyxFQUE2Q0MsSUFBSSxHQUFHLEVBQXBELEVBQXdEQyxHQUFHLEdBQUcsRUFBOUQsRUFBa0VDLGlCQUFpQixHQUFHQyxrQkFBdEYsRUFBNEZDLFNBQVMsR0FBRyxJQUF4RyxFQUE4RztBQUU1R0osRUFBQUEsSUFBSSxHQUFHLENBQUMsUUFBRCxFQUFXRixPQUFYLEVBQW9CLEdBQUdFLElBQXZCLENBQVA7QUFHQUMsRUFBQUEsR0FBRyxHQUFHSSxnQkFBRUMsUUFBRixDQUFXRCxnQkFBRUUsT0FBRixDQUFVTixHQUFWLEVBQWUsQ0FBQ08sS0FBRCxFQUFRQyxHQUFSLEtBQWdCO0FBQzlDLFdBQVEsZ0JBQWVBLEdBQUksRUFBM0I7QUFDRCxHQUZnQixDQUFYLEVBRUZDLE9BQU8sQ0FBQ1Qs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QUMzQixZQUFJNkosS0FBSixFQUFXO0FBQ1QsZ0JBQU1BLEtBQU47QUFDRDs7QUFDRCxlQUFPRCxpQkFBUDtBQUNELE9BTEssRUFLSDtBQUFDYyxRQUFBQSxNQUFNLEVBQUUxSyxPQUFUO0FBQWtCMkssUUFBQUEsVUFBVSxFQUFFO0FBQTlCLE9BTEcsQ0FBTjtBQU1ELEtBUEQsQ0FPRSxPQUFPakosR0FBUCxFQUFZO0FBQ1osWUFBTTBJLFdBQVcsRUFBakI7QUFDQSxZQUFNLElBQUlsRyxLQUFKLENBQVcsaUJBQWdCM0MsSUFBSyx1Q0FBc0NaLE9BQU8sQ0FBQzZKLE1BQVIsQ0FBZUQsV0FBZixFQUE0QixDQUE1QixDQUErQixLQUEzRixHQUNiLG9CQUFtQlosTUFBTyxFQUR2QixDQUFOO0FBRUQ7QUFDRjs7QUFDRCxTQUFPSSxXQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBleGVjLCBTdWJQcm9jZXNzIH0gZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCB7IHJldHJ5SW50ZXJ2YWwsIHdhaXRGb3JDb25kaXRpb24gfSBmcm9tICdhc3luY2JveCc7XG5pbXBvcnQgeyBsb2dnZXIsIGZzLCB0ZW1wRGlyIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBzZW12ZXIgZnJvbSAnc2VtdmVyJztcblxuXG5jb25zdCBsb2cgPSBsb2dnZXIuZ2V0TG9nZ2VyKCdzaW1jdGwnKTtcblxuY29uc3QgU0lNX1JVTlRJTUVfTkFNRSA9ICdjb20uYXBwbGUuQ29yZVNpbXVsYXRvci5TaW1SdW50aW1lLic7XG5jb25zdCBTSU1fUlVOVElNRV9OQU1FX1NVRkZJWF9JT1MgPSAnaU9TJztcbmNvbnN0IERFRkFVTFRfQ1JFQVRFX1NJTVVMQVRPUl9USU1FT1VUID0gMTAwMDA7XG5cbi8qKlxuICogRXhlY3V0ZSB0aGUgcGFydGljdWxhciBzaW1jdGwgY29tbWFuZCBhbmQgcmV0dXJuIHRoZSBvdXRwdXQuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGNvbW1hbmQgLSBPbmUgb2YgYXZhaWxhYmxlIHNpbWN0bCBzdWJjb21tYW5kcy5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgRXhlY3V0ZSBgeGNydW4gc2ltY3RsYCBpbiBUZXJtaW5hbCB0byBzZWUgdGhlIGZ1bGwgbGlzdFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICBvZiBhdmFpbGFibGUgc3ViY29tbWFuZHMuXG4gKiBAcGFyYW0ge251bWJlcn0gdGltZW91dCAtIENvbW1hbmQgZXhlY3V0aW9uIHRpbWVvdXQgaW4gbWlsbGlzZWNvbmRzLlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICBTZXQgaXQgdG8gemVybyB0byBza2lwIHdhaXRpbmcgZm9yIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhlY3V0aW9uLlxuICogQHBhcmFtIHtBcnJheS48c3RyaW5nPn0gYXJncyBbW11dIC0gVGhlIGxpc3Qgb2YgYWRkaXRpb25hbCBzdWJjb21tYW5kIGFyZ3VtZW50cy5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEl0J3MgZW1wdHkgYnkgZGVmYXVsdC5cbiAqIEBwYXJhbSB7T2JqZWN0fSBlbnYgW3t9XSAtIEVudmlyb25tZW50IHZhcmlhYmxlcyBtYXBwaW5nLiBBbGwgdGhlc2UgdmFyaWFibGVzXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWxsIGJlIHBhc3NlZCBTaW11bGF0b3IgYW5kIHVzZWQgaW4gX2V4ZWN1dGluZ0Z1bmN0aW9uXy5cbiAqIEBwYXJhbSB7RnVuY3Rpb259IGV4ZWN1dGluZ0Z1bmN0aW9uIC0gRXhlY3V0aW5nIGZ1bmN0aW9uIG9iamVjdC4gRXF1YWxzIHRvIHRlZW5fcHJvY2VzcydzXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9leGVjXyBieSBkZWZhdWx0LlxuICogQHBhcmFtIHtib29sZWFufSBsb2dFcnJvcnMgW3RydWVdIC0gU2V0IGl0IHRvIF9mYWxzZV8gdG8gdGhyb3cgZXhlY3V0aW9uIGVycm9yc1xuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1tZWRpYXRlbHkgd2l0aG91dCBsb2dnaW5nIGFueSBhZGRpdGlvbmFsIGluZm9ybWF0aW9uLlxuICogQHJldHVybiB7T2JqZWN0fSBUaGUgcmVzdWx0IG9mIF9leGVjdXRpbmdGdW5jdGlvbl8uXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIHNpbWN0bCBzdWJjb21tYW5kIGNvbW1hbmQgZXhlY3V0ZWQgYnkgX2V4ZWN1dGluZ0Z1bmN0aW9uX1xuICogICAgICAgICAgICAgICAgIHJldHVybnMgbm9uLXplcm8gcmV0dXJuIGNvZGUuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHNpbUNvbW1hbmQgKGNvbW1hbmQsIHRpbWVvdXQsIGFyZ3MgPSBbXSwgZW52ID0ge30sIGV4ZWN1dGluZ0Z1bmN0aW9uID0gZXhlYywgbG9nRXJyb3JzID0gdHJ1ZSkge1xuICAvLyBydW4gYSBwYXJ0aWN1bGFyIHNpbWN0bCBjb21tYW5kXG4gIGFyZ3MgPSBbJ3NpbWN0bCcsIGNvbW1hbmQsIC4uLmFyZ3NdO1xuICAvLyBQcmVmaXggYWxsIHBhc3NlZCBpbiBlbnZpcm9ubWVudCB2YXJpYWJsZXMgd2l0aCAnU0lNQ1RMX0NISUxEXycsIHNpbWN0bFxuICAvLyB3aWxsIHRoZW4gcGFzcyB0aGVzZSB0byB0aGUgY2hpbGQgKHNwYXduZWQpIHByb2Nlc3MuXG4gIGVudiA9IF8uZGVmYXVsdHMoXy5tYXBLZXlzKGVudiwgKHZhbHVlLCBrZXkpID0+IHtcbiAgICByZXR1cm4gYFNJTUNUTF9DSElMRF8ke2tleX1gO1xuICB9KSwgcHJvY2Vzcy5lbnYpO1xuXG4gIHRyeSB7XG4gICAgcmV0dXJuIGF3YWl0IGV4ZWN1dGluZ0Z1bmN0aW9uKCd4Y3J1bicsIGFyZ3MsIHt0aW1lb3V0LCBlbnZ9KTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGlmICghbG9nRXJyb3JzKSB7XG4gICAgICAvLyBpZiB3ZSBkb24ndCB3YW50IHRvIHNlZSB0aGUgZXJyb3JzLCBqdXN0IHRocm93IGFuZCBhbGxvdyB0aGUgY2FsbGluZ1xuICAgICAgLy8gY29kZSBkbyB3aGF0IGl0IHdhbnRzXG4gICAgICB0aHJvdyBlO1xuICAgIH0gZWxzZSBpZiAoZS5zdGRlcnIpIHtcbiAgICAgIGxvZy5lcnJvckFuZFRocm93KGBzaW1jdGwgZXJyb3IgcnVubmluZyAnJHtjb21tYW5kfSc6ICR7ZS5zdGRlcnIudHJpbSgpfWApO1xuICAgIH0gZWxzZSB7XG4gICAgICBsb2cuZXJyb3JBbmRUaHJvdyhlKTtcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBFeGVjUmVzdWx0XG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IHN0ZG91dCAtIFByb2Nlc3Mgc3Rkb3V0LlxuICogQHByb3BlcnR5IHs/c3RyaW5nfSBzdGRlcnIgLSBQcm9jZXNzIHN0ZGVyci5cbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBjb2RlIC0gUHJvY2VzcyBleGl0IGNvZGUuXG4gKi9cblxuLyoqXG4gKiBFeGVjdXRlIHRoZSBwYXJ0aWN1bGFyIHNpbWN0bCBzdWJjb21tYW5kIHN5bmNocm9ub3VzbHkgYW5kXG4gKiB3YWl0IGZvciB0aGUgb3V0cHV0LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBjb21tYW5kIC0gU2VlIHtAbGluayBzaW1Db21tYW5kfSBwYXJhbWV0ZXJzLlxuICogQHBhcmFtIHtudW1iZXJ9IHRpbWVvdXQgLSBTZWUge0BsaW5rIHNpbUNvbW1hbmR9IHBhcmFtZXRlcnMuXG4gKiBAcGFyYW0ge0FycmF5LjxzdHJpbmc+fSBhcmdzIFtbXV0gLSBTZWUge0BsaW5rIHNpbUNvbW1hbmR9IHBhcmFtZXRlcnMuXG4gKiBAcGFyYW0ge09iamVjdH0gZW52IFt7fV0gLSBTZWUge0BsaW5rIHNpbUNvbW1hbmR9IHBhcmFtZXRlcnMuXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGxvZ0Vycm9ycyBbdHJ1ZV0gLSBTZWUge0BsaW5rIHNpbUNvbW1hbmR9IHBhcmFtZXRlcnMuXG4gKiBAcmV0dXJuIHtFeGVjUmVzdWx0fSBUaGUgcmVzdWx0IG9mIF9leGVjXyBmdW5jdGlvbi5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgc2ltY3RsIHN1YmNvbW1hbmQgY29tbWFuZCBleGVjdXRlZCBieSBleGVjXG4gKiAgICAgICAgICAgICAgICAgcmV0dXJucyBub24temVybyByZXR1cm4gY29kZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gc2ltRXhlYyAoY29tbWFuZCwgdGltZW91dCwgYXJncyA9IFtdLCBlbnYgPSB7fSwgbG9nRXJyb3JzID0gdHJ1ZSkge1xuICByZXR1cm4gYXdhaXQgc2ltQ29tbWFuZChjb21tYW5kLCB0aW1lb3V0LCBhcmdzLCBlbnYsIGFzeW5jIChjLCBhLCBvYikgPT4ge1xuICAgIHJldHVybiBhd2FpdCBleGVjKGMsIGEsIG9iKTtcbiAgfSwgbG9nRXJyb3JzKTtcbn1cblxuLyoqXG4gKiBDcmF0ZSBhIHRlZW5fcHJvY2VzcydzIFN1YlByb2Nlc3MgaW5zdGFuY2UgZm9yIHRoZSBwYXJ0aWN1bGFyXG4gKiBzaW1jdGwgc3ViY29tbWFuZCBleGVjdXRpb24uIFRoaXMgbWlnaHQgYmUgbmVlZGVkIHRvIGdhaW4gYmV0dGVyXG4gKiBjb250cm9sIG92ZXIgdGhlIGV4ZWN1dGlvbiBwcm9jZXNzLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBjb21tYW5kIC0gU2VlIHtAbGluayBzaW1Db21tYW5kfSBwYXJhbWV0ZXJzLlxuICogQHBhcmFtIHtudW1iZXJ9IHRpbWVvdXQgLSBTZWUge0BsaW5rIHNpbUNvbW1hbmR9IHBhcmFtZXRlcnMuXG4gKiBAcGFyYW0ge0FycmF5LjxzdHJpbmc+fSBhcmdzIFtbXV0gLSBTZWUge0BsaW5rIHNpbUNvbW1hbmR9IHBhcmFtZXRlcnMuXG4gKiBAcGFyYW0ge09iamVjdH0gZW52IFt7fV0gLSBTZWUge0BsaW5rIHNpbUNvbW1hbmR9IHBhcmFtZXRlcnMuXG4gKiBAcmV0dXJuIHtTdWJQcm9jZXNzfSBUaGUgaW5zdGFuY2Ugb2YgdGVlbl9wcm9jZXNzJ3MgU3ViUHJvY2VzcyBjbGFzcy5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gc2ltU3ViUHJvY2VzcyAoY29tbWFuZCwgdGltZW91dCwgYXJncyA9IFtdLCBlbnYgPSB7fSkge1xuICByZXR1cm4gYXdhaXQgc2ltQ29tbWFuZChjb21tYW5kLCB0aW1lb3V0LCBhcmdzLCBlbnYsIChjLCBhLCBvYikgPT4ge1xuICAgIHJldHVybiBuZXcgU3ViUHJvY2VzcyhjLCBhLCBvYik7XG4gIH0pO1xufVxuXG4vKipcbiAqIEluc3RhbGwgdGhlIHBhcnRpY3VsYXIgYXBwbGljYXRpb24gcGFja2FnZSBvbiBTaW11bGF0b3IuXG4gKiBJdCBpcyByZXF1aXJlZCB0aGF0IFNpbXVsYXRvciBpcyBpbiBfYm9vdGVkXyBzdGF0ZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdWRpZCAtIFRoZSBVRElEIG9mIGFuIGV4aXN0aW5nIFNpbXVsYXRvci5cbiAqIEBwYXJhbSB7c3RyaW5nfSBhcHBQYXRoIC0gRnVsbCBwYXRoIHRvIC5hcHAgcGFja2FnZSwgd2hpY2ggaXNcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgZ29pbmcgdG8gYmUgaW5zdGFsbGVkLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb3JyZXNwb25kaW5nIHNpbWN0bCBzdWJjb21tYW5kIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICByZXR1cm5zIG5vbi16ZXJvIHJldHVybiBjb2RlLlxuICovXG5hc3luYyBmdW5jdGlvbiBpbnN0YWxsQXBwICh1ZGlkLCBhcHBQYXRoKSB7XG4gIGF3YWl0IHNpbUV4ZWMoJ2luc3RhbGwnLCAwLCBbdWRpZCwgYXBwUGF0aF0pO1xufVxuXG4vKipcbiAqIEJvb3QgdGhlIHBhcnRpY3VsYXIgU2ltdWxhdG9yIGlmIGl0IGlzIG5vdCBydW5uaW5nLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVGhlIFVESUQgb2YgYW4gZXhpc3RpbmcgU2ltdWxhdG9yLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb3JyZXNwb25kaW5nIHNpbWN0bCBzdWJjb21tYW5kIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICByZXR1cm5zIG5vbi16ZXJvIHJldHVybiBjb2RlLlxuICovXG5hc3luYyBmdW5jdGlvbiBib290RGV2aWNlICh1ZGlkKSB7XG4gIHRyeSB7XG4gICAgYXdhaXQgc2ltRXhlYygnYm9vdCcsIDAsIFt1ZGlkXSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGlmICgoZXJyLm1lc3NhZ2UgfHwgJycpLmluZGV4T2YoJ1VuYWJsZSB0byBib290IGRldmljZSBpbiBjdXJyZW50IHN0YXRlOiBCb290ZWQnKSA9PT0gLTEpIHtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gICAgbG9nLmRlYnVnKGBTaW11bGF0b3IgYWxyZWFkeSBpbiAnQm9vdGVkJyBzdGF0ZS4gQ29udGludWluZ2ApO1xuICB9XG59XG5cbi8qKlxuICogUmVtb3ZlIHRoZSBwYXJ0aWN1bGFyIGFwcGxpY2F0aW9uIHBhY2thZ2UgZnJvbSBTaW11bGF0b3IuXG4gKiBJdCBpcyByZXF1aXJlZCB0aGF0IFNpbXVsYXRvciBpcyBpbiBfYm9vdGVkXyBzdGF0ZSBhbmRcbiAqIHRoZSBhcHBsaWNhdGlvbiB3aXRoIGdpdmVuIGJ1bmRsZSBpZGVudGlmaWVyIGlzIGFscmVhZHkgaW5zdGFsbGVkLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVGhlIFVESUQgb2YgYW4gZXhpc3RpbmcgU2ltdWxhdG9yLlxuICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gQnVuZGxlIGlkZW50aWZpZXIgb2YgdGhlIGFwcGxpY2F0aW9uLFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpY2ggaXMgZ29pbmcgdG8gYmUgcmVtb3ZlZC5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgY29ycmVzcG9uZGluZyBzaW1jdGwgc3ViY29tbWFuZCBjb21tYW5kXG4gKiAgICAgICAgICAgICAgICAgcmV0dXJucyBub24temVybyByZXR1cm4gY29kZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gcmVtb3ZlQXBwICh1ZGlkLCBidW5kbGVJZCkge1xuICBhd2FpdCBzaW1FeGVjKCd1bmluc3RhbGwnLCAwLCBbdWRpZCwgYnVuZGxlSWRdKTtcbn1cblxuLyoqXG4gKiBFeGVjdXRlIHRoZSBwYXJ0aWN1bGFyIGFwcGxpY2F0aW9uIHBhY2thZ2Ugb24gU2ltdWxhdG9yLlxuICogSXQgaXMgcmVxdWlyZWQgdGhhdCBTaW11bGF0b3IgaXMgaW4gX2Jvb3RlZF8gc3RhdGUgYW5kXG4gKiB0aGUgYXBwbGljYXRpb24gd2l0aCBnaXZlbiBidW5kbGUgaWRlbnRpZmllciBpcyBhbHJlYWR5IGluc3RhbGxlZC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdWRpZCAtIFRoZSBVRElEIG9mIGFuIGV4aXN0aW5nIFNpbXVsYXRvci5cbiAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJZCAtIEJ1bmRsZSBpZGVudGlmaWVyIG9mIHRoZSBhcHBsaWNhdGlvbixcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWNoIGlzIGdvaW5nIHRvIGJlIHJlbW92ZWQuXG4gKiBAcGFyYW0ge251bWJlcn0gdHJpZXMgWzVdIC0gVGhlIG1heGltdW0gbnVtYmVyIG9mIHJldHJpZXMgYmVmb3JlXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3dpbmcgYW4gZXhjZXB0aW9uLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb3JyZXNwb25kaW5nIHNpbWN0bCBzdWJjb21tYW5kIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICByZXR1cm5zIG5vbi16ZXJvIHJldHVybiBjb2RlLlxuICovXG5hc3luYyBmdW5jdGlvbiBsYXVuY2ggKHVkaWQsIGJ1bmRsZUlkLCB0cmllcyA9IDUpIHtcbiAgYXdhaXQgcmV0cnlJbnRlcnZhbCh0cmllcywgMTAwMCwgYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IHNpbUV4ZWMoJ2xhdW5jaCcsIDAsIFt1ZGlkLCBidW5kbGVJZF0pO1xuICB9KTtcbn1cblxuLyoqXG4gKiBTcGF3biB0aGUgcGFydGljdWxhciBwcm9jZXNzIG9uIFNpbXVsYXRvci5cbiAqIEl0IGlzIHJlcXVpcmVkIHRoYXQgU2ltdWxhdG9yIGlzIGluIF9ib290ZWRfIHN0YXRlLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVGhlIFVESUQgb2YgYW4gZXhpc3RpbmcgU2ltdWxhdG9yLlxuICogQHBhcmFtIHtzdHJpbmd8QXJyYXk8c3RyaW5nPn0gYXJncyAtIFNwYXduIGFyZ3VtZW50c1xuICogQHBhcmFtIHtvYmplY3R9IGVudiBbe31dIC0gQWRkaXRpb25hbCBlbnZpcm9ubWVudCB2YXJpYWJsZXMgbWFwcGluZy5cbiAqIEByZXR1cm4ge0V4ZWNSZXN1bHR9IENvbW1hbmQgZXhlY3V0aW9uIHJlc3VsdC5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgY29ycmVzcG9uZGluZyBzaW1jdGwgc3ViY29tbWFuZCBjb21tYW5kXG4gKiAgICAgICAgICAgICAgICAgcmV0dXJucyBub24temVybyByZXR1cm4gY29kZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gc3Bhd24gKHVkaWQsIGFyZ3MsIGVudiA9IHt9KSB7XG4gIHJldHVybiBhd2FpdCBzaW1FeGVjKCdzcGF3bicsIDAsIFt1ZGlkLCAuLi4oXy5pc0FycmF5KGFyZ3MpID8gYXJncyA6IFthcmdzXSldLCBlbnYpO1xufVxuXG4vKipcbiAqIFByZXBhcmUgU3ViUHJvY2VzcyBpbnN0YW5jZSBmb3IgYSBuZXcgcHJvY2Vzcywgd2hpY2ggaXMgZ29pbmcgdG8gYmUgc3Bhd25lZFxuICogb24gU2ltdWxhdG9yLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVGhlIFVESUQgb2YgYW4gZXhpc3RpbmcgU2ltdWxhdG9yLlxuICogQHBhcmFtIHtzdHJpbmd8QXJyYXk8c3RyaW5nPn0gYXJncyAtIFNwYXduIGFyZ3VtZW50c1xuICogQHBhcmFtIHtvYmplY3R9IGVudiBbe31dIC0gQWRkaXRpb25hbCBlbnZpcm9ubWVudCB2YXJpYWJsZXMgbWFwcGluZy5cbiAqIEByZXR1cm4ge1N1YlByb2Nlc3N9IFRoZSBpbnN0YW5jZSBvZiB0aGUgcHJvY2VzcyB0byBiZSBzcGF3bmVkLlxuICovXG5hc3luYyBmdW5jdGlvbiBzcGF3blN1YlByb2Nlc3MgKHVkaWQsIGFyZ3MsIGVudiA9IHt9KSB7XG4gIHJldHVybiBhd2FpdCBzaW1TdWJQcm9jZXNzKCdzcGF3bicsIDAsIFt1ZGlkLCAuLi4oXy5pc0FycmF5KGFyZ3MpID8gYXJncyA6IFthcmdzXSldLCBlbnYpO1xufVxuXG4vKipcbiAqIE9wZW4gVVJMIHNjaGVtZSBvbiBTaW11bGF0b3IuIGlPUyB3aWxsIGF1dG9tYXRpY2FsbHkgdHJ5XG4gKiB0byBmaW5kIGEgbWF0Y2hpbmcgYXBwbGljYXRpb24sIHdoaWNoIHN1cHBvcnRzIHRoZSBnaXZlbiBzY2hlbWUuXG4gKiBJdCBpcyByZXF1aXJlZCB0aGF0IFNpbXVsYXRvciBpcyBpbiBfYm9vdGVkXyBzdGF0ZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdWRpZCAtIFRoZSBVRElEIG9mIGFuIGV4aXN0aW5nIFNpbXVsYXRvci5cbiAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgLSBUaGUgVVJMIHNjaGVtZSB0byBvcGVuLCBmb3IgZXhhbXBsZSBodHRwOi8vYXBwaW9tLmlvXG4gKiAgICAgICAgICAgICAgICAgICAgICAgd2lsbCBiZSBvcGVuZWQgYnkgdGhlIGJ1aWx0LWluIG1vYmlsZSBicm93c2VyLlxuICogQHJldHVybiB7RXhlY1Jlc3VsdH0gQ29tbWFuZCBleGVjdXRpb24gcmVzdWx0LlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb3JyZXNwb25kaW5nIHNpbWN0bCBzdWJjb21tYW5kIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICByZXR1cm5zIG5vbi16ZXJvIHJldHVybiBjb2RlLlxuICovXG5hc3luYyBmdW5jdGlvbiBvcGVuVXJsICh1ZGlkLCB1cmwpIHtcbiAgcmV0dXJuIGF3YWl0IHNpbUV4ZWMoJ29wZW51cmwnLCAwLCBbdWRpZCwgdXJsXSk7XG59XG5cbi8qKlxuICogSW52b2tlIGhpZGRlbiBhcHBpbmZvIHN1YmNvbW1hbmQgdG8gZ2V0IHRoZSBpbmZvcm1hdGlvblxuICogYWJvdXQgYXBwbGljYXRpb25zIGluc3RhbGxlZCBvbiBTaW11bGF0b3IsIGluY2x1ZGluZ1xuICogc3lzdGVtIGFwcGxpY2F0aW9ucyAoe0BsaW5rIGdldEFwcENvbnRhaW5lcn0gZG9lcyBub3QgXCJzZWVcIiBzdWNoIGFwcHMpLlxuICogU2ltdWxhdG9yIHNlcnZlciBzaG91bGQgYmUgaW4gJ2Jvb3RlZCcgc3RhdGUgZm9yIHRoaXMgY2FsbCB0byB3b3JrIHByb3Blcmx5LlxuICogVGhlIHRvb2wgaXMgb25seSBhdmFpbGFibGUgc2luY2UgWGNvZGUgU0RLIDguMVxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVURJRCBvZiB0aGUgdGFyZ2V0IFNpbXVsYXRvci5cbiAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJZCAtIFRoZSBidW5kbGUgaWRlbnRpZmllciBvZiB0aGUgdGFyZ2V0IGFwcGxpY2F0aW9uLlxuICogQHJldHVybiB7c3RyaW5nfSBUaGUgaW5mb3JtYXRpb24gYWJvdXQgaW5zdGFsbGVkIGFwcGxpY2F0aW9uLlxuICpcbiAqIEV4YW1wbGUgb3V0cHV0IGZvciBub24tZXhpc3RpbmcgYXBwbGljYXRpb24gY29udGFpbmVyOlxuICogPHByZT5cbiAqIHtcbiAqICAgQ0ZCdW5kbGVJZGVudGlmaWVyID0gXCJjb20uYXBwbGUuTW9iaWxlU2FmYXJpXCI7XG4gKiAgIEdyb3VwQ29udGFpbmVycyA9ICAgICB7XG4gKiAgIH07XG4gKiAgIFNCQXBwVGFncyA9ICAgICAoXG4gKiAgICk7XG4gKiB9XG4gKiA8L3ByZT5cbiAqXG4gKiBFeGFtcGxlIG91dHB1dCBmb3IgYW4gZXhpc3Rpbmcgc3lzdGVtIGFwcGxpY2F0aW9uIGNvbnRhaW5lcjpcbiAqIDxwcmU+XG4gKiB7XG4gKiAgIEFwcGxpY2F0aW9uVHlwZSA9IEhpZGRlbjtcbiAqICAgQnVuZGxlID0gXCJmaWxlOi8vL0FwcGxpY2F0aW9ucy9YY29kZS1iZXRhLmFwcC9Db250ZW50cy9EZXZlbG9wZXIvUGxhdGZvcm1zL2lQaG9uZU9TLnBsYXRmb3JtL0RldmVsb3Blci9MaWJyYXJ5L0NvcmVTaW11bGF0b3IvUHJvZmlsZXMvUnVudGltZXMvaU9TLnNpbXJ1bnRpbWUvQ29udGVudHMvUmVzb3VyY2VzL1J1bnRpbWVSb290L1N5c3RlbS9MaWJyYXJ5L0NvcmVTZXJ2aWNlcy9TcHJpbmdCb2FyZC5hcHBcIjtcbiAqICAgQ0ZCdW5kbGVEaXNwbGF5TmFtZSA9IFNwcmluZ0JvYXJkO1xuICogICBDRkJ1bmRsZUV4ZWN1dGFibGUgPSBTcHJpbmdCb2FyZDtcbiAqICAgQ0ZCdW5kbGVJZGVudGlmaWVyID0gXCJjb20uYXBwbGUuc3ByaW5nYm9hcmRcIjtcbiAqICAgQ0ZCdW5kbGVOYW1lID0gU3ByaW5nQm9hcmQ7XG4gKiAgIENGQnVuZGxlVmVyc2lvbiA9IDUwO1xuICogICBHcm91cENvbnRhaW5lcnMgPSAgICAge1xuICogICB9O1xuICogICBQYXRoID0gXCIvQXBwbGljYXRpb25zL1hjb2RlLWJldGEuYXBwL0NvbnRlbnRzL0RldmVsb3Blci9QbGF0Zm9ybXMvaVBob25lT1MucGxhdGZvcm0vRGV2ZWxvcGVyL0xpYnJhcnkvQ29yZVNpbXVsYXRvci9Qcm9maWxlcy9SdW50aW1lcy9pT1Muc2ltcnVudGltZS9Db250ZW50cy9SZXNvdXJjZXMvUnVudGltZVJvb3QvU3lzdGVtL0xpYnJhcnkvQ29yZVNlcnZpY2VzL1NwcmluZ0JvYXJkLmFwcFwiO1xuICogICBTQkFwcFRhZ3MgPSAgICAgKFxuICogICApO1xuICogfVxuICogPC9wcmU+XG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGFwcEluZm8gKHVkaWQsIGJ1bmRsZUlkKSB7XG4gIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgc2ltRXhlYygnYXBwaW5mbycsIDAsIFt1ZGlkLCBidW5kbGVJZF0pO1xuICByZXR1cm4gKHN0ZG91dCB8fCAnJykudHJpbSgpO1xufVxuXG4vKipcbiAqIEFkZCB0aGUgcGFydGljdWxhciBtZWRpYSBmaWxlIHRvIFNpbXVsYXRvcidzIGxpYnJhcnkuXG4gKiBJdCBpcyByZXF1aXJlZCB0aGF0IFNpbXVsYXRvciBpcyBpbiBfYm9vdGVkXyBzdGF0ZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdWRpZCAtIFRoZSBVRElEIG9mIGFuIGV4aXN0aW5nIFNpbXVsYXRvci5cbiAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoIC0gRnVsbCBwYXRoIHRvIGEgbWVkaWEgZmlsZSBvbiB0aGUgbG9jYWxcbiAqICAgICAgICAgICAgICAgICAgICAgICAgZmlsZSBzeXN0ZW0uXG4gKiBAcmV0dXJuIHtFeGVjUmVzdWx0fSBDb21tYW5kIGV4ZWN1dGlvbiByZXN1bHQuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIGNvcnJlc3BvbmRpbmcgc2ltY3RsIHN1YmNvbW1hbmQgY29tbWFuZFxuICogICAgICAgICAgICAgICAgIHJldHVybnMgbm9uLXplcm8gcmV0dXJuIGNvZGUuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGFkZE1lZGlhICh1ZGlkLCBwYXRoKSB7XG4gIHJldHVybiBhd2FpdCBzaW1FeGVjKCdhZGRtZWRpYScsIDAsIFt1ZGlkLCBwYXRoXSk7XG59XG5cbi8qKlxuICogVGVybWluYXRlIHRoZSBnaXZlbiBydW5uaW5nIGFwcGxpY2F0aW9uIG9uIFNpbXVsYXRvci5cbiAqIEl0IGlzIHJlcXVpcmVkIHRoYXQgU2ltdWxhdG9yIGlzIGluIF9ib290ZWRfIHN0YXRlLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVGhlIFVESUQgb2YgYW4gZXhpc3RpbmcgU2ltdWxhdG9yLlxuICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gQnVuZGxlIGlkZW50aWZpZXIgb2YgdGhlIGFwcGxpY2F0aW9uLFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpY2ggaXMgZ29pbmcgdG8gYmUgdGVybWluYXRlZC5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgY29ycmVzcG9uZGluZyBzaW1jdGwgc3ViY29tbWFuZCBjb21tYW5kXG4gKiAgICAgICAgICAgICAgICAgcmV0dXJucyBub24temVybyByZXR1cm4gY29kZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gdGVybWluYXRlICh1ZGlkLCBidW5kbGVJZCkge1xuICBhd2FpdCBzaW1FeGVjKCd0ZXJtaW5hdGUnLCAwLCBbdWRpZCwgYnVuZGxlSWRdKTtcbn1cblxuLyoqXG4gKiBHZXQgdGhlIGZ1bGwgcGF0aCB0byB0aGUgcGFydGljdWxhciBhcHBsaWNhdGlvbiBjb250YWluZXJcbiAqIG9uIHRoZSBsb2NhbCBmaWxlIHN5c3RlbS4gTm90ZSwgdGhhdCB0aGlzIHN1YmNvbW1hbmQgdGhyb3dzXG4gKiBhbiBlcnJvciBpZiBidW5kbGUgaWQgb2YgYSBzeXN0ZW0gYXBwbGljYXRpb24gaXMgcHJvdmlkZWQsXG4gKiBsaWtlICdjb20uYXBwbGUuc3ByaW5nYm9hcmQnLlxuICogSXQgaXMgcmVxdWlyZWQgdGhhdCBTaW11bGF0b3IgaXMgaW4gX2Jvb3RlZF8gc3RhdGUuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHVkaWQgLSBUaGUgVURJRCBvZiBhbiBleGlzdGluZyBTaW11bGF0b3IuXG4gKiBAcGFyYW0ge3N0cmluZ30gYnVuZGxlSWQgLSBCdW5kbGUgaWRlbnRpZmllciBvZiBhbiBhcHBsaWNhdGlvbi5cbiAqIEBwYXJhbSB7P2Jvb2xlYW59IGxvZ0Vycm9ycyBbdHJ1ZV0gLSBXaGV0aGVyIHRvIGluY2x1ZGUgZXhlYydzIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGRlcnIgb3V0cHV0IGludG8gZXhjZXB0aW9uIG1lc3NhZ2UgaWYgdGhyb3duLlxuICogQHBhcmFtIHs/c3RyaW5nfSBjb250YWluZXJUeXBlIC0gV2hpY2ggY29udGFpbmVyIHR5cGUgdG8gcmV0dXJuLiBQb3NzaWJsZSB2YWx1ZXNcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZSAnYXBwJywgJ2RhdGEnLCAnZ3JvdXBzJywgJzxBIHNwZWNpZmljIEFwcCBHcm91cCBjb250YWluZXI+Jy5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRoZSBkZWZhdWx0IHZhbHVlIGlzICdhcHAnLlxuICogQHJldHVybiB7c3RyaW5nfSBGdWxsIHBhdGggdG8gdGhlIGdpdmVuIGFwcGxpY2F0aW9uIGNvbnRhaW5lciBvbiB0aGUgbG9jYWxcbiAqICAgICAgICAgICAgICAgICAgZmlsZSBzeXN0ZW0uXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIGNvcnJlc3BvbmRpbmcgc2ltY3RsIHN1YmNvbW1hbmQgY29tbWFuZFxuICogICAgICAgICAgICAgICAgIHJldHVybnMgbm9uLXplcm8gcmV0dXJuIGNvZGUuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldEFwcENvbnRhaW5lciAodWRpZCwgYnVuZGxlSWQsIGxvZ0Vycm9ycyA9IHRydWUsIGNvbnRhaW5lclR5cGUgPSBudWxsKSB7XG4gIGNvbnN0IGFyZ3MgPSBbdWRpZCwgYnVuZGxlSWRdO1xuICBpZiAoY29udGFpbmVyVHlwZSkge1xuICAgIGFyZ3MucHVzaChjb250YWluZXJUeXBlKTtcbiAgfVxuICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IHNpbUV4ZWMoJ2dldF9hcHBfY29udGFpbmVyJywgMCwgYXJncywge30sIGxvZ0Vycm9ycyk7XG4gIHJldHVybiAoc3Rkb3V0IHx8ICcnKS50cmltKCk7XG59XG5cbi8qKlxuICogU2h1dGRvd24gdGhlIGdpdmVuIFNpbXVsYXRvciBpZiBpdCBpcyBydW5uaW5nLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVGhlIFVESUQgb2YgYW4gZXhpc3RpbmcgU2ltdWxhdG9yLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb3JyZXNwb25kaW5nIHNpbWN0bCBzdWJjb21tYW5kIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICByZXR1cm5zIG5vbi16ZXJvIHJldHVybiBjb2RlLlxuICovXG5hc3luYyBmdW5jdGlvbiBzaHV0ZG93biAodWRpZCkge1xuICB0cnkge1xuICAgIGF3YWl0IHNpbUV4ZWMoJ3NodXRkb3duJywgMCwgW3VkaWRdKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgaWYgKCEoZXJyICsgJycpLmluY2x1ZGVzKCdjdXJyZW50IHN0YXRlOiBTaHV0ZG93bicpKSB7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICAgIGxvZy5kZWJ1ZyhgU2ltdWxhdG9yIGFscmVhZHkgaW4gJ1NodXRkb3duJyBzdGF0ZS4gQ29udGludWluZ2ApO1xuICB9XG59XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gU2ltQ3JlYXRpb25PcHRzXG4gKiBAcHJvcGVydHkge3N0cmluZ30gcGxhdGZvcm0gW2lPU10gLSBQbGF0Zm9ybSBuYW1lIGluIG9yZGVyIHRvIHNwZWNpZnkgcnVudGltZSBzdWNoIGFzICdpT1MnLCAndHZPUycsICd3YXRjaE9TJ1xuICogQHByb3BlcnR5IHtudW1iZXJ9IHRpbWVvdXQgWzEwMDAwXSAtIFRoZSBtYXhpbXVtIG51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuaXQgZGV2aWNlIGNyZWF0aW9uIGlzIGNvbXBsZXRlZC5cbiAqL1xuLyoqXG4gKiBDcmVhdGUgU2ltdWxhdG9yIGRldmljZSB3aXRoIGdpdmVuIG5hbWUgZm9yIHRoZSBwYXJ0aWN1bGFyXG4gKiBwbGF0Zm9ybSB0eXBlIGFuZCB2ZXJzaW9uLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gVGhlIGRldmljZSBuYW1lIHRvIGJlIGNyZWF0ZWQuXG4gKiBAcGFyYW0ge3N0cmluZ30gZGV2aWNlVHlwZUlkIC0gRGV2aWNlIHR5cGUsIGZvciBleGFtcGxlICdpUGhvbmUgNicuXG4gKiBAcGFyYW0ge3N0cmluZ30gcGxhdGZvcm1WZXJzaW9uIC0gUGxhdGZvcm0gdmVyc2lvbiwgZm9yIGV4YW1wbGUgJzEwLjMnLlxuICogQHBhcmFtIHs/U2ltQ3JlYXRpb25PcHRzfSBvcHRzIC0gU2ltdWxhdG9yIG9wdGlvbnMgZm9yIGNyZWF0aW5nIGRldmljZXMuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBVRElEIG9mIHRoZSBuZXdseSBjcmVhdGVkIGRldmljZS5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgY29ycmVzcG9uZGluZyBzaW1jdGwgc3ViY29tbWFuZCBjb21tYW5kXG4gKiAgICAgICAgICAgICAgICAgcmV0dXJucyBub24temVybyByZXR1cm4gY29kZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gY3JlYXRlRGV2aWNlIChuYW1lLCBkZXZpY2VUeXBlSWQsIHBsYXRmb3JtVmVyc2lvbiwgb3B0cyA9IHt9KSB7XG4gIGNvbnN0IHtcbiAgICBwbGF0Zm9ybSA9IFNJTV9SVU5USU1FX05BTUVfU1VGRklYX0lPUyxcbiAgICB0aW1lb3V0ID0gREVGQVVMVF9DUkVBVEVfU0lNVUxBVE9SX1RJTUVPVVRcbiAgfSA9IG9wdHM7XG5cbiAgbGV0IHJ1bnRpbWVJZHMgPSBbXTtcblxuICAvLyBUcnkgZ2V0dGluZyBydW50aW1lSWQgdXNpbmcgSlNPTiBmbGFnXG4gIHRyeSB7XG4gICAgcnVudGltZUlkcy5wdXNoKGF3YWl0IGdldFJ1bnRpbWVGb3JQbGF0Zm9ybVZlcnNpb25WaWFKc29uKHBsYXRmb3JtVmVyc2lvbiwgcGxhdGZvcm0pKTtcbiAgfSBjYXRjaCAoaWduKSB7IH1cblxuICBpZiAoXy5pc0VtcHR5KHJ1bnRpbWVJZHMpKSB7XG4gICAgLy8gYXQgZmlyc3QgbWFrZSBzdXJlIHRoYXQgdGhlIHJ1bnRpbWUgaWQgaXMgdGhlIHJpZ2h0IG9uZVxuICAgIC8vIGluIHNvbWUgdmVyc2lvbnMgb2YgWGNvZGUgaXQgd2lsbCBiZSBhIHBhdGNoIHZlcnNpb25cbiAgICBsZXQgcnVudGltZUlkO1xuICAgIHRyeSB7XG4gICAgICBydW50aW1lSWQgPSBhd2FpdCBnZXRSdW50aW1lRm9yUGxhdGZvcm1WZXJzaW9uKHBsYXRmb3JtVmVyc2lvbiwgcGxhdGZvcm0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nLndhcm4oYFVuYWJsZSB0byBmaW5kIHJ1bnRpbWUgZm9yIGlPUyAnJHtwbGF0Zm9ybVZlcnNpb259Jy4gQ29udGludWluZ2ApO1xuICAgICAgcnVudGltZUlkID0gcGxhdGZvcm1WZXJzaW9uO1xuICAgIH1cblxuICAgIC8vIGdldCB0aGUgcG9zc2libGUgcnVudGltZXMsIHdoaWNoIHdpbGwgYmUgaXRlcmF0ZWQgb3ZlclxuICAgIC8vIGNvbXB1dGUgdGhlIGBtYWpvci5taW5vcmAgdmVyc2lvbiBmaXJzdCBzaW5jZSBYY29kZSB1c3VhbGx5IGhhcyBhIHJ1bnRpbWVcbiAgICAvLyB0aGF0IGRvZXMgbm90IGluY2x1ZGUgdGhlIHBhdGNoIHZlcnNpb24sIGV2ZW4gaWYgaXQgZXhpc3RzXG4gICAgY29uc3QgcnVudGltZUlkU2VtdmVyID0gc2VtdmVyLmNvZXJjZShydW50aW1lSWQpO1xuICAgIGlmIChfLmlzTmlsKHJ1bnRpbWVJZFNlbXZlcikpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVW5hYmxlIHRvIHBhcnNlIHJ1bnRpbWUgaWQgJyR7cnVudGltZUlkfSdgKTtcbiAgICB9XG5cbiAgICAvLyBzdGFydCB3aXRoIG1ham9yLW1pbm9yIHZlcnNpb25cbiAgICBsZXQgcG90ZW50aWFsUnVudGltZUlkcyA9IFtgJHtydW50aW1lSWRTZW12ZXIubWFqb3J9LiR7cnVudGltZUlkU2VtdmVyLm1pbm9yfWBdO1xuICAgIGlmIChydW50aW1lSWQuc3BsaXQoJy4nKS5sZW5ndGggPT09IDMpIHtcbiAgICAgIC8vIGFkZCBwYXRjaCB2ZXJzaW9uIGlmIGl0IGV4aXN0c1xuICAgICAgcG90ZW50aWFsUnVudGltZUlkcy5wdXNoKHJ1bnRpbWVJZCk7XG4gICAgfVxuXG4gICAgLy8gYWRkIG1vZGlmaWVkIHZlcnNpb25zLCBzaW5jZSBtb2Rlcm4gWGNvZGVzIHVzZSB0aGlzLCB0aGVuIHRoZSBiYXJlXG4gICAgLy8gdmVyc2lvbnMsIHRvIGFjY29tb2RhdGUgb2xkZXIgWGNvZGVzXG4gICAgcnVudGltZUlkcy5wdXNoKFxuICAgICAgLi4uKHBvdGVudGlhbFJ1bnRpbWVJZHMubWFwKChpZCkgPT4gYCR7U0lNX1JVTlRJTUVfTkFNRX0ke3BsYXRmb3JtfS0ke2lkLnJlcGxhY2UoL1xcLi9nLCAnLScpfWApKSxcbiAgICAgIC4uLnBvdGVudGlhbFJ1bnRpbWVJZHNcbiAgICApO1xuICB9XG5cbiAgLy8gZ28gdGhyb3VnaCB0aGUgcnVudGltZSBpZHMgYW5kIHRyeSB0byBjcmVhdGUgYSBzaW11bGF0b3Igd2l0aCBlYWNoXG4gIGxldCB1ZGlkO1xuICBmb3IgKGNvbnN0IHJ1bnRpbWVJZCBvZiBydW50aW1lSWRzKSB7XG4gICAgbG9nLmRlYnVnKGBDcmVhdGluZyBzaW11bGF0b3Igd2l0aCBuYW1lICcke25hbWV9JywgZGV2aWNlIHR5cGUgaWQgJyR7ZGV2aWNlVHlwZUlkfScgYW5kIHJ1bnRpbWUgaWQgJyR7cnVudGltZUlkfSdgKTtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgb3V0ID0gYXdhaXQgc2ltRXhlYygnY3JlYXRlJywgMCwgW25hbWUsIGRldmljZVR5cGVJZCwgcnVudGltZUlkXSk7XG4gICAgICB1ZGlkID0gb3V0LnN0ZG91dC50cmltKCk7XG4gICAgICBicmVhaztcbiAgICB9IGNhdGNoIChpZ24pIHtcbiAgICAgIC8vIHRoZSBlcnJvciBnZXRzIGxvZ2dlZCBpbiBgc2ltRXhlY2BcbiAgICB9XG4gIH1cblxuICBpZiAoIXVkaWQpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgQ291bGQgbm90IGNyZWF0ZSBzaW11bGF0b3Igd2l0aCBuYW1lICcke25hbWV9JywgZGV2aWNlIGAgK1xuICAgICAgICAgICAgICAgICAgICAgIGB0eXBlIGlkICcke2RldmljZVR5cGVJZH0nLCB3aXRoIHJ1bnRpbWUgaWRzIGAgK1xuICAgICAgICAgICAgICAgICAgICAgIGAke3J1bnRpbWVJZHMubWFwKChpZCkgPT4gYCcke2lkfSdgKS5qb2luKCcsICcpfWApO1xuICB9XG5cbiAgLy8gbWFrZSBzdXJlIHRoYXQgaXQgZ2V0cyBvdXQgb2YgdGhlIFwiQ3JlYXRpbmdcIiBzdGF0ZVxuICBjb25zdCByZXRyaWVzID0gcGFyc2VJbnQodGltZW91dCAvIDEwMDAsIDEwKTtcbiAgYXdhaXQgcmV0cnlJbnRlcnZhbChyZXRyaWVzLCAxMDAwLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgZGV2aWNlcyA9IF8udmFsdWVzKGF3YWl0IGdldERldmljZXMoKSk7XG4gICAgZm9yIChjb25zdCBkZXZpY2VBcnIgb2YgXy52YWx1ZXMoZGV2aWNlcykpIHtcbiAgICAgIGZvciAoY29uc3QgZGV2aWNlIG9mIGRldmljZUFycikge1xuICAgICAgICBpZiAoZGV2aWNlLnVkaWQgPT09IHVkaWQpIHtcbiAgICAgICAgICBpZiAoZGV2aWNlLnN0YXRlID09PSAnQ3JlYXRpbmcnKSB7XG4gICAgICAgICAgICAvLyBuZWVkIHRvIHJldHJ5XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYERldmljZSB3aXRoIHVkaWQgJyR7dWRpZH0nIHN0aWxsIGJlaW5nIGNyZWF0ZWRgKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gc3RvcCBsb29raW5nLCB3ZSdyZSBkb25lXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcihgRGV2aWNlIHdpdGggdWRpZCAnJHt1ZGlkfScgbm90IHlldCBjcmVhdGVkYCk7XG4gIH0pO1xuXG4gIHJldHVybiB1ZGlkO1xufVxuXG4vKipcbiAqIERlbGV0ZSB0aGUgcGFydGljdWxhciBTaW11bGF0b3IgZnJvbSBhdmFpbGFibGUgZGV2aWNlcyBsaXN0LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVGhlIFVESUQgb2YgYW4gZXhpc3RpbmcgU2ltdWxhdG9yLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb3JyZXNwb25kaW5nIHNpbWN0bCBzdWJjb21tYW5kIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICByZXR1cm5zIG5vbi16ZXJvIHJldHVybiBjb2RlLlxuICovXG5hc3luYyBmdW5jdGlvbiBkZWxldGVEZXZpY2UgKHVkaWQpIHtcbiAgYXdhaXQgc2ltRXhlYygnZGVsZXRlJywgMCwgW3VkaWRdKTtcbn1cblxuLyoqXG4gKiBSZXNldCB0aGUgY29udGVudCBhbmQgc2V0dGluZ3Mgb2YgdGhlIHBhcnRpY3VsYXIgU2ltdWxhdG9yLlxuICogSXQgaXMgcmVxdWlyZWQgdGhhdCBTaW11bGF0b3IgaXMgaW4gX3NodXRkb3duXyBzdGF0ZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdWRpZCAtIFRoZSBVRElEIG9mIGFuIGV4aXN0aW5nIFNpbXVsYXRvci5cbiAqIEBwYXJhbSB7bnVtYmVyfSB0aW1lb3V0IFsxMDAwMF0gLSBUaGUgbWF4aW11bSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXRcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bml0IGRldmljZSByZXNldCBpcyBjb21wbGV0ZWQuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIGNvcnJlc3BvbmRpbmcgc2ltY3RsIHN1YmNvbW1hbmQgY29tbWFuZFxuICogICAgICAgICAgICAgICAgIHJldHVybnMgbm9uLXplcm8gcmV0dXJuIGNvZGUuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGVyYXNlRGV2aWNlICh1ZGlkLCB0aW1lb3V0ID0gMTAwMCkge1xuICBsZXQgbG9vcEZuID0gYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IHNpbUV4ZWMoJ2VyYXNlJywgMTAwMDAsIFt1ZGlkXSk7XG4gIH07XG4gIC8vIHJldHJ5IGVyYXNlIHdpdGggYSBzbGVlcCBpbiBiZXR3ZWVuIGJlY2F1c2UgaXQncyBmbGFrZXlcbiAgbGV0IHJldHJpZXMgPSBwYXJzZUludCh0aW1lb3V0IC8gMjAwLCAxMCk7XG4gIGF3YWl0IHJldHJ5SW50ZXJ2YWwocmV0cmllcywgMjAwLCBsb29wRm4pO1xufVxuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IERldmljZUluZm9cbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBuYW1lIC0gVGhlIGRldmljZSBuYW1lLlxuICogQHByb3BlcnR5IHtzdHJpbmd9IHVkaWQgLSBUaGUgZGV2aWNlIFVESUQuXG4gKiBAcHJvcGVydHkge3N0cmluZ30gc3RhdGUgLSBUaGUgY3VycmVudCBTaW11bGF0b3Igc3RhdGUsIGZvciBleGFtcGxlICdib290ZWQnIG9yICdzaHV0ZG93bicuXG4gKiBAcHJvcGVydHkge3N0cmluZ30gc2RrIC0gVGhlIFNESyB2ZXJzaW9uLCBmb3IgZXhhbXBsZSAnMTAuMycuXG4gKi9cblxuLyoqXG4gKiBQYXJzZSB0aGUgbGlzdCBvZiBleGlzdGluZyBTaW11bGF0b3IgZGV2aWNlcyB0byByZXByZXNlbnRcbiAqIGl0IGFzIGNvbnZlbmllbnQgbWFwcGluZy5cbiAqXG4gKiBAcGFyYW0gez9zdHJpbmd9IHBsYXRmb3JtIC0gVGhlIHBsYXRmb3JtIG5hbWUsIGZvciBleGFtcGxlICd3YXRjaE9TJy5cbiAqIEByZXR1cm4ge09iamVjdH0gVGhlIHJlc3VsdGluZyBtYXBwaW5nLiBFYWNoIGtleSBpcyBwbGF0Zm9ybSB2ZXJzaW9uLFxuICogICAgICAgICAgICAgICAgICBmb3IgZXhhbXBsZSAnMTAuMycgYW5kIHRoZSBjb3JyZXNwb25kaW5nIHZhbHVlIGlzIGFuXG4gKiAgICAgICAgICAgICAgICAgIGFycmF5IG9mIHRoZSBtYXRjaGluZyB7QGxpbmsgRGV2aWNlSW5mb30gaW5zdGFuY2VzLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb3JyZXNwb25kaW5nIHNpbWN0bCBzdWJjb21tYW5kIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICByZXR1cm5zIG5vbi16ZXJvIHJldHVybiBjb2RlLlxuICovXG5hc3luYyBmdW5jdGlvbiBnZXREZXZpY2VzQnlQYXJzaW5nIChwbGF0Zm9ybSkge1xuICAvLyBnZXQgdGhlIGxpc3Qgb2YgZGV2aWNlc1xuICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IHNpbUV4ZWMoJ2xpc3QnLCAwLCBbJ2RldmljZXMnXSk7XG5cbiAgLy8gZXhwZWN0IHRvIGdldCBhIGxpc3RpbmcgbGlrZVxuICAvLyAtLSBpT1MgOC4xIC0tXG4gIC8vICAgICBpUGhvbmUgNHMgKDNDQTZFN0RELTIyMEUtNDVFNS1CNzE2LTFFOTkyQjNBNDI5QykgKFNodXRkb3duKVxuICAvLyAgICAgLi4uXG4gIC8vIC0tIGlPUyA4LjIgLS1cbiAgLy8gICAgIGlQaG9uZSA0cyAoQTk5RkZGQzMtOEUxOS00RENGLUI1ODUtN0Q5RDQ2QjRDMTZFKSAoU2h1dGRvd24pXG4gIC8vICAgICAuLi5cbiAgLy8gc28sIGdldCB0aGUgYC0tIGlPUyBYLlggLS1gIGxpbmUgdG8gZmluZCB0aGUgc2RrIChYLlgpXG4gIC8vIGFuZCB0aGUgcmVzdCBvZiB0aGUgbGlzdGluZyBpbiBvcmRlciB0byBsYXRlciBmaW5kIHRoZSBkZXZpY2VzXG4gIGNvbnN0IGRldmljZVNlY3Rpb25SZSA9IF8uaXNFbXB0eShwbGF0Zm9ybSlcbiAgICA/IG5ldyBSZWdFeHAoYFxcXFwtXFxcXC1cXFxccysoXFxcXFMrKVxcXFxzKyhcXFxcUyspXFxcXHMrXFxcXC1cXFxcLShcXFxcblxcXFxzezR9LispKmAsICdtZ2knKVxuICAgIDogbmV3IFJlZ0V4cChgXFxcXC1cXFxcLVxcXFxzKyR7Xy5lc2NhcGVSZWdFeHAocGxhdGZvcm0pfVxcXFxzKyhcXFxcUyspXFxcXHMrXFxcXC1cXFxcLShcXFxcblxcXFxzezR9LispKmAsICdtZ2knKTtcbiAgY29uc3QgbWF0Y2hlcyA9IFtdO1xuICBsZXQgbWF0Y2g7XG4gIC8vIG1ha2UgYW4gZW50cnkgZm9yIGVhY2ggc2RrIHZlcnNpb25cbiAgd2hpbGUgKChtYXRjaCA9IGRldmljZVNlY3Rpb25SZS5leGVjKHN0ZG91dCkpKSB7XG4gICAgbWF0Y2hlcy5wdXNoKG1hdGNoKTtcbiAgfVxuICBpZiAoXy5pc0VtcHR5KG1hdGNoZXMpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdDb3VsZCBub3QgZmluZCBkZXZpY2Ugc2VjdGlvbicpO1xuICB9XG5cbiAgY29uc3QgbGluZVJlID0gLyhbXlxcc10uKykgXFwoKFxcdystLitcXHcrKVxcKSBcXCgoXFx3K1xccz9cXHcrKVxcKS87IC8vIGh0dHBzOi8vcmVnZXgxMDEuY29tL3IvbEc3bUs2LzNcbiAgLy8gZ2V0IGFsbCB0aGUgZGV2aWNlcyBmb3IgZWFjaCBzZGtcbiAgY29uc3QgZGV2aWNlcyA9IHt9O1xuICBmb3IgKG1hdGNoIG9mIG1hdGNoZXMpIHtcbiAgICBjb25zdCBzZGsgPSBwbGF0Zm9ybSA/IG1hdGNoWzFdIDogbWF0Y2hbMl07XG4gICAgZGV2aWNlc1tzZGtdID0gZGV2aWNlc1tzZGtdIHx8IFtdO1xuICAgIC8vIHNwbGl0IHRoZSBmdWxsIG1hdGNoIGludG8gbGluZXMgYW5kIHJlbW92ZSB0aGUgZmlyc3RcbiAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbWF0Y2hbMF0uc3BsaXQoJ1xcbicpLnNsaWNlKDEpKSB7XG4gICAgICBpZiAobGluZS5pbmNsdWRlcygnKHVuYXZhaWxhYmxlLCAnKSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIC8vIGEgbGluZSBpcyBzb21ldGhpbmcgbGlrZVxuICAgICAgLy8gICAgaVBob25lIDRzIChBOTlGRkZDMy04RTE5LTREQ0YtQjU4NS03RDlENDZCNEMxNkUpIChTaHV0ZG93bilcbiAgICAgIC8vIHJldHJpZXZlOlxuICAgICAgLy8gICBpUGhvbmUgNHNcbiAgICAgIC8vICAgQTk5RkZGQzMtOEUxOS00RENGLUI1ODUtN0Q5RDQ2QjRDMTZFXG4gICAgICAvLyAgIFNodXRkb3duXG4gICAgICBjb25zdCBsaW5lTWF0Y2ggPSBsaW5lUmUuZXhlYyhsaW5lKTtcbiAgICAgIGlmICghbGluZU1hdGNoKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQ291bGQgbm90IG1hdGNoIGxpbmU6ICR7bGluZX1gKTtcbiAgICAgIH1cbiAgICAgIC8vIHNhdmUgdGhlIHdob2xlIHRoaW5nIGFzIGFiIG9iamVjdCBpbiB0aGUgbGlzdCBmb3IgdGhpcyBzZGtcbiAgICAgIGRldmljZXNbc2RrXS5wdXNoKHtcbiAgICAgICAgbmFtZTogbGluZU1hdGNoWzFdLFxuICAgICAgICB1ZGlkOiBsaW5lTWF0Y2hbMl0sXG4gICAgICAgIHN0YXRlOiBsaW5lTWF0Y2hbM10sXG4gICAgICAgIHNkayxcbiAgICAgICAgcGxhdGZvcm06IHBsYXRmb3JtIHx8IG1hdGNoWzFdLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG4gIHJldHVybiBkZXZpY2VzO1xufVxuXG4vKipcbiAqIFBhcnNlIHRoZSBsaXN0IG9mIGV4aXN0aW5nIFNpbXVsYXRvciBkZXZpY2VzIHRvIHJlcHJlc2VudFxuICogaXQgYXMgY29udmVuaWVudCBtYXBwaW5nIGZvciB0aGUgcGFydGljdWxhciBwbGF0Zm9ybSB2ZXJzaW9uLlxuICpcbiAqIEBwYXJhbSB7P3N0cmluZ30gZm9yU2RrIC0gVGhlIHNkayB2ZXJzaW9uLFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICBmb3Igd2hpY2ggdGhlIGRldmljZXMgbGlzdCBzaG91bGQgYmUgcGFyc2VkLFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgZXhhbXBsZSAnMTAuMycuXG4gKiBAcGFyYW0gez9zdHJpbmd9IHBsYXRmb3JtIC0gVGhlIHBsYXRmb3JtIG5hbWUsIGZvciBleGFtcGxlICd3YXRjaE9TJy5cbiAqIEByZXR1cm4ge09iamVjdHxBcnJheTxEZXZpY2VJbmZvPn0gSWYgX2ZvclNka18gaXMgc2V0IHRoZW4gdGhlIGxpc3RcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2YgZGV2aWNlcyBmb3IgdGhlIHBhcnRpY3VsYXIgcGxhdGZvcm0gdmVyc2lvbi5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT3RoZXJ3aXNlIHRoZSBzYW1lIHJlc3VsdCBhcyBmb3Ige0BsaW5rIGdldERldmljZXNCeVBhcnNpbmd9XG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb3JyZXNwb25kaW5nIHNpbWN0bCBzdWJjb21tYW5kIGNvbW1hbmRcbiAqICAgICAgICAgICAgICAgICByZXR1cm5zIG5vbi16ZXJvIHJldHVybiBjb2RlIG9yIGlmIG5vIG1hdGNoaW5nXG4gKiAgICAgICAgICAgICAgICAgcGxhdGZvcm0gdmVyc2lvbiBpcyBmb3VuZCBpbiB0aGUgc3lzdGVtLlxuICovXG5hc3luYyBmdW5jdGlvbiBnZXREZXZpY2VzIChmb3JTZGssIHBsYXRmb3JtKSB7XG4gIGxldCBkZXZpY2VzID0ge307XG4gIHRyeSB7XG4gICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBzaW1FeGVjKCdsaXN0JywgMCwgWydkZXZpY2VzJywgJy1qJ10pO1xuICAgIC8qIEpTT04gc2hvdWxkIGJlXG4gICAgICoge1xuICAgICAqICAgXCJkZXZpY2VzXCIgOiB7XG4gICAgICogICAgIFwiaU9TIDxzZGs+XCIgOiBbIC8vIG9yXG4gICAgICogICAgIFwiY29tLmFwcGxlLkNvcmVTaW11bGF0b3IuU2ltUnVudGltZS5pT1MtPHNkaz4gOiBbXG4gICAgICogICAgICAge1xuICAgICAqICAgICAgICAgXCJzdGF0ZVwiIDogXCJCb290ZWRcIixcbiAgICAgKiAgICAgICAgIFwiYXZhaWxhYmlsaXR5XCIgOiBcIihhdmFpbGFibGUpXCIsXG4gICAgICogICAgICAgICBcImlzQXZhaWxhYmxlXCIgOiB0cnVlLFxuICAgICAqICAgICAgICAgXCJuYW1lXCIgOiBcImlQaG9uZSA2XCIsXG4gICAgICogICAgICAgICBcInVkaWRcIiA6IFwiNzVFMzQxNDAtMThFOC00RDFBLTlGNDUtQUFDNzM1REY3NURGXCJcbiAgICAgKiAgICAgICB9XG4gICAgICogICAgIF1cbiAgICAgKiAgIH1cbiAgICAgKiB9XG4gICAgICovXG4gICAgY29uc3QgdmVyc2lvbk1hdGNoUmUgPSBfLmlzRW1wdHkocGxhdGZvcm0pXG4gICAgICA/IG5ldyBSZWdFeHAoYF4oW15cXFxccy1dKylbXFxcXHMtXShcXFxcUyspYCwgJ2knKVxuICAgICAgOiBuZXcgUmVnRXhwKGBeJHtfLmVzY2FwZVJlZ0V4cChwbGF0Zm9ybSl9W1xcXFxzLV0oXFxcXFMrKWAsICdpJyk7XG4gICAgZm9yIChsZXQgW3Nka05hbWUsIGVudHJpZXNdIG9mIF8udG9QYWlycyhKU09OLnBhcnNlKHN0ZG91dCkuZGV2aWNlcykpIHtcbiAgICAgIC8vIHRoZXJlIGNvdWxkIGJlIGEgbG9uZ2VyIG5hbWUsIHNvIHJlbW92ZSBpdFxuICAgICAgc2RrTmFtZSA9IHNka05hbWUucmVwbGFjZShTSU1fUlVOVElNRV9OQU1FLCAnJyk7XG4gICAgICBjb25zdCB2ZXJzaW9uTWF0Y2ggPSB2ZXJzaW9uTWF0Y2hSZS5leGVjKHNka05hbWUpO1xuICAgICAgaWYgKCF2ZXJzaW9uTWF0Y2gpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIC8vIHRoZSBzZGsgY2FuIGhhdmUgZGFzaGVzIChgMTItMmApIG9yIGRvdHMgKGAxMi4xYClcbiAgICAgIGNvbnN0IHNkayA9IChwbGF0Zm9ybSA/IHZlcnNpb25NYXRjaFsxXSA6IHZlcnNpb25NYXRjaFsyXSkucmVwbGFjZSgnLScsICcuJyk7XG4gICAgICBkZXZpY2VzW3Nka10gPSBkZXZpY2VzW3Nka10gfHwgW107XG4gICAgICBkZXZpY2VzW3Nka10ucHVzaCguLi5lbnRyaWVzLmZpbHRlcigoZWwpID0+IF8uaXNVbmRlZmluZWQoZWwuaXNBdmFpbGFibGUpIHx8IGVsLmlzQXZhaWxhYmxlKVxuICAgICAgICAubWFwKChlbCkgPT4ge1xuICAgICAgICAgIGRlbGV0ZSBlbC5hdmFpbGFiaWxpdHk7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHNkayxcbiAgICAgICAgICAgIC4uLmVsLFxuICAgICAgICAgICAgcGxhdGZvcm06IHBsYXRmb3JtIHx8IHZlcnNpb25NYXRjaFsxXSxcbiAgICAgICAgICB9O1xuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZy5kZWJ1ZyhgVW5hYmxlIHRvIGdldCBKU09OIGRldmljZSBsaXN0OiAke2Vyci5zdGFja31gKTtcbiAgICBsb2cuZGVidWcoJ0ZhbGxpbmcgYmFjayB0byBtYW51YWwgcGFyc2luZycpO1xuICAgIGRldmljZXMgPSBhd2FpdCBnZXREZXZpY2VzQnlQYXJzaW5nKHBsYXRmb3JtKTtcbiAgfVxuXG4gIGlmICghZm9yU2RrKSB7XG4gICAgcmV0dXJuIGRldmljZXM7XG4gIH1cbiAgLy8gaWYgYSBgZm9yU2RrYCB3YXMgcGFzc2VkIGluLCByZXR1cm4gb25seSB0aGUgY29ycmVzcG9uZGluZyBsaXN0XG4gIGlmIChkZXZpY2VzW2ZvclNka10pIHtcbiAgICByZXR1cm4gZGV2aWNlc1tmb3JTZGtdO1xuICB9XG5cbiAgbGV0IGVyck1zZyA9IGAnJHtmb3JTZGt9JyBkb2VzIG5vdCBleGlzdCBpbiB0aGUgbGlzdCBvZiBzaW1jdGwgU0RLcy5gO1xuICBjb25zdCBhdmFpbGFibGVTREtzID0gXy5rZXlzKGRldmljZXMpO1xuICBlcnJNc2cgKz0gYXZhaWxhYmxlU0RLcy5sZW5ndGhcbiAgICA/IGAgT25seSB0aGUgZm9sbG93aW5nIFNpbXVsYXRvciBTREsgdmVyc2lvbnMgYXJlIGF2YWlsYWJsZSBvbiB5b3VyIHN5c3RlbTogJHthdmFpbGFibGVTREtzLmpvaW4oJywgJyl9YFxuICAgIDogYCBObyBTaW11bGF0b3IgU0RLIHZlcnNpb25zIGFyZSBhdmFpbGFibGUgb24geW91ciBzeXN0ZW0uIFBsZWFzZSBpbnN0YWxsIHNvbWUgdmlhIFhjb2RlIHByZWZlcmVuY2VzLmA7XG4gIHRocm93IG5ldyBFcnJvcihlcnJNc2cpO1xufVxuXG4vKipcbiAqIEdldCB0aGUgcnVudGltZSBmb3IgdGhlIHBhcnRpY3VsYXIgcGxhdGZvcm0gdmVyc2lvbiB1c2luZyAtLWpzb24gZmxhZ1xuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwbGF0Zm9ybVZlcnNpb24gLSBUaGUgcGxhdGZvcm0gdmVyc2lvbiBuYW1lLFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBleGFtcGxlICcxMC4zJy5cbiAqIEBwYXJhbSB7P3N0cmluZ30gcGxhdGZvcm0gLSBUaGUgcGxhdGZvcm0gbmFtZSwgZm9yIGV4YW1wbGUgJ3dhdGNoT1MnLlxuICogQHJldHVybiB7c3RyaW5nfSBUaGUgY29ycmVzcG9uZGluZyBydW50aW1lIG5hbWUgZm9yIHRoZSBnaXZlblxuICogICAgICAgICAgICAgICAgICBwbGF0Zm9ybSB2ZXJzaW9uLlxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRSdW50aW1lRm9yUGxhdGZvcm1WZXJzaW9uVmlhSnNvbiAocGxhdGZvcm1WZXJzaW9uLCBwbGF0Zm9ybSA9ICdpT1MnKSB7XG4gIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgc2ltRXhlYygnbGlzdCcsIDAsIFsncnVudGltZXMnLCAnLS1qc29uJ10pO1xuICBmb3IgKGNvbnN0IHt2ZXJzaW9uLCBpZGVudGlmaWVyLCBuYW1lfSBvZiBKU09OLnBhcnNlKHN0ZG91dCkucnVudGltZXMpIHtcbiAgICBpZiAodmVyc2lvbiA9PT0gcGxhdGZvcm1WZXJzaW9uICYmIG5hbWUudG9Mb3dlckNhc2UoKS5zdGFydHNXaXRoKHBsYXRmb3JtLnRvTG93ZXJDYXNlKCkpKSB7XG4gICAgICByZXR1cm4gaWRlbnRpZmllcjtcbiAgICB9XG4gIH1cbiAgdGhyb3cgbmV3IEVycm9yKGBDb3VsZCBub3QgdXNlIC0tanNvbiBmbGFnIHRvIHBhcnNlIHBsYXRmb3JtIHZlcnNpb25gKTtcbn1cblxuLyoqXG4gKiBHZXQgdGhlIHJ1bnRpbWUgZm9yIHRoZSBwYXJ0aWN1bGFyIHBsYXRmb3JtIHZlcnNpb24uXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBsYXRmb3JtVmVyc2lvbiAtIFRoZSBwbGF0Zm9ybSB2ZXJzaW9uIG5hbWUsXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGV4YW1wbGUgJzEwLjMnLlxuICogQHBhcmFtIHs/c3RyaW5nfSBwbGF0Zm9ybSAtIFRoZSBwbGF0Zm9ybSBuYW1lLCBmb3IgZXhhbXBsZSAnd2F0Y2hPUycuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBjb3JyZXNwb25kaW5nIHJ1bnRpbWUgbmFtZSBmb3IgdGhlIGdpdmVuXG4gKiAgICAgICAgICAgICAgICAgIHBsYXRmb3JtIHZlcnNpb24uXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldFJ1bnRpbWVGb3JQbGF0Zm9ybVZlcnNpb24gKHBsYXRmb3JtVmVyc2lvbiwgcGxhdGZvcm0gPSAnaU9TJykge1xuICAvLyBUcnkgd2l0aCBwYXJzaW5nXG4gIHRyeSB7XG4gICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBzaW1FeGVjKCdsaXN0JywgMCwgWydydW50aW1lcyddKTtcbiAgICAvLyBodHRwczovL3JlZ2V4MTAxLmNvbS9yL1V5a2pRWi8xXG4gICAgY29uc3QgcnVudGltZVJlID0gbmV3IFJlZ0V4cChgJHtfLmVzY2FwZVJlZ0V4cChwbGF0Zm9ybSl9XFxcXHMrKFxcXFxkK1xcXFwuXFxcXGQrKVxcXFxzK1xcXFwoKFxcXFxkK1xcXFwuXFxcXGQrXFxcXC4qXFxcXGQqKWAsICdpJyk7XG4gICAgZm9yIChjb25zdCBsaW5lIG9mIHN0ZG91dC5zcGxpdCgnXFxuJykpIHtcbiAgICAgIGNvbnN0IG1hdGNoID0gcnVudGltZVJlLmV4ZWMobGluZSk7XG4gICAgICBpZiAobWF0Y2ggJiYgbWF0Y2hbMV0gPT09IHBsYXRmb3JtVmVyc2lvbikge1xuICAgICAgICByZXR1cm4gbWF0Y2hbMl07XG4gICAgICB9XG4gICAgfVxuICB9IGNhdGNoIChpZ24pIHt9XG5cbiAgLy8gaWYgbm90aGluZyB3YXMgZm91bmQsIHBhc3MgcGxhdGZvcm0gdmVyc2lvbiBiYWNrXG4gIHJldHVybiBwbGF0Zm9ybVZlcnNpb247XG59XG5cbi8qKlxuICogR2V0cyBiYXNlNjQgc2NyZWVuc2hvdCBmb3IgZGV2aWNlICh4Y29kZSA+PSA4LjEgb25seSkuXG4gKiBJdCBpcyByZXF1aXJlZCB0aGF0IFNpbXVsYXRvciBpcyBpbiBfYm9vdGVkXyBzdGF0ZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdWRpZCAtIFRoZSBVRElEIG9mIGFuIGV4aXN0aW5nIFNpbXVsYXRvci5cbiAqIEByZXR1cm4ge3N0cmluZ30gQmFzZTY0LWVuY29kZWQgU2ltdWxhdG9yIHNjcmVlbnNob3QuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIGNvcnJlc3BvbmRpbmcgc2ltY3RsIHN1YmNvbW1hbmQgY29tbWFuZFxuICogICAgICAgICAgICAgICAgIHJldHVybnMgbm9uLXplcm8gcmV0dXJuIGNvZGUuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldFNjcmVlbnNob3QgKHVkaWQpIHtcbiAgbGV0IHBhdGhUb1NjcmVlbnNob3RQbmcgPSBhd2FpdCB0ZW1wRGlyLnBhdGgoe3ByZWZpeDogYHNjcmVlbnNob3QtJHt1ZGlkfWAsIHN1ZmZpeDogJy5wbmcnfSk7XG4gIGF3YWl0IHNpbUV4ZWMoJ2lvJywgMCwgW3VkaWQsICdzY3JlZW5zaG90JywgcGF0aFRvU2NyZWVuc2hvdFBuZ10pO1xuICBsZXQgc2NyZWVuc2hvdEltZyA9IGF3YWl0IGZzLnJlYWRGaWxlKHBhdGhUb1NjcmVlbnNob3RQbmcpO1xuICBhd2FpdCBmcy5yaW1yYWYocGF0aFRvU2NyZWVuc2hvdFBuZyk7XG4gIHJldHVybiBzY3JlZW5zaG90SW1nLnRvU3RyaW5nKCdiYXNlNjQnKTtcbn1cblxuLyoqXG4gKiBTZXQgdGhlIGNvbnRlbnQgb2YgU2ltdWxhdG9yIHBhc3RlYm9hcmQgKHhjb2RlID49IDguMSBvbmx5KS5cbiAqIEl0IGlzIHJlcXVpcmVkIHRoYXQgU2ltdWxhdG9yIGlzIGluIF9ib290ZWRfIHN0YXRlLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gRGV2aWNlIFVESUQuXG4gKiBAcGFyYW0ge3N0cmluZ30gY29udGVudCAtIFRoZSBhY3R1YWwgc3RyaW5nIGNvbnRlbnQgdG8gYmUgc2V0LlxuICogQHBhcmFtIHtzdHJpbmd9IGVuY29kaW5nIFsndXRmLTgnXSAtIFRoZSBlbmNvZGluZyBvZiB0aGUgZ2l2ZW4gcGFzdGVib2FyZCBjb250ZW50LlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFVURi04IGJ5IGRlZmF1bHQuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIGNvcnJlc3BvbmRpbmcgc2ltY3RsIHN1YmNvbW1hbmQgY29tbWFuZFxuICogICAgICAgICAgICAgICAgIHJldHVybnMgbm9uLXplcm8gcmV0dXJuIGNvZGUuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHNldFBhc3RlYm9hcmQgKHVkaWQsIGNvbnRlbnQsIGVuY29kaW5nID0gJ3V0Zi04Jykge1xuICBjb25zdCBwYkNvcHlTdWJwcm9jZXNzID0gbmV3IFN1YlByb2Nlc3MoJ3hjcnVuJywgWydzaW1jdGwnLCAncGJjb3B5JywgdWRpZF0pO1xuICBhd2FpdCBwYkNvcHlTdWJwcm9jZXNzLnN0YXJ0KDApO1xuICBjb25zdCBleGl0Q29kZVZlcmlmaWVyID0gcGJDb3B5U3VicHJvY2Vzcy5qb2luKCk7XG4gIGNvbnN0IHN0ZGluID0gcGJDb3B5U3VicHJvY2Vzcy5wcm9jLnN0ZGluO1xuICBzdGRpbi5zZXRFbmNvZGluZyhlbmNvZGluZyk7XG4gIHN0ZGluLndyaXRlKGNvbnRlbnQpO1xuICBzdGRpbi5lbmQoKTtcbiAgYXdhaXQgZXhpdENvZGVWZXJpZmllcjtcbn1cblxuLyoqXG4gKiBHZXQgdGhlIGNvbnRlbnQgb2YgU2ltdWxhdG9yIHBhc3RlYm9hcmQgKHhjb2RlID49IDguMSBvbmx5KS5cbiAqIEl0IGlzIHJlcXVpcmVkIHRoYXQgU2ltdWxhdG9yIGlzIGluIF9ib290ZWRfIHN0YXRlLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gRGV2aWNlIFVESUQuXG4gKiBAcGFyYW0ge3N0cmluZ30gZW5jb2RpbmcgWyd1dGYtOCddIC0gVGhlIGVuY29kaW5nIG9mIHRoZSByZXR1cm5lZCBwYXN0ZWJvYXJkIGNvbnRlbnQuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVVRGLTggYnkgZGVmYXVsdC5cbiAqIEByZXR1cm4ge3N0cmluZ30gQ3VycmVudCBjb250ZW50IG9mIFNpbXVsYXRvciBwYXN0ZWJvYXJkIG9yIGFuIGVtcHR5IHN0cmluZy5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgY29ycmVzcG9uZGluZyBzaW1jdGwgc3ViY29tbWFuZCBjb21tYW5kXG4gKiAgICAgICAgICAgICAgICAgcmV0dXJucyBub24temVybyByZXR1cm4gY29kZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0UGFzdGVib2FyZCAodWRpZCwgZW5jb2RpbmcgPSAndXRmLTgnKSB7XG4gIGNvbnN0IGFyZ3MgPSBbJ3NpbWN0bCcsICdwYnBhc3RlJywgdWRpZF07XG4gIHRyeSB7XG4gICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBleGVjKCd4Y3J1bicsIGFyZ3MsIHt0aW1lb3V0OiAwLCBlbmNvZGluZ30pO1xuICAgIHJldHVybiBzdGRvdXQ7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBpZiAoZS5zdGRlcnIpIHtcbiAgICAgIGxvZy5lcnJvckFuZFRocm93KGBFcnJvciBydW5uaW5nICd4Y3J1biAke2FyZ3Muam9pbignICcpfSc6ICR7ZS5zdGRlcnIudHJpbSgpfWApO1xuICAgIH0gZWxzZSB7XG4gICAgICBsb2cuZXJyb3JBbmRUaHJvdyhlKTtcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBHZXQgdGhlIGxpc3Qgb2YgZGV2aWNlIHR5cGVzIGF2YWlsYWJsZSBpbiB0aGUgY3VycmVudCBYY29kZSBpbnN0YWxsYXRpb25cbiAqXG4gKiBAcmV0dXJuIHtBcnJheTxzdHJpbmc+fSBMaXN0IG9mIHRoZSB0eXBlcyBvZiBkZXZpY2VzIGF2YWlsYWJsZVxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjb3JyZXNwb25kaW5nIHNpbWN0bCBjb21tYW5kIGZhaWxzXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldERldmljZVR5cGVzICgpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IHNpbUV4ZWMoJ2xpc3QnLCAwLCBbJ2RldmljZXR5cGVzJywgJy1qJ10pO1xuICAgIC8qXG4gICAgICogSlNPTiB3aWxsIGJlIGxpa2U6XG4gICAgICogICB7XG4gICAgICogICAgIFwiZGV2aWNldHlwZXNcIiA6IFtcbiAgICAgKiAgICAgICB7XG4gICAgICogICAgICAgICBcIm5hbWVcIiA6IFwiaVBob25lIDRzXCIsXG4gICAgICogICAgICAgICBcImlkZW50aWZpZXJcIiA6IFwiY29tLmFwcGxlLkNvcmVTaW11bGF0b3IuU2ltRGV2aWNlVHlwZS5pUGhvbmUtNHNcIlxuICAgICAqICAgICAgIH0sXG4gICAgICogICAgICAgLi4uXG4gICAgICogICB9XG4gICAgICovXG4gICAgY29uc3QgZGV2aWNlVHlwZXMgPSBKU09OLnBhcnNlKHN0ZG91dC50cmltKCkpO1xuICAgIHJldHVybiBkZXZpY2VUeXBlcy5kZXZpY2V0eXBlcy5tYXAoKHR5cGUpID0+IHR5cGUubmFtZSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxldCBtc2cgPSBgVW5hYmxlIHRvIGdldCBsaXN0IG9mIGRldmljZSB0eXBlczogJHtlcnIubWVzc2FnZX1gO1xuICAgIGlmIChlcnIuc3RkZXJyKSB7XG4gICAgICBtc2cgPSBgJHttc2d9LiBTdGRlcnI6ICR7ZXJyLnN0ZGVycn1gO1xuICAgIH1cbiAgICB0aHJvdyBuZXcgRXJyb3IobXNnKTtcbiAgfVxufVxuXG5cbi8qKlxuICogR2V0IHRoZSBmdWxsIGxpc3Qgb2YgcnVudGltZXMsIGRldmljZXR5cGVzLCBkZXZpY2VzIGFuZCBwYWlycyBhcyBPYmplY3RcbiAqXG4gKiBAcmV0dXJuIHtPYmplY3R9IE9iamVjdCBjb250YWluaW5nIGRldmljZSB0eXBlcywgcnVudGltZXMgZGV2aWNlcyBhbmQgcGFpcnNcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgY29ycmVzcG9uZGluZyBzaW1jdGwgY29tbWFuZCBmYWlsc1xuICovXG5hc3luYyBmdW5jdGlvbiBnZXRTaW1jdGxMaXN0ICgpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IHNpbUV4ZWMoJ2xpc3QnLCAwLCBbJy1qJ10pO1xuICAgIC8qXG4gICAgICogSlNPTiB3aWxsIGJlIGxpa2VcbiAgICAgKiAgIHtcbiAgICAgKiAgICAgXCJkZXZpY2V0eXBlc1wiIDogW1xuICAgICAqICAgICAgIHtcbiAgICAgKiAgICAgICAgIFwibmFtZVwiIDogXCJpUGhvbmUgNHNcIixcbiAgICAgKiAgICAgICAgIFwiaWRlbnRpZmllclwiIDogXCJjb20uYXBwbGUuQ29yZVNpbXVsYXRvci5TaW1EZXZpY2VUeXBlLmlQaG9uZS00c1wiXG4gICAgICogICAgICAgfSxcbiAgICAgKiAgICAgICAuLi5cbiAgICAgKiAgICAgIF0sXG4gICAgICogICAgIFwicnVudGltZXNcIiA6IFtcbiAgICAgKiAgICAgICB7XG4gICAgICogICAgICAgICBcInZlcnNpb25cIiA6ICcxMy4wJyxcbiAgICAgKiAgICAgICAgIFwiYnVuZGxlUGF0aFwiIDogJy9BcHBsaWNhdGlvbnMvWGNvZGUxMWJldGE0LmFwcC9Db250ZW50cy9EZXZlbG9wZXIvUGxhdGZvcm1zL2lQaG9uZU9TLnBsYXRmb3JtL0xpYnJhcnkvRGV2ZWxvcGVyL0NvcmVTaW11bGF0b3IvUHJvZmlsZXMvUnVudGltZXMvaU9TLnNpbXJ1bnRpbWUnLFxuICAgICAqICAgICAgICAgXCJpc0F2YWlsYWJsZVwiIDogdHJ1ZSxcbiAgICAgKiAgICAgICAgIFwibmFtZVwiIDogJ2lPUyAxMy4wJyxcbiAgICAgKiAgICAgICAgIFwiaWRlbnRpZmllclwiIDogJ2NvbS5hcHBsZS5Db3JlU2ltdWxhdG9yLlNpbVJ1bnRpbWUuaU9TLTEzLTAnLFxuICAgICAqICAgICAgICAgXCJidWlsZHZlcnNpb25cIiA6ICcxN0E1NTM0ZCdcbiAgICAgKiAgICAgICB9LFxuICAgICAqICAgICAgIC4uLlxuICAgICAqICAgICAgfSxcbiAgICAgKiAgICAgXCJkZXZpY2VzXCIgOlxuICAgICAqICAgICAgIHtcbiAgICAgKiAgICAgICAgICdjb20uYXBwbGUuQ29yZVNpbXVsYXRvci5TaW1SdW50aW1lLmlPUy0xMy0wJzogWyBbT2JqZWN0XSwgW09iamVjdF0gXSB9LFxuICAgICAqICAgICAgICAgLi4uXG4gICAgICogICAgICAgfSxcbiAgICAgKiAgICAgXCJwYWlyc1wiIDoge30gfVxuICAgICAqXG4gICAgICogICB9XG4gICAgICovXG4gICAgcmV0dXJuIEpTT04ucGFyc2Uoc3Rkb3V0KTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbGV0IG1zZyA9IGBVbmFibGUgdG8gZ2V0IHNpbWN0bCBsaXN0OiAke2Vyci5tZXNzYWdlfWA7XG4gICAgaWYgKGVyci5zdGRlcnIpIHtcbiAgICAgIG1zZyA9IGAke21zZ30uIFN0ZGVycjogJHtlcnIuc3RkZXJyfWA7XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcihtc2cpO1xuICB9XG59XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gQm9vdE1vbml0b3JPcHRpb25zXG4gKiBAcHJvcGVydHkgez9udW1iZXJ9IHRpbWVvdXQgWzI0MDAwMF0gLSBTaW11bGF0b3IgYm9vdGluZyB0aW1lb3V0IGluIG1zLlxuICogQHByb3BlcnR5IHs/RnVuY3Rpb259IG9uV2FpdGluZ0RhdGFNaWdyYXRpb24gLSBUaGlzIGV2ZW50IGlzIGZpcmVkIHdoZW4gZGF0YSBtaWdyYXRpb24gc3RhZ2Ugc3RhcnRzLlxuICogQHByb3BlcnR5IHs/RnVuY3Rpb259IG9uV2FpdGluZ1N5c3RlbUFwcCAtIFRoaXMgZXZlbnQgaXMgZmlyZWQgd2hlbiBzeXN0ZW0gYXBwIHdhaXQgc3RhZ2Ugc3RhcnRzLlxuICogQHByb3BlcnR5IHs/RnVuY3Rpb259IG9uRmluaXNoZWQgLSBUaGlzIGV2ZW50IGlzIGZpcmVkIHdoZW4gU2ltdWxhdG9yIGlzIGZ1bGx5IGJvb3RlZC5cbiAqIEBwcm9wZXJ0eSB7P0Z1bmN0aW9ufSBvbkVycm9yIC0gVGhpcyBldmVudCBpcyBmaXJlZCB3aGVuIHRoZXJlIHdhcyBhbiBlcnJvciB3aGlsZSBtb25pdG9yaW5nIHRoZSBib290aW5nIHByb2Nlc3NcbiAqIG9yIHdoZW4gdGhlIHRpbWVvdXQgaGFzIGV4cGlyZWQuXG4gKi9cblxuLyoqXG4gKiBTdGFydCBtb25pdG9yaW5nIGZvciBib290IHN0YXR1cyBvZiB0aGUgcGFydGljdWxhciBTaW11bGF0b3IuXG4gKiBJZiBvbkZpbmlzaGVkIHByb3BlcnR5IGlzIG5vdCBzZXQgdGhlbiB0aGUgbWV0aG9kIHdpbGwgYmxvY2tcbiAqIHVudGlsIFNpbXVsYXRvciBib290aW5nIGlzIGNvbXBsZXRlZC5cbiAqIFRoZSBtZXRob2QgaXMgb25seSBhdmFpbGFibGUgc2luY2UgWGNvZGU4LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gRGV2aWNlIFVESUQuXG4gKiBAcGFyYW0gez9Cb290TW9uaXRvck9wdGlvbnN9IG9wdHMgLSBNb25pdG9yaW5nIG9wdGlvbnMuXG4gKiBAcmV0dXJucyB7U3ViUHJvY2Vzc30gVGhlIGluc3RhbmNlIG9mIHRoZSBjb3JyZXNwb25kaW5nIG1vbml0b3JpbmcgcHJvY2Vzcy5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgU2ltdWxhdG9yIGZhaWxzIHRvIGZpbmlzaCBib290aW5nIHdpdGhpbiB0aGUgZ2l2ZW4gdGltZW91dCBhbmQgb25GaW5pc2hlZFxuICogcHJvcGVydHkgaXMgbm90IHNldC5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gc3RhcnRCb290TW9uaXRvciAodWRpZCwgb3B0cyA9IHt9KSB7XG4gIGNvbnN0IHtcbiAgICB0aW1lb3V0ID0gMjQwMDAwLFxuICAgIG9uV2FpdGluZ0RhdGFNaWdyYXRpb24sXG4gICAgb25XYWl0aW5nU3lzdGVtQXBwLFxuICAgIG9uRmluaXNoZWQsXG4gICAgb25FcnJvcixcbiAgfSA9IG9wdHM7XG5cbiAgbGV0IHN0YXR1cyA9ICcnO1xuICBsZXQgaXNCb290aW5nRmluaXNoZWQgPSBmYWxzZTtcbiAgbGV0IGVycm9yID0gbnVsbDtcbiAgbGV0IHRpbWVvdXRIYW5kbGVyID0gbnVsbDtcbiAgY29uc3QgYm9vdE1vbml0b3IgPSBhd2FpdCBzaW1TdWJQcm9jZXNzKCdib290c3RhdHVzJywgMCwgW3VkaWRdKTtcbiAgYm9vdE1vbml0b3Iub24oJ291dHB1dCcsIChzdGRvdXQsIHN0ZGVycikgPT4ge1xuICAgIHN0YXR1cyArPSBzdGRvdXQgfHwgc3RkZXJyO1xuICAgIGlmIChzdGRvdXQpIHtcbiAgICAgIGlmIChzdGRvdXQuaW5jbHVkZXMoJ1dhaXRpbmcgb24gRGF0YSBNaWdyYXRpb24nKSAmJiBvbldhaXRpbmdEYXRhTWlncmF0aW9uKSB7XG4gICAgICAgIG9uV2FpdGluZ0RhdGFNaWdyYXRpb24oKTtcbiAgICAgIH0gZWxzZSBpZiAoc3Rkb3V0LmluY2x1ZGVzKCdXYWl0aW5nIG9uIFN5c3RlbSBBcHAnKSAmJiBvbldhaXRpbmdTeXN0ZW1BcHApIHtcbiAgICAgICAgb25XYWl0aW5nU3lzdGVtQXBwKCk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbiAgYm9vdE1vbml0b3Iub24oJ2V4aXQnLCAoY29kZSwgc2lnbmFsKSA9PiB7XG4gICAgaWYgKHRpbWVvdXRIYW5kbGVyKSB7XG4gICAgICBjbGVhclRpbWVvdXQodGltZW91dEhhbmRsZXIpO1xuICAgIH1cbiAgICBpZiAoY29kZSA9PT0gMCkge1xuICAgICAgaWYgKG9uRmluaXNoZWQpIHtcbiAgICAgICAgb25GaW5pc2hlZCgpO1xuICAgICAgfVxuICAgICAgaXNCb290aW5nRmluaXNoZWQgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBzdGF0dXMgPSBzdGF0dXMgfHwgc2lnbmFsO1xuICAgICAgZXJyb3IgPSBuZXcgRXJyb3Ioc3RhdHVzKTtcbiAgICAgIGlmIChvbkVycm9yKSB7XG4gICAgICAgIG9uRXJyb3IoZXJyb3IpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG4gIGF3YWl0IGJvb3RNb25pdG9yLnN0YXJ0KDApO1xuICBjb25zdCBzdG9wTW9uaXRvciA9IGFzeW5jICgpID0+IHtcbiAgICBpZiAoYm9vdE1vbml0b3IuaXNSdW5uaW5nKSB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBib290TW9uaXRvci5zdG9wKCk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGxvZy53YXJuKGUubWVzc2FnZSk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICBjb25zdCB0aW1lU3RhcnRlZCA9IHByb2Nlc3MuaHJ0aW1lKCk7XG4gIGlmIChvbkZpbmlzaGVkKSB7XG4gICAgdGltZW91dEhhbmRsZXIgPSBzZXRUaW1lb3V0KHN0b3BNb25pdG9yLCB0aW1lb3V0KTtcbiAgfSBlbHNlIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgd2FpdEZvckNvbmRpdGlvbigoKSA9PiB7XG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpc0Jvb3RpbmdGaW5pc2hlZDtcbiAgICAgIH0sIHt3YWl0TXM6IHRpbWVvdXQsIGludGVydmFsTXM6IDUwMH0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgYXdhaXQgc3RvcE1vbml0b3IoKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIHNpbXVsYXRvciAke3VkaWR9IGhhcyBmYWlsZWQgdG8gZmluaXNoIGJvb3RpbmcgYWZ0ZXIgJHtwcm9jZXNzLmhydGltZSh0aW1lU3RhcnRlZClbMF19cy4gYCArXG4gICAgICAgIGBPcmlnaW5hbCBzdGF0dXM6ICR7c3RhdHVzfWApO1xuICAgIH1cbiAgfVxuICByZXR1cm4gYm9vdE1vbml0b3I7XG59XG5cblxuZXhwb3J0IHtcbiAgaW5zdGFsbEFwcCwgcmVtb3ZlQXBwLCBsYXVuY2gsIHNwYXduLCBzcGF3blN1YlByb2Nlc3MsIG9wZW5VcmwsIHRlcm1pbmF0ZSxcbiAgc2h1dGRvd24sIGNyZWF0ZURldmljZSwgZ2V0QXBwQ29udGFpbmVyLCBnZXRTY3JlZW5zaG90LCBkZWxldGVEZXZpY2UsXG4gIGVyYXNlRGV2aWNlLCBnZXREZXZpY2VzLCBnZXRSdW50aW1lRm9yUGxhdGZvcm1WZXJzaW9uLCBib290RGV2aWNlLFxuICBzZXRQYXN0ZWJvYXJkLCBnZXRQYXN0ZWJvYXJkLCBhZGRNZWRpYSwgYXBwSW5mbywgZ2V0RGV2aWNlVHlwZXMsXG4gIHN0YXJ0Qm9vdE1vbml0b3IsIGdldFNpbWN0bExpc3Rcbn07XG4iXSwiZmlsZSI6ImxpYi9zaW1jdGwuanMiLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
